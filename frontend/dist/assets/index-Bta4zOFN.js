import{j as t}from"./vendor-pdf-Cn0rG44s.js";import{a4 as _,r as n,G,S,Z as N,h as k,af as O}from"./vendor-antd-B8jUXf3i.js";import{b as V,u as I}from"./vendor-redux-rS0pI56E.js";import{F as q,G as J,I as K,z as U,J as C,A as X,B as Z,v as $,K as Q,L as Y,M as ee}from"./index-4IR4xblb.js";import"./vendor-canvas-DrFPvyt4.js";import{b as te,a as se,u as z}from"./vendor-react-DW9h-haf.js";import{S as ae}from"./vendor-antd-icons-BoTJB7uA.js";import"./vendor-http-t--hEgTQ.js";import"./vendor-ui-BmMA_ojr.js";const ie=({exhibitionId:i,destination:x="layout",label:f="Back to Layout"})=>{const c=z(),{currentExhibition:r}=I(s=>s.exhibition);return t.jsxs("div",{style:{marginBottom:"24px",position:"sticky",top:"16px",zIndex:10},children:[t.jsx(k,{icon:t.jsx(ae,{}),onClick:()=>c($(r,x),{state:{exhibitionId:i}}),type:"default",size:"large",style:{borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",background:"white",borderColor:"transparent",fontWeight:500,padding:"0 16px",height:"42px",display:"flex",alignItems:"center",transition:"all 0.3s ease"},className:"back-button-hover",children:t.jsx("span",{style:{marginLeft:8},children:f})}),t.jsx("style",{children:`
        .back-button-hover:hover {
          transform: translateX(-5px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: #f0f5ff;
          border-color: #d6e4ff;
        }
      `})]})},re=[{value:"all",label:"All Types"},{value:"sofa",label:"Sofas"},{value:"chair",label:"Chairs"},{value:"table",label:"Tables"},{value:"desk",label:"Desks"},{value:"plant",label:"Plants"},{value:"entrance",label:"Entrances"},{value:"exit",label:"Exits"},{value:"info",label:"Information"},{value:"restroom",label:"Restrooms"},{value:"food",label:"Food Areas"},{value:"custom",label:"Custom"}],me=()=>{var w,F,j;const{message:i}=_.useApp(),{id:x}=te(),f=se(),c=z(),r=V(),s=((w=f.state)==null?void 0:w.exhibitionId)||x,{currentExhibition:o,fixtures:p,halls:E,stalls:D,loading:oe}=I(e=>e.exhibition),l=n.useRef(null),[A,d]=n.useState(!1),[b,m]=n.useState(null),[u,B]=n.useState({width:0,height:0}),[h,R]=n.useState("all"),[H,g]=n.useState([]);n.useEffect(()=>{if(!s){i.error("Exhibition ID not found"),c("/exhibitions");return}},[s,c,i]),n.useEffect(()=>{(async()=>{try{await r(U(s)).unwrap(),await r(C({exhibitionId:s})).unwrap(),await r(X(s)).unwrap(),await r(Z({exhibitionId:s})).unwrap()}catch{i.error("Failed to load data")}})()},[s,r,i]),n.useEffect(()=>{g(h==="all"?p:p.filter(e=>e.type===h))},[p,h]),n.useEffect(()=>{const e=()=>{if(l.current){const{clientWidth:W,clientHeight:P}=l.current;B({width:Math.max(W||400,400),height:Math.max(P||400,400)})}};e();const a=new ResizeObserver(e);return l.current&&a.observe(l.current),window.addEventListener("resize",e),()=>{a.disconnect(),window.removeEventListener("resize",e)}},[]);const v=()=>{m(null),d(!0)},L=e=>{m(e),d(!!e)},y=async e=>{try{e.id||e._id?(await r(Q({exhibitionId:s,id:e.id||e._id||"",data:e})).unwrap(),i.success("Fixture updated successfully")):(await r(Y({exhibitionId:s,data:e})).unwrap(),i.success("Fixture created successfully")),await r(C({exhibitionId:s})).unwrap(),d(!1)}catch(a){console.error("Failed to save fixture:",a),i.error(a.message||"Failed to save fixture")}},M=async e=>{try{const a=e.id||e._id;if(!a)throw new Error("Fixture ID is required");await r(ee({exhibitionId:s,id:a})).unwrap(),i.success("Fixture deleted successfully"),d(!1),m(null)}catch(a){console.error("Failed to delete fixture:",a),i.error(a.message||"Failed to delete fixture")}},T=e=>{R(e)};return t.jsxs("div",{style:{padding:"24px",height:"100vh",display:"flex",flexDirection:"column"},children:[t.jsx(ie,{exhibitionId:s}),t.jsxs(G,{title:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(S,{children:t.jsx("span",{children:"Fixture Management"})}),t.jsxs(S,{children:[t.jsx(N,{style:{width:180},value:h,onChange:T,options:re}),t.jsx(k,{type:"primary",icon:t.jsx(O,{}),onClick:v,children:"Add Fixture"})]})]}),styles:{body:{flex:1,padding:0,overflow:"hidden",minHeight:"400px",position:"relative",background:"#fafafa"}},style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:"500px"},children:[t.jsx("div",{style:{padding:"8px 16px",background:"#f0f7ff",borderBottom:"1px solid #d6e8ff",color:"#0050b3",fontSize:"14px"},children:"Halls and stalls are shown for reference. Place fixtures relative to these elements to enhance visitor navigation."}),t.jsx("div",{ref:l,style:{position:"absolute",top:33,left:0,right:0,bottom:0,overflow:"hidden"},children:t.jsx(q,{children:u.width>0&&u.height>0&&(o==null?void 0:o.dimensions)&&t.jsx(J,{width:u.width,height:u.height,exhibitionWidth:o.dimensions.width,exhibitionHeight:o.dimensions.height,halls:E,stalls:D,fixtures:H,selectedFixture:b,onSelectFixture:L,onFixtureChange:y,onAddFixture:v,isFixtureMode:!0})})})]}),t.jsx(K,{visible:A,fixture:b,onCancel:()=>d(!1),onSubmit:y,onDelete:M,exhibitionWidth:((F=o==null?void 0:o.dimensions)==null?void 0:F.width)||100,exhibitionHeight:((j=o==null?void 0:o.dimensions)==null?void 0:j.height)||100})]})};export{me as default};
