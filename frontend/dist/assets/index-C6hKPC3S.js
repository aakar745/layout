import{w as v,B as H,j as s}from"./index-DoSueJxk.js";import{u as pe,l as ge,k as fe,r as o,R as P}from"./vendor-react-dkbxt9Jf.js";import{u as B,w as ye}from"./vendor-export-PCv_shhx.js";import{c as p}from"./stallUtils-DlikgrX5.js";/* empty css                  */import{$,a0 as r,S as X,T as je,c as Y,aQ as G,ab as N,J as ve,ar as we,a1 as be,aq as F,aR as R,az as Ae,ai as Ce,b as Te,W as V}from"./vendor-antd-mFVHvrVJ.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const{Title:Pe,Text:ke}=je,{Option:y}=N,Re=()=>{pe();const g=ge(),{stalls:Z,loading:ee,stallsPagination:_}=fe(e=>e.exhibition),[O,te]=o.useState([]),[x,z]=o.useState([]),[l,se]=o.useState(null),[a,D]=o.useState(null),[ae,k]=o.useState(!1),[L,w]=o.useState({totalStalls:0,totalArea:0}),[d,le]=o.useState(""),[h,ie]=o.useState(null),[u,ne]=o.useState("number"),[m,oe]=o.useState("ascend"),[W,b]=o.useState(1),[S,re]=o.useState(10),J=P.useRef({statusFilter:h,sortField:u,sortOrder:m,pageSize:S});P.useEffect(()=>{J.current={statusFilter:h,sortField:u,sortOrder:m,pageSize:S}},[h,u,m,S]);const A=P.useCallback(async()=>{if(!l||!a){w({totalStalls:0,totalArea:0});return}try{const e={page:1,limit:1e4,search:d||void 0,status:h||void 0,sortBy:u,sortOrder:m==="ascend"?"asc":"desc"},n=(a==="all"?await v.getStalls(l,void 0,e):await v.getStalls(l,a,e)).data,f=n&&typeof n=="object"&&"stalls"in n?n.stalls:n,C=f.reduce((E,j)=>j?.dimensions?.width&&j?.dimensions?.height?E+j.dimensions.width*j.dimensions.height:E,0);w({totalStalls:f.length,totalArea:C})}catch(e){console.error("Failed to fetch total stats:",e),w({totalStalls:0,totalArea:0})}},[l,a,d,h,u,m]),I=P.useCallback(e=>{l&&a&&(g(H({exhibitionId:l,hallId:a==="all"?void 0:a,page:e.page||W,limit:e.size||S,search:e.search||void 0,status:e.status||void 0,sortBy:e.sortBy||u,sortOrder:e.sortOrder||(m==="ascend"?"asc":"desc")})),A())},[g,l,a,W,S,u,m,A]);P.useEffect(()=>{if(!l||!a)return;const e=setTimeout(()=>{if(l&&a){const t=J.current;g(H({exhibitionId:l,hallId:a==="all"?void 0:a,page:1,limit:t.pageSize,search:d||void 0,status:t.statusFilter||void 0,sortBy:t.sortField,sortOrder:t.sortOrder==="ascend"?"asc":"desc"})),b(1),A()}},500);return()=>clearTimeout(e)},[d,l,a,g,A]);const ce=e=>{ie(e),b(1),I({page:1,search:d||void 0,status:e})},de=(e,t)=>{ne(e),oe(t),b(1),I({page:1,search:d||void 0,status:h,sortBy:e,sortOrder:t==="ascend"?"asc":"desc"})},M=(e,t)=>{b(e),t&&t!==S&&re(t),I({page:e,size:t||S,search:d||void 0,status:h})},Q=async(e=!0)=>{try{let t=q;if(e&&l&&a){const i={page:1,limit:1e4,search:d||void 0,status:h||void 0,sortBy:u,sortOrder:m==="ascend"?"asc":"desc"},T=(a==="all"?await v.getStalls(l,void 0,i):await v.getStalls(l,a,i)).data;t=T&&typeof T=="object"&&"stalls"in T?T.stalls:T}const n=t.map(i=>({"Stall Number":i.number,Hall:x.find(U=>U._id===i.hallId)?.name||"N/A","Stall Type":i.stallType?.name||"N/A","Dimensions (W×H)":`${i.dimensions.width}×${i.dimensions.height}`,"Area (sq.m)":p(i.dimensions),"Rate per Sq.m":`₹${i.ratePerSqm.toLocaleString()}`,"Total Price":`₹${(i.ratePerSqm*p(i.dimensions)).toLocaleString()}`,Status:i.status.charAt(0).toUpperCase()+i.status.slice(1),"Position (X,Y)":`${i.dimensions.x},${i.dimensions.y}`,"Created Date":new Date(i.createdAt||Date.now()).toLocaleDateString()})),c=B.book_new(),f=B.json_to_sheet(n),C=[{wch:15},{wch:20},{wch:15},{wch:15},{wch:12},{wch:15},{wch:18},{wch:12},{wch:15},{wch:15}];f["!cols"]=C,B.book_append_sheet(c,f,"Stalls");const E=O.find(i=>i._id===l)?.name||"Exhibition",j=a==="all"?"All-Halls":x.find(i=>i._id===a)?.name||"Hall",xe=new Date().toISOString().split("T")[0],Se=`${E}-${j}-Stalls-${xe}.xlsx`;ye(c,Se),V.success(`Exported ${t.length} stalls to Excel successfully!`)}catch(t){console.error("Export failed:",t),V.error("Failed to export stalls. Please try again.")}},he=e=>{se(e),D(null),g({type:"exhibition/clearStalls"}),w({totalStalls:0,totalArea:0})},ue=e=>{D(e),b(1),l&&e?(g(H({exhibitionId:l,hallId:e==="all"?void 0:e,page:1,limit:S,search:d||void 0,status:h||void 0,sortBy:u,sortOrder:m==="ascend"?"asc":"desc"})),A()):(g({type:"exhibition/clearStalls"}),w({totalStalls:0,totalArea:0}))};o.useEffect(()=>{(async()=>{try{k(!0),console.log("Fetching exhibitions...");const t=await v.getActiveExhibitions();console.log("Exhibitions response:",t.data),te(t.data)}catch(t){console.error("Failed to fetch exhibitions:",t)}finally{k(!1)}})()},[]),o.useEffect(()=>{l?(async()=>{try{k(!0),console.log("Fetching halls for exhibition:",l);const t=await v.getHalls(l);console.log("Halls response:",t.data),z(t.data)}catch(t){console.error("Failed to fetch halls:",t)}finally{k(!1)}})():z([])},[l]);const q=Z,me=e=>{switch(e){case"available":return"success";case"booked":return"warning";case"reserved":return"processing";case"sold":return"error";default:return"default"}},K={totalStalls:L.totalStalls,totalSize:L.totalArea};return s.jsx("div",{className:"dashboard-container",children:s.jsx("div",{style:{marginBottom:"24px"},children:s.jsxs($,{gutter:[24,24],children:[s.jsx(r,{span:24,children:s.jsxs($,{justify:"space-between",align:"middle",children:[s.jsx(r,{children:s.jsxs(X,{direction:"vertical",size:4,children:[s.jsx(Pe,{level:4,style:{margin:0},children:"Stalls"}),s.jsx(ke,{type:"secondary",children:"Manage your exhibition stalls"})]})}),s.jsx(r,{children:s.jsxs(X,{children:[s.jsx(Y,{icon:s.jsx(G,{}),onClick:()=>Q(!1),disabled:!a||q.length===0,children:"Export Current Page"}),s.jsx(Y,{type:"primary",icon:s.jsx(G,{}),onClick:()=>Q(!0),disabled:!a,children:"Export All Stalls"})]})})]})}),s.jsx(r,{span:24,children:s.jsxs($,{gutter:[16,16],align:"middle",children:[s.jsx(r,{xs:24,sm:12,md:6,children:s.jsx(N,{style:{width:"100%"},placeholder:"Select Exhibition",value:l,onChange:he,allowClear:!0,children:O.map(e=>s.jsx(y,{value:e._id||e.id,children:e.name},e._id||e.id))})}),s.jsx(r,{xs:24,sm:12,md:6,children:s.jsxs(N,{style:{width:"100%"},placeholder:"Select Hall",value:a,onChange:ue,disabled:!l||x.length===0,allowClear:!0,children:[s.jsxs(y,{value:"all",children:["All Halls (",x.length," halls)"]},"all-halls"),x.map(e=>s.jsx(y,{value:e._id||e.id,children:e.name},e._id||e.id))]})}),s.jsx(r,{xs:24,sm:12,md:6,children:s.jsx(ve,{placeholder:"Search by stall number",prefix:s.jsx(we,{}),value:d,onChange:e=>le(e.target.value),allowClear:!0})}),s.jsx(r,{xs:24,sm:12,md:6,children:s.jsxs(N,{style:{width:"100%"},placeholder:"Filter by status",value:h,onChange:ce,allowClear:!0,children:[s.jsx(y,{value:"available",children:"Available"}),s.jsx(y,{value:"booked",children:"Booked"}),s.jsx(y,{value:"reserved",children:"Reserved"}),s.jsx(y,{value:"sold",children:"Sold"})]})})]})}),s.jsx(r,{span:24,children:s.jsx(be,{size:"small",children:s.jsxs($,{gutter:16,children:[s.jsx(r,{xs:12,sm:12,md:6,children:s.jsx(F,{title:"Total Stalls",value:K.totalStalls,prefix:s.jsx(R,{})})}),s.jsx(r,{xs:12,sm:12,md:6,children:s.jsx(F,{title:"Total Area",value:K.totalSize,suffix:"sqm",prefix:s.jsx(Ae,{}),precision:2})}),a==="all"&&s.jsx(r,{xs:12,sm:12,md:6,children:s.jsx(F,{title:"Halls",value:x.length,prefix:s.jsx(R,{})})}),a!=="all"&&a&&s.jsx(r,{xs:12,sm:12,md:6,children:s.jsx(F,{title:"Current Hall",value:x.find(e=>(e._id||e.id)===a)?.name||"N/A",prefix:s.jsx(R,{})})})]})})}),s.jsx(r,{span:24,children:s.jsx(Ce,{columns:[{title:"Stall Number",dataIndex:"number",key:"number",sorter:(e,t)=>e.number.localeCompare(t.number),defaultSortOrder:"ascend"},...a==="all"?[{title:"Hall",key:"hall",render:(e,t)=>x.find(c=>(c._id||c.id)===t.hallId)?.name||"N/A"}]:[],{title:"Type",dataIndex:["stallType","name"],key:"type",render:(e,t)=>t.stallType?.name||"N/A"},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"ratePerSqm",render:e=>e?`₹${e.toLocaleString()}`:"N/A",sorter:(e,t)=>(e.ratePerSqm||0)-(t.ratePerSqm||0)},{title:"Area (sqm)",key:"area",render:(e,t)=>t?.dimensions?`${p(t.dimensions)} sqm`:"N/A",sorter:(e,t)=>{const n=e.dimensions?p(e.dimensions):0,c=t.dimensions?p(t.dimensions):0;return n-c}},{title:"Dimensions",key:"dimensions",render:(e,t)=>t?.dimensions?.width&&t?.dimensions?.height?`${t.dimensions.width}m × ${t.dimensions.height}m`:"N/A"},{title:"Total Price",key:"totalPrice",render:(e,t)=>{if(t?.dimensions&&t.ratePerSqm){const n=p(t.dimensions);return`₹${(t.ratePerSqm*n).toLocaleString()}`}return"N/A"},sorter:(e,t)=>{const n=e.dimensions?p(e.dimensions):0,c=t.dimensions?p(t.dimensions):0,f=(e.ratePerSqm||0)*n,C=(t.ratePerSqm||0)*c;return f-C}},{title:"Status",dataIndex:"status",key:"status",render:e=>s.jsx(Te,{color:me(e),style:{textTransform:"capitalize"},children:e||"N/A"}),filters:[{text:"Available",value:"available"},{text:"Booked",value:"booked"},{text:"Reserved",value:"reserved"},{text:"Sold",value:"sold"}],onFilter:(e,t)=>t.status===e}],dataSource:q,rowKey:e=>e._id||e.id,loading:ae||ee,pagination:{current:_.currentPage,pageSize:_.pageSize,total:_.totalCount,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} stalls`,onChange:M,onShowSizeChange:M,pageSizeOptions:["10","25","50","100"]},onChange:(e,t,n)=>{n.field&&n.order&&de(n.field,n.order)}})})]})})})};export{Re as default};
