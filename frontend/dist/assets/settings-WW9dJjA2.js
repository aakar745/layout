import{j as e,G as ne}from"./index-BfjvBafq.js";import{r as p,u as ae,X as oe}from"./vendor-react-BNeW3y6d.js";/* empty css                       */import{N as a,X as o,T as ce,l as K,c as x,a5 as y,a6 as c,a7 as S,a4 as M,b as O,S as k,aa as q,K as w,Q as le,W as de,aj as he,am as pe,b5 as ge,Z as xe,$ as ye,D as ue,b6 as me,bv as fe,R as ve}from"./vendor-antd-sZZBSykP.js";import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:W,Text:l,Paragraph:T}=ce,{Option:je}=M,{TextArea:H}=w,ke=()=>{var F,B,_,R,D,L,U,V;const[u,C]=p.useState([]),[s,f]=p.useState(null),[J,z]=p.useState(!1),[X,A]=p.useState(!1),[G,v]=p.useState(!1),[m,P]=p.useState(null),$=ae(),[E]=oe(),[j]=a.useForm(),[I]=a.useForm();p.useEffect(()=>{Q()},[]),p.useEffect(()=>{const i=E.get("exhibition");if(i&&u.length>0){const r=u.find(n=>n._id===i);r&&(f(r),N(r))}},[E,u]);const Q=async()=>{z(!0);try{const i=await fetch("/api/exhibitions",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(i.ok){const r=await i.json();C(Array.isArray(r)?r:r.data||[])}else o.error("Failed to fetch exhibitions")}catch(i){console.error("Error fetching exhibitions:",i),o.error("Error fetching exhibitions")}finally{z(!1)}},N=i=>{const r=i.serviceChargeConfig||{isEnabled:!1,title:"Service Charges",description:"Pay service charges for stall positioning and setup",razorpayKeyId:""};j.setFieldsValue({isEnabled:r.isEnabled,title:r.title,description:r.description,razorpayKeyId:r.razorpayKeyId||""})},Y=i=>{const r=u.find(n=>n._id===i);if(r){f(r),N(r);const n=new URLSearchParams(E);n.set("exhibition",i),$(`?${n.toString()}`,{replace:!0})}},Z=async i=>{var r;if(!s){o.error("Please select an exhibition");return}A(!0);try{const n={...i,serviceTypes:((r=s.serviceChargeConfig)==null?void 0:r.serviceTypes)||[]},d=await fetch(`/api/service-charges/config/${s._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(n)});if(d.ok)o.success("Configuration saved successfully"),C(t=>t.map(b=>b._id===s._id?{...b,serviceChargeConfig:n}:b)),f(t=>t?{...t,serviceChargeConfig:n}:null);else{const t=await d.json();o.error(t.message||"Failed to save configuration")}}catch(n){console.error("Error saving configuration:",n),o.error("Error saving configuration")}finally{A(!1)}},ee=()=>{P(null),I.resetFields(),v(!0)},ie=i=>{P(i),I.setFieldsValue(i),v(!0)},re=async i=>{var d;if(!s)return;const r=((d=s.serviceChargeConfig)==null?void 0:d.serviceTypes)||[];let n;if(m)n=r.map(t=>t.name===m.name?i:t);else{if(r.some(t=>t.name===i.name)){o.error("Service type with this name already exists");return}n=[...r,i]}try{const t={...j.getFieldsValue(),serviceTypes:n};(await fetch(`/api/service-charges/config/${s._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)})).ok?(o.success(`Service type ${m?"updated":"added"} successfully`),C(h=>h.map(g=>g._id===s._id?{...g,serviceChargeConfig:t}:g)),f(h=>h?{...h,serviceChargeConfig:t}:null),v(!1)):o.error("Failed to save service type")}catch(t){console.error("Error saving service type:",t),o.error("Error saving service type")}},se=async i=>{var d;if(!s)return;const n=(((d=s.serviceChargeConfig)==null?void 0:d.serviceTypes)||[]).filter(t=>t.name!==i);try{const t={...j.getFieldsValue(),serviceTypes:n};(await fetch(`/api/service-charges/config/${s._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)})).ok?(o.success("Service type deleted successfully"),C(h=>h.map(g=>g._id===s._id?{...g,serviceChargeConfig:t}:g)),f(h=>h?{...h,serviceChargeConfig:t}:null)):o.error("Failed to delete service type")}catch(t){console.error("Error deleting service type:",t),o.error("Error deleting service type")}},te=[{title:"Name",dataIndex:"name",key:"name",render:i=>e.jsx(l,{strong:!0,children:i})},{title:"Amount",dataIndex:"amount",key:"amount",render:i=>e.jsxs(l,{children:["â‚¹",i.toLocaleString("en-IN")]})},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0},{title:"Status",dataIndex:"isActive",key:"isActive",render:i=>e.jsx(O,{color:i?"green":"red",children:i?"Active":"Inactive"})},{title:"Actions",key:"actions",width:120,render:i=>e.jsxs(k,{children:[e.jsx(x,{type:"text",size:"small",icon:e.jsx(me,{}),onClick:()=>ie(i)}),e.jsx(fe,{title:"Are you sure you want to delete this service type?",onConfirm:()=>se(i.name),okText:"Yes",cancelText:"No",children:e.jsx(x,{type:"text",size:"small",icon:e.jsx(ve,{}),danger:!0})})]})}];return e.jsxs("div",{className:"service-charges-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs(W,{level:2,children:[e.jsx(K,{})," Service Charge Settings"]}),e.jsx(x,{onClick:()=>$("/service-charges"),children:"Back to Service Charges"})]}),e.jsxs(y,{gutter:24,children:[e.jsx(c,{span:8,children:e.jsxs(S,{title:"Select Exhibition",loading:J,style:{height:"fit-content"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(l,{type:"secondary",style:{fontSize:"14px"},children:"Choose an exhibition to configure service charges"})}),e.jsx(M,{placeholder:"Choose an exhibition...",style:{width:"100%",marginBottom:16},value:s==null?void 0:s._id,onChange:Y,showSearch:!0,optionFilterProp:"children",dropdownStyle:{maxHeight:400,overflow:"auto",padding:"4px"},size:"large",filterOption:(i,r)=>{const n=u.find(t=>t._id===(r==null?void 0:r.value));return n?`${n.name} ${n.venue}`.toLowerCase().includes(i.toLowerCase()):!1},children:u.map(i=>e.jsx(je,{value:i._id,children:e.jsxs("div",{style:{padding:"8px 4px",lineHeight:"1.4"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:"#1d1d1d",marginBottom:"2px"},children:i.name}),e.jsx("div",{style:{fontSize:"12px",color:"#8c8c8c",maxWidth:"280px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.venue&&i.venue.length>25?`${i.venue.substring(0,25)}...`:i.venue||"No venue specified"})]})},i._id))}),s&&e.jsxs("div",{style:{marginTop:16,padding:16,background:"#f9f9f9",borderRadius:8,border:"1px solid #e8e8e8"},children:[e.jsx("div",{style:{marginBottom:12},children:e.jsx(l,{strong:!0,style:{fontSize:"16px",color:"#1d1d1d"},children:s.name})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(l,{type:"secondary",style:{fontSize:"13px"},children:[e.jsx("strong",{children:"Venue:"})," ",s.venue]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,paddingTop:12,borderTop:"1px solid #e8e8e8"},children:[e.jsxs("div",{children:[e.jsx(l,{type:"secondary",style:{fontSize:"12px"},children:"Status:"}),e.jsx("br",{}),e.jsx(O,{color:(F=s.serviceChargeConfig)!=null&&F.isEnabled?"green":"red",children:(B=s.serviceChargeConfig)!=null&&B.isEnabled?"Enabled":"Disabled"})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(l,{type:"secondary",style:{fontSize:"12px"},children:"Service Types:"}),e.jsx("br",{}),e.jsx(l,{strong:!0,style:{fontSize:"16px",color:"#1890ff"},children:((R=(_=s.serviceChargeConfig)==null?void 0:_.serviceTypes)==null?void 0:R.length)||0})]})]})]})]})}),e.jsx(c,{span:16,children:s?e.jsxs(k,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs(S,{title:"Basic Configuration",extra:e.jsx(x,{type:"primary",icon:e.jsx(he,{}),loading:X,onClick:()=>j.submit(),children:"Save Configuration"}),children:[e.jsxs(a,{form:j,layout:"vertical",onFinish:Z,children:[e.jsx(y,{gutter:16,children:e.jsx(c,{span:24,children:e.jsx(a.Item,{name:"isEnabled",label:"Enable Service Charges",valuePropName:"checked",children:e.jsx(q,{checkedChildren:"Enabled",unCheckedChildren:"Disabled"})})})}),e.jsxs(y,{gutter:16,children:[e.jsx(c,{span:12,children:e.jsx(a.Item,{name:"title",label:"Title",rules:[{required:!0,message:"Please enter a title"}],children:e.jsx(w,{placeholder:"e.g., Service Charges"})})}),e.jsx(c,{span:12,children:e.jsx(a.Item,{name:"razorpayKeyId",label:"Razorpay Key ID (Optional)",tooltip:"Leave empty to use default Razorpay credentials",children:e.jsx(w,{placeholder:"rzp_live_..."})})})]}),e.jsx(y,{gutter:16,children:e.jsx(c,{span:24,children:e.jsx(a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:e.jsx(H,{rows:3,placeholder:"Brief description of the service charges"})})})})]}),e.jsx(le,{message:"Configuration Note",description:"When service charges are enabled, a public form will be available for vendors to make payments without logging in. The form link will be available in the public exhibition view.",type:"info",icon:e.jsx(de,{}),style:{marginTop:16}})]}),e.jsx(S,{title:"Service Types",extra:e.jsx(x,{type:"primary",icon:e.jsx(ge,{}),onClick:ee,disabled:!((D=s.serviceChargeConfig)!=null&&D.isEnabled),children:"Add Service Type"}),children:e.jsx(pe,{columns:te,dataSource:((L=s.serviceChargeConfig)==null?void 0:L.serviceTypes)||[],rowKey:"name",size:"small",locale:{emptyText:(U=s.serviceChargeConfig)!=null&&U.isEnabled?'No service types configured. Click "Add Service Type" to get started.':"Enable service charges to configure service types."}})}),((V=s.serviceChargeConfig)==null?void 0:V.isEnabled)&&e.jsxs(S,{title:"Public Form Access",children:[e.jsx(T,{children:e.jsx(l,{strong:!0,children:"Public Form URL:"})}),e.jsx(T,{copyable:!0,children:`${window.location.origin}${ne(s,"service-charge")}`}),e.jsx(T,{type:"secondary",children:"This URL can be shared with vendors to access the service charge payment form directly. No login is required for vendors to use this form."})]})]}):e.jsx(S,{style:{minHeight:400},children:e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},children:[e.jsx(K,{style:{fontSize:64,color:"#d9d9d9",marginBottom:24}}),e.jsx(W,{level:3,type:"secondary",style:{marginBottom:16},children:"Select an Exhibition"}),e.jsx(T,{type:"secondary",style:{fontSize:"16px",maxWidth:400,lineHeight:1.6},children:"Choose an exhibition from the dropdown to configure service charges, payment settings, and service types for vendors."}),e.jsx("div",{style:{marginTop:24,padding:16,background:"#f8f9fa",borderRadius:8,border:"1px solid #e9ecef"},children:e.jsxs(l,{type:"secondary",style:{fontSize:"14px"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Enable service charges to allow vendors to make payments directly without logging in to the system."]})})]})})})]}),e.jsx(xe,{title:`${m?"Edit":"Add"} Service Type`,open:G,onCancel:()=>v(!1),footer:null,width:600,children:e.jsxs(a,{form:I,layout:"vertical",onFinish:re,children:[e.jsxs(y,{gutter:16,children:[e.jsx(c,{span:12,children:e.jsx(a.Item,{name:"name",label:"Service Name",rules:[{required:!0,message:"Please enter service name"},{max:50,message:"Name cannot exceed 50 characters"}],children:e.jsx(w,{placeholder:"e.g., Stall Positioning",disabled:!!m})})}),e.jsx(c,{span:12,children:e.jsx(a.Item,{name:"amount",label:"Amount (â‚¹)",rules:[{required:!0,message:"Please enter amount"},{type:"number",min:1,message:"Amount must be greater than 0"}],children:e.jsx(ye,{style:{width:"100%"},placeholder:"0",min:1,max:1e5,formatter:i=>`â‚¹ ${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:i=>Number((i==null?void 0:i.replace(/â‚¹\s?|(,*)/g,""))||0)})})})]}),e.jsx(y,{gutter:16,children:e.jsx(c,{span:24,children:e.jsx(a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter description"},{max:200,message:"Description cannot exceed 200 characters"}],children:e.jsx(H,{rows:3,placeholder:"Brief description of this service"})})})}),e.jsx(y,{gutter:16,children:e.jsx(c,{span:24,children:e.jsx(a.Item,{name:"isActive",label:"Status",valuePropName:"checked",initialValue:!0,children:e.jsx(q,{checkedChildren:"Active",unCheckedChildren:"Inactive"})})})}),e.jsx(ue,{}),e.jsx(a.Item,{children:e.jsxs(k,{children:[e.jsxs(x,{type:"primary",htmlType:"submit",children:[m?"Update":"Add"," Service Type"]}),e.jsx(x,{onClick:()=>v(!1),children:"Cancel"})]})})]})})]})};export{ke as default};
