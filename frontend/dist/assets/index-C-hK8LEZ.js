import{j as e,l as K,m as O,n as q,r as Y}from"./index-ZeXq6Cnq.js";import{r as x,j as J,i as Q}from"./vendor-react-BNeW3y6d.js";import{H as w,W as z,I as C,D as X,a5 as V,a6 as M,a7 as B,J as $,T as L,S as v,c as _,ae as Z,aT as ee,aj as se,A as ie,a as F,aU as te,R as le,K as re,aV as oe,an as ne}from"./vendor-antd-DmzwxccF.js";import{u as ae}from"./reduxHooks-D3iepLCM.js";import"./vendor-utils-D9BQhWAM.js";import"./vendor-styling-C4kvkEn0.js";import"./vendor-canvas-BRbMLhVA.js";const{Text:U}=L,ce=[{key:"dashboard_view",label:"View Dashboard",group:"Dashboard"},{key:"dashboard_manage",label:"Manage Dashboard",group:"Dashboard"},{key:"users_view",label:"View Users",group:"Users"},{key:"users_create",label:"Create Users",group:"Users"},{key:"users_edit",label:"Edit Users",group:"Users"},{key:"users_delete",label:"Delete Users",group:"Users"},{key:"roles_view",label:"View Roles",group:"Roles"},{key:"roles_create",label:"Create Roles",group:"Roles"},{key:"roles_edit",label:"Edit Roles",group:"Roles"},{key:"roles_delete",label:"Delete Roles",group:"Roles"},{key:"exhibitions_view",label:"View Exhibitions",group:"Exhibitions"},{key:"exhibitions_create",label:"Create Exhibitions",group:"Exhibitions"},{key:"exhibitions_edit",label:"Edit Exhibitions",group:"Exhibitions"},{key:"exhibitions_delete",label:"Delete Exhibitions",group:"Exhibitions"},{key:"amenities_view",label:"View Amenities",group:"Amenities"},{key:"amenities_create",label:"Create Amenities",group:"Amenities"},{key:"amenities_edit",label:"Edit Amenities",group:"Amenities"},{key:"amenities_delete",label:"Delete Amenities",group:"Amenities"},{key:"bookings_view",label:"View Bookings",group:"Bookings"},{key:"bookings_create",label:"Create Bookings",group:"Bookings"},{key:"bookings_edit",label:"Edit Bookings",group:"Bookings"},{key:"bookings_delete",label:"Delete Bookings",group:"Bookings"},{key:"invoices_view",label:"View Invoices",group:"Invoices"},{key:"invoices_create",label:"Create Invoices",group:"Invoices"},{key:"invoices_edit",label:"Edit Invoices",group:"Invoices"},{key:"invoices_delete",label:"Delete Invoices",group:"Invoices"},{key:"exhibitors_view",label:"View Exhibitors",group:"Exhibitors"},{key:"exhibitors_create",label:"Create Exhibitors",group:"Exhibitors"},{key:"exhibitors_edit",label:"Edit Exhibitors",group:"Exhibitors"},{key:"exhibitors_delete",label:"Delete Exhibitors",group:"Exhibitors"},{key:"settings_view",label:"View Settings",group:"Settings"},{key:"settings_edit",label:"Edit Settings",group:"Settings"}],T=ce.reduce((r,o)=>(r[o.group]||(r[o.group]=[]),r[o.group].push({key:o.key,label:o.label}),r),{}),de=({visible:r,onCancel:o,onSave:u,role:n,loading:j})=>{const[a]=w.useForm(),g=!!n,[c,b]=x.useState([]);x.useEffect(()=>{if(r)if(n){const t=n.permissions||[];a.setFieldsValue({name:n.name,description:n.description,permissions:t}),b(t)}else a.resetFields(),b([])},[r,n,a]);const p=()=>{a.setFieldsValue({permissions:c}),a.validateFields().then(t=>{u(t)})},k=t=>{const d=T[t].map(l=>l.key);return d.length>0&&d.every(l=>c.includes(l))},R=(t,d)=>{let l;d?l=[...c,t]:l=c.filter(h=>h!==t),b(l)},f=(t,d)=>{const l=T[t].map(m=>m.key);let h;if(d){const m=l.filter(I=>!c.includes(I));h=[...c,...m]}else h=c.filter(m=>!l.includes(m));b(h)},S=t=>c.includes(t);return e.jsx(z,{title:g?"Edit Role":"Add New Role",open:r,onCancel:o,width:700,footer:[e.jsx(_,{onClick:o,children:"Cancel"},"cancel"),e.jsx(_,{type:"primary",loading:j,onClick:p,children:g?"Update":"Create"},"submit")],children:e.jsxs(w,{form:a,layout:"vertical",initialValues:{name:"",description:"",permissions:[]},children:[e.jsx(w.Item,{name:"name",label:"Role Name",rules:[{required:!0,message:"Please enter a role name"}],children:e.jsx(C,{placeholder:"e.g., Administrator, Editor, Viewer"})}),e.jsx(w.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please provide a description"}],children:e.jsx(C.TextArea,{placeholder:"Describe the purpose of this role",rows:3})}),e.jsx(X,{plain:!0,children:"Permissions"}),e.jsx(w.Item,{name:"permissions",hidden:!0,children:e.jsx(C,{})}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 8px"},children:Object.entries(T).map(([t,d])=>e.jsx(V,{size:"small",title:e.jsxs(v,{children:[e.jsx(U,{strong:!0,children:t}),e.jsx($,{checked:k(t),onChange:l=>f(t,l.target.checked),children:"Select All"})]}),style:{marginBottom:16},children:e.jsx(M,{gutter:[16,12],children:d.map(l=>e.jsx(B,{span:12,children:e.jsx($,{checked:S(l.key),onChange:h=>R(l.key,h.target.checked),children:e.jsx(U,{children:l.label})})},l.key))})},t))})]})})},{Title:A,Paragraph:W,Text:y}=L,{confirm:he}=z;function D({allowed:r}){return r?e.jsx(re,{className:"text-success",style:{color:"#52c41a",fontSize:16}}):e.jsx(oe,{className:"text-danger",style:{color:"#f5222d",fontSize:16}})}function je(){const{message:r,notification:o}=Z.useApp(),u=J(),{roles:n,loading:j,error:a}=Q(s=>s.role),[g,c]=x.useState(""),[b,p]=x.useState(!1),[k,R]=x.useState(null),{hasPermission:f}=ae();x.useEffect(()=>{u(K())},[u]),x.useEffect(()=>{a&&o.error({message:"Error",description:a})},[a,o]);const S=()=>{R(null),p(!0)},t=s=>{R(s),p(!0)},d=s=>{k?u(O({id:k._id,roleData:s})).unwrap().then(()=>{p(!1),r.success("Role updated successfully")}).catch(i=>{r.error(`Failed to update role: ${i.message}`)}):u(q(s)).unwrap().then(()=>{p(!1),r.success("Role created successfully")}).catch(i=>{r.error(`Failed to create role: ${i.message}`)})},l=s=>{he({title:"Are you sure you want to delete this role?",icon:e.jsx(ne,{}),content:`This will permanently delete the ${s.name} role. This action cannot be undone.`,okText:"Yes, delete it",okType:"danger",cancelText:"Cancel",onOk(){u(Y(s._id)).unwrap().then(()=>{r.success(`${s.name} role deleted successfully`)}).catch(i=>{r.error(`Failed to delete role: ${i.message}`)})}})},h=[{title:"Role",dataIndex:"name",key:"name",render:(s,i)=>e.jsxs(v,{children:[e.jsx(ie,{style:{backgroundColor:N(i.name)},children:s.charAt(0).toUpperCase()}),e.jsx(y,{strong:!0,children:s})]})},{title:"Description",dataIndex:"description",key:"description",render:s=>e.jsx(y,{type:"secondary",children:s})},{title:"Read",key:"read",align:"center",render:(s,i)=>e.jsx(D,{allowed:m(i)})},{title:"Write",key:"write",align:"center",render:(s,i)=>e.jsx(D,{allowed:I(i)})},{title:"Delete",key:"delete",align:"center",render:(s,i)=>e.jsx(D,{allowed:G(i)})},{title:"Actions",key:"actions",align:"right",render:(s,i)=>e.jsxs(v,{children:[f("roles_edit")&&e.jsx(F,{title:i.name==="Administrator"?"Administrator role cannot be edited":"Edit role",children:e.jsx(_,{type:"primary",shape:"circle",icon:e.jsx(te,{}),size:"small",onClick:()=>t(i),disabled:i.name==="Administrator"})}),f("roles_delete")&&e.jsx(F,{title:"Delete role",children:e.jsx(_,{danger:!0,shape:"circle",icon:e.jsx(le,{}),size:"small",onClick:()=>l(i),disabled:i.name==="Administrator"})})]})}],m=s=>s.permissions.some(i=>i.endsWith("_view")),I=s=>s.permissions.some(i=>i.endsWith("_create")||i.endsWith("_edit")),G=s=>s.permissions.some(i=>i.endsWith("_delete")),N=s=>{const i=["#1677ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#eb2f96"];let E=0;for(let P=0;P<s.length;P++)E=s.charCodeAt(P)+((E<<5)-E);return i[Math.abs(E)%i.length]},H=n.filter(s=>s.name.toLowerCase().includes(g.toLowerCase())||s.description.toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{style:{padding:"12px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(A,{level:2,children:"Roles & Permissions"}),e.jsx(W,{children:"Manage role-based access control and permissions for your users."})]}),e.jsxs(V,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},loading:j&&n.length===0,children:[e.jsxs(M,{gutter:16,style:{marginBottom:16},children:[e.jsx(B,{span:16,children:e.jsx(C,{placeholder:"Search roles...",allowClear:!0,value:g,onChange:s=>c(s.target.value),prefix:e.jsx(y,{type:"secondary",style:{fontSize:16},children:"ðŸ”"})})}),e.jsx(B,{span:8,style:{textAlign:"right"},children:f("roles_create")&&e.jsx(_,{type:"primary",icon:e.jsx(ee,{}),style:{borderRadius:6},onClick:S,children:"Add Role"})})]}),e.jsx(se,{columns:h,dataSource:H,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(s,i)=>`Showing ${i[0]}-${i[1]} of ${s} roles`},style:{marginTop:8},loading:j&&n.length>0})]}),e.jsx(V,{title:e.jsx(A,{level:4,style:{margin:0},children:"Role Management Tips"}),style:{marginTop:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[e.jsxs(v,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(A,{level:5,children:"Best Practices"}),e.jsxs("ul",{style:{paddingLeft:20},children:[e.jsx("li",{children:e.jsx(y,{children:"Follow the principle of least privilege"})}),e.jsx("li",{children:e.jsx(y,{children:"Regularly audit user roles"})}),e.jsx("li",{children:e.jsx(y,{children:"Document role responsibilities"})})]})]}),e.jsxs(v,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(A,{level:5,children:"Role Inheritance"}),e.jsx(W,{children:"Higher-level roles automatically include permissions from lower-level roles to ensure consistency."})]})]})}),e.jsx(de,{visible:b,onCancel:()=>p(!1),onSave:d,role:k,loading:j})]})}export{je as default};
