import{j as t,P as V,Q as _,T as N,I as O,U as C,J as U,K as X,F as q,V as J,W as K,X as Q}from"./index-nu_xN7Rs.js";import{l as Y,k as Z,u as z,j as $,i as E,r as o}from"./vendor-react-BNeW3y6d.js";import"./vendor-canvas-BRbMLhVA.js";import{ag as G,a6 as ee,S as k,a3 as te,c as D,b1 as se,aY as ae}from"./vendor-antd-CPyaZRZ0.js";import"./vendor-utils-DNTYNPA0.js";import"./vendor-styling-DBLAJE0-.js";const ie=({exhibitionId:i,destination:p="layout",label:b="Back to Layout"})=>{const u=z(),{currentExhibition:n}=E(a=>a.exhibition);return t.jsxs("div",{style:{marginBottom:"24px",position:"sticky",top:"16px",zIndex:10},children:[t.jsx(D,{icon:t.jsx(ae,{}),onClick:()=>u(q(n,p),{state:{exhibitionId:i}}),type:"default",size:"large",style:{borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",background:"white",borderColor:"transparent",fontWeight:500,padding:"0 16px",height:"42px",display:"flex",alignItems:"center",transition:"all 0.3s ease"},className:"back-button-hover",children:t.jsx("span",{style:{marginLeft:8},children:b})}),t.jsx("style",{children:`
        .back-button-hover:hover {
          transform: translateX(-5px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: #f0f5ff;
          border-color: #d6e4ff;
        }
      `})]})},ne=[{value:"all",label:"All Types"},{value:"sofa",label:"Sofas"},{value:"chair",label:"Chairs"},{value:"table",label:"Tables"},{value:"desk",label:"Desks"},{value:"plant",label:"Plants"},{value:"entrance",label:"Entrances"},{value:"exit",label:"Exits"},{value:"info",label:"Information"},{value:"restroom",label:"Restrooms"},{value:"food",label:"Food Areas"},{value:"custom",label:"Custom"}],he=()=>{var j,S,I;const{message:i}=G.useApp(),{id:p}=Y(),b=Z(),u=z(),n=$(),a=((j=b.state)==null?void 0:j.exhibitionId)||p,{currentExhibition:r,fixtures:x,halls:R,stalls:A,loading:re}=E(e=>e.exhibition),d=o.useRef(null),[B,c]=o.useState(!1),[v,m]=o.useState(null),[h,H]=o.useState({width:0,height:0}),[f,T]=o.useState("all"),[M,w]=o.useState([]);o.useEffect(()=>{if(!a){i.error("Exhibition ID not found"),u("/exhibitions");return}},[a,u,i]),o.useEffect(()=>{(async()=>{try{await n(O(a)).unwrap(),await n(C({exhibitionId:a})).unwrap(),await n(U(a)).unwrap(),await n(X({exhibitionId:a})).unwrap()}catch{i.error("Failed to load data")}})()},[a,n,i]),o.useEffect(()=>{w(f==="all"?x:x.filter(e=>e.type===f))},[x,f]),o.useEffect(()=>{const e=()=>{if(d.current){const{clientWidth:l,clientHeight:g}=d.current;H({width:Math.max(l||400,400),height:Math.max(g||400,400)})}};e();const s=new ResizeObserver(e);return d.current&&s.observe(d.current),window.addEventListener("resize",e),()=>{s.disconnect(),window.removeEventListener("resize",e)}},[]);const y=()=>{m(null),c(!0)},L=e=>{m(e),c(!!e)},F=async e=>{try{const s=x.reduce((l,g)=>Math.max(l,g.zIndex||1),1);if(e.id||e._id){const l={...e,zIndex:s+1};await n(J({exhibitionId:a,id:e.id||e._id||"",data:l})).unwrap(),i.success("Fixture updated successfully")}else{const l={...e,zIndex:s+1};await n(K({exhibitionId:a,data:l})).unwrap(),i.success("Fixture created successfully")}await n(C({exhibitionId:a})).unwrap(),c(!1)}catch(s){console.error("Failed to save fixture:",s),i.error(s.message||"Failed to save fixture")}},W=async e=>{try{const s=e.id||e._id;if(!s)throw new Error("Fixture ID is required");await n(Q({exhibitionId:a,id:s})).unwrap(),i.success("Fixture deleted successfully"),c(!1),m(null)}catch(s){console.error("Failed to delete fixture:",s),i.error(s.message||"Failed to delete fixture")}},P=e=>{T(e)};return t.jsxs("div",{style:{padding:"24px",height:"100vh",display:"flex",flexDirection:"column"},children:[t.jsx(ie,{exhibitionId:a}),t.jsxs(ee,{title:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(k,{children:t.jsx("span",{children:"Fixture Management"})}),t.jsxs(k,{children:[t.jsx(te,{style:{width:180},value:f,onChange:P,options:ne}),t.jsx(D,{type:"primary",icon:t.jsx(se,{}),onClick:y,children:"Add Fixture"})]})]}),styles:{body:{flex:1,padding:0,overflow:"hidden",minHeight:"400px",position:"relative",background:"#fafafa"}},style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:"500px"},children:[t.jsx("div",{style:{padding:"8px 16px",background:"#f0f7ff",borderBottom:"1px solid #d6e8ff",color:"#0050b3",fontSize:"14px"},children:"Halls and stalls are shown for reference. Place fixtures relative to these elements to enhance visitor navigation."}),t.jsx("div",{ref:d,style:{position:"absolute",top:33,left:0,right:0,bottom:0,overflow:"hidden"},children:t.jsx(V,{children:h.width>0&&h.height>0&&(r==null?void 0:r.dimensions)&&t.jsx(_,{width:h.width,height:h.height,exhibitionWidth:r.dimensions.width,exhibitionHeight:r.dimensions.height,halls:R,stalls:A,fixtures:M,selectedFixture:v,onSelectFixture:L,onFixtureChange:F,onAddFixture:y,isFixtureMode:!0})})})]}),t.jsx(N,{visible:B,fixture:v,onCancel:()=>c(!1),onSubmit:F,onDelete:W,exhibitionWidth:((S=r==null?void 0:r.dimensions)==null?void 0:S.width)||100,exhibitionHeight:((I=r==null?void 0:r.dimensions)==null?void 0:I.height)||100})]})};export{he as default};
