import{a as w,j as e}from"./index-BfjvBafq.js";import{r}from"./vendor-react-BNeW3y6d.js";import{T as ve,a5 as k,a6 as n,a7 as j,aL as I,W as X,x as M,m as $,K as ee,bb as te,a4 as D,bf as Se,S as se,c as u,j as ie,b as g,bd as be,R as Ae,am as Ce,Z as z,ak as x,d as P,B as re,Q as le,aq as ne,f as oe,aR as Re}from"./vendor-antd-sZZBSykP.js";import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";import"./vendor-canvas-BRbMLhVA.js";const T={getActivities:async(h={})=>(await w.get("/activities",{params:h})).data,getStats:async(h=30)=>(await w.get("/activities/stats",{params:{days:h}})).data,getFilters:async()=>(await w.get("/activities/filters")).data,clearLogs:async h=>(await w.delete("/activities/clear",{data:h})).data},{Title:_,Text:o}=ve,{RangePicker:Le}=Se,{Option:E}=D,Ee=()=>{const[h,v]=r.useState([]),[ae,V]=r.useState(!1),[S,G]=r.useState(!1),[p,b]=r.useState({current:1,pageSize:50,total:0}),[s,ce]=r.useState(null),[f,de]=r.useState(null),[l,xe]=r.useState(null),[he,O]=r.useState(!1),[ue,W]=r.useState(!1),[y,Y]=r.useState(!1),[a,B]=r.useState(""),[A,N]=r.useState(""),[C,H]=r.useState(void 0),[R,U]=r.useState(void 0),[L,J]=r.useState(void 0),[d,K]=r.useState(null),m=async()=>{var t,i;V(!0);try{const c={page:p.current,limit:p.pageSize,search:A||void 0,action:C,resource:R,success:L,startDate:(t=d==null?void 0:d[0])==null?void 0:t.toISOString(),endDate:(i=d==null?void 0:d[1])==null?void 0:i.toISOString()};console.log("Fetching activities with params:",c);const F=await T.getActivities(c);console.log("Activities response:",F),v(F.activities),b(me=>({...me,total:F.pagination.total}))}catch(c){console.error("Error fetching activities:",c)}finally{V(!1)}},Q=async()=>{G(!0);try{const t=await T.getStats(30);ce(t)}catch(t){console.error("Error fetching stats:",t)}finally{G(!1)}},pe=async()=>{try{const t=await T.getFilters();de(t)}catch(t){console.error("Error fetching filters:",t)}};r.useEffect(()=>{m()},[p.current,p.pageSize]),r.useEffect(()=>{Q(),pe()},[]);const ge=!!(A||C||R||L!==void 0||d),q=()=>{console.log("Applying filters:",{searchText:A,selectedAction:C,selectedResource:R,selectedSuccess:L,dateRange:d}),b(t=>({...t,current:1})),m()},fe=()=>{N(""),H(void 0),U(void 0),J(void 0),K(null),b(t=>({...t,current:1})),setTimeout(m,100)},je=async()=>{var t,i;if(a==="CLEAR ALL LOGS"){Y(!0);try{const c=await T.clearLogs({confirmText:a});z.success({title:"Logs Cleared Successfully",content:`${c.deletedCount} activity logs have been cleared from the database.`,onOk(){W(!1),B(""),m(),Q()}})}catch(c){console.error("Error clearing logs:",c),z.error({title:"Error Clearing Logs",content:((i=(t=c.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to clear activity logs. Please try again."})}finally{Y(!1)}}},Z=()=>{W(!1),B("")},ye=[{title:"Timestamp",dataIndex:"timestamp",key:"timestamp",width:180,render:t=>e.jsxs("div",{children:[e.jsx("div",{children:P(t).format("MMM DD, YYYY")}),e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:P(t).format("HH:mm:ss")})]}),sorter:!0,defaultSortOrder:"descend"},{title:"User",key:"user",width:200,render:(t,i)=>i.userId?e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(oe,{style:{marginRight:4}}),i.userId.username||i.userId.name]}),e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:i.userId.email})]}):i.exhibitorId?e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(oe,{style:{marginRight:4}}),i.exhibitorId.contactPerson]}),e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:i.exhibitorId.companyName})]}):e.jsx(g,{color:"default",children:"System"})},{title:"Action",dataIndex:"action",key:"action",width:150,render:t=>{const i={user_created:"green",user_updated:"blue",user_deleted:"red",exhibitor_registered:"green",exhibitor_updated:"blue",exhibitor_deleted:"red",exhibition_created:"green",exhibition_updated:"blue",exhibition_deleted:"red",booking_created:"green",booking_updated:"blue",booking_cancelled:"orange",booking_deleted:"red",invoice_downloaded:"purple",stall_created:"green",stall_updated:"blue",stall_deleted:"red"};return e.jsx(g,{color:i[t]||"default",children:t.replace(/_/g," ").toUpperCase()})}},{title:"Resource",dataIndex:"resource",key:"resource",width:120,render:t=>e.jsx(g,{color:"geekblue",children:t.toUpperCase()})},{title:"Description",key:"description",render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{children:i.details.description}),e.jsxs(o,{type:"secondary",style:{fontSize:"12px"},children:[i.method," ",i.endpoint]})]})},{title:"Status",dataIndex:"success",key:"success",width:100,render:t=>e.jsx(re,{status:t?"success":"error",text:t?"Success":"Failed"})},{title:"Actions",key:"actions",width:80,render:(t,i)=>e.jsx(u,{type:"text",icon:e.jsx(Re,{}),onClick:()=>{xe(i),O(!0)}})}];return e.jsxs("div",{className:"activity-page",children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(_,{level:2,children:"System Activity"}),e.jsx(o,{type:"secondary",children:"Monitor all user actions and system events in real-time"})]}),e.jsxs(k,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(n,{xs:24,sm:12,md:6,children:e.jsx(j,{children:e.jsx(I,{title:"Total Activities",value:(s==null?void 0:s.totalActivities)||0,loading:S,prefix:e.jsx(X,{})})})}),e.jsx(n,{xs:24,sm:12,md:6,children:e.jsx(j,{children:e.jsx(I,{title:"Successful",value:(s==null?void 0:s.successfulActivities)||0,loading:S,prefix:e.jsx(M,{}),valueStyle:{color:"#3f8600"}})})}),e.jsx(n,{xs:24,sm:12,md:6,children:e.jsx(j,{children:e.jsx(I,{title:"Failed",value:(s==null?void 0:s.failedActivities)||0,loading:S,prefix:e.jsx($,{}),valueStyle:{color:"#cf1322"}})})}),e.jsx(n,{xs:24,sm:12,md:6,children:e.jsx(j,{children:e.jsx(I,{title:"Success Rate",value:(s==null?void 0:s.successRate)||0,precision:1,suffix:"%",loading:S,valueStyle:{color:((s==null?void 0:s.successRate)||0)>95?"#3f8600":((s==null?void 0:s.successRate)||0)>80?"#faad14":"#cf1322"}})})})]}),e.jsxs(j,{style:{marginBottom:24},children:[e.jsxs(k,{gutter:[16,16],align:"middle",children:[e.jsx(n,{xs:24,sm:12,md:6,children:e.jsx(ee,{placeholder:"Search activities...",prefix:e.jsx(te,{}),value:A,onChange:t=>N(t.target.value),onPressEnter:q})}),e.jsx(n,{xs:24,sm:12,md:4,children:e.jsx(D,{placeholder:"Action",value:C,onChange:H,allowClear:!0,style:{width:"100%"},children:f==null?void 0:f.actions.map(t=>e.jsx(E,{value:t,children:t.replace(/_/g," ")},t))})}),e.jsx(n,{xs:24,sm:12,md:4,children:e.jsx(D,{placeholder:"Resource",value:R,onChange:U,allowClear:!0,style:{width:"100%"},children:f==null?void 0:f.resources.map(t=>e.jsx(E,{value:t,children:t},t))})}),e.jsx(n,{xs:24,sm:12,md:4,children:e.jsxs(D,{placeholder:"Status",value:L,onChange:J,allowClear:!0,style:{width:"100%"},children:[e.jsx(E,{value:!0,children:"Success"}),e.jsx(E,{value:!1,children:"Failed"})]})}),e.jsx(n,{xs:24,sm:12,md:6,children:e.jsx(Le,{value:d,onChange:t=>K(t),style:{width:"100%"},placeholder:["Start Date","End Date"]})})]}),e.jsxs(k,{style:{marginTop:16},justify:"space-between",align:"middle",children:[e.jsx(n,{flex:"auto",children:e.jsxs(se,{wrap:!0,children:[e.jsx(u,{type:"primary",icon:e.jsx(te,{}),onClick:q,children:"Search"}),e.jsx(u,{icon:e.jsx(ie,{}),onClick:fe,children:"Reset"}),e.jsx(u,{icon:e.jsx(ie,{}),onClick:m,children:"Refresh"})]})}),e.jsx(n,{children:e.jsxs(se,{children:[ge&&e.jsx(g,{color:"blue",icon:e.jsx(be,{}),children:"Filters Active"}),e.jsx(u,{danger:!0,icon:e.jsx(Ae,{}),onClick:()=>W(!0),style:{borderRadius:"6px",fontWeight:500,height:"36px",paddingLeft:"16px",paddingRight:"16px"},children:"Clear Logs"})]})})]})]}),e.jsx(j,{children:e.jsx(Ce,{columns:ye,dataSource:h,rowKey:"_id",loading:ae,pagination:{current:p.current,pageSize:p.pageSize,total:p.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,i)=>`${i[0]}-${i[1]} of ${t} activities`,onChange:(t,i)=>{b(c=>({...c,current:t,pageSize:i||50}))}},scroll:{x:1200}})}),e.jsx(z,{title:"Activity Details",open:he,onCancel:()=>O(!1),footer:[e.jsx(u,{onClick:()=>O(!1),children:"Close"},"close")],width:800,children:l&&e.jsxs("div",{children:[e.jsxs(x,{column:2,bordered:!0,children:[e.jsx(x.Item,{label:"Timestamp",children:P(l.timestamp).format("YYYY-MM-DD HH:mm:ss")}),e.jsx(x.Item,{label:"Status",children:e.jsx(re,{status:l.success?"success":"error",text:l.success?"Success":"Failed"})}),e.jsx(x.Item,{label:"Action",children:e.jsx(g,{color:"blue",children:l.action})}),e.jsx(x.Item,{label:"Resource",children:e.jsx(g,{color:"geekblue",children:l.resource})}),e.jsx(x.Item,{label:"Method",children:e.jsx(g,{children:l.method})}),e.jsx(x.Item,{label:"Endpoint",children:e.jsx("code",{children:l.endpoint})}),e.jsx(x.Item,{label:"IP Address",children:l.ipAddress||"N/A"}),e.jsx(x.Item,{label:"User Agent",span:2,children:e.jsx(o,{style:{fontSize:"12px",wordBreak:"break-all"},children:l.userAgent||"N/A"})})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(_,{level:5,children:"Description"}),e.jsx(o,{children:l.details.description})]}),l.details.oldValues&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(_,{level:5,children:"Previous Values"}),e.jsx("pre",{style:{background:"#f5f5f5",padding:12,borderRadius:4,fontSize:"12px",overflow:"auto"},children:JSON.stringify(l.details.oldValues,null,2)})]}),l.details.newValues&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(_,{level:5,children:"New Values"}),e.jsx("pre",{style:{background:"#f5f5f5",padding:12,borderRadius:4,fontSize:"12px",overflow:"auto"},children:JSON.stringify(l.details.newValues,null,2)})]}),l.errorMessage&&e.jsx("div",{style:{marginTop:16},children:e.jsx(le,{type:"error",message:"Error Details",description:l.errorMessage})})]})}),e.jsx(z,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",color:"#ff4d4f",fontSize:"16px",fontWeight:600},children:[e.jsx(ne,{style:{marginRight:12,fontSize:"20px",padding:"8px",backgroundColor:"#fff2f0",borderRadius:"50%",border:"2px solid #ffccc7"}}),"Clear All Activity Logs"]}),open:ue,onCancel:Z,closable:!y,maskClosable:!y,width:650,centered:!0,className:"clear-logs-modal",footer:[e.jsx(u,{size:"large",disabled:y,onClick:Z,style:{minWidth:"100px",height:"40px",borderRadius:"6px"},children:"Cancel"},"cancel"),e.jsx(u,{type:"primary",danger:!0,size:"large",loading:y,disabled:a!=="CLEAR ALL LOGS",onClick:je,style:{minWidth:"140px",height:"40px",borderRadius:"6px",fontWeight:600},children:"Clear All Logs"},"clear")],children:e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsx(le,{message:"⚠️ Permanent Data Deletion Warning",description:e.jsxs("div",{style:{marginTop:8},children:[e.jsxs("div",{style:{marginBottom:8},children:["This action will ",e.jsx("strong",{children:"permanently delete all activity logs"})," from the database."]}),e.jsxs("div",{style:{fontSize:"13px",color:"#666"},children:["• This operation cannot be undone",e.jsx("br",{}),"• The deletion action will be logged before clearing",e.jsx("br",{}),"• Consider backing up your database first"]})]}),type:"warning",showIcon:!0,style:{marginBottom:24,border:"1px solid #faad14",borderRadius:"8px"}}),e.jsxs("div",{style:{backgroundColor:"#fafafa",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"16px",marginBottom:24},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:12,fontSize:"14px",fontWeight:600,color:"#262626"},children:[e.jsx(X,{style:{marginRight:8,color:"#1890ff"}}),"Current Activity Statistics"]}),e.jsxs(k,{gutter:[16,8],children:[e.jsx(n,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#1890ff"},children:(s==null?void 0:s.totalActivities)||0}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"Total Activities"})]})}),e.jsx(n,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#52c41a"},children:(s==null?void 0:s.successfulActivities)||0}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"Successful"})]})}),e.jsx(n,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#ff4d4f"},children:(s==null?void 0:s.failedActivities)||0}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"Failed"})]})})]})]}),e.jsxs("div",{style:{backgroundColor:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"8px",padding:"20px",marginBottom:16},children:[e.jsx("div",{style:{marginBottom:16,fontSize:"14px",lineHeight:"1.6"},children:e.jsx(o,{strong:!0,style:{color:"#262626"},children:"To confirm this dangerous action, please type the following text exactly:"})}),e.jsx("div",{style:{textAlign:"center",marginBottom:16,padding:"12px",backgroundColor:"#ffffff",border:"2px dashed #ff4d4f",borderRadius:"6px"},children:e.jsx(o,{code:!0,style:{color:"#ff4d4f",fontWeight:"bold",fontSize:"16px",letterSpacing:"1px"},children:"CLEAR ALL LOGS"})}),e.jsx(ee,{placeholder:"Type the confirmation text here...",value:a,onChange:t=>B(t.target.value),disabled:y,size:"large",style:{borderColor:a==="CLEAR ALL LOGS"?"#52c41a":"#ff4d4f",borderWidth:"2px",borderRadius:"6px",fontSize:"14px",textAlign:"center",fontWeight:a==="CLEAR ALL LOGS"?"bold":"normal"},suffix:a==="CLEAR ALL LOGS"?e.jsx(M,{style:{color:"#52c41a",fontSize:"16px"}}):a?e.jsx($,{style:{color:"#ff4d4f",fontSize:"16px"}}):null}),a&&a!=="CLEAR ALL LOGS"&&e.jsx("div",{style:{marginTop:8,padding:"8px 12px",backgroundColor:"#fff1f0",border:"1px solid #ffccc7",borderRadius:"4px",textAlign:"center"},children:e.jsxs(o,{type:"danger",style:{fontSize:"13px"},children:[e.jsx($,{style:{marginRight:4}}),"Please type exactly: ",e.jsx(o,{code:!0,strong:!0,children:"CLEAR ALL LOGS"})]})}),a==="CLEAR ALL LOGS"&&e.jsx("div",{style:{marginTop:8,padding:"8px 12px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",textAlign:"center"},children:e.jsxs(o,{type:"success",style:{fontSize:"13px",fontWeight:"bold"},children:[e.jsx(M,{style:{marginRight:4}}),"Confirmation text verified. You may now proceed."]})})]}),e.jsxs("div",{style:{textAlign:"center",padding:"12px",backgroundColor:"#fff7e6",border:"1px solid #ffd591",borderRadius:"6px",fontSize:"13px",color:"#ad6800"},children:[e.jsx(ne,{style:{marginRight:4}}),e.jsx("strong",{children:"Last Warning:"})," This action will permanently delete ",(s==null?void 0:s.totalActivities)||0," activity logs."]})]})})]})};export{Ee as default};
