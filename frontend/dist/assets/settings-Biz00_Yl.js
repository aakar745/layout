import{J as E,j as e}from"./index-DoSueJxk.js";import{r as d,u as A,Y as N}from"./vendor-react-dkbxt9Jf.js";import{a as _}from"./url-DUULaBjX.js";/* empty css                       */import{K as a,W as h,T as D,l as T,c as y,$ as p,a0 as l,a1 as x,ab as k,S as U,ac as V,J as F,D as M,P as I,aF as b,aa as H}from"./vendor-antd-mFVHvrVJ.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const{Title:B,Text:u,Paragraph:g}=D,{Option:J}=k,{TextArea:O}=F,ee=()=>{const[c,v]=d.useState([]),[t,f]=d.useState(null),[R,C]=d.useState(!1),[$,P]=d.useState(!1),j=A(),[S]=N(),[n]=a.useForm();d.useEffect(()=>{q()},[]),d.useEffect(()=>{const i=S.get("exhibition");if(i&&c.length>0){const r=c.find(s=>s._id===i);r&&(f(r),w(r))}},[S,c]);const q=async()=>{C(!0);try{const i=await fetch(`${E}/exhibitions/active`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(i.ok){const r=await i.json();v(Array.isArray(r)?r:r.data||[])}else h.error("Failed to fetch active exhibitions")}catch(i){console.error("Error fetching active exhibitions:",i),h.error("Error fetching active exhibitions")}finally{C(!1)}},w=i=>{const r=i.serviceChargeConfig||{isEnabled:!1,title:"Service Charges",description:"Pay service charges for stall positioning and setup",pricingRules:{smallStallThreshold:50,smallStallPrice:2e3,largeStallPrice:2500}};n.setFieldsValue({isEnabled:r.isEnabled,title:r.title,description:r.description,smallStallThreshold:r.pricingRules?.smallStallThreshold||50,smallStallPrice:r.pricingRules?.smallStallPrice||2e3,largeStallPrice:r.pricingRules?.largeStallPrice||2500})},L=i=>{const r=c.find(s=>s._id===i);if(r){f(r),w(r);const s=new URLSearchParams(S);s.set("exhibition",i),j(`?${s.toString()}`,{replace:!0})}},z=async i=>{if(!t){h.error("Please select an exhibition");return}P(!0);try{const r={isEnabled:i.isEnabled,title:i.title,description:i.description,pricingRules:{smallStallThreshold:i.smallStallThreshold,smallStallPrice:i.smallStallPrice,largeStallPrice:i.largeStallPrice}},s=await fetch(`${E}/service-charges/config/${t._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(r)});if(s.ok)h.success("Configuration saved successfully"),v(o=>o.map(m=>m._id===t._id?{...m,serviceChargeConfig:r}:m)),f(o=>o?{...o,serviceChargeConfig:r}:null);else{const o=await s.json();h.error(o.message||"Failed to save configuration")}}catch(r){console.error("Error saving configuration:",r),h.error("Error saving configuration")}finally{P(!1)}};return e.jsxs("div",{className:"service-charges-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs(B,{level:2,children:[e.jsx(T,{})," Service Charge Settings"]}),e.jsx(y,{onClick:()=>j("/service-charges"),children:"Back to Service Charges"})]}),e.jsxs(p,{gutter:24,children:[e.jsx(l,{span:8,children:e.jsxs(x,{title:"Select Exhibition",loading:R,style:{height:"fit-content"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(u,{type:"secondary",style:{fontSize:"14px"},children:"Choose an exhibition to configure service charges"})}),e.jsx(k,{placeholder:"Choose an exhibition...",style:{width:"100%",marginBottom:16},value:t?._id,onChange:L,showSearch:!0,optionFilterProp:"children",dropdownStyle:{maxHeight:400,overflow:"auto",padding:"4px"},size:"large",filterOption:(i,r)=>{const s=c.find(m=>m._id===r?.value);return s?`${s.name} ${s.venue}`.toLowerCase().includes(i.toLowerCase()):!1},children:c.map(i=>e.jsx(J,{value:i._id,children:e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsx("div",{style:{fontWeight:500,marginBottom:4},children:i.name}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{children:["ðŸ“ ",i.venue]}),i.serviceChargeConfig?.isEnabled&&e.jsx("span",{style:{color:"#52c41a"},children:"âœ“ Enabled"})]})]})},i._id))})]})}),e.jsx(l,{span:16,children:t?e.jsxs(U,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(x,{title:"Service Charge Configuration",extra:e.jsx(y,{type:"primary",icon:e.jsx(H,{}),loading:$,onClick:()=>n.submit(),children:"Save Configuration"}),children:e.jsxs(a,{form:n,layout:"vertical",onFinish:z,children:[e.jsx(p,{gutter:16,children:e.jsx(l,{span:24,children:e.jsx(a.Item,{name:"isEnabled",label:"Enable Service Charges",valuePropName:"checked",children:e.jsx(V,{checkedChildren:"Enabled",unCheckedChildren:"Disabled"})})})}),e.jsx(p,{gutter:16,children:e.jsx(l,{span:12,children:e.jsx(a.Item,{name:"title",label:"Title",rules:[{required:!0,message:"Please enter a title"}],children:e.jsx(F,{placeholder:"e.g., Service Charges"})})})}),e.jsx(p,{gutter:16,children:e.jsx(l,{span:24,children:e.jsx(a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:e.jsx(O,{rows:3,placeholder:"Brief description of service charges"})})})}),e.jsx(M,{children:"Pricing Rules"}),e.jsx(I,{message:"Stall-Based Pricing",description:"Service charges are calculated based on stall area. Configure the threshold and prices below.",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(p,{gutter:16,children:[e.jsx(l,{span:8,children:e.jsx(a.Item,{name:"smallStallThreshold",label:"Small Stall Threshold (sqm)",rules:[{required:!0,message:"Please enter threshold"}],children:e.jsx(b,{style:{width:"100%"},placeholder:"50",min:1,max:1e3,addonAfter:"sqm"})})}),e.jsx(l,{span:8,children:e.jsx(a.Item,{name:"smallStallPrice",label:"Small Stall Price (â‚¹)",rules:[{required:!0,message:"Please enter price"}],children:e.jsx(b,{style:{width:"100%"},placeholder:"2000",min:1,max:1e5,formatter:i=>`â‚¹ ${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:i=>Number(i?.replace(/â‚¹\s?|(,*)/g,"")||0)})})}),e.jsx(l,{span:8,children:e.jsx(a.Item,{name:"largeStallPrice",label:"Large Stall Price (â‚¹)",rules:[{required:!0,message:"Please enter price"}],children:e.jsx(b,{style:{width:"100%"},placeholder:"2500",min:1,max:1e5,formatter:i=>`â‚¹ ${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:i=>Number(i?.replace(/â‚¹\s?|(,*)/g,"")||0)})})})]}),e.jsx(I,{message:"Pricing Logic",description:e.jsxs("div",{children:[e.jsxs("p",{children:["â€¢ Stalls with area â‰¤ ",n.getFieldValue("smallStallThreshold")||50," sqm will be charged â‚¹",n.getFieldValue("smallStallPrice")||2e3]}),e.jsxs("p",{style:{margin:0},children:["â€¢ Stalls with area > ",n.getFieldValue("smallStallThreshold")||50," sqm will be charged â‚¹",n.getFieldValue("largeStallPrice")||2500]})]}),type:"warning",showIcon:!0,style:{marginBottom:16}})]})}),t.serviceChargeConfig?.isEnabled&&e.jsxs(x,{title:"Stall Management",children:[e.jsx(g,{children:e.jsx(u,{strong:!0,children:"Manage Stalls:"})}),e.jsxs(g,{children:["Use the ",e.jsx(y,{type:"link",onClick:()=>j("/service-charge-stalls"),style:{padding:0},children:"Stall Management"})," page to add, edit, and import stall data. This data is used for auto-filling exhibitor company names in the public service charge form."]})]}),t.serviceChargeConfig?.isEnabled&&e.jsxs(x,{title:"Public Form Access",children:[e.jsx(g,{children:e.jsx(u,{strong:!0,children:"Public Form URL:"})}),e.jsx(g,{copyable:!0,children:`${window.location.origin}${_(t,"service-charge")}`}),e.jsx(g,{type:"secondary",children:"This URL can be shared with vendors to access the service charge payment form directly. No login is required for vendors to use this form."})]})]}):e.jsx(x,{style:{minHeight:400},children:e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},children:[e.jsx(T,{style:{fontSize:64,color:"#d9d9d9",marginBottom:24}}),e.jsx(B,{level:3,type:"secondary",style:{marginBottom:16},children:"Select an Exhibition"}),e.jsx(g,{type:"secondary",style:{fontSize:"16px",maxWidth:400,lineHeight:1.6},children:"Choose an exhibition from the dropdown to configure service charges, pricing rules, and payment settings for vendors."}),e.jsx("div",{style:{marginTop:24,padding:16,background:"#f8f9fa",borderRadius:8,border:"1px solid #e9ecef"},children:e.jsxs(u,{type:"secondary",style:{fontSize:"14px"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Enable service charges to allow vendors to make payments based on stall area without logging in to the system."]})})]})})})]})]})};export{ee as default};
