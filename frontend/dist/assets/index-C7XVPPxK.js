const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BP1I9PmK.js","assets/vendor-react-BNeW3y6d.js","assets/vendor-utils-j652IAQy.js","assets/vendor-antd-DhcJxEc5.js","assets/vendor-styling-BBrlYwaV.js","assets/vendor-canvas-BRbMLhVA.js","assets/index-DpXRMR6H.css"])))=>i.map(i=>d[i]);
import{j as e,Y as ne,Z as Se,_ as Ie,$ as we,C as Ce,I as ke,a0 as Ae,a1 as De}from"./index-BP1I9PmK.js";import{u as de,j as ce,R as Te,i as re,r as w}from"./vendor-react-BNeW3y6d.js";import{a7 as se,a8 as $,a6 as S,o as E,aH as P,b7 as _e,a as C,U as F,h as xe,x as U,m as X,S as k,I as pe,b4 as Re,a2 as oe,b9 as $e,c as z,j as ze,ak as he,d as Ne,b as _,aN as Be,p as Ee,bb as Pe,M as G,C as ue,R as me,bg as Fe,V as b,X as q,T as fe,D as ye,bh as L,J as Le,O as K,ao as Me,aW as We,a_ as Oe}from"./vendor-antd-DhcJxEc5.js";/* empty css                  */import{u as qe}from"./reduxHooks-D3iepLCM.js";import{u as ie,a as Ue,F as Ve}from"./vendor-export-CrAKd1if.js";import"./vendor-utils-j652IAQy.js";import"./vendor-styling-BBrlYwaV.js";import"./vendor-canvas-BRbMLhVA.js";const He=({bookings:t,paginationTotal:u,stats:y,statsLoading:l=!1})=>{const p=y||{total:u!==void 0?u:t.length,pending:t.filter(o=>o.status==="pending").length,approved:t.filter(o=>o.status==="approved").length,rejected:t.filter(o=>o.status==="rejected").length,confirmed:t.filter(o=>o.status==="confirmed").length,cancelled:t.filter(o=>o.status==="cancelled").length,totalRevenue:t.filter(o=>o.status==="confirmed"||o.status==="approved").reduce((o,n)=>o+n.amount,0),totalBaseAmount:t.reduce((o,n)=>{var i;return o+(((i=n.calculations)==null?void 0:i.totalBaseAmount)||0)},0)};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(S,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(E,{})}):e.jsx(P,{title:e.jsxs(C,{title:"Total count across all pages",children:["Total Bookings ",e.jsx(F,{style:{fontSize:"14px",marginLeft:4}})]}),value:p.total,prefix:e.jsx(_e,{})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(S,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(E,{})}):e.jsx(P,{title:e.jsxs(C,{title:"Count of all pending bookings",children:["Pending Bookings ",e.jsx(F,{style:{fontSize:"14px",marginLeft:4}})]}),value:p.pending,prefix:e.jsx(xe,{style:{color:"#faad14"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(S,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(E,{})}):e.jsx(P,{title:e.jsxs(C,{title:"Count of all approved bookings",children:["Approved Bookings ",e.jsx(F,{style:{fontSize:"14px",marginLeft:4}})]}),value:p.approved,prefix:e.jsx(U,{style:{color:"#52c41a"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(S,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(E,{})}):e.jsx(P,{title:e.jsxs(C,{title:"Count of all confirmed bookings",children:["Confirmed Bookings ",e.jsx(F,{style:{fontSize:"14px",marginLeft:4}})]}),value:p.confirmed,prefix:e.jsx(U,{style:{color:"#52c41a"}})})})})]}),e.jsxs(se,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(S,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(E,{})}):e.jsx(P,{title:e.jsxs(C,{title:"Count of all rejected bookings",children:["Rejected Bookings ",e.jsx(F,{style:{fontSize:"14px",marginLeft:4}})]}),value:p.rejected,prefix:e.jsx(X,{style:{color:"#f5222d"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(S,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(E,{})}):e.jsx(P,{title:e.jsxs(C,{title:"Count of all cancelled bookings",children:["Cancelled Bookings ",e.jsx(F,{style:{fontSize:"14px",marginLeft:4}})]}),value:p.cancelled,prefix:e.jsx(X,{style:{color:"#f5222d"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(S,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(E,{})}):e.jsx(P,{title:e.jsxs(C,{title:"Total revenue from all bookings",children:["Total Revenue ",e.jsx(F,{style:{fontSize:"14px",marginLeft:4}})]}),value:p.totalRevenue,precision:0,prefix:"₹"})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(S,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(E,{})}):e.jsx(P,{title:e.jsxs(C,{title:"Total base amount before taxes and discounts",children:["Total Base Amount ",e.jsx(F,{style:{fontSize:"14px",marginLeft:4}})]}),value:p.totalBaseAmount,precision:0,prefix:"₹",valueStyle:{color:"#1890ff"}})})})]})]})},{RangePicker:Ye}=$e,Ge=({filters:t,exhibitions:u,onFilterChange:y,onRefresh:l})=>e.jsx(S,{style:{marginBottom:"24px"},children:e.jsxs(k,{wrap:!0,children:[e.jsx(pe,{placeholder:"Search by company, customer, email, or phone",prefix:e.jsx(Re,{}),value:t.search,onChange:m=>y({...t,search:m.target.value}),style:{width:250},allowClear:!0}),e.jsx(oe,{placeholder:"Filter by exhibition",value:t.exhibition,onChange:m=>y({...t,exhibition:m}),style:{minWidth:200},allowClear:!0,options:u.map(m=>({label:m.name,value:m._id}))}),e.jsx(oe,{mode:"multiple",placeholder:"Filter by status",value:t.status,onChange:m=>y({...t,status:m}),style:{minWidth:200},options:[{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"},{label:"Confirmed",value:"confirmed"},{label:"Cancelled",value:"cancelled"}]}),e.jsx(Ye,{onChange:m=>{var p,g;return y({...t,dateRange:m?[((p=m[0])==null?void 0:p.toISOString())||"",((g=m[1])==null?void 0:g.toISOString())||""]:null})}}),e.jsx(z,{icon:e.jsx(ze,{}),onClick:l,children:"Refresh"})]})}),Ke=(t,u,y)=>{q.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(me,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Booking"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete booking ",e.jsx("strong",{children:y(t._id,t.createdAt)}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data including invoices."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(z,{onClick:()=>q.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(z,{danger:!0,type:"primary",onClick:()=>{u(t._id),q.destroyAll()},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},Xe=t=>{const u=de(),{data:y,isLoading:l,error:m,refetch:p}=ne({page:1,limit:200},{refetchOnMountOrArgChange:30,refetchOnFocus:!0}),g=n=>{if(l||m||!y)return null;const s=(y.data||[]).find(a=>a.bookingId&&typeof a.bookingId=="object"&&a.bookingId._id===n);return s==null?void 0:s._id},o=async n=>{if(n.status!=="approved"&&n.status!=="confirmed"){b.warning("First approve the stall, then view the invoice.");return}if(l){b.loading("Loading invoice data...");return}let i=g(n._id);if(i)u(`/invoice/${i}`);else{const s="invoice-loading";if(b.loading({content:"Checking for invoice...",key:s}),await p(),i=g(n._id),i){b.success({content:"Invoice found!",key:s,duration:1}),u(`/invoice/${i}`);return}const a=new Date(n.createdAt),h=new Date(Date.now()-5*60*1e3);if(a>h||n.status==="approved"){b.info({content:"Invoice is being generated. Please wait...",key:s});let A=0;const v=3,D=[1500,2500,4e3],f=async()=>{A++,await p();const M=g(n._id);if(M)b.success({content:"Invoice is ready!",key:s,duration:1}),u(`/invoice/${M}`);else if(A<v){const J=D[A]||3e3;b.loading({content:`Checking invoice availability... (${A}/${v})`,key:s}),setTimeout(f,J)}else b.warning({content:"Invoice is still being processed. Please refresh the page in a moment or try again later.",key:s,duration:4})};setTimeout(f,D[0])}else b.error({content:"No invoice found for this booking. Please contact support if this persists.",key:s})}};return[{title:"Booking Number",dataIndex:"_id",key:"bookingNumber",fixed:"left",width:190,render:(n,i)=>e.jsx(z,{type:"link",onClick:()=>{t.setSelectedBooking(i),t.setIsDetailsModalVisible(!0)},children:t.formatBookingNumber(n,i.createdAt)})},{title:"Exhibition",dataIndex:["exhibitionId","name"],key:"exhibition",width:250,render:(n,i)=>i.exhibitionId.name},{title:"Company Name",dataIndex:"companyName",key:"company",width:250,render:n=>n||"N/A"},{title:"Stall No.",key:"stallNumber",width:120,render:(n,i)=>e.jsx("span",{children:i.stallIds.map((s,a)=>e.jsxs("span",{children:[s.number,a<i.stallIds.length-1?", ":""]},`stall-${s._id||a}`))})},{title:"Stall Type",key:"stallType",width:120,render:(n,i)=>{const s=Array.from(new Set(i.stallIds.map(a=>a.type)));return e.jsx("span",{children:s.map((a,h)=>e.jsxs("span",{children:[a,h<s.length-1?", ":""]},`type-${a}-${h}`))})}},{title:"Dimensions",key:"dimensions",width:150,render:(n,i)=>e.jsx("span",{children:i.stallIds.map((s,a)=>e.jsxs("span",{children:[s.dimensions?`${s.dimensions.width}m × ${s.dimensions.height}m`:"No dimensions",a<i.stallIds.length-1?", ":""]},`dim-${s._id||a}`))})},{title:"Area (sqm)",key:"area",width:120,render:(n,i)=>{const s=i.stallIds.reduce((a,h)=>h.dimensions?a+h.dimensions.width*h.dimensions.height:a,0);return e.jsxs("span",{children:[Math.round(s)," sqm"]})}},{title:"Base Amount",dataIndex:["calculations","totalBaseAmount"],key:"baseAmount",width:150,render:n=>`₹${n.toLocaleString()}`},{title:"Discount",key:"discount",width:150,render:(n,i)=>{const s=i.calculations.totalDiscountAmount;if(!s||s===0)return"-";const a=i.calculations.stalls.filter(d=>d.discount).map(d=>d.discount);if(a.length===0)return"-";const h=a[0];return e.jsx(C,{title:e.jsx("div",{children:a.map((d,A)=>e.jsxs("div",{children:[d==null?void 0:d.name,": ",(d==null?void 0:d.type)==="percentage"?`${d==null?void 0:d.value}%`:`₹${d==null?void 0:d.value}`,e.jsx("br",{}),"Amount: ₹",d==null?void 0:d.amount.toLocaleString()]},`discount-${A}-${(d==null?void 0:d.name)||"unnamed"}`))}),children:e.jsxs(_,{color:"red",children:["-₹",s.toLocaleString(),(h==null?void 0:h.type)==="percentage"&&` (${h.value}%)`,a.length>1&&" +"]})})}},{title:"Total Amount",dataIndex:"amount",key:"amount",width:150,render:n=>`₹${n.toLocaleString()}`},{title:"Booked By",dataIndex:"bookedBy",key:"bookedBy",width:200,render:(n,i)=>{var s;if(i.bookingSource==="exhibitor"&&i.exhibitorId){const a=i.exhibitorId;return e.jsx(C,{title:`${a.email} - Exhibitor Portal`,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.contactPerson}),e.jsx("div",{className:"text-xs text-gray-500",children:"Exhibitor Portal"})]})})}else if(i.bookingSource==="admin"&&i.userId){const a=i.userId,h=((s=a.role)==null?void 0:s.name)||"Admin";return e.jsx(C,{title:`${a.email} - ${h}`,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.name||a.username}),e.jsx("div",{className:"text-xs text-gray-500",children:h})]})})}return e.jsx("span",{className:"text-gray-400",children:"System"})}},{title:"Created At",dataIndex:"createdAt",key:"createdAt",width:200,render:n=>Ne(n).format("MMM D, YYYY HH:mm")},{title:"Status",dataIndex:"status",key:"status",width:120,fixed:"right",render:n=>e.jsx(_,{color:n==="confirmed"?"success":n==="approved"?"blue":n==="pending"?"warning":n==="rejected"?"error":"default",children:n.toUpperCase()})},{title:"Actions",key:"actions",fixed:"right",width:220,render:(n,i)=>e.jsxs(k,{children:[e.jsx(C,{title:"View Details",children:e.jsx(z,{icon:e.jsx(Be,{}),onClick:()=>{t.setSelectedBooking(i),t.setIsDetailsModalVisible(!0)}})}),e.jsx(Ee,{overlay:e.jsxs(G,{children:[i.status!=="cancelled"&&t.hasPermission("view_bookings")&&e.jsx(G.Item,{icon:e.jsx(ue,{}),disabled:l||i.status!=="approved"&&i.status!=="confirmed",onClick:()=>o(i),children:i.status!=="approved"&&i.status!=="confirmed"?"Approve First to View Invoice":"View Invoice"},"invoice"),e.jsx(G.Item,{icon:e.jsx(U,{}),onClick:()=>{t.setSelectedBooking(i),t.setSelectedStatus(i.status),t.setRejectionReasonText(i.rejectionReason||""),t.setIsStatusModalVisible(!0)},children:"Update Status"},"updateStatus"),t.hasPermission("bookings_delete")&&e.jsx(G.Item,{icon:e.jsx(me,{}),danger:!0,onClick:()=>{Ke(i,t.handleDelete,t.formatBookingNumber)},children:"Delete"},"delete")]}),trigger:["click"],children:e.jsx(z,{icon:e.jsx(Pe,{})})})]})}]},Je=t=>{const{bookings:u,loading:y,pagination:l,fetchBookingsWithPagination:m}=t,p=Xe(t),g=(o,n,i,s)=>e.jsx("div",{className:"ant-table-pagination ant-table-pagination-right",style:{padding:"16px 24px",margin:0,display:"flex",justifyContent:"flex-end"},children:e.jsx(Fe,{current:o,pageSize:n,total:i,showTotal:a=>`Total ${a} items`,showSizeChanger:!0,pageSizeOptions:["5","10","20","50","100"],onChange:a=>s(a,n),onShowSizeChange:(a,h)=>s(a,h),size:"default"})});return e.jsxs(e.Fragment,{children:[e.jsx(he,{columns:p,dataSource:u,loading:y,rowKey:"_id",scroll:{x:1950},pagination:!1}),g(l.page,l.limit,l.total,(o,n)=>m(o,n))]})},{Title:mt,Text:r}=fe,Qe=({selectedBooking:t,isDetailsModalVisible:u,setIsDetailsModalVisible:y,setSelectedBooking:l,setIsStatusModalVisible:m,setSelectedStatus:p,setRejectionReasonText:g,formatBookingNumber:o})=>{var n;return e.jsx(q,{title:"Booking Details",open:u,onCancel:()=>{y(!1),l(null)},footer:null,width:800,styles:{body:{padding:"16px"}},children:t&&e.jsxs(k,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsx(S,{title:"Booking Information",size:"small",styles:{body:{padding:"16px"}},children:e.jsxs(k,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#fafafa",borderRadius:"6px",border:"1px solid #f0f0f0"},children:[e.jsxs("div",{children:[e.jsx(r,{strong:!0,style:{fontSize:"16px",color:"#1890ff"},children:o(t._id,t.createdAt)}),e.jsx("br",{}),e.jsx(r,{type:"secondary",style:{fontSize:"13px"},children:t.exhibitionId.name})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(_,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",style:{fontSize:"12px",fontWeight:500},children:t.status.toUpperCase()}),e.jsx("br",{}),e.jsx(r,{type:"secondary",style:{fontSize:"12px"},children:new Date(t.createdAt).toLocaleDateString()})]})]}),t.rejectionReason&&e.jsxs("div",{style:{padding:"8px 12px",backgroundColor:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"4px"},children:[e.jsx(r,{type:"secondary",style:{fontSize:"12px",fontWeight:500},children:"Rejection Reason:"}),e.jsx("br",{}),e.jsx(r,{style:{fontSize:"13px"},children:t.rejectionReason})]}),e.jsxs("div",{children:[e.jsx(r,{strong:!0,style:{fontSize:"14px",marginBottom:"8px",display:"block"},children:"Customer Details"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px 24px"},children:[e.jsxs("div",{children:[e.jsx(r,{type:"secondary",style:{fontSize:"12px",display:"block"},children:"Name"}),e.jsx(r,{style:{fontSize:"13px"},children:t.customerName})]}),e.jsxs("div",{children:[e.jsx(r,{type:"secondary",style:{fontSize:"12px",display:"block"},children:"Company"}),e.jsx(r,{style:{fontSize:"13px"},children:t.companyName})]}),e.jsxs("div",{children:[e.jsx(r,{type:"secondary",style:{fontSize:"12px",display:"block"},children:"Email"}),e.jsx(r,{style:{fontSize:"13px"},children:t.customerEmail})]}),e.jsxs("div",{children:[e.jsx(r,{type:"secondary",style:{fontSize:"12px",display:"block"},children:"Phone"}),e.jsx(r,{style:{fontSize:"13px"},children:t.customerPhone})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{strong:!0,style:{fontSize:"14px",marginBottom:"8px",display:"block"},children:"Booking Source"}),e.jsx("div",{style:{padding:"8px 12px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:t.bookingSource==="exhibitor"&&t.exhibitorId?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1},children:[e.jsx(r,{strong:!0,style:{fontSize:"13px"},children:t.exhibitorId.contactPerson}),e.jsx("br",{}),e.jsx(r,{type:"secondary",style:{fontSize:"12px"},children:t.exhibitorId.email})]}),e.jsx(_,{color:"blue",style:{fontSize:"11px"},children:"Exhibitor Portal"})]}):t.bookingSource==="admin"&&t.userId?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1},children:[e.jsx(r,{strong:!0,style:{fontSize:"13px"},children:t.userId.name||t.userId.username}),e.jsx("br",{}),e.jsx(r,{type:"secondary",style:{fontSize:"12px"},children:t.userId.email})]}),e.jsx(_,{color:"green",style:{fontSize:"11px"},children:((n=t.userId.role)==null?void 0:n.name)||"Admin"})]}):e.jsx(r,{type:"secondary",style:{fontSize:"13px"},children:"System Generated"})})]})]})}),e.jsx(S,{title:"Stall Details",size:"small",styles:{body:{padding:"12px"}},children:e.jsx(he,{dataSource:t.stallIds,pagination:!1,rowKey:"_id",size:"small",columns:[{title:"Stall Number",dataIndex:"number",key:"number"},{title:"Stall Type",key:"type",render:i=>i.type||"-"},{title:"Dimensions",key:"dimensions",render:i=>e.jsx(_,{color:"blue",children:i.dimensions?`${i.dimensions.width}x${i.dimensions.height}m`:"No dimensions"})},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"rate",render:i=>`₹${i.toLocaleString()}`},{title:"Base Amount",key:"baseAmount",render:i=>{const s=t.calculations.stalls.find(a=>a.stallId===i._id);return s?`₹${s.baseAmount.toLocaleString()}`:"-"}},{title:"Discount",key:"discount",render:i=>{const s=t.calculations.stalls.find(a=>a.stallId===i._id);return s!=null&&s.discount?e.jsx(C,{title:e.jsx("div",{children:s.discount.type==="percentage"&&` (${s.discount.value}%)`}),children:e.jsxs(_,{color:"red",children:["-₹",s.discount.amount.toLocaleString(),s.discount.type==="percentage"&&` (${s.discount.value}%)`]})}):"-"}}]})}),e.jsx(S,{title:"Financial Summary",size:"small",styles:{body:{padding:"12px"}},children:e.jsxs(k,{direction:"vertical",style:{width:"100%"},size:8,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(r,{children:"Total Base Amount:"}),e.jsxs(r,{children:["₹",t.calculations.totalBaseAmount.toLocaleString()]})]}),t.calculations.totalDiscountAmount>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(r,{children:"Total Discount:"}),e.jsxs(r,{type:"danger",children:["-₹",t.calculations.totalDiscountAmount.toLocaleString()]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(r,{children:"Amount after Discount:"}),e.jsxs(r,{children:["₹",t.calculations.totalAmountAfterDiscount.toLocaleString()]})]}),e.jsx(ye,{style:{margin:"8px 0"}}),t.calculations.taxes.map(i=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(r,{children:[i.name," (",i.rate,"%):"]}),e.jsxs(r,{children:["₹",i.amount.toLocaleString()]})]},`tax-${i.name}-${i.rate}`)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[e.jsx(r,{strong:!0,children:"Total Amount (incl. Taxes):"}),e.jsxs(r,{strong:!0,children:["₹",t.amount.toLocaleString()]})]})]})})]})})},Ze=({selectedBooking:t,isStatusModalVisible:u,setIsStatusModalVisible:y,selectedStatus:l,setSelectedStatus:m,rejectionReasonText:p,setRejectionReasonText:g,formatBookingNumber:o,refreshAfterAction:n})=>{const i=ce(),[s,a]=Te.useState(!1),{refetch:h}=ne({page:1,limit:100}),d=async(v,D,f)=>{try{a(!0),await i(Se({id:v,status:D,...f&&{rejectionReason:f}})).unwrap(),b.success(`Booking ${D} successfully`),n(),y(!1),A(null),(D==="approved"||D==="confirmed")&&setTimeout(async()=>{await h()},1e3)}catch{b.error("Failed to update booking status")}finally{a(!1)}},A=v=>{};return e.jsx(q,{title:"Update Booking Status",open:u,onCancel:()=>{y(!1),g("")},footer:null,width:600,children:t&&e.jsxs("div",{children:[e.jsx(S,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(ue,{style:{fontSize:"18px"}}),e.jsx("span",{children:"Booking Information"})]}),style:{marginBottom:16},variant:"borderless",size:"small",children:e.jsxs(k,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(_,{color:"processing",children:o(t._id,t.createdAt)}),e.jsx(_,{color:"default",children:t.exhibitionId.name}),e.jsx(_,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()})]}),e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx(r,{strong:!0,children:"Stall Details:"}),e.jsx("div",{style:{marginTop:"4px"},children:t.stallIds.map((v,D)=>e.jsxs(_,{style:{margin:"2px"},children:["#",v.number," ",v.type&&`(${v.type})`]},v._id))})]}),e.jsx(ye,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(r,{strong:!0,style:{minWidth:"120px"},children:"Company:"}),e.jsx(r,{children:t.companyName})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(r,{strong:!0,style:{minWidth:"120px"},children:"Current Status:"}),e.jsx(_,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()})]})]})}),e.jsxs(S,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(Me,{style:{fontSize:"18px"}}),e.jsx("span",{children:"Update Status"})]}),variant:"borderless",size:"small",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx(r,{strong:!0,children:"Select New Status:"}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsxs(L.Group,{value:l,onChange:v=>m(v.target.value),buttonStyle:"solid",style:{display:"flex",flexWrap:"nowrap",overflowX:"auto"},children:[e.jsx(L.Button,{value:"pending",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(xe,{style:{color:"#faad14"}}),"Pending"]})}),e.jsx(L.Button,{value:"approved",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(U,{style:{color:"#52c41a"}}),"Approved"]})}),e.jsx(L.Button,{value:"rejected",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(X,{style:{color:"#f5222d"}}),"Rejected"]})}),e.jsx(L.Button,{value:"confirmed",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(U,{style:{color:"#1890ff"}}),"Confirmed"]})}),e.jsx(L.Button,{value:"cancelled",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(X,{style:{color:"#ff7875"}}),"Cancelled"]})})]})})]}),l==="rejected"&&e.jsx("div",{children:e.jsx(Le.Item,{label:e.jsx(r,{strong:!0,children:"Rejection Reason:"}),required:l==="rejected",rules:[{required:!0,message:"Please provide a reason for rejection"}],help:"This will be visible to the customer",children:e.jsx(pe.TextArea,{rows:4,value:p,onChange:v=>g(v.target.value),placeholder:"Provide a reason for rejection",style:{marginTop:8}})})}),l==="approved"&&e.jsx(K,{message:"Approval Confirmation",description:"By approving this booking, the stalls will be reserved but not yet confirmed. Customer will be notified.",type:"success",showIcon:!0,style:{marginTop:8}}),l==="confirmed"&&e.jsx(K,{message:"Confirmation Notice",description:"By confirming this booking, the stalls will be marked as booked. This should be done after payment is received.",type:"info",showIcon:!0,style:{marginTop:8}}),l==="cancelled"&&e.jsx(K,{message:"Cancellation Warning",description:"By cancelling this booking, all stalls will be marked as available again.",type:"warning",showIcon:!0,style:{marginTop:8}}),l==="pending"&&e.jsx(K,{message:"Return to Pending",description:"This booking will be moved back to pending status.",type:"warning",showIcon:!0,style:{marginTop:8}})]}),e.jsxs("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end",gap:"8px"},children:[e.jsx(z,{onClick:()=>{y(!1),g("")},children:"Cancel"}),e.jsx(z,{type:"primary",onClick:()=>{if(l==="rejected"&&!p.trim()){b.error("Rejection reason is required when rejecting a booking");return}d(t._id,l,l==="rejected"?p:void 0)},loading:s,disabled:l==="rejected"&&!p.trim(),children:"Update Status"})]})]})]})})},{Title:et,Text:tt}=fe,ft=()=>{const t=ce(),{bookings:u,loading:y,pagination:l,stats:m,statsLoading:p}=re(x=>x.booking),{exhibitions:g}=re(x=>x.exhibition),[o,n]=w.useState(null),[i,s]=w.useState(!1),[a,h]=w.useState(!1),[d,A]=w.useState("pending"),[v,D]=w.useState(""),[f,M]=w.useState({search:"",status:[],dateRange:null,exhibition:null}),J=de(),{data:it,isLoading:st,error:nt,refetch:at}=ne({page:1,limit:200},{refetchOnMountOrArgChange:30,refetchOnFocus:!0}),{hasPermission:je}=qe(),B=w.useCallback((x=1,T=10,W)=>{const j=W||f,N={page:x,limit:T};j.search&&(N.search=j.search),j.exhibition&&(N.exhibitionId=j.exhibition),j.status&&j.status.length>0&&(N.status=j.status),j.dateRange&&j.dateRange.length===2&&(N.startDate=j.dateRange[0],N.endDate=j.dateRange[1]),t(Ie(N))},[t,f]),V=w.useCallback(()=>{t(we())},[t]),Q=w.useCallback(()=>{B(l.page,l.limit),V()},[B,V,l.page,l.limit]);w.useEffect(()=>{B(l.page,l.limit),V()},[B,V,l.page,l.limit]),w.useEffect(()=>{t(Ce())},[t]),w.useEffect(()=>{u.length>0&&[...new Set(u.map(T=>T.exhibitionId._id))].forEach(T=>{t(ke(T))})},[u,t]),w.useEffect(()=>{const x=setTimeout(()=>{B(1,l.limit)},f.search?500:0);return()=>clearTimeout(x)},[f.search,B,l.limit]);const ge=async x=>{try{await t(De(x)).unwrap(),b.success("Booking deleted successfully"),Q()}catch(T){b.error((T==null?void 0:T.message)||"Failed to delete booking")}},be=x=>{M(x),B(1,l.limit,x)},Z=Array.isArray(u)?u:[],H=(x,T)=>{const W=new Date(T).getFullYear(),j=Z.find(R=>R._id===x);if(!j)return`--/${W}/--`;const Y=(Z.filter(R=>R.exhibitionId._id===j.exhibitionId._id).sort((R,c)=>new Date(R.createdAt).getTime()-new Date(c.createdAt).getTime()).findIndex(R=>R._id===x)+1).toString().padStart(2,"0"),O=g.find(R=>R._id===j.exhibitionId._id);return`${(O==null?void 0:O.invoicePrefix)||j.exhibitionId.invoicePrefix||"BK"}/${W}/${Y}`},ve=async()=>{try{b.loading({content:"Preparing export...",key:"export"});const x={};f.search&&(x.search=f.search),f.exhibition&&(x.exhibitionId=f.exhibition),f.status&&f.status.length>0&&(x.status=f.status),f.dateRange&&f.dateRange.length===2&&(x.startDate=f.dateRange[0],x.endDate=f.dateRange[1]);const j=(await(await Ae(async()=>{const{default:c}=await import("./index-BP1I9PmK.js").then(ee=>ee.a7);return{default:c}},__vite__mapDeps([0,1,2,3,4,5,6]))).default.get("/bookings/export",{params:x})).data;if(!Array.isArray(j))throw new Error("Invalid data format received");const N=j.map(c=>{const ee=c.stallIds.reduce((I,te)=>te.dimensions?I+te.dimensions.width*te.dimensions.height:I,0);return{"Booking Number":H(c._id,c.createdAt),Exhibition:c.exhibitionId.name,"Company Name":c.companyName||"N/A","Customer Name":c.customerName,"Customer Email":c.customerEmail,"Customer Phone":c.customerPhone,"Stall Numbers":c.stallIds.map(I=>I.number).join(", "),"Stall Types":Array.from(new Set(c.stallIds.map(I=>I.type||(I.stallTypeId&&typeof I.stallTypeId=="object"?I.stallTypeId.name:"-")))).join(", "),Dimensions:c.stallIds.map(I=>I.dimensions?`${I.dimensions.width}m × ${I.dimensions.height}m`:"No dimensions").join(", "),"Total Area (sqm)":Math.round(ee),"Base Amount":Math.round(c.calculations.totalBaseAmount),Discount:Math.round(c.calculations.totalDiscountAmount),"Total Amount":Math.round(c.calculations.totalAmount),Status:c.status.toUpperCase(),"Booked By":c.bookingSource==="exhibitor"&&c.exhibitorId?`${c.exhibitorId.contactPerson} (Exhibitor)`:c.userId?`${c.userId.name||c.userId.username} (Admin)`:"System","Created Date":new Date(c.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}}),ae=ie.json_to_sheet(N),Y=ie.book_new();ie.book_append_sheet(Y,ae,"Bookings");const O=Ue(Y,{bookType:"xlsx",type:"array"}),le=new Blob([O],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),R=new Date().toISOString().split("T")[0];Ve.saveAs(le,`bookings_export_${R}.xlsx`),b.success({content:"Export successful!",key:"export",duration:2})}catch(x){console.error("Export error:",x),b.error({content:"Failed to export bookings",key:"export",duration:2})}};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(se,{gutter:[24,24],align:"middle",children:[e.jsx($,{flex:"auto",children:e.jsxs(k,{direction:"vertical",size:4,children:[e.jsx(et,{level:4,style:{margin:0},children:"Stall Bookings"}),e.jsx(tt,{type:"secondary",children:"Manage exhibition stall bookings"})]})}),e.jsx($,{children:e.jsxs(k,{children:[e.jsx(z,{icon:e.jsx(We,{}),onClick:ve,size:"large",children:"Export"}),e.jsx(z,{type:"primary",size:"large",icon:e.jsx(Oe,{}),onClick:()=>J("/bookings/create"),children:"Create Booking"})]})})]})}),e.jsx(He,{bookings:u,paginationTotal:l.total,stats:m,statsLoading:p}),e.jsx(Ge,{filters:f,exhibitions:g,onFilterChange:be,onRefresh:Q}),e.jsx(S,{className:"info-card",styles:{body:{padding:0,overflow:"auto"},header:{paddingBottom:12}},title:"Booking List",children:e.jsx(Je,{bookings:Z,loading:y,fetchBookingsWithPagination:B,pagination:l,setSelectedBooking:n,setIsDetailsModalVisible:s,setIsStatusModalVisible:h,setSelectedStatus:A,setRejectionReasonText:D,formatBookingNumber:H,handleDelete:ge,hasPermission:je})}),e.jsx(Qe,{selectedBooking:o,isDetailsModalVisible:i,setIsDetailsModalVisible:s,setSelectedBooking:n,setIsStatusModalVisible:h,setSelectedStatus:A,setRejectionReasonText:D,formatBookingNumber:H}),e.jsx(Ze,{selectedBooking:o,isStatusModalVisible:a,setIsStatusModalVisible:h,selectedStatus:d,setSelectedStatus:A,rejectionReasonText:v,setRejectionReasonText:D,formatBookingNumber:H,refreshAfterAction:Q})]})};export{ft as default};
