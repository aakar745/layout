import{r as e,R as s,j as r,a,b as t,c as i,d as l,e as n}from"./vendor-others-aeGeD6f-.js";import{u as o,a as d}from"./vendor-react-i7tvbPTl.js";import{h as c,s as m,a as u}from"./store-D4NI4RZ9.js";import{e as p}from"./services-DHEt1Qtz.js";import{T as h,A as y,I as x,D as g,S as j,R as f,C as v,s as w}from"./vendor-antd-core-CLD06I8y.js";import{F as P}from"./vendor-antd-form-DJHhvp8w.js";import{M as b}from"./vendor-antd-modal-1GBGM2fb.js";import{B as I}from"./vendor-antd-buttons-wjEWA2x8.js";const{Step:F}=j,{Text:k}=h,C=({loginModalVisible:u,registerModalVisible:h,setRegisterModalVisible:C,setExhibitorCredentials:S,onForgotPassword:E})=>{const R=o(),T=d((e=>e.exhibitorAuth)),[q,z]=e.useState(!1),[B,V]=e.useState(null),[N]=P.useForm(),[A]=P.useForm(),[O]=P.useForm(),[L,_]=e.useState(0),[Y,M]=e.useState(""),[W,$]=e.useState(!1),[D,G]=e.useState(!1),[H,J]=e.useState(0),[K,Q]=e.useState({companyName:"",contactPerson:""}),U=e.useRef(null),X=()=>{U.current&&clearInterval(U.current),U.current=setInterval((()=>{J((e=>e<=1?(U.current&&clearInterval(U.current),0):e-1))}),1e3)},Z=()=>{$(!1),G(!1),M(""),J(0),_(0),Q({companyName:"",contactPerson:""}),U.current&&clearInterval(U.current),O.resetFields()};s.useEffect((()=>()=>{U.current&&clearInterval(U.current)}),[]);return r.jsxs(r.Fragment,{children:[r.jsxs(b,{title:"Exhibitor Login",open:u,onCancel:()=>{R(c()),V(null),N.resetFields()},footer:null,width:400,children:["stall-booking"===T.loginContext&&r.jsx(y,{message:"Login Required for Stall Booking",description:"Please log in to your exhibitor account to select and book stalls for this exhibition.",type:"info",showIcon:!0,style:{marginBottom:16}}),B&&r.jsx(y,{message:B,type:"error",showIcon:!0,style:{marginBottom:16}}),r.jsxs(P,{form:N,name:"exhibitor_login_modal",onFinish:async e=>{var s,r,a,t,i,l,n,o,d;try{V(null),z(!0);const s=await p.login(e),{exhibitor:r,token:a}=s.data;if(!r||!a)throw new Error("Invalid response from server");S({exhibitor:r,token:a}),R(c()),N.resetFields(),w.success("Login successful!")}catch(m){if(403===(null==(s=m.response)?void 0:s.status)){const e=null==(a=null==(r=m.response)?void 0:r.data)?void 0:a.status;if("pending"===e)V("Your account is pending approval. You will be able to log in after admin approval.");else if("rejected"===e){const e=null==(i=null==(t=m.response)?void 0:t.data)?void 0:i.rejectionReason;V(e?`Your registration has been rejected. Reason: ${e}`:"Your registration has been rejected. Please contact the administrator for more details.")}else V((null==(n=null==(l=m.response)?void 0:l.data)?void 0:n.message)||"Access denied. Please contact administrator.")}else V((null==(d=null==(o=m.response)?void 0:o.data)?void 0:d.message)||"Login failed. Please try again.")}finally{z(!1)}},layout:"vertical",children:[r.jsx(P.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"},{type:"email",message:"Please enter a valid email address!"}],children:r.jsx(x,{prefix:r.jsx(a,{}),placeholder:"Email",size:"large",disabled:q})}),r.jsx(P.Item,{name:"password",rules:[{required:!0,message:"Please input your password!"}],children:r.jsx(x.Password,{prefix:r.jsx(t,{}),placeholder:"Password",size:"large",disabled:q})}),r.jsxs(P.Item,{children:[r.jsx("div",{style:{textAlign:"right",marginBottom:10},children:r.jsx(I,{type:"link",onClick:()=>{R(c()),E()},style:{padding:0},children:"Forgot password?"})}),r.jsx(I,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:q,children:"Login"})]})]}),r.jsx(g,{children:r.jsx("span",{style:{fontSize:"14px",color:"#888"},children:"Don't have an account?"})}),r.jsx(I,{type:"default",block:!0,onClick:()=>{R(c()),C(!0),N.resetFields()},children:"Register as Exhibitor"})]}),r.jsxs(b,{title:"Exhibitor Registration",open:h,onCancel:()=>{C(!1),V(null),A.resetFields(),Z()},footer:null,width:500,children:[r.jsxs(j,{current:L,style:{marginBottom:24},children:[r.jsx(F,{title:"Basic Info"}),r.jsx(F,{title:"Verify Email"}),r.jsx(F,{title:"Complete"})]}),B&&r.jsx(y,{message:B,type:"error",showIcon:!0,style:{marginBottom:16}}),0===L&&r.jsxs(r.Fragment,{children:[r.jsx(y,{message:"Email Verification Required",description:"We'll send a one-time password (OTP) to verify your email before completing registration.",type:"info",showIcon:!0,style:{marginBottom:16}}),r.jsxs(P,{form:A,name:"exhibitor_register_step1",layout:"vertical",children:[r.jsx(P.Item,{name:"companyName",rules:[{required:!0,message:"Please input your company name!"}],children:r.jsx(x,{prefix:r.jsx(i,{}),placeholder:"Company Name",size:"large",disabled:q})}),r.jsx(P.Item,{name:"contactPerson",rules:[{required:!0,message:"Please input contact person name!"}],children:r.jsx(x,{prefix:r.jsx(l,{}),placeholder:"Contact Person",size:"large",disabled:q})}),r.jsx(P.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"},{type:"email",message:"Please enter a valid email address!"}],children:r.jsx(x,{prefix:r.jsx(a,{}),placeholder:"Email",size:"large",disabled:q})}),r.jsx(P.Item,{children:r.jsx(I,{type:"primary",onClick:async()=>{var e,s;try{const e=await A.validateFields(["email","companyName","contactPerson"]);z(!0),V(null),M(e.email),Q({companyName:e.companyName,contactPerson:e.contactPerson}),await p.sendRegistrationOTP(e.email),$(!0),w.success("OTP sent to your email address"),J(60),X(),_(1)}catch(r){if("ValidationError"===r.name)return;const a=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Failed to send OTP. Please try again.";V(a),w.error(a)}finally{z(!1)}},block:!0,size:"large",loading:q,children:"Continue & Verify Email"})})]}),r.jsx(g,{children:r.jsx("span",{style:{fontSize:"14px",color:"#888"},children:"Already have an account?"})}),r.jsx(I,{type:"default",block:!0,onClick:()=>{C(!1),R(m(void 0)),A.resetFields()},children:"Login"})]}),1===L&&r.jsxs(r.Fragment,{children:[r.jsx(y,{message:"Email Verification",description:`We've sent a verification code to ${Y}. Please enter it below to continue.`,type:"info",showIcon:!0,style:{marginBottom:16}}),r.jsxs(P,{form:O,name:"verify_otp",onFinish:async e=>{var s,r;try{z(!0),V(null);const s={email:Y,otp:e.otp};await p.verifyOTP(s),G(!0),w.success("Email verified successfully"),U.current&&clearInterval(U.current),_(2)}catch(a){const e=(null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.message)||"Invalid OTP. Please try again.";V(e),w.error(e)}finally{z(!1)}},layout:"vertical",children:[r.jsx(P.Item,{name:"otp",rules:[{required:!0,message:"Please enter the verification code!"}],children:r.jsx(x,{size:"large",placeholder:"Enter OTP",maxLength:6,style:{textAlign:"center",letterSpacing:"8px",fontSize:"20px"},disabled:q})}),r.jsx(P.Item,{children:r.jsx(I,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:q,children:"Verify & Continue"})})]}),r.jsxs(f,{justify:"space-between",align:"middle",style:{marginTop:16},children:[r.jsx(v,{children:r.jsx(I,{type:"link",disabled:H>0||q,onClick:async()=>{var e,s;try{z(!0),V(null),await p.sendRegistrationOTP(Y),w.success("New OTP sent to your email address"),J(60),X()}catch(r){const a=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Failed to resend OTP. Please try again.";V(a),w.error(a)}finally{z(!1)}},children:"Resend Code"})}),r.jsx(v,{children:H>0&&r.jsxs(k,{type:"secondary",children:["Resend in ",H,"s"]})})]}),r.jsx(g,{}),r.jsx(I,{type:"default",block:!0,onClick:()=>_(0),children:"Back"})]}),2===L&&r.jsxs(r.Fragment,{children:[r.jsx(y,{message:"Email Verified Successfully",description:"Please complete your registration by providing the remaining details.",type:"success",showIcon:!0,style:{marginBottom:16}}),r.jsxs(P,{form:A,name:"exhibitor_register_step2",onFinish:async e=>{var s,r;try{if(V(null),z(!0),!D)return void V("Email verification required");const{confirmPassword:s,...r}=e,a={...r,email:Y,companyName:K.companyName,contactPerson:K.contactPerson};await p.register(a);w.success("Registration successful! You can log in and book a stall only after admin approval."),C(!1),A.resetFields(),Z(),setTimeout((()=>{R(m(void 0))}),500)}catch(a){const e=(null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.message)||"Registration failed. Please try again.";V(e),w.error(e)}finally{z(!1)}},layout:"vertical",children:[r.jsx(P.Item,{name:"phone",rules:[{required:!0,message:"Please input your phone number!"}],children:r.jsx(x,{prefix:r.jsx(n,{}),placeholder:"Phone Number",size:"large",disabled:q})}),r.jsx(P.Item,{name:"address",rules:[{required:!0,message:"Please input your address!"}],children:r.jsx(x.TextArea,{placeholder:"Address",rows:3,disabled:q})}),r.jsx(P.Item,{name:"password",rules:[{required:!0,message:"Please input your password!"},{min:6,message:"Password must be at least 6 characters!"}],children:r.jsx(x.Password,{prefix:r.jsx(t,{}),placeholder:"Password",size:"large",disabled:q})}),r.jsx(P.Item,{name:"confirmPassword",dependencies:["password"],rules:[{required:!0,message:"Please confirm your password!"},({getFieldValue:e})=>({validator:(s,r)=>r&&e("password")!==r?Promise.reject(new Error("The two passwords do not match!")):Promise.resolve()})],children:r.jsx(x.Password,{prefix:r.jsx(t,{}),placeholder:"Confirm Password",size:"large",disabled:q})}),r.jsx(P.Item,{children:r.jsx(I,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:q,children:"Complete Registration"})})]})]})]})]})},{Step:S}=j,{Text:E}=h,R=({visible:i})=>{const l=o(),[n,d]=e.useState(!1),[c,f]=e.useState(null),[v,F]=e.useState(0),[k,C]=e.useState(""),[S,E]=e.useState(!1),[R,T]=e.useState(0),q=P.useForm()[0],z=P.useForm()[0],B=P.useForm()[0],V=e.useRef(null),N=()=>{V.current&&clearInterval(V.current),V.current=setInterval((()=>{T((e=>e<=1?(V.current&&clearInterval(V.current),0):e-1))}),1e3)},A=()=>{F(0),C(""),E(!1),T(0),V.current&&clearInterval(V.current),q.resetFields(),z.resetFields(),B.resetFields()};return s.useEffect((()=>()=>{V.current&&clearInterval(V.current)}),[]),r.jsxs(b,{title:"Forgot Password",open:i,onCancel:()=>{A(),l(u())},footer:null,width:400,children:[c&&r.jsx(y,{message:c,type:"error",style:{marginBottom:16}}),r.jsx(j,{current:v,size:"small",style:{marginBottom:20},items:[{title:"Email"},{title:"Verify"},{title:"Reset"}]}),0===v&&r.jsxs(P,{form:q,onFinish:async e=>{var s,r;try{d(!0),f(null);await p.requestPasswordReset(e);C(e.email),E(!0),F(1),w.success("Password reset code sent to your email"),T(60),N()}catch(a){const e=(null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.message)||"Failed to send password reset code. Please try again.";f(e)}finally{d(!1)}},layout:"vertical",children:[r.jsx(P.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter your email"},{type:"email",message:"Please enter a valid email"}],children:r.jsx(x,{prefix:r.jsx(a,{}),placeholder:"Email"})}),r.jsx(P.Item,{children:r.jsx(I,{type:"primary",htmlType:"submit",block:!0,loading:n,children:"Send Reset Code"})}),r.jsx(g,{style:{margin:"12px 0"},children:r.jsx("span",{style:{fontSize:"12px",color:"#8c8c8c"},children:"Remember your password?"})}),r.jsx(I,{type:"link",onClick:()=>{A(),l(u()),l(m())},block:!0,children:"Back to Login"})]}),1===v&&r.jsxs(P,{form:z,onFinish:async e=>{var s,r;try{d(!0),f(null),F(2),V.current&&clearInterval(V.current)}catch(a){const e=(null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.message)||"Invalid code. Please try again.";f(e)}finally{d(!1)}},layout:"vertical",children:[r.jsxs("p",{children:["We've sent a verification code to ",r.jsx("strong",{children:k}),". Please check your email and enter the code below."]}),r.jsx(P.Item,{name:"otp",rules:[{required:!0,message:"Please enter the verification code"},{pattern:/^\d{6}$/,message:"Please enter a valid 6-digit code"}],children:r.jsx(x,{placeholder:"Enter 6-digit code",maxLength:6,style:{letterSpacing:"0.5em",textAlign:"center",fontWeight:"bold"}})}),r.jsx(P.Item,{children:r.jsx(I,{type:"primary",htmlType:"submit",block:!0,loading:n,children:"Verify Code"})}),r.jsx("div",{style:{textAlign:"center",marginTop:8},children:R>0?r.jsxs(h.Text,{type:"secondary",children:["Resend code in ",R,"s"]}):r.jsx(I,{type:"link",onClick:async()=>{var e,s;try{d(!0),f(null),await p.requestPasswordReset({email:k}),w.success("New password reset code sent to your email"),T(60),N()}catch(r){const a=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Failed to resend password reset code. Please try again.";f(a)}finally{d(!1)}},disabled:n,children:"Resend Code"})}),r.jsx(g,{style:{margin:"12px 0"},children:r.jsx("span",{style:{fontSize:"12px",color:"#8c8c8c"},children:"Back to beginning"})}),r.jsx(I,{type:"link",onClick:()=>{F(0),V.current&&(clearInterval(V.current),T(0))},block:!0,children:"Change Email"})]}),2===v&&r.jsxs(P,{form:B,onFinish:async e=>{var s,r;try{d(!0),f(null);const s=z.getFieldValue("otp"),r={email:k,otp:s,newPassword:e.newPassword};await p.resetPassword(r),w.success("Password reset successful. You can now log in with your new password."),A(),l(u()),l(m())}catch(a){const e=(null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.message)||"Failed to reset password. Please try again.";f(e)}finally{d(!1)}},layout:"vertical",children:[r.jsx(P.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter your new password"},{min:6,message:"Password must be at least 6 characters"}],hasFeedback:!0,children:r.jsx(x.Password,{prefix:r.jsx(t,{}),placeholder:"New Password"})}),r.jsx(P.Item,{name:"confirmPassword",label:"Confirm Password",dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0,message:"Please confirm your password"},({getFieldValue:e})=>({validator:(s,r)=>r&&e("newPassword")!==r?Promise.reject(new Error("The two passwords do not match")):Promise.resolve()})],children:r.jsx(x.Password,{prefix:r.jsx(t,{}),placeholder:"Confirm Password"})}),r.jsx(P.Item,{children:r.jsx(I,{type:"primary",htmlType:"submit",block:!0,loading:n,children:"Reset Password"})})]})]})};export{C as E,R as F};
