import{j as e,a as He,o as ue,J as P}from"./index-DoSueJxk.js";import{r as p,u as Oe}from"./vendor-react-dkbxt9Jf.js";import{u as Ge}from"./reduxHooks-Be1Cl4uN.js";import{K as x,ag as H,S as b,P as Ue,J as G,C as ie,D as Ye,b3 as fe,c as h,b5 as oe,X as le,a1 as A,T as ye,b as k,W as d,at as _e,R as K,ar as Ve,au as We,aQ as me,l as qe,$ as se,a0 as C,aq as B,x as Je,h as Ke,ai as Qe,b6 as Xe,ab as R,aw as Ze,n as Se,d as S,al as ge,a3 as et,b7 as tt,p as nt,ay as rt}from"./vendor-antd-mFVHvrVJ.js";/* empty css                       */import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const{Text:f}=ye,st=({visible:v,onClose:Q,onSuccess:X,selectedExhibition:m})=>{const[E]=x.useForm(),[Z,z]=p.useState(!1),[s,y]=p.useState(null),g=()=>{E.resetFields(),y(null),Q()},L=async n=>{z(!0);try{const I={receiptNumber:n.receiptNumber,phonePeTransactionId:n.phonePeTransactionId},w=await He.post("/sync/phonepe/transaction",I);y(w.data)}catch(I){const w=I.response?.data;y({success:!1,message:w?.message||"Failed to check transaction status",data:w,phonePeData:w?.phonePeData})}finally{z(!1)}},Y=n=>{L(n)},_=n=>{switch(n){case"COMPLETED":return"success";case"FAILED":return"error";case"PENDING":case"INITIATED":case"PROCESSING":return"processing";default:return"warning"}};return e.jsx(H,{title:e.jsxs(b,{children:[e.jsx(oe,{}),e.jsx("span",{children:"Check PhonePe Transaction Status"})]}),open:v,onCancel:g,footer:null,width:600,destroyOnHidden:!0,children:e.jsxs(b,{direction:"vertical",style:{width:"100%"},size:"large",children:[!s&&e.jsxs(x,{form:E,layout:"vertical",onFinish:Y,autoComplete:"off",children:[e.jsx(Ue,{message:"Check Transaction Status",description:"Enter either the receipt number (e.g., SC2025000189) or PhonePe transaction ID to check the payment status.",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(x.Item,{name:"receiptNumber",label:"Receipt Number",rules:[{validator:(n,I)=>{const w=E.getFieldValue("phonePeTransactionId");return!I&&!w?Promise.reject("Please provide either receipt number or PhonePe transaction ID"):Promise.resolve()}}],children:e.jsx(G,{placeholder:"e.g., SC2025000189",prefix:e.jsx(ie,{})})}),e.jsx(Ye,{children:"OR"}),e.jsx(x.Item,{name:"phonePeTransactionId",label:"PhonePe Transaction ID",children:e.jsx(G,{placeholder:"e.g., OM2507311245055380005375",prefix:e.jsx(fe,{})})}),e.jsx(x.Item,{children:e.jsx(h,{type:"primary",htmlType:"submit",loading:Z,icon:e.jsx(oe,{}),block:!0,children:"Check Status"})})]}),s&&e.jsx("div",{children:s.success?e.jsx(le,{status:"success",title:"Transaction Status Retrieved",subTitle:s.message,extra:e.jsxs(b,{direction:"vertical",style:{width:"100%"},children:[s.data&&e.jsx(A,{children:e.jsxs(b,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(f,{children:[e.jsx("strong",{children:"PhonePe Gateway Status:"})," ",e.jsx(k,{color:_(s.data.currentStatus),children:s.data.currentStatus})]}),s.data.amount&&e.jsxs(f,{children:[e.jsx("strong",{children:"Amount:"})," ₹",(s.data.amount/100).toLocaleString()]}),s.data.phonePeTransactionId&&e.jsxs(f,{children:[e.jsx("strong",{children:"PhonePe Transaction ID:"})," ",s.data.phonePeTransactionId]}),s.data.merchantTransactionId&&e.jsxs(f,{children:[e.jsx("strong",{children:"Merchant Transaction ID:"})," ",s.data.merchantTransactionId]}),s.data.paymentMethod&&e.jsxs(f,{children:[e.jsx("strong",{children:"Payment Method:"})," ",s.data.paymentMethod]}),s.data.receiptNumber&&e.jsxs(f,{children:[e.jsx("strong",{children:"Receipt Number:"})," ",s.data.receiptNumber]}),s.data.localStatus&&e.jsxs(f,{type:"secondary",children:[e.jsx("strong",{children:"Local DB Status:"})," ",s.data.localStatus]})]})}),e.jsx(h,{onClick:()=>y(null),children:"Check Another Transaction"})]})}):e.jsx(le,{status:"error",title:"Failed to Check Status",subTitle:s.message,extra:e.jsxs(b,{direction:"vertical",style:{width:"100%"},children:[(s.data||s.phonePeData)&&e.jsx(A,{children:e.jsxs(b,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(f,{children:[e.jsx("strong",{children:"PhonePe Gateway Status:"})," ",e.jsx(k,{color:_(s.data?.currentStatus||s.phonePeData?.state),children:s.data?.currentStatus||s.phonePeData?.state})]}),e.jsxs(f,{children:[e.jsx("strong",{children:"Amount:"})," ₹",((s.data?.amount||s.phonePeData?.amount)/100).toLocaleString()]}),e.jsxs(f,{children:[e.jsx("strong",{children:"Transaction ID:"})," ",s.data?.phonePeTransactionId||s.phonePeData?.transactionId]}),e.jsxs(f,{children:[e.jsx("strong",{children:"Merchant Transaction ID:"})," ",s.data?.merchantTransactionId||s.phonePeData?.merchantTransactionId]}),e.jsxs(f,{children:[e.jsx("strong",{children:"Payment Method:"})," ",s.data?.paymentMethod||s.phonePeData?.paymentInstrument?.type||"N/A"]})]})}),e.jsx(h,{onClick:()=>y(null),children:"Try Again"})]})})})]})})},{RangePicker:at}=Ze,{Option:u}=R,{Title:it,Text:l}=ye,{TabPane:je}=Se,U=18,O=v=>Math.round(v*U/(100+U)),ae=v=>v-O(v),ut=()=>{const{hasPermission:v}=Ge();if(!v("view_service_charges"))return e.jsx(le,{status:"403",title:"403",subTitle:"Sorry, you are not authorized to access this page.",extra:e.jsx(h,{type:"primary",onClick:()=>window.location.href="/dashboard",children:"Back to Dashboard"})});const[Q,X]=p.useState([]),[m,E]=p.useState(null),[Z,z]=p.useState(!1),[s,y]=p.useState({current:1,pageSize:10,total:0}),[g,L]=p.useState({}),[Y,_]=p.useState([]),[n,I]=p.useState(null),[w,ee]=p.useState(!1),[be,te]=p.useState(!1),[ve,V]=p.useState(!1),[Ie,W]=p.useState(!1),[we,q]=p.useState(!1),[ce,J]=p.useState(!1),[Ce,ne]=p.useState(!1),Te=Oe(),[Pe]=x.useForm();p.useEffect(()=>{Ae()},[]),p.useEffect(()=>{M(),D()},[s.current,s.pageSize,g]),p.useEffect(()=>{const t=r=>{console.log("🔄 [REAL-TIME] Service charge update received:",r);const{serviceCharge:a,action:c,exhibition:o}=r;c==="payment_received"&&(X(j=>{const $=j.findIndex(T=>T._id===a._id);if($>=0){const T=[...j];return T[$]={...T[$],...a,updatedAt:new Date().toISOString()},console.log("✅ [REAL-TIME] Updated existing service charge in table"),T}else return console.log("⚠️ [REAL-TIME] Service charge not found in current table, adding new entry"),[a,...j]}),D(),d.success({content:e.jsxs("div",{children:[e.jsx("strong",{children:"Payment Received!"}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"12px",color:"#666"},children:[a.receiptNumber," - ₹",a.amount.toLocaleString("en-IN")," from ",a.vendorName]})]}),duration:6,style:{marginTop:"60px"}}),console.log("🎉 [REAL-TIME] Service charge payment update processed successfully"))};return ue.addEventListener("service_charge_updated",t),()=>{ue.removeEventListener("service_charge_updated",t)}},[]);const Ae=async()=>{try{const t=await fetch(`${P}/exhibitions/active`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const r=await t.json();console.log("Fetched active exhibitions:",r);const a=Array.isArray(r)?r:r.data||[];console.log("Setting active exhibitions:",a.length,"items"),_(a)}}catch(t){console.error("Error fetching active exhibitions:",t)}},M=async()=>{z(!0);try{const t={page:s.current.toString(),limit:s.pageSize.toString()};Object.entries(g).forEach(([c,o])=>{o!==void 0&&c!=="dateRange"&&(t[c]=String(o))}),g.dateRange&&(t.startDate=g.dateRange[0].toISOString(),t.endDate=g.dateRange[1].toISOString());const r=new URLSearchParams(t),a=await fetch(`${P}/service-charges?${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const c=await a.json();X(c.data||[]),y(o=>({...o,total:c.pagination?.total||0}))}else d.error("Failed to fetch service charges")}catch(t){console.error("Error fetching service charges:",t),d.error("Error fetching service charges")}finally{z(!1)}},D=async()=>{try{const t={period:"all"};Object.entries(g).forEach(([c,o])=>{o!==void 0&&c!=="dateRange"&&(t[c]=String(o))});const r=new URLSearchParams(t),a=await fetch(`${P}/service-charges/stats?${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const c=await a.json();E(c.data?.overview||null)}}catch(t){console.error("Error fetching stats:",t)}},ke=async t=>{if(n)try{(await fetch(`${P}/service-charges/${n._id}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)})).ok?(d.success("Status updated successfully"),te(!1),M(),D()):d.error("Failed to update status")}catch(r){console.error("Error updating status:",r),d.error("Error updating status")}},Ne=async()=>{try{d.loading("Preparing export...",0);const t={export:"true",limit:"10000"};Object.entries(g).forEach(([c,o])=>{o!==void 0&&c!=="dateRange"&&(t[c]=String(o))}),g.dateRange&&(t.startDate=g.dateRange[0].toISOString(),t.endDate=g.dateRange[1].toISOString());const r=new URLSearchParams(t),a=await fetch(`${P}/service-charges?${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(d.destroy(),a.ok){const o=(await a.json()).data||[];if(o.length===0){d.warning("No data to export");return}const j=["Receipt Number","Exhibition Name","Exhibition Venue","Vendor Name","Company Name","Exhibitor Company","Mobile","Service Type","Uploaded Image","Stall Number","Stall Area (sqm)","Transaction ID","Base Amount (₹) - Excl. GST","GST Amount (₹) - 18%","Total Amount (₹) - Incl. GST","Payment Status","Status","Created Date","Created Time","Paid Date","Paid Time","Admin Notes"],$=o.map(i=>{const N=ae(i.amount),Be=O(i.amount);let re="";return i.phonePeTransactionId&&i.paymentStatus==="paid"?re=`PhonePe: ${i.phonePeTransactionId}`:i.phonePeMerchantTransactionId&&(re=`Merchant: ${i.phonePeMerchantTransactionId}`),[i.receiptNumber,i.exhibitionId?.name||"N/A",i.exhibitionId?.venue||"N/A",i.vendorName,i.companyName,i.exhibitorCompanyName||"",i.vendorPhone,i.serviceType||"",i.uploadedImage?i.uploadedImage.toLowerCase().includes("heic")?`HEIC Image (converted): ${i.uploadedImage}`:`Image: ${i.uploadedImage}`:"No image",i.stallNumber||"",i.stallArea||"",re,N,Be,i.amount,i.paymentStatus.toUpperCase(),i.status.toUpperCase(),S(i.createdAt).format("DD/MM/YYYY"),S(i.createdAt).format("HH:mm:ss"),i.paidAt?S(i.paidAt).format("DD/MM/YYYY"):"",i.paidAt?S(i.paidAt).format("HH:mm:ss"):"",i.adminNotes||""]}),T=i=>{const N=String(i||"");return N.includes(",")||N.includes('"')||N.includes(`
`)?`"${N.replace(/"/g,'""')}"`:N},Me=[j.map(T).join(","),...$.map(i=>i.map(T).join(","))].join(`
`),$e="\uFEFF",Fe=new Blob([$e+Me],{type:"text/csv;charset=utf-8;"}),xe=window.URL.createObjectURL(Fe),F=document.createElement("a");F.style.display="none",F.href=xe,F.download=`service-charges-${S().format("YYYY-MM-DD-HHmm")}.csv`,document.body.appendChild(F),F.click(),window.URL.revokeObjectURL(xe),d.success(`Export completed! ${o.length} records exported.`)}else d.error("Failed to export data")}catch(t){console.error("Error exporting data:",t),d.destroy(),d.error("Error exporting data")}},de=async(t,r)=>{try{d.loading({content:"Preparing receipt for download...",key:"receipt-download"});const a=await fetch(`${P}/service-charges/${t}/receipt`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const c=await a.blob(),o=window.URL.createObjectURL(c),j=document.createElement("a");j.style.display="none",j.href=o,j.download=`Receipt-${r||t}.pdf`,document.body.appendChild(j),j.click(),document.body.removeChild(j),window.URL.revokeObjectURL(o),d.success({content:"Receipt downloaded successfully",key:"receipt-download"})}else{const c=await a.text();let o="Failed to download receipt";a.status===404?o="Receipt not found or not yet generated":a.status===403&&(o="Access denied - insufficient permissions"),d.error({content:o,key:"receipt-download"})}}catch(a){console.error("Error downloading receipt:",a),d.error({content:"Network error - please try again",key:"receipt-download"})}},De=async()=>{if(n){J(!0);try{const t=await fetch(`${P}/service-charges/${n._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok)d.success("Service charge deleted successfully"),W(!1),I(null),M(),D();else{const r=await t.json();d.error(r.message||"Failed to delete service charge")}}catch(t){console.error("Error deleting service charge:",t),d.error("Error deleting service charge")}finally{J(!1)}}},Re=async()=>{J(!0);try{const t=await fetch(`${P}/service-charges`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const r=await t.json();d.success(r.message||"All service charges deleted successfully"),q(!1),M(),D()}else{const r=await t.json();d.error(r.message||"Failed to delete service charges")}}catch(t){console.error("Error deleting all service charges:",t),d.error("Error deleting service charges")}finally{J(!1)}},he=t=>{switch(t){case"paid":case"completed":return"green";case"pending":case"submitted":return"orange";case"cancelled":case"failed":return"red";default:return"default"}},pe=t=>{switch(t){case"paid":return"green";case"pending":return"orange";case"failed":return"red";case"refunded":return"purple";default:return"default"}},Ee=[{key:"view",label:"View Details",icon:e.jsx(_e,{})},{key:"receipt",label:"Download Receipt",icon:e.jsx(ie,{})},...v("delete_service_charges")?[{type:"divider"},{key:"delete",label:"Delete",icon:e.jsx(K,{}),danger:!0}]:[]],ze=(t,r)=>{switch(t){case"view":I(r),ee(!0);break;case"receipt":de(r._id,r.receiptNumber);break;case"delete":I(r),W(!0);break}},Le=[{title:"Receipt #",dataIndex:"receiptNumber",key:"receiptNumber",width:140,fixed:"left",render:t=>e.jsx(l,{strong:!0,copyable:!0,style:{fontSize:"15px"},children:t})},{title:"Vendor Details",key:"vendor",width:180,render:t=>e.jsxs("div",{style:{lineHeight:"1.3"},children:[e.jsx("div",{children:e.jsx(l,{strong:!0,style:{fontSize:"13px"},children:t.vendorName})}),e.jsx("div",{children:e.jsx(l,{type:"secondary",style:{fontSize:"12px"},children:t.companyName})})]})},{title:"Exhibitor Company",key:"exhibitorCompany",width:160,render:t=>e.jsx("div",{style:{lineHeight:"1.3"},children:t.exhibitorCompanyName?e.jsx(l,{strong:!0,style:{fontSize:"13px",color:"#1890ff"},children:t.exhibitorCompanyName}):e.jsx(l,{type:"secondary",style:{fontSize:"12px"},children:"-"})})},{title:"Image",key:"uploadedImage",width:80,align:"center",render:t=>{if(!t.uploadedImage)return e.jsx(l,{type:"secondary",style:{fontSize:"12px"},children:"No image"});const r=`/api/public/uploads/${t.uploadedImage}`,a=t.uploadedImage.toLowerCase().includes("heic");return e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("img",{src:r,alt:"Service charge attachment",className:"service-charge-image",style:{width:"50px",height:"50px",objectFit:"cover",borderRadius:"4px",border:"1px solid #d9d9d9"},onClick:()=>{window.open(r,"_blank")},onError:c=>{const j=c.target.parentElement;j&&(j.innerHTML='<div class="service-charge-image-error">❌</div>')},onLoad:c=>{const o=c.target;o.style.border="1px solid #52c41a"},title:a?"Originally HEIC, converted to JPEG - Click to view full size":"Click to view full size"})})}},{title:"Mobile",dataIndex:"vendorPhone",key:"mobile",width:120,align:"center",render:t=>e.jsx(l,{style:{fontSize:"15px",fontFamily:"monospace"},children:t})},{title:"Stall No.",dataIndex:"stallNumber",key:"stallNumber",width:100,align:"center",render:t=>e.jsx(k,{color:"blue",style:{fontSize:"13px",margin:0},children:t})},{title:"Stall Area",dataIndex:"stallArea",key:"stallArea",width:100,align:"center",render:t=>t?e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(l,{strong:!0,style:{fontSize:"13px",color:"#52c41a"},children:[t," sqm"]}),e.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:t<=50?"Small":"Large"})]}):e.jsx(l,{type:"secondary",style:{fontSize:"12px"},children:"-"})},{title:"Transaction ID",key:"transactionId",width:160,align:"center",render:t=>t.phonePeTransactionId&&t.paymentStatus==="paid"?e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsx(l,{copyable:!0,style:{fontSize:"12px",fontFamily:"monospace",color:"#52c41a",fontWeight:500},title:"PhonePe Transaction ID - Click to copy",children:t.phonePeTransactionId}),e.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:"PhonePe TXN"})]}):t.phonePeMerchantTransactionId?e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsx(l,{copyable:!0,style:{fontSize:"12px",fontFamily:"monospace",color:"#1890ff",fontWeight:500},title:"Merchant Transaction ID - Click to copy",children:t.phonePeMerchantTransactionId}),e.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:"Merchant ID"})]}):e.jsx(l,{type:"secondary",style:{fontSize:"12px"},children:"-"})},{title:"Base Amount",dataIndex:"amount",key:"baseAmount",width:110,align:"center",render:t=>{const r=ae(t);return e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(l,{strong:!0,style:{fontSize:"13px",color:"#1890ff"},children:["₹",r.toLocaleString("en-IN")]}),e.jsx("div",{style:{fontSize:"9px",color:"#666",marginTop:"2px"},children:"(Excl. GST)"})]})}},{title:"GST Amount",dataIndex:"amount",key:"gstAmount",width:100,align:"center",render:t=>{const r=O(t);return e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(l,{strong:!0,style:{fontSize:"13px",color:"#f5222d"},children:["₹",r.toLocaleString("en-IN")]}),e.jsxs("div",{style:{fontSize:"9px",color:"#666",marginTop:"2px"},children:["(",U,"% GST)"]})]})}},{title:"Total Amount",dataIndex:"amount",key:"totalAmount",width:110,align:"center",render:t=>e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(l,{strong:!0,style:{fontSize:"15px",color:"#52c41a"},children:["₹",t.toLocaleString("en-IN")]}),e.jsx("div",{style:{fontSize:"9px",color:"#666",marginTop:"2px"},children:"(Incl. GST)"})]})},{title:"Payment Status",dataIndex:"paymentStatus",key:"paymentStatus",width:120,align:"center",render:t=>e.jsx(k,{color:pe(t),style:{fontSize:"13px",fontWeight:600,margin:0},children:t.toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:110,align:"center",render:t=>e.jsx(k,{color:he(t),style:{fontSize:"13px",fontWeight:600,margin:0},children:t.toUpperCase()})},{title:"Date",dataIndex:"createdAt",key:"date",width:100,align:"center",render:t=>e.jsx("div",{style:{lineHeight:"1.2"},children:e.jsxs("div",{style:{fontSize:"13px",fontWeight:500},children:[e.jsx(et,{style:{marginRight:4,color:"#1890ff"}}),S(t).format("DD/MM/YY")]})})},{title:"Time",dataIndex:"createdAt",key:"time",width:90,align:"center",render:t=>e.jsxs("div",{style:{fontSize:"13px",color:"#666"},children:[e.jsx(tt,{style:{marginRight:4}}),S(t).format("HH:mm")]})},{title:"Paid At",dataIndex:"paidAt",key:"paidAt",width:100,align:"center",render:(t,r)=>!t||r.paymentStatus!=="paid"?e.jsx(l,{type:"secondary",style:{fontSize:"13px"},children:"-"}):e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsx("div",{style:{fontSize:"13px",color:"#52c41a",fontWeight:500},children:S(t).format("DD/MM/YY")}),e.jsx("div",{style:{fontSize:"10px",color:"#52c41a"},children:S(t).format("HH:mm")})]})},{title:"Actions",key:"actions",width:100,align:"center",fixed:"right",render:t=>e.jsx(nt,{menu:{items:Ee,onClick:({key:r})=>ze(r,t)},trigger:["click"],placement:"bottomRight",children:e.jsx(h,{type:"text",size:"small",icon:e.jsx(rt,{}),style:{padding:"4px 8px",borderRadius:"6px",border:"1px solid #d9d9d9",backgroundColor:"#fafafa"}})})}];return e.jsxs("div",{className:"service-charges-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(it,{level:2,children:"Service Charges"}),e.jsxs(b,{children:[e.jsx(G,{placeholder:"Search by receipt, vendor, company, mobile, stall no.",prefix:e.jsx(Ve,{}),style:{width:350},value:g.search||"",onChange:t=>{const r=t.target.value;L(a=>({...a,search:r})),y(a=>({...a,current:1}))},allowClear:!0}),e.jsx(h,{icon:e.jsx(We,{}),onClick:()=>V(!0),children:"Filters"}),e.jsx(h,{icon:e.jsx(me,{}),onClick:Ne,type:"primary",children:"Export"}),e.jsx(h,{icon:e.jsx(qe,{}),onClick:()=>Te("/service-charges/settings"),children:"Settings"}),e.jsx(h,{icon:e.jsx(oe,{}),onClick:()=>ne(!0),type:"dashed",style:{borderColor:"#52c41a",color:"#52c41a"},children:"Sync PhonePe"}),v("delete_service_charges")&&e.jsx(h,{icon:e.jsx(K,{}),onClick:()=>q(!0),danger:!0,disabled:!m||m.totalCharges===0,children:"Delete All"})]})]}),m&&e.jsxs(se,{gutter:16,className:"stats-row",children:[e.jsx(C,{span:4,children:e.jsx(A,{children:e.jsx(B,{title:"Total Charges",value:m.totalCharges,prefix:e.jsx(ie,{})})})}),e.jsx(C,{span:5,children:e.jsxs(A,{children:[e.jsx(B,{title:"Total Amount",value:m.totalAmount,prefix:e.jsx(fe,{}),formatter:t=>`₹${t?.toLocaleString("en-IN")}`}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Inclusive of GST)"})]})}),e.jsx(C,{span:5,children:e.jsxs(A,{children:[e.jsx(B,{title:"Total GST",value:m.totalGSTAmount||O(m.totalAmount||0),prefix:e.jsx("span",{style:{color:"#f5222d"},children:"📊"}),formatter:t=>`₹${t?.toLocaleString("en-IN")}`,valueStyle:{color:"#f5222d"}}),e.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:["(",U,"% GST Amount)"]})]})}),e.jsx(C,{span:5,children:e.jsxs(A,{children:[e.jsx(B,{title:"Paid Amount",value:m.paidAmount,prefix:e.jsx(Je,{}),formatter:t=>`₹${t?.toLocaleString("en-IN")}`,valueStyle:{color:"#3f8600"}}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Inclusive of GST)"})]})}),e.jsx(C,{span:5,children:e.jsxs(A,{children:[e.jsx(B,{title:"Pending Amount",value:m.pendingAmount,prefix:e.jsx(Ke,{}),formatter:t=>`₹${t?.toLocaleString("en-IN")}`,valueStyle:{color:"#cf1322"}}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Inclusive of GST)"})]})})]}),e.jsx(A,{className:"service-charges-table-card",children:e.jsx(Qe,{columns:Le,dataSource:Q,rowKey:"_id",loading:Z,pagination:{current:s.current,pageSize:s.pageSize,total:s.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,r)=>`${r[0]}-${r[1]} of ${t} items`,pageSizeOptions:["10","20","50","100"],onChange:(t,r)=>{y(a=>({...a,current:t,pageSize:r||10}))}},scroll:{x:1560,y:"calc(100vh - 380px)"},size:"middle",bordered:!0,className:"modern-table",rowClassName:(t,r)=>r%2===0?"table-row-light":"table-row-dark"})}),e.jsx(Xe,{title:"Filters",placement:"right",open:ve,onClose:()=>V(!1),width:400,children:e.jsxs(x,{layout:"vertical",onFinish:t=>{L(t),V(!1),y(r=>({...r,current:1}))},initialValues:g,children:[e.jsx(x.Item,{name:"exhibitionId",label:"Exhibition",children:e.jsx(R,{placeholder:"Select exhibition",allowClear:!0,children:Y.map(t=>e.jsx(u,{value:t._id,children:t.name},t._id))})}),e.jsx(x.Item,{name:"paymentStatus",label:"Payment Status",children:e.jsxs(R,{placeholder:"Select payment status",allowClear:!0,children:[e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"paid",children:"Paid"}),e.jsx(u,{value:"failed",children:"Failed"}),e.jsx(u,{value:"refunded",children:"Refunded"})]})}),e.jsx(x.Item,{name:"status",label:"Status",children:e.jsxs(R,{placeholder:"Select status",allowClear:!0,children:[e.jsx(u,{value:"submitted",children:"Submitted"}),e.jsx(u,{value:"paid",children:"Paid"}),e.jsx(u,{value:"completed",children:"Completed"}),e.jsx(u,{value:"cancelled",children:"Cancelled"})]})}),e.jsx(x.Item,{name:"serviceType",label:"Service Type",children:e.jsxs(R,{placeholder:"Select service type",allowClear:!0,children:[e.jsx(u,{value:"positioning",children:"Positioning"}),e.jsx(u,{value:"setup",children:"Setup"}),e.jsx(u,{value:"maintenance",children:"Maintenance"}),e.jsx(u,{value:"other",children:"Other"})]})}),e.jsx(x.Item,{name:"search",label:"Search",children:e.jsx(G,{placeholder:"Search by receipt, vendor, company, mobile, stall no."})}),e.jsx(x.Item,{name:"dateRange",label:"Date Range",children:e.jsx(at,{style:{width:"100%"}})}),e.jsx(x.Item,{children:e.jsxs(b,{children:[e.jsx(h,{type:"primary",htmlType:"submit",children:"Apply Filters"}),e.jsx(h,{onClick:()=>{L({}),V(!1),y(t=>({...t,current:1}))},children:"Clear"})]})})]})}),e.jsx(H,{title:"Update Status",open:be,onCancel:()=>te(!1),footer:null,children:e.jsxs(x,{form:Pe,layout:"vertical",onFinish:ke,children:[e.jsx(x.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select a status"}],children:e.jsxs(R,{children:[e.jsx(u,{value:"submitted",children:"Submitted"}),e.jsx(u,{value:"paid",children:"Paid"}),e.jsx(u,{value:"completed",children:"Completed"}),e.jsx(u,{value:"cancelled",children:"Cancelled"})]})}),e.jsx(x.Item,{name:"adminNotes",label:"Admin Notes",children:e.jsx(G.TextArea,{rows:4,placeholder:"Add notes..."})}),e.jsx(x.Item,{children:e.jsxs(b,{children:[e.jsx(h,{type:"primary",htmlType:"submit",children:"Update Status"}),e.jsx(h,{onClick:()=>te(!1),children:"Cancel"})]})})]})}),e.jsx(H,{title:"Service Charge Details",open:w,onCancel:()=>ee(!1),footer:[e.jsx(h,{onClick:()=>ee(!1),children:"Close"},"close"),e.jsx(h,{type:"primary",icon:e.jsx(me,{}),onClick:()=>n&&de(n._id,n.receiptNumber),disabled:!n?.receiptGenerated,children:n?.receiptGenerated?"Download Receipt":"Receipt Not Available"},"download")],width:800,children:n&&e.jsx("div",{className:"service-charge-details",children:e.jsxs(Se,{children:[e.jsx(je,{tab:"Basic Info",children:e.jsxs(se,{gutter:24,children:[e.jsxs(C,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Receipt Number:"})," ",n.receiptNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vendor Name:"})," ",n.vendorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," ",n.companyName]}),n.exhibitorCompanyName&&e.jsxs("p",{children:[e.jsx("strong",{children:"Exhibitor Company:"})," ",e.jsx("span",{style:{color:"#1890ff"},children:n.exhibitorCompanyName})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",n.vendorPhone]}),n.stallNumber&&e.jsxs("p",{children:[e.jsx("strong",{children:"Stall Number:"})," ",n.stallNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Exhibition:"})," ",n.exhibitionId.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Venue:"})," ",n.exhibitionId.venue]})]}),e.jsxs(C,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Service Type:"})," ",n.serviceType]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("p",{style:{marginBottom:"8px"},children:e.jsx("strong",{children:"Amount Breakdown:"})}),e.jsxs("div",{style:{background:"#f9f9f9",padding:"12px",borderRadius:"6px",border:"1px solid #e8e8e8"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Base Amount:"}),e.jsxs("span",{style:{color:"#1890ff",fontWeight:"bold"},children:["₹",ae(n.amount).toLocaleString("en-IN")]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsxs("span",{children:["GST (",U,"%):"]}),e.jsxs("span",{style:{color:"#f5222d",fontWeight:"bold"},children:["₹",O(n.amount).toLocaleString("en-IN")]})]}),e.jsx("div",{style:{borderTop:"1px solid #d9d9d9",paddingTop:"4px",marginTop:"4px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Total Amount:"}),e.jsxs("span",{style:{color:"#52c41a",fontWeight:"bold",fontSize:"16px"},children:["₹",n.amount.toLocaleString("en-IN")]})]})})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",S(n.createdAt).format("DD/MM/YYYY HH:mm")]}),n.paidAt&&e.jsxs("p",{children:[e.jsx("strong",{children:"Paid At:"})," ",S(n.paidAt).format("DD/MM/YYYY HH:mm")]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Uploaded Image:"})}),n.uploadedImage?e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsx("img",{src:`/api/public/uploads/${n.uploadedImage}`,alt:"Service charge attachment",className:"service-charge-image-preview",style:{maxWidth:"250px",maxHeight:"250px",objectFit:"contain",border:"1px solid #d9d9d9",borderRadius:"6px",cursor:"pointer",display:"block",transition:"all 0.2s ease-in-out"},onClick:()=>{window.open(`/api/public/uploads/${n.uploadedImage}`,"_blank")},onError:t=>{const a=t.target.parentElement;a&&(a.innerHTML=`
                                  <div style="
                                    color: #ff4d4f; 
                                    padding: 20px; 
                                    border: 1px dashed #ff4d4f; 
                                    border-radius: 6px; 
                                    text-align: center;
                                    background-color: #fff2f0;
                                    font-size: 14px;
                                  ">
                                    ❌ Image could not be loaded<br/>
                                    <small style="font-size: 12px; opacity: 0.8;">File may have been moved or deleted</small>
                                  </div>
                                `)},onLoad:t=>{const r=t.target;r.style.border="1px solid #52c41a"},onMouseEnter:t=>{const r=t.target;r.style.transform="scale(1.02)",r.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},onMouseLeave:t=>{const r=t.target;r.style.transform="scale(1)",r.style.boxShadow="none"}}),e.jsxs(l,{type:"secondary",style:{fontSize:"12px",display:"block",marginTop:"8px",textAlign:"center"},children:["📱 Click to view full size",n.uploadedImage.toLowerCase().includes("heic")&&e.jsx("span",{style:{color:"#1890ff",marginLeft:"8px"},children:"(Originally HEIC, converted to JPEG)"})]})]}):e.jsx("div",{style:{padding:"20px",border:"1px dashed #d9d9d9",borderRadius:"4px",textAlign:"center",color:"#999",backgroundColor:"#fafafa"},children:"📷 No image uploaded"})]})]})]})},"basic"),e.jsxs(je,{tab:"Status",children:[e.jsxs(se,{gutter:16,children:[e.jsxs(C,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Status:"}),e.jsx(k,{color:pe(n.paymentStatus),style:{marginLeft:8},children:n.paymentStatus.toUpperCase()})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"}),e.jsx(k,{color:he(n.status),style:{marginLeft:8},children:n.status.toUpperCase()})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Receipt Generated:"}),e.jsx(k,{color:n.receiptGenerated?"green":"orange",style:{marginLeft:8},children:n.receiptGenerated?"Yes":"No"})]})]}),e.jsx(C,{span:12,children:e.jsxs("div",{style:{border:"1px solid #e8e8e8",borderRadius:"6px",padding:"12px",backgroundColor:"#fafafa"},children:[e.jsx("p",{style:{fontWeight:600,marginBottom:"8px",color:"#1890ff",fontSize:"14px"},children:"📊 Transaction Details"}),n.phonePeTransactionId?e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx(l,{strong:!0,style:{fontSize:"12px"},children:"PhonePe Transaction ID:"}),e.jsx("br",{}),e.jsx(l,{copyable:!0,style:{fontFamily:"monospace",fontSize:"11px",color:"#52c41a",fontWeight:500,padding:"2px 4px",backgroundColor:"#f0f9f0",borderRadius:"3px"},children:n.phonePeTransactionId})]}):null,n.phonePeMerchantTransactionId?e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx(l,{strong:!0,style:{fontSize:"12px"},children:"Merchant Transaction ID:"}),e.jsx("br",{}),e.jsx(l,{copyable:!0,style:{fontFamily:"monospace",fontSize:"11px",color:"#1890ff",fontWeight:500,padding:"2px 4px",backgroundColor:"#f0f7ff",borderRadius:"3px"},children:n.phonePeMerchantTransactionId})]}):null,n.phonePeOrderId?e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx(l,{strong:!0,style:{fontSize:"12px"},children:"PhonePe Order ID:"}),e.jsx("br",{}),e.jsx(l,{copyable:!0,style:{fontFamily:"monospace",fontSize:"11px",color:"#722ed1",fontWeight:500,padding:"2px 4px",backgroundColor:"#f9f0ff",borderRadius:"3px"},children:n.phonePeOrderId})]}):null,!n.phonePeTransactionId&&!n.phonePeMerchantTransactionId&&!n.phonePeOrderId?e.jsx(l,{type:"secondary",style:{fontSize:"12px",fontStyle:"italic"},children:"No transaction IDs available yet"}):null]})})]}),n.adminNotes&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Admin Notes:"})}),e.jsx("p",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"4px"},children:n.adminNotes})]})]},"status")]})})}),e.jsx(H,{title:"Delete Service Charge",open:Ie,onCancel:()=>W(!1),footer:null,width:500,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(ge,{style:{fontSize:"48px",color:"#ff4d4f",marginBottom:"20px"}}),e.jsx("h3",{style:{marginBottom:"16px"},children:"Are you sure you want to delete this service charge?"}),n&&e.jsxs("div",{style:{backgroundColor:"#f5f5f5",padding:"16px",borderRadius:"8px",marginBottom:"20px",textAlign:"left"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Receipt Number:"})," ",n.receiptNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vendor:"})," ",n.vendorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," ",n.companyName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ₹",n.amount.toLocaleString("en-IN")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",n.status]})]}),e.jsxs("div",{style:{color:"#ff4d4f",marginBottom:"20px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"⚠️ Warning:"})}),e.jsx("p",{children:"This action cannot be undone. The service charge record and associated receipt will be permanently deleted."})]}),e.jsxs(b,{children:[e.jsx(h,{onClick:()=>W(!1),children:"Cancel"}),e.jsx(h,{type:"primary",danger:!0,loading:ce,onClick:De,icon:e.jsx(K,{}),children:"Delete Service Charge"})]})]})}),e.jsx(H,{title:"Delete All Service Charges",open:we,onCancel:()=>q(!1),footer:null,width:600,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(ge,{style:{fontSize:"48px",color:"#ff4d4f",marginBottom:"20px"}}),e.jsx("h3",{style:{marginBottom:"16px"},children:"Are you sure you want to delete ALL service charges?"}),m&&e.jsxs("div",{style:{backgroundColor:"#fff2f0",border:"1px solid #ffccc7",padding:"16px",borderRadius:"8px",marginBottom:"20px",textAlign:"left"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total Service Charges:"})," ",m.totalCharges]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Amount:"})," ₹",m.totalAmount.toLocaleString("en-IN")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Paid Amount:"})," ₹",m.paidAmount.toLocaleString("en-IN")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pending Amount:"})," ₹",m.pendingAmount.toLocaleString("en-IN")]})]}),e.jsxs("div",{style:{color:"#ff4d4f",marginBottom:"20px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"🚨 DANGER ZONE:"})}),e.jsx("p",{children:"This action cannot be undone. ALL service charge records and associated receipts will be permanently deleted."}),e.jsx("p",{children:"This includes both paid and pending service charges."})]}),e.jsxs(b,{children:[e.jsx(h,{onClick:()=>q(!1),children:"Cancel"}),e.jsx(h,{type:"primary",danger:!0,loading:ce,onClick:Re,icon:e.jsx(K,{}),children:"Delete All Service Charges"})]})]})}),e.jsx(st,{visible:Ce,onClose:()=>ne(!1),onSuccess:()=>{ne(!1),M(),D()},selectedExhibition:Y.find(t=>t._id===g.exhibitionId)})]})};export{ut as default};
