const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BP1I9PmK.js","assets/vendor-react-BNeW3y6d.js","assets/vendor-utils-j652IAQy.js","assets/vendor-antd-DhcJxEc5.js","assets/vendor-styling-BBrlYwaV.js","assets/vendor-canvas-BRbMLhVA.js","assets/index-DpXRMR6H.css"])))=>i.map(i=>d[i]);
import{j as e,C as Qe,_ as ze,a as Fe,a0 as Ye}from"./index-BP1I9PmK.js";import{r as u,j as Ue,i as we}from"./vendor-react-BNeW3y6d.js";import{u as ue,a as Ve,F as Ge}from"./vendor-export-CrAKd1if.js";import{a6 as G,T as ne,a7 as ge,a8 as $,a2 as se,I as Ke,b4 as We,b9 as Je,S as Z,c as ae,j as Ze,b7 as He,D as Xe,b as _,v as et,$ as ve,ax as tt,bj as st,E as ie,ak as pe,O as at,aW as it,B as xe,p as nt,bk as lt,M as te,aN as rt,a$ as ot,l as dt,af as ct,d as ut,n as Ce,aY as pt,bh as me,bl as xt}from"./vendor-antd-DhcJxEc5.js";import"./vendor-utils-j652IAQy.js";import"./vendor-styling-BBrlYwaV.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:mt,Text:J}=ne,{Option:L}=se,{RangePicker:ht}=Je,ft=({exhibitionId:y,exhibitions:S,exhibitionsLoading:g,onExhibitionChange:T,typeFilter:Q,setTypeFilter:k,bookingStatusFilter:x,setBookingStatusFilter:E,searchQuery:M,setSearchQuery:z,dateRange:q,setDateRange:F,resetFilters:K})=>{var P,H;const R=j=>{z(j.target.value)},w=j=>{F(j)};return e.jsxs(G,{className:"amenities-filters",children:[e.jsx(mt,{level:5,className:"filter-heading",children:"Filters"}),e.jsxs(ge,{gutter:[16,16],children:[e.jsx($,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Exhibition"}),e.jsx(se,{placeholder:"Select an exhibition",style:{width:"100%"},loading:g,onChange:T,value:y,children:S.map(j=>e.jsx(L,{value:j._id,children:j.name},j._id))})]})}),e.jsx($,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Amenity Type"}),e.jsxs(se,{mode:"multiple",placeholder:"Select types",style:{width:"100%"},value:Q,onChange:k,maxTagCount:2,children:[e.jsx(L,{value:"facility",children:"Facility"}),e.jsx(L,{value:"service",children:"Service"}),e.jsx(L,{value:"equipment",children:"Equipment"}),e.jsx(L,{value:"other",children:"Other"})]})]})}),e.jsx($,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Booking Status"}),e.jsxs(se,{mode:"multiple",placeholder:"Select statuses",style:{width:"100%"},value:x,onChange:E,maxTagCount:2,children:[e.jsx(L,{value:"confirmed",children:"Confirmed"}),e.jsx(L,{value:"approved",children:"Approved"}),e.jsx(L,{value:"pending",children:"Pending"}),e.jsx(L,{value:"rejected",children:"Rejected"}),e.jsx(L,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx($,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Search"}),e.jsx(Ke,{placeholder:"Search amenities",prefix:e.jsx(We,{}),value:M,onChange:R,allowClear:!0})]})}),e.jsx($,{xs:24,md:16,lg:12,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Booking Date Range"}),e.jsx(ht,{style:{width:"100%"},onChange:w,value:q})]})}),e.jsx($,{xs:24,md:8,lg:12,children:e.jsx("div",{className:"filter-group",style:{display:"flex",justifyContent:"flex-end",alignItems:"flex-end",height:"100%"},children:e.jsxs(Z,{children:[e.jsx(ae,{icon:e.jsx(Ze,{}),onClick:K,children:"Reset"}),e.jsx(ae,{type:"primary",icon:e.jsx(He,{}),children:"Apply Filters"})]})})})]}),(Q.length>0||x.length>0||M||q)&&e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"filter-divider"}),e.jsxs("div",{children:[e.jsx(J,{className:"filter-label",children:"Active Filters:"}),e.jsxs("div",{style:{marginTop:8},children:[Q.map(j=>e.jsxs(_,{closable:!0,onClose:()=>k(Q.filter(D=>D!==j)),className:`amenity-tag amenity-tag-${j}`,children:["Type: ",j]},`type-${j}`)),x.map(j=>e.jsxs(_,{closable:!0,onClose:()=>E(x.filter(D=>D!==j)),color:"blue",children:["Status: ",j]},`status-${j}`)),M&&e.jsxs(_,{closable:!0,onClose:()=>z(""),color:"purple",children:["Search: ",M]}),q&&e.jsxs(_,{closable:!0,onClose:()=>F(null),color:"green",children:["Date Range: ",(P=q[0])==null?void 0:P.format("MMM DD, YYYY")," - ",(H=q[1])==null?void 0:H.format("MMM DD, YYYY")]})]})]})]})]})},{Text:Tt}=ne,gt=({basicAmenities:y,extraAmenities:S,bookedStalls:g,calculatedAmenities:T})=>e.jsxs(ge,{gutter:[24,24],children:[e.jsx($,{xs:24,sm:12,md:6,children:e.jsxs(G,{className:"stats-card stats-primary",bordered:!1,children:[e.jsx(et,{style:{fontSize:24,color:"#1890ff"}}),e.jsx("div",{className:"stats-value",children:y.length}),e.jsx("div",{className:"stats-label",children:"Basic Amenities"})]})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsxs(G,{className:"stats-card stats-secondary",bordered:!1,children:[e.jsx(ve,{style:{fontSize:24,color:"#52c41a"}}),e.jsx("div",{className:"stats-value",children:S.length}),e.jsx("div",{className:"stats-label",children:"Extra Amenities"})]})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsxs(G,{className:"stats-card stats-tertiary",bordered:!1,children:[e.jsx(tt,{style:{fontSize:24,color:"#fa8c16"}}),e.jsx("div",{className:"stats-value",children:g}),e.jsx("div",{className:"stats-label",children:"Booked Stalls"})]})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsxs(G,{className:"stats-card stats-quaternary",bordered:!1,children:[e.jsx(st,{style:{fontSize:24,color:"#722ed1"}}),e.jsx("div",{className:"stats-value",children:T}),e.jsx("div",{className:"stats-label",children:"Calculated Amenities"})]})})]}),{Text:O,Title:Ne}=ne,Ae=y=>{switch(y){case"facility":return{color:"#e6f7ff",borderColor:"#91d5ff",textColor:"#1890ff"};case"service":return{color:"#f6ffed",borderColor:"#b7eb8f",textColor:"#52c41a"};case"equipment":return{color:"#fff7e6",borderColor:"#ffd591",textColor:"#fa8c16"};default:return{color:"#f9f0ff",borderColor:"#d3adf7",textColor:"#722ed1"}}},he=({title:y,amenities:S,loading:g,onExport:T,isDynamicColumns:Q=!1,isCalculated:k=!1,exhibitionId:x,amenityViewType:E="basic"})=>{const[M,z]=u.useState([]),[q,F]=u.useState([]),[K,R]=u.useState(!1),w=u.useMemo(()=>k?E==="basic"?S.filter(o=>o.hasOwnProperty("calculatedQuantity")||o.hasOwnProperty("perSqm")):E==="extra"?S.filter(o=>o.hasOwnProperty("rate")&&!o.hasOwnProperty("perSqm")):S:S,[S,k,E]);u.useEffect(()=>{if(!x){F([]),R(!1);return}R(!0),setTimeout(()=>{R(!1)},500)},[x]);const P=()=>{const o=new Map,c=new Map;w.forEach(s=>{var p,m;if(s.isExtraAmenity&&s.isBookingLevel){c.has(s.bookingId)||c.set(s.bookingId,{key:`booking-${s.bookingId}`,companyName:s.exhibitorName||"Unknown",stallNumber:s.stallNumber,dimension:s.dimensions,stallType:s.stallType,area:s.area||0,bookingDate:s.bookingDate?new Date(s.bookingDate).toISOString().slice(0,10):"-",status:s.bookingStatus||"-",amenities:{},isBookingLevel:!0,stallCount:s.stallCount||1});const v=c.get(s.bookingId);s.booked&&s.quantity>0&&(v.amenities[s.name]=s.quantity)}else if(s.stallId&&s.stallNumber&&!s.isBookingLevel){o.has(s.stallId)||o.set(s.stallId,{key:s.stallId,companyName:s.exhibitorName||"Unknown",stallNumber:s.stallNumber,dimension:s.dimensions?`${s.dimensions.width}x${s.dimensions.height}m`:"-",stallType:s.stallType||"-",area:s.area||((p=s.dimensions)!=null&&p.width&&((m=s.dimensions)!=null&&m.height)?s.dimensions.width*s.dimensions.height:"-"),bookingDate:s.bookingDate?new Date(s.bookingDate).toISOString().slice(0,10):"-",status:s.bookingStatus||"-",amenities:{},isBookingLevel:!1});const v=o.get(s.stallId);if(s.hasOwnProperty("calculatedQuantity"))v.amenities[s.name]=s.calculatedQuantity;else if(s.hasOwnProperty("perSqm")){const I=typeof v.area=="number"?v.area:0,Y=Math.floor(I/s.perSqm)*s.quantity;v.amenities[s.name]=Y>0?Y:s.quantity}}});let f=[];return E==="basic"&&(f=[...f,...Array.from(o.values()).filter(s=>Object.keys(s.amenities).length>0)]),E==="extra"&&(f=[...f,...Array.from(c.values()).filter(s=>Object.keys(s.amenities).length>0)]),f},H=()=>{const o=new Set;return w.forEach(c=>{const f=s=>k?!0:y.toLowerCase().includes("basic")?s.hasOwnProperty("perSqm"):y.toLowerCase().includes("additional")||y.toLowerCase().includes("extra")?s.hasOwnProperty("rate"):!0;c.name&&f(c)&&o.add(c.name)}),Array.from(o)},j=()=>{const o=[{title:"Company Name",dataIndex:"companyName",key:"companyName",fixed:"left",width:180,render:p=>e.jsx(O,{strong:!0,children:p}),sorter:(p,m)=>p.companyName.localeCompare(m.companyName)},{title:"Stall No.",dataIndex:"stallNumber",key:"stallNumber",width:150,render:(p,m)=>m.isBookingLevel?e.jsx(xe,{status:"processing",text:p}):e.jsx(xe,{status:"success",text:p}),sorter:(p,m)=>p.stallNumber.localeCompare(m.stallNumber)},{title:"Dimension",dataIndex:"dimension",key:"dimension",width:120},{title:"Stall Type",dataIndex:"stallType",key:"stallType",width:120},{title:"Area (SQM)",dataIndex:"area",key:"area",width:100,render:p=>typeof p=="number"?p.toFixed(2):p,sorter:(p,m)=>{const v=typeof p.area=="number"?p.area:0,I=typeof m.area=="number"?m.area:0;return v-I}}],f=H().map(p=>({title:p,dataIndex:["amenities",p],key:p,width:100,render:m=>m==null?"-":m===0?e.jsx(O,{type:"secondary",children:"0"}):m==="âœ“"?e.jsx(xe,{status:"success"}):e.jsx(O,{strong:!0,children:m}),sorter:(m,v)=>{const I=m.amenities[p]||0,Y=v.amenities[p]||0;return I-Y}})),s={title:"Actions",key:"actions",width:80,fixed:"right",render:(p,m)=>e.jsx(nt,{overlay:e.jsxs(te,{children:[e.jsx(te.Item,{icon:e.jsx(rt,{}),children:"View Details"},"view"),e.jsx(te.Item,{icon:e.jsx(ot,{}),children:"Edit"},"edit"),e.jsx(te.Item,{icon:e.jsx(dt,{}),children:"Settings"},"settings")]}),trigger:["click"],children:e.jsx(ae,{type:"text",icon:e.jsx(lt,{})})})};return[...o,...f,s]},D=o=>{z(o)},X=P(),je=o=>e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Ne,{level:5,children:"Stall Details"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:[Object.entries(o).map(([c,f])=>["key","amenities"].includes(c)?null:e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs(O,{type:"secondary",style:{fontSize:"12px"},children:[c.charAt(0).toUpperCase()+c.slice(1).replace(/([A-Z])/g," $1"),":"]}),e.jsx("div",{children:e.jsx(O,{strong:!0,children:f==null?"-":typeof f=="object"?JSON.stringify(f):String(f)})})]},c)),e.jsxs("div",{style:{marginBottom:"8px",gridColumn:"1 / -1"},children:[e.jsx(O,{type:"secondary",style:{fontSize:"12px"},children:"Amenities:"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"4px"},children:Object.entries(o.amenities||{}).map(([c,f])=>e.jsxs(_,{color:"blue",children:[c,": ",f==="âœ“"?"Available":f]},c))})]})]})]});return e.jsx(G,{className:"amenities-card",title:e.jsxs(Z,{children:[e.jsx(Ne,{level:5,style:{margin:0},children:y}),k&&e.jsxs(e.Fragment,{children:[e.jsx(_,{color:"green",children:"Calculated"}),E==="basic"&&e.jsx(_,{color:"blue",children:"Basic Amenities"}),E==="extra"&&e.jsx(_,{color:"purple",children:"Extra Amenities"})]})]}),extra:e.jsx(Z,{children:e.jsx(ae,{type:"primary",icon:e.jsx(it,{}),onClick:T,disabled:w.length===0,children:"Export"})}),children:w.length===0?e.jsx(ie,{image:ie.PRESENTED_IMAGE_SIMPLE,description:"No amenities data available"}):y.toLowerCase().includes("basic")&&!k?e.jsx(pe,{dataSource:w.map((o,c)=>({key:o._id||o.id||`basic-${c}`,...o})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(o,c)=>e.jsxs(Z,{children:[e.jsx(O,{strong:!0,children:o}),e.jsx(_,{color:Ae(c.type).textColor,children:c.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Per SQM",dataIndex:"perSqm",key:"perSqm",render:o=>o?`1 per ${o} sqm`:"-"},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:o=>e.jsx(_,{color:"blue",children:o})}],loading:g,pagination:{pageSize:10},className:"amenities-table"}):(y.toLowerCase().includes("additional")||y.toLowerCase().includes("extra"))&&!k?e.jsx(pe,{dataSource:w.map((o,c)=>({key:o._id||o.id||`extra-${c}`,...o})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(o,c)=>e.jsxs(Z,{children:[e.jsx(O,{strong:!0,children:o}),e.jsx(_,{color:Ae(c.type).textColor,children:c.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Rate",dataIndex:"rate",key:"rate",render:o=>e.jsxs(O,{style:{color:"#1890ff"},children:["â‚¹",o.toLocaleString()]})}],loading:g,pagination:{pageSize:10},className:"amenities-table"}):X.length===0?e.jsx(at,{message:"No stall data available",description:"Amenities exist but could not be linked to stalls. Make sure stalls are booked and have amenities assigned.",type:"info",showIcon:!0}):e.jsx(pe,{dataSource:X,columns:j(),loading:g||K,pagination:{pageSize:10},className:"amenities-table",scroll:{x:"max-content"},expandable:{expandedRowKeys:M,onExpandedRowsChange:D,expandedRowRender:je}})})},{Title:jt,Text:Te}=ne,{TabPane:vt}=Ce,fe=(y,S)=>{const g=ue.json_to_sheet(y),T=ue.book_new();ue.book_append_sheet(T,g,"Amenities");const Q=Ve(T,{bookType:"xlsx",type:"array"}),k=new Blob([Q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ge.saveAs(k,`${S}.xlsx`)},Ct=()=>{const y=Ue(),{message:S}=ct.useApp(),{exhibitions:g,loading:T}=we(a=>a.exhibition),{bookings:Q,loading:k}=we(a=>a.booking),[x,E]=u.useState(null),[M,z]=u.useState([]),[q,F]=u.useState([]),[K,R]=u.useState([]),[w,P]=u.useState([]),[H,j]=u.useState(!1),[D,X]=u.useState({}),[je,o]=u.useState(!1),[c,f]=u.useState({current:1,pageSize:10,total:0}),[s,p]=u.useState([]),[m,v]=u.useState([]),[I,Y]=u.useState(""),[U,be]=u.useState(null),[ke,le]=u.useState(0),[Ee,re]=u.useState(0),[De,Be]=u.useState("basic"),[V,_e]=u.useState("basic");u.useEffect(()=>{y(Qe()),y(ze({page:1,limit:100}))},[y]);const $e=async(a,n=1,d=10)=>{try{j(!0);const l=await Fe.get("/bookings",{params:{exhibitionId:a,includeDetails:!0,populate:"stallIds.stallTypeId",page:n,limit:d}});if(l&&l.data){const r=l.data.data.map(i=>{const t={...i};return t.stallIds&&(t.stallIds=t.stallIds.map(b=>(b.stallTypeId&&typeof b.stallTypeId=="object"&&(b.type=b.stallTypeId.name),b))),t}).filter(i=>i.exhibitionId._id===a&&["confirmed","approved"].includes(i.status));P(r),f({current:l.data.pagination.page,pageSize:l.data.pagination.limit,total:l.data.pagination.total})}else P([]),f({current:1,pageSize:10,total:0})}catch(l){console.error("Error fetching complete booking data:",l),P([]),f({current:1,pageSize:10,total:0})}finally{j(!1)}};u.useEffect(()=>{if(x&&g.length>0){const a=g.find(n=>n._id===x);a&&(z(a.basicAmenities||[]),F(a.amenities||[]),$e(x,c.current,c.pageSize))}else z([]),F([]),R([]),le(0),re(0),P([])},[x,g]),u.useEffect(()=>{if(x&&g.length>0&&w.length>0){const a=g.find(n=>n._id===x);if(a){const n=w.flatMap(r=>r.stallIds.map(i=>{const t=i.type||(i.stallTypeId&&typeof i.stallTypeId=="object"?i.stallTypeId.name:D[i.stallTypeId])||"-";return{stallId:i._id,stallNumber:i.number,bookingId:r._id,exhibitorName:r.companyName,bookingDate:r.createdAt,dimensions:i.dimensions,area:i.dimensions.width*i.dimensions.height,status:r.status,stallType:t}})),d=w.flatMap(r=>!r.basicAmenities||r.basicAmenities.length===0?r.stallIds.flatMap(i=>{const t=i.dimensions.width*i.dimensions.height,b=i.type||(i.stallTypeId&&typeof i.stallTypeId=="object"?i.stallTypeId.name:D[i.stallTypeId])||"-";return(a.basicAmenities||[]).map(h=>{const C=Math.floor(t/h.perSqm)*h.quantity;return{...h,calculatedQuantity:C>0?C:h.quantity,stallId:i._id,stallNumber:i.number,bookingId:r._id,exhibitorId:r.exhibitorId||"",exhibitorName:r.companyName,bookingDate:r.createdAt,dimensions:i.dimensions,area:t,bookingStatus:r.status,stallType:b}})}):r.basicAmenities.flatMap(i=>r.stallIds.map(t=>{const b=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:D[t.stallTypeId])||"-";return{...i,stallId:t._id,stallNumber:t.number,bookingId:r._id,exhibitorId:r.exhibitorId||"",exhibitorName:r.companyName,bookingDate:r.createdAt,dimensions:t.dimensions,area:t.dimensions.width*t.dimensions.height,bookingStatus:r.status,stallType:b}}))),l=w.flatMap(r=>!r.extraAmenities||r.extraAmenities.length===0?[]:r.extraAmenities.map(i=>{var ee;const t=r.stallIds.map(N=>`${N.dimensions.width}x${N.dimensions.height}m`).join(", "),b=r.stallIds.map(N=>N.type||(N.stallTypeId&&typeof N.stallTypeId=="object"?N.stallTypeId.name:D[N.stallTypeId])||"-"),h=[...new Set(b)],C=h.length===1?h[0]:h.join(", ");return{...i,booked:!0,stallId:((ee=r.stallIds[0])==null?void 0:ee._id)||"",stallNumber:r.stallIds.map(N=>N.number).join(", "),bookingId:r._id,exhibitorId:r.exhibitorId||"",exhibitorName:r.companyName,bookingDate:r.createdAt,dimensions:t,area:r.stallIds.reduce((N,W)=>N+W.dimensions.width*W.dimensions.height,0),bookingStatus:r.status,stallType:C,allStalls:r.stallIds,isExtraAmenity:!0,isBookingLevel:!0,stallCount:r.stallIds.length,quantity:i.quantity||1}}));let B=l;if(l.length===0&&a.amenities&&a.amenities.length>0){const r=new Set;B=w.flatMap(i=>r.has(i._id)?[]:(r.add(i._id),(a.amenities||[]).map((t,b)=>{var ye,Se;const h=(ye=i.extraAmenities)==null?void 0:ye.find(A=>A.name===t.name),C=!!h,ee=i.stallIds.map(A=>`${A.dimensions.width}x${A.dimensions.height}m`).join(", "),N=i.stallIds.map(A=>A.type||(A.stallTypeId&&typeof A.stallTypeId=="object"?A.stallTypeId.name:D[A.stallTypeId])||"-"),W=[...new Set(N)],Oe=W.length===1?W[0]:W.join(", ");return{...t,id:`sim-booking-${i._id}-${b}`,booked:C,stallId:((Se=i.stallIds[0])==null?void 0:Se._id)||"",stallNumber:i.stallIds.map(A=>A.number).join(", "),bookingId:i._id,exhibitorId:i.exhibitorId||"",exhibitorName:i.companyName||"Unknown",bookingDate:i.createdAt||new Date().toISOString(),dimensions:ee,area:i.stallIds.reduce((A,Ie)=>A+Ie.dimensions.width*Ie.dimensions.height,0),bookingStatus:i.status||"approved",stallType:Oe,allStalls:i.stallIds,isExtraAmenity:!0,isBookingLevel:!0,stallCount:i.stallIds.length,quantity:C?(h==null?void 0:h.quantity)||1:0}})))}R([...d,...B]),le(n.length),re(d.length+B.length)}}else x&&g.length>0&&(R([]),le(0),re(0))},[x,g,w,D]);const oe=u.useMemo(()=>{let a=M;if(s.length>0&&(a=a.filter(n=>s.includes(n.type))),I){const n=I.toLowerCase();a=a.filter(d=>d.name.toLowerCase().includes(n)||d.type.toLowerCase().includes(n)||d.description&&d.description.toLowerCase().includes(n))}return a},[M,s,I]),de=u.useMemo(()=>{let a=q;if(s.length>0&&(a=a.filter(n=>s.includes(n.type))),I){const n=I.toLowerCase();a=a.filter(d=>d.name.toLowerCase().includes(n)||d.type.toLowerCase().includes(n)||d.description&&d.description.toLowerCase().includes(n))}return a},[q,s,I]),ce=u.useMemo(()=>{let a=K;if(s.length>0&&(a=a.filter(n=>s.includes(n.type))),m.length>0&&(a=a.filter(n=>m.includes(n.bookingStatus))),I){const n=I.toLowerCase();a=a.filter(d=>d.name.toLowerCase().includes(n)||d.type.toLowerCase().includes(n)||d.description&&d.description.toLowerCase().includes(n)||d.stallNumber&&d.stallNumber.toLowerCase().includes(n)||d.exhibitorName&&d.exhibitorName.toLowerCase().includes(n))}if(U&&U[0]&&U[1]){const n=U[0].startOf("day"),d=U[1].endOf("day");a=a.filter(l=>{if(!l.bookingDate)return!1;const B=ut(l.bookingDate);return B.isAfter(n)&&B.isBefore(d)})}return a},[K,s,m,I,U]),Me=()=>{p([]),v([]),Y(""),be(null)},qe=()=>{if(oe.length===0){S.warning("No basic amenities to export");return}const a=oe.map(l=>({Name:l.name,Type:l.type,Description:l.description||"","Per Sq. Meter":l.perSqm,"Quantity Per Unit":l.quantity,ID:l._id||l.id})),n=g.find(l=>l._id===x),d=`${(n==null?void 0:n.name)||"Exhibition"}_Basic_Amenities`;fe(a,d),S.success("Basic amenities exported successfully")},Le=()=>{if(de.length===0){S.warning("No extra amenities to export");return}const a=de.map(l=>({Name:l.name,Type:l.type,Description:l.description||"",Rate:l.rate,ID:l._id||l.id})),n=g.find(l=>l._id===x),d=`${(n==null?void 0:n.name)||"Exhibition"}_Extra_Amenities`;fe(a,d),S.success("Extra amenities exported successfully")},Re=()=>{if(ce.length===0){S.warning("No calculated amenities to export");return}const a=new Map,n=new Map;ce.filter(t=>V==="basic"?t.hasOwnProperty("calculatedQuantity")||t.hasOwnProperty("perSqm"):V==="extra"?t.hasOwnProperty("rate")&&!t.hasOwnProperty("perSqm"):!0).forEach(t=>{if(t.isExtraAmenity&&t.isBookingLevel){n.has(t.bookingId)||n.set(t.bookingId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,"Total Area (SQM)":t.area||0,"Stall Count":t.stallCount||1,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-","Booking Type":"Extra Amenities"});const b=n.get(t.bookingId);t.booked&&t.quantity>0&&(b[t.name]=t.quantity)}else if(t.stallId&&t.stallNumber){if(!a.has(t.stallId)){const h=t.dimensions||{width:0,height:0},C=t.area||(h.width&&h.height?h.width*h.height:0);a.set(t.stallId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,Dimension:h?`${h.width}x${h.height}m`:"-","Stall Type":t.stallType||"-","Area (SQM)":typeof C=="number"?C:0,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-","Booking Type":"Basic Amenities"})}const b=a.get(t.stallId);if(t.hasOwnProperty("calculatedQuantity"))b[t.name]=t.calculatedQuantity;else if(t.hasOwnProperty("perSqm")){const h=typeof b["Area (SQM)"]=="number"?b["Area (SQM)"]:0,C=Math.floor(h/t.perSqm)*t.quantity;b[t.name]=C>0?C:t.quantity}}});let l=[];V==="basic"&&(l=[...l,...Array.from(a.values())]),V==="extra"&&(l=[...l,...Array.from(n.values())]);const B=g.find(t=>t._id===x),r=V==="basic"?"Basic":"Extra",i=`${(B==null?void 0:B.name)||"Exhibition"}_${r}_Calculated_Amenities`;fe(l,i),S.success(`${r} calculated amenities exported successfully`)},Pe=async()=>{try{o(!0);const{default:a}=await Ye(async()=>{const{default:d}=await import("./index-BP1I9PmK.js").then(l=>l.a8);return{default:d}},__vite__mapDeps([0,1,2,3,4,5,6])),n=await a.getStallTypes();if(n&&n.data){const d={};n.data.forEach(l=>{l._id&&(d[l._id]=l.name)}),X(d)}}catch(a){console.error("Error fetching stall types:",a)}finally{o(!1)}};return u.useEffect(()=>{x&&Pe()},[x]),e.jsxs("div",{className:"amenities-container",children:[e.jsxs("div",{className:"amenities-header",children:[e.jsx(jt,{level:4,className:"amenities-title",children:"Amenities Management"}),e.jsx(Te,{type:"secondary",children:"View, filter, and export amenities data. See calculated amenities for booked stalls."})]}),e.jsx(ft,{exhibitionId:x,exhibitions:g,exhibitionsLoading:T,onExhibitionChange:E,typeFilter:s,setTypeFilter:p,bookingStatusFilter:m,setBookingStatusFilter:v,searchQuery:I,setSearchQuery:Y,dateRange:U,setDateRange:be,resetFilters:Me}),x&&e.jsx("div",{style:{marginBottom:24},children:e.jsx(gt,{basicAmenities:M,extraAmenities:q,bookedStalls:ke,calculatedAmenities:Ee})}),x?e.jsx(Ce,{activeKey:De,onChange:Be,className:"amenities-tabs",items:[{key:"basic",label:e.jsxs("span",{children:[e.jsx(pt,{}),"Basic Amenities"]}),children:e.jsx(he,{title:"Basic Amenities",amenities:oe,loading:T,onExport:qe,exhibitionId:x})},{key:"extra",label:e.jsxs("span",{children:[e.jsx(ve,{}),"Extra Amenities"]}),children:e.jsx(he,{title:"Additional Amenities",amenities:de,loading:T,onExport:Le,exhibitionId:x})},{key:"calculated",label:e.jsxs("span",{children:[e.jsx(xt,{}),"Calculated Amenities"]}),children:e.jsxs(e.Fragment,{children:[e.jsx(ge,{gutter:[0,16],children:e.jsx($,{span:24,children:e.jsx(G,{className:"filter-card",children:e.jsxs(Z,{children:[e.jsx(Te,{strong:!0,children:"View: "}),e.jsxs(me.Group,{value:V,onChange:a=>_e(a.target.value),optionType:"button",buttonStyle:"solid",children:[e.jsx(me.Button,{value:"basic",children:"Basic Amenities"}),e.jsx(me.Button,{value:"extra",children:"Extra Amenities"})]})]})})})}),e.jsx(he,{title:"Calculated Amenities",amenities:ce,loading:T,onExport:Re,isDynamicColumns:!0,isCalculated:!0,exhibitionId:x,amenityViewType:V})]})}]}):e.jsx("div",{style:{marginTop:24,textAlign:"center",padding:48,background:"#fff",borderRadius:8},children:e.jsx(ie,{description:"Please select an exhibition to view amenities",image:ie.PRESENTED_IMAGE_SIMPLE})})]})};export{Ct as default};
