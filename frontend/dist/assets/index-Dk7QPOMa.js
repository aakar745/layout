import{D as w,K as R,j as s,Y as f}from"./index-BfjvBafq.js";import{u as je,j as be,i as ve,r,R as E}from"./vendor-react-BNeW3y6d.js";import{u as z,w as we}from"./vendor-export-CrAKd1if.js";/* empty css                  */import{a5 as N,a6 as c,S as Z,T as Ae,c as ee,b0 as te,a4 as I,K as Ce,bb as Te,a7 as Pe,aL as _,bl as D,a0 as Ee,am as ke,b as Fe,X as se}from"./vendor-antd-sZZBSykP.js";import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:$e,Text:Ne}=Ae,{Option:j}=I,De=()=>{var G;je();const y=be(),{stalls:ae,loading:le,stallsPagination:H}=ve(e=>e.exhibition),[L,ie]=r.useState([]),[S,K]=r.useState([]),[i,ne]=r.useState(null),[l,W]=r.useState(null),[oe,k]=r.useState(!1),[M,A]=r.useState({totalStalls:0,totalArea:0}),[d,re]=r.useState(""),[h,ce]=r.useState(null),[m,de]=r.useState("number"),[x,he]=r.useState("ascend"),[X,C]=r.useState(1),[p,ue]=r.useState(10),Y=E.useRef({statusFilter:h,sortField:m,sortOrder:x,pageSize:p});E.useEffect(()=>{Y.current={statusFilter:h,sortField:m,sortOrder:x,pageSize:p}},[h,m,x,p]);const T=E.useCallback(async()=>{if(!i||!l){A({totalStalls:0,totalArea:0});return}try{const e={page:1,limit:1e4,search:d||void 0,status:h||void 0,sortBy:m,sortOrder:x==="ascend"?"asc":"desc"},a=(l==="all"?await w.getStalls(i,void 0,e):await w.getStalls(i,l,e)).data,b=a&&typeof a=="object"&&"stalls"in a?a.stalls:a,v=b.reduce((P,u)=>{var F,$;return(F=u==null?void 0:u.dimensions)!=null&&F.width&&(($=u==null?void 0:u.dimensions)!=null&&$.height)?P+u.dimensions.width*u.dimensions.height:P},0);A({totalStalls:b.length,totalArea:v})}catch(e){console.error("Failed to fetch total stats:",e),A({totalStalls:0,totalArea:0})}},[i,l,d,h,m,x]),q=E.useCallback(e=>{i&&l&&(y(R({exhibitionId:i,hallId:l==="all"?void 0:l,page:e.page||X,limit:e.size||p,search:e.search||void 0,status:e.status||void 0,sortBy:e.sortBy||m,sortOrder:e.sortOrder||(x==="ascend"?"asc":"desc")})),T())},[y,i,l,X,p,m,x,T]);E.useEffect(()=>{if(!i||!l)return;const e=setTimeout(()=>{if(i&&l){const t=Y.current;y(R({exhibitionId:i,hallId:l==="all"?void 0:l,page:1,limit:t.pageSize,search:d||void 0,status:t.statusFilter||void 0,sortBy:t.sortField,sortOrder:t.sortOrder==="ascend"?"asc":"desc"})),C(1),T()}},500);return()=>clearTimeout(e)},[d,i,l,y,T]);const me=e=>{ce(e),C(1),q({page:1,search:d||void 0,status:e})},xe=(e,t)=>{de(e),he(t),C(1),q({page:1,search:d||void 0,status:h,sortBy:e,sortOrder:t==="ascend"?"asc":"desc"})},J=(e,t)=>{C(e),t&&t!==p&&ue(t),q({page:e,size:t||p,search:d||void 0,status:h})},Q=async(e=!0)=>{var t,a;try{let o=B;if(e&&i&&l){const n={page:1,limit:1e4,search:d||void 0,status:h||void 0,sortBy:m,sortOrder:x==="ascend"?"asc":"desc"},g=(l==="all"?await w.getStalls(i,void 0,n):await w.getStalls(i,l,n)).data;o=g&&typeof g=="object"&&"stalls"in g?g.stalls:g}const b=o.map(n=>{var O,g;return{"Stall Number":n.number,Hall:((O=S.find(V=>V._id===n.hallId))==null?void 0:O.name)||"N/A","Stall Type":((g=n.stallType)==null?void 0:g.name)||"N/A","Dimensions (W×H)":`${n.dimensions.width}×${n.dimensions.height}`,"Area (sq.m)":f(n.dimensions),"Rate per Sq.m":`₹${n.ratePerSqm.toLocaleString()}`,"Total Price":`₹${(n.ratePerSqm*f(n.dimensions)).toLocaleString()}`,Status:n.status.charAt(0).toUpperCase()+n.status.slice(1),"Position (X,Y)":`${n.dimensions.x},${n.dimensions.y}`,"Created Date":new Date(n.createdAt||Date.now()).toLocaleDateString()}}),v=z.book_new(),P=z.json_to_sheet(b),u=[{wch:15},{wch:20},{wch:15},{wch:15},{wch:12},{wch:15},{wch:18},{wch:12},{wch:15},{wch:15}];P["!cols"]=u,z.book_append_sheet(v,P,"Stalls");const F=((t=L.find(n=>n._id===i))==null?void 0:t.name)||"Exhibition",$=l==="all"?"All-Halls":((a=S.find(n=>n._id===l))==null?void 0:a.name)||"Hall",fe=new Date().toISOString().split("T")[0],ye=`${F}-${$}-Stalls-${fe}.xlsx`;we(v,ye),se.success(`Exported ${o.length} stalls to Excel successfully!`)}catch(o){console.error("Export failed:",o),se.error("Failed to export stalls. Please try again.")}},Se=e=>{ne(e),W(null),y({type:"exhibition/clearStalls"}),A({totalStalls:0,totalArea:0})},pe=e=>{W(e),C(1),i&&e?(y(R({exhibitionId:i,hallId:e==="all"?void 0:e,page:1,limit:p,search:d||void 0,status:h||void 0,sortBy:m,sortOrder:x==="ascend"?"asc":"desc"})),T()):(y({type:"exhibition/clearStalls"}),A({totalStalls:0,totalArea:0}))};r.useEffect(()=>{(async()=>{try{k(!0),console.log("Fetching exhibitions...");const t=await w.getActiveExhibitions();console.log("Exhibitions response:",t.data),ie(t.data)}catch(t){console.error("Failed to fetch exhibitions:",t)}finally{k(!1)}})()},[]),r.useEffect(()=>{i?(async()=>{try{k(!0),console.log("Fetching halls for exhibition:",i);const t=await w.getHalls(i);console.log("Halls response:",t.data),K(t.data)}catch(t){console.error("Failed to fetch halls:",t)}finally{k(!1)}})():K([])},[i]);const B=ae,ge=e=>{switch(e){case"available":return"success";case"booked":return"warning";case"reserved":return"processing";case"sold":return"error";default:return"default"}},U={totalStalls:M.totalStalls,totalSize:M.totalArea};return s.jsx("div",{className:"dashboard-container",children:s.jsx("div",{style:{marginBottom:"24px"},children:s.jsxs(N,{gutter:[24,24],children:[s.jsx(c,{span:24,children:s.jsxs(N,{justify:"space-between",align:"middle",children:[s.jsx(c,{children:s.jsxs(Z,{direction:"vertical",size:4,children:[s.jsx($e,{level:4,style:{margin:0},children:"Stalls"}),s.jsx(Ne,{type:"secondary",children:"Manage your exhibition stalls"})]})}),s.jsx(c,{children:s.jsxs(Z,{children:[s.jsx(ee,{icon:s.jsx(te,{}),onClick:()=>Q(!1),disabled:!l||B.length===0,children:"Export Current Page"}),s.jsx(ee,{type:"primary",icon:s.jsx(te,{}),onClick:()=>Q(!0),disabled:!l,children:"Export All Stalls"})]})})]})}),s.jsx(c,{span:24,children:s.jsxs(N,{gutter:[16,16],align:"middle",children:[s.jsx(c,{xs:24,sm:12,md:6,children:s.jsx(I,{style:{width:"100%"},placeholder:"Select Exhibition",value:i,onChange:Se,allowClear:!0,children:L.map(e=>s.jsx(j,{value:e._id||e.id,children:e.name},e._id||e.id))})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsxs(I,{style:{width:"100%"},placeholder:"Select Hall",value:l,onChange:pe,disabled:!i||S.length===0,allowClear:!0,children:[s.jsxs(j,{value:"all",children:["All Halls (",S.length," halls)"]},"all-halls"),S.map(e=>s.jsx(j,{value:e._id||e.id,children:e.name},e._id||e.id))]})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsx(Ce,{placeholder:"Search by stall number",prefix:s.jsx(Te,{}),value:d,onChange:e=>re(e.target.value),allowClear:!0})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsxs(I,{style:{width:"100%"},placeholder:"Filter by status",value:h,onChange:me,allowClear:!0,children:[s.jsx(j,{value:"available",children:"Available"}),s.jsx(j,{value:"booked",children:"Booked"}),s.jsx(j,{value:"reserved",children:"Reserved"}),s.jsx(j,{value:"sold",children:"Sold"})]})})]})}),s.jsx(c,{span:24,children:s.jsx(Pe,{size:"small",children:s.jsxs(N,{gutter:16,children:[s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(_,{title:"Total Stalls",value:U.totalStalls,prefix:s.jsx(D,{})})}),s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(_,{title:"Total Area",value:U.totalSize,suffix:"sqm",prefix:s.jsx(Ee,{}),precision:2})}),l==="all"&&s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(_,{title:"Halls",value:S.length,prefix:s.jsx(D,{})})}),l!=="all"&&l&&s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(_,{title:"Current Hall",value:((G=S.find(e=>(e._id||e.id)===l))==null?void 0:G.name)||"N/A",prefix:s.jsx(D,{})})})]})})}),s.jsx(c,{span:24,children:s.jsx(ke,{columns:[{title:"Stall Number",dataIndex:"number",key:"number",sorter:(e,t)=>e.number.localeCompare(t.number),defaultSortOrder:"ascend"},...l==="all"?[{title:"Hall",key:"hall",render:(e,t)=>{const a=S.find(o=>(o._id||o.id)===t.hallId);return(a==null?void 0:a.name)||"N/A"}}]:[],{title:"Type",dataIndex:["stallType","name"],key:"type",render:(e,t)=>{var a;return((a=t.stallType)==null?void 0:a.name)||"N/A"}},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"ratePerSqm",render:e=>e?`₹${e.toLocaleString()}`:"N/A",sorter:(e,t)=>(e.ratePerSqm||0)-(t.ratePerSqm||0)},{title:"Area (sqm)",key:"area",render:(e,t)=>t!=null&&t.dimensions?`${f(t.dimensions)} sqm`:"N/A",sorter:(e,t)=>{const a=e.dimensions?f(e.dimensions):0,o=t.dimensions?f(t.dimensions):0;return a-o}},{title:"Dimensions",key:"dimensions",render:(e,t)=>{var a,o;return(a=t==null?void 0:t.dimensions)!=null&&a.width&&((o=t==null?void 0:t.dimensions)!=null&&o.height)?`${t.dimensions.width}m × ${t.dimensions.height}m`:"N/A"}},{title:"Total Price",key:"totalPrice",render:(e,t)=>{if(t!=null&&t.dimensions&&t.ratePerSqm){const a=f(t.dimensions);return`₹${(t.ratePerSqm*a).toLocaleString()}`}return"N/A"},sorter:(e,t)=>{const a=e.dimensions?f(e.dimensions):0,o=t.dimensions?f(t.dimensions):0,b=(e.ratePerSqm||0)*a,v=(t.ratePerSqm||0)*o;return b-v}},{title:"Status",dataIndex:"status",key:"status",render:e=>s.jsx(Fe,{color:ge(e),style:{textTransform:"capitalize"},children:e||"N/A"}),filters:[{text:"Available",value:"available"},{text:"Booked",value:"booked"},{text:"Reserved",value:"reserved"},{text:"Sold",value:"sold"}],onFilter:(e,t)=>t.status===e}],dataSource:B,rowKey:e=>e._id||e.id,loading:oe||le,pagination:{current:H.currentPage,pageSize:H.pageSize,total:H.totalCount,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} stalls`,onChange:J,onShowSizeChange:J,pageSizeOptions:["10","25","50","100"]},onChange:(e,t,a)=>{a.field&&a.order&&xe(a.field,a.order)}})})]})})})};export{De as default};
