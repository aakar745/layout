import{j as e,c as Y,d as q,m as H,e as K,r as Z}from"./index-aoH9EzMk.js";import{Z as w,r as g,ag as z,Y as C,D as J,ab as $,a9 as M,aa as B,$ as V,T as L,S as R,i as _,aO as Q,F as X,p as ee,by as se,aS as ie,A as te,f as F,bC as le,j as re,a0 as oe,bP as ne,aW as ae}from"./vendor-Be5M1UDi.js";import"./apis-CU9I9MMq.js";import"./canvas-C-A9eff5.js";const{Text:U}=L,de=[{key:"dashboard_view",label:"View Dashboard",group:"Dashboard"},{key:"dashboard_manage",label:"Manage Dashboard",group:"Dashboard"},{key:"users_view",label:"View Users",group:"Users"},{key:"users_create",label:"Create Users",group:"Users"},{key:"users_edit",label:"Edit Users",group:"Users"},{key:"users_delete",label:"Delete Users",group:"Users"},{key:"roles_view",label:"View Roles",group:"Roles"},{key:"roles_create",label:"Create Roles",group:"Roles"},{key:"roles_edit",label:"Edit Roles",group:"Roles"},{key:"roles_delete",label:"Delete Roles",group:"Roles"},{key:"exhibitions_view",label:"View Exhibitions",group:"Exhibitions"},{key:"exhibitions_create",label:"Create Exhibitions",group:"Exhibitions"},{key:"exhibitions_edit",label:"Edit Exhibitions",group:"Exhibitions"},{key:"exhibitions_delete",label:"Delete Exhibitions",group:"Exhibitions"},{key:"bookings_view",label:"View Bookings",group:"Bookings"},{key:"bookings_create",label:"Create Bookings",group:"Bookings"},{key:"bookings_edit",label:"Edit Bookings",group:"Bookings"},{key:"bookings_delete",label:"Delete Bookings",group:"Bookings"},{key:"exhibitors_view",label:"View Exhibitors",group:"Exhibitors"},{key:"exhibitors_create",label:"Create Exhibitors",group:"Exhibitors"},{key:"exhibitors_edit",label:"Edit Exhibitors",group:"Exhibitors"},{key:"exhibitors_delete",label:"Delete Exhibitors",group:"Exhibitors"},{key:"settings_view",label:"View Settings",group:"Settings"},{key:"settings_edit",label:"Edit Settings",group:"Settings"}],D=de.reduce((r,o)=>(r[o.group]||(r[o.group]=[]),r[o.group].push({key:o.key,label:o.label}),r),{}),ce=({visible:r,onCancel:o,onSave:u,role:n,loading:j})=>{const[a]=w.useForm(),m=!!n,[d,b]=g.useState([]);g.useEffect(()=>{if(r)if(n){const t=n.permissions||[];a.setFieldsValue({name:n.name,description:n.description,permissions:t}),b(t)}else a.resetFields(),b([])},[r,n,a]);const x=()=>{a.setFieldsValue({permissions:d}),a.validateFields().then(t=>{u(t)})},f=t=>{const c=D[t].map(l=>l.key);return c.length>0&&c.every(l=>d.includes(l))},E=(t,c)=>{let l;c?l=[...d,t]:l=d.filter(h=>h!==t),b(l)},k=(t,c)=>{const l=D[t].map(p=>p.key);let h;if(c){const p=l.filter(A=>!d.includes(A));h=[...d,...p]}else h=d.filter(p=>!l.includes(p));b(h)},P=t=>d.includes(t);return e.jsx(z,{title:m?"Edit Role":"Add New Role",open:r,onCancel:o,width:700,footer:[e.jsx(_,{onClick:o,children:"Cancel"},"cancel"),e.jsx(_,{type:"primary",loading:j,onClick:x,children:m?"Update":"Create"},"submit")],children:e.jsxs(w,{form:a,layout:"vertical",initialValues:{name:"",description:"",permissions:[]},children:[e.jsx(w.Item,{name:"name",label:"Role Name",rules:[{required:!0,message:"Please enter a role name"}],children:e.jsx(C,{placeholder:"e.g., Administrator, Editor, Viewer"})}),e.jsx(w.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please provide a description"}],children:e.jsx(C.TextArea,{placeholder:"Describe the purpose of this role",rows:3})}),e.jsx(J,{plain:!0,children:"Permissions"}),e.jsx(w.Item,{name:"permissions",hidden:!0,children:e.jsx(C,{})}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 8px"},children:Object.entries(D).map(([t,c])=>e.jsx($,{size:"small",title:e.jsxs(R,{children:[e.jsx(U,{strong:!0,children:t}),e.jsx(V,{checked:f(t),onChange:l=>k(t,l.target.checked),children:"Select All"})]}),style:{marginBottom:16},children:e.jsx(M,{gutter:[16,12],children:c.map(l=>e.jsx(B,{span:12,children:e.jsx(V,{checked:P(l.key),onChange:h=>E(l.key,h.target.checked),children:e.jsx(U,{children:l.label})})},l.key))})},t))})]})})},{Title:S,Paragraph:W,Text:y}=L,{confirm:he}=z;function I({allowed:r}){return r?e.jsx(oe,{className:"text-success",style:{color:"#52c41a",fontSize:16}}):e.jsx(ne,{className:"text-danger",style:{color:"#f5222d",fontSize:16}})}function me(){const{message:r,notification:o}=Q.useApp(),u=X(),{roles:n,loading:j,error:a}=ee(s=>s.role),[m,d]=g.useState(""),[b,x]=g.useState(!1),[f,E]=g.useState(null),{hasPermission:k}=Y();g.useEffect(()=>{u(q())},[u]),g.useEffect(()=>{a&&o.error({message:"Error",description:a})},[a,o]);const P=()=>{E(null),x(!0)},t=s=>{E(s),x(!0)},c=s=>{f?u(H({id:f._id,roleData:s})).unwrap().then(()=>{x(!1),r.success("Role updated successfully")}).catch(i=>{r.error(`Failed to update role: ${i.message}`)}):u(K(s)).unwrap().then(()=>{x(!1),r.success("Role created successfully")}).catch(i=>{r.error(`Failed to create role: ${i.message}`)})},l=s=>{he({title:"Are you sure you want to delete this role?",icon:e.jsx(ae,{}),content:`This will permanently delete the ${s.name} role. This action cannot be undone.`,okText:"Yes, delete it",okType:"danger",cancelText:"Cancel",onOk(){u(Z(s._id)).unwrap().then(()=>{r.success(`${s.name} role deleted successfully`)}).catch(i=>{r.error(`Failed to delete role: ${i.message}`)})}})},h=[{title:"Role",dataIndex:"name",key:"name",render:(s,i)=>e.jsxs(R,{children:[e.jsx(te,{style:{backgroundColor:N(i.name)},children:s.charAt(0).toUpperCase()}),e.jsx(y,{strong:!0,children:s})]})},{title:"Description",dataIndex:"description",key:"description",render:s=>e.jsx(y,{type:"secondary",children:s})},{title:"Read",key:"read",align:"center",render:(s,i)=>e.jsx(I,{allowed:p(i)})},{title:"Write",key:"write",align:"center",render:(s,i)=>e.jsx(I,{allowed:A(i)})},{title:"Delete",key:"delete",align:"center",render:(s,i)=>e.jsx(I,{allowed:G(i)})},{title:"Actions",key:"actions",align:"right",render:(s,i)=>e.jsxs(R,{children:[k("roles_edit")&&e.jsx(F,{title:i.name==="Administrator"?"Administrator role cannot be edited":"Edit role",children:e.jsx(_,{type:"primary",shape:"circle",icon:e.jsx(le,{}),size:"small",onClick:()=>t(i),disabled:i.name==="Administrator"})}),k("roles_delete")&&e.jsx(F,{title:"Delete role",children:e.jsx(_,{danger:!0,shape:"circle",icon:e.jsx(re,{}),size:"small",onClick:()=>l(i),disabled:i.name==="Administrator"})})]})}],p=s=>s.permissions.some(i=>i.endsWith("_view")),A=s=>s.permissions.some(i=>i.endsWith("_create")||i.endsWith("_edit")),G=s=>s.permissions.some(i=>i.endsWith("_delete")),N=s=>{const i=["#1677ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#eb2f96"];let v=0;for(let T=0;T<s.length;T++)v=s.charCodeAt(T)+((v<<5)-v);return i[Math.abs(v)%i.length]},O=n.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.description.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{style:{padding:"12px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(S,{level:2,children:"Roles & Permissions"}),e.jsx(W,{children:"Manage role-based access control and permissions for your users."})]}),e.jsxs($,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},loading:j&&n.length===0,children:[e.jsxs(M,{gutter:16,style:{marginBottom:16},children:[e.jsx(B,{span:16,children:e.jsx(C,{placeholder:"Search roles...",allowClear:!0,value:m,onChange:s=>d(s.target.value),prefix:e.jsx(y,{type:"secondary",style:{fontSize:16},children:"🔍"})})}),e.jsx(B,{span:8,style:{textAlign:"right"},children:k("roles_create")&&e.jsx(_,{type:"primary",icon:e.jsx(se,{}),style:{borderRadius:6},onClick:P,children:"Add Role"})})]}),e.jsx(ie,{columns:h,dataSource:O,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(s,i)=>`Showing ${i[0]}-${i[1]} of ${s} roles`},style:{marginTop:8},loading:j&&n.length>0})]}),e.jsx($,{title:e.jsx(S,{level:4,style:{margin:0},children:"Role Management Tips"}),style:{marginTop:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[e.jsxs(R,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(S,{level:5,children:"Best Practices"}),e.jsxs("ul",{style:{paddingLeft:20},children:[e.jsx("li",{children:e.jsx(y,{children:"Follow the principle of least privilege"})}),e.jsx("li",{children:e.jsx(y,{children:"Regularly audit user roles"})}),e.jsx("li",{children:e.jsx(y,{children:"Document role responsibilities"})})]})]}),e.jsxs(R,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(S,{level:5,children:"Role Inheritance"}),e.jsx(W,{children:"Higher-level roles automatically include permissions from lower-level roles to ensure consistency."})]})]})}),e.jsx(ce,{visible:b,onCancel:()=>x(!1),onSave:c,role:f,loading:j})]})}export{me as default};
