import{r as e,j as i,ad as n,X as a,a as o,ag as t,R as s,U as l,T as d,aj as r,V as c,Z as m}from"./vendor-others-aeGeD6f-.js";import{I as u}from"./component-invoice-D8MH7a8A.js";import{D as h,f as x,u as p,E as b}from"./store-D4NI4RZ9.js";import{f as v,a as g}from"./services-DHEt1Qtz.js";/* empty css                   */import{b as y,c as j,u as I,a as k}from"./vendor-react-i7tvbPTl.js";import{F as f}from"./vendor-antd-form-DJHhvp8w.js";import{c as w,e as S,P as C,I as N,s as A,i as L,T as _,k as E,f as O,d as T,o as F}from"./vendor-antd-core-CLD06I8y.js";import{B as D}from"./vendor-antd-buttons-wjEWA2x8.js";import{M}from"./vendor-antd-modal-1GBGM2fb.js";import{d as P}from"./vendor-utils-CTzFqUk0.js";import{F as $}from"./vendor-antd-table-CA0XBoxE.js";const R=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{id:s}=y(),l=j(),{data:d,isLoading:r}=h(s||""),[c,m]=e.useState(!1),[x,p]=e.useState(!1),[b]=f.useForm(),[I,k]=e.useState(0),[L,_]=e.useState(!1);return r||!d?i.jsx("div",{children:"Loading..."}):i.jsxs("div",{style:{padding:"24px"},children:[i.jsx(w,{title:"Invoice Details",extra:i.jsxs(S,{direction:"vertical",style:{width:"100%"},children:[i.jsxs(S,{children:[i.jsx(D,{icon:i.jsx(n,{}),onClick:()=>l(-1),disabled:L,children:"Back"}),i.jsx(D,{type:"primary",icon:i.jsx(a,{}),onClick:async()=>{if(s)try{_(!0),k(0),A.loading({content:"Preparing invoice...",key:"download"});const e=await v(`/invoices/${s}/download?force=false`,!1,(e=>{const i=e.total,n=e.loaded;if(i){const e=Math.round(100*n/i);k(e),e%25==0&&A.loading({content:`Downloading: ${e}% complete`,key:"download"})}})),i=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=i,n.setAttribute("download",`invoice-${s}.pdf`),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(i),A.success({content:"Invoice downloaded successfully",key:"download"})}catch(e){A.error({content:"Failed to download invoice",key:"download"})}finally{_(!1),k(0)}},loading:L&&I<100,disabled:L&&I>=100,children:"Download"}),i.jsx(D,{icon:i.jsx(o,{}),onClick:()=>m(!0),disabled:L,children:"Share via Email"}),i.jsx(D,{icon:i.jsx(t,{}),onClick:()=>p(!0),disabled:L,children:"Share via WhatsApp"})]}),L&&i.jsx(C,{percent:I,size:"small",status:"active",style:{marginBottom:0,marginTop:4}})]}),children:i.jsx(u,{booking:{...d.bookingId,customerGSTIN:d.bookingId.customerGSTIN||"",invoiceNumber:d.invoiceNumber,exhibitionId:{...d.bookingId.exhibitionId,companyName:d.bookingId.exhibitionId.companyName||"Company Name",bankName:d.bookingId.exhibitionId.bankName||"",bankAccount:d.bookingId.exhibitionId.bankAccount||"",bankAccountName:d.bookingId.exhibitionId.bankAccountName||"",bankBranch:d.bookingId.exhibitionId.bankBranch||"",bankIFSC:d.bookingId.exhibitionId.bankIFSC||"",companyCIN:d.bookingId.exhibitionId.companyCIN||"",companyPAN:d.bookingId.exhibitionId.companyPAN||"",companySAC:d.bookingId.exhibitionId.companySAC||"",companyGST:d.bookingId.exhibitionId.companyGST||"",companyEmail:d.bookingId.exhibitionId.companyEmail||"",companyWebsite:d.bookingId.exhibitionId.companyWebsite||"",companyAddress:d.bookingId.exhibitionId.companyAddress||"",headerLogo:d.bookingId.exhibitionId.headerLogo||void 0},calculations:{...d.bookingId.calculations,stalls:d.bookingId.calculations.stalls.map((e=>({discount:e.discount?{...e.discount,type:e.discount.type||"percentage",value:e.discount.value}:void 0})))}}})}),i.jsx(M,{title:"Share Invoice via Email",open:c,onCancel:()=>m(!1),footer:null,children:i.jsxs(f,{form:b,onFinish:async e=>{try{await g.post(`/invoices/${s}/share/email`,e),A.success("Invoice shared via email successfully"),m(!1),b.resetFields()}catch(i){A.error("Failed to share invoice via email")}},layout:"vertical",children:[i.jsx(f.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter email address"},{type:"email",message:"Please enter a valid email address"}],children:i.jsx(N,{placeholder:"Enter email address"})}),i.jsx(f.Item,{name:"message",label:"Message (Optional)",children:i.jsx(N.TextArea,{placeholder:"Enter optional message"})}),i.jsx(f.Item,{children:i.jsx(D,{type:"primary",htmlType:"submit",children:"Send"})})]})}),i.jsx(M,{title:"Share Invoice via WhatsApp",open:x,onCancel:()=>p(!1),footer:null,children:i.jsxs(f,{form:b,onFinish:async e=>{try{await g.post(`/invoices/${s}/share/whatsapp`,e),A.success("Invoice shared via WhatsApp successfully"),p(!1),b.resetFields()}catch(i){A.error("Failed to share invoice via WhatsApp")}},layout:"vertical",children:[i.jsx(f.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^\+?[1-9]\d{9,14}$/,message:"Please enter a valid phone number"}],children:i.jsx(N,{placeholder:"Enter phone number with country code"})}),i.jsx(f.Item,{children:i.jsx(D,{type:"primary",htmlType:"submit",children:"Send"})})]})})]})}},Symbol.toStringTag,{value:"Module"})),{Title:W,Text:B}=_,{Option:U}=O,{RangePicker:z}=T,Y=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var n;const t=j(),u=I(),[h,g]=e.useState(1),[y,f]=e.useState(10),[_,T]=e.useState(""),[R,Y]=e.useState(null),[G,q]=e.useState(null),[V,K]=e.useState(null),[X,Z]=e.useState(!1),[H,J]=e.useState(null),[Q,ee]=e.useState(""),[ie,ne]=e.useState(""),[ae,oe]=e.useState("createdAt"),[te,se]=e.useState("descend"),[le,de]=A.useMessage(),[re,ce]=e.useState(null),[me,ue]=e.useState(0),{exhibitions:he,loading:xe}=k((e=>e.exhibition));e.useEffect((()=>{u(x())}),[u]);const{data:pe,isLoading:be,refetch:ve}=p({page:h,limit:y}),[ge,{isLoading:ye}]=b(),je=s.useMemo((()=>(null==pe?void 0:pe.data)?pe.data.filter((e=>{const i=_.toLowerCase(),n=""===_||e.invoiceNumber&&e.invoiceNumber.toLowerCase().includes(i)||e._id.toLowerCase().includes(i)||e.bookingId.customerName&&e.bookingId.customerName.toLowerCase().includes(i)||e.bookingId.companyName&&e.bookingId.companyName.toLowerCase().includes(i),a=!R||e.status===R,o=!G||e.bookingId.exhibitionId&&e.bookingId.exhibitionId._id===G;let t=!0;if(V&&V[0]&&V[1]){const i=P(e.createdAt);t=i.isAfter(V[0])&&i.isBefore(V[1])}return n&&a&&o&&t})):[]),[pe,_,R,G,V]),Ie=[{title:"Invoice #",dataIndex:["invoiceNumber"],key:"invoiceNumber",sorter:!0,sortOrder:"invoiceNumber"===ae?te:null,render:(e,n)=>i.jsx("a",{onClick:()=>t(`/invoice/${n._id}`),children:e||"N/A"})},{title:"Company",dataIndex:["bookingId","companyName"],key:"companyName",sorter:!0,sortOrder:"companyName"===ae?te:null,render:e=>e||"N/A"},{title:"Exhibition",dataIndex:["bookingId","exhibitionId","name"],key:"exhibitionName",sorter:!0,sortOrder:"exhibitionName"===ae?te:null,render:(e,n)=>i.jsx("a",{onClick:()=>t(`/exhibition/${n.bookingId.exhibitionId._id}`),children:e})},{title:"Amount",dataIndex:"amount",key:"amount",sorter:!0,sortOrder:"amount"===ae?te:null,render:e=>`â‚¹${e.toLocaleString("en-IN")}`},{title:"Status",dataIndex:"status",key:"status",sorter:!0,sortOrder:"status"===ae?te:null,render:e=>i.jsx(F,{color:"paid"===e?"green":"pending"===e?"gold":"cancelled"===e?"red":"blue",children:e.toUpperCase()})},{title:"Due Date",dataIndex:"dueDate",key:"dueDate",sorter:!0,sortOrder:"dueDate"===ae?te:null,render:e=>e?P(e).format("DD MMM YYYY"):"N/A"},{title:"Created",dataIndex:"createdAt",key:"createdAt",sorter:!0,sortOrder:"createdAt"===ae?te:null,render:e=>P(e).format("DD MMM YYYY")},{title:"Actions",key:"actions",render:(e,n)=>i.jsxs(S,{direction:"vertical",size:"small",style:{width:"100%"},children:[i.jsxs(S,{children:[i.jsx(E,{title:"View Invoice",children:i.jsx(D,{type:"text",icon:i.jsx(m,{}),onClick:()=>t(`/invoice/${n._id}`)})}),i.jsx(E,{title:"Download",children:i.jsx(D,{type:"text",icon:i.jsx(a,{}),onClick:()=>(async e=>{try{ce(e),ue(0),le.loading({content:"Preparing invoice...",key:e});const i=await v(`/invoices/${e}/download?force=false`,!1,(i=>{const n=i.total,a=i.loaded;if(n){const i=Math.round(100*a/n);ue(i),i%25==0&&le.loading({content:`Downloading: ${i}% complete`,key:e})}})),n=window.URL.createObjectURL(new Blob([i.data])),a=document.createElement("a");a.href=n,a.setAttribute("download",`invoice-${e}.pdf`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(n),le.success({content:"Invoice downloaded successfully",key:e})}catch(i){le.error({content:"Failed to download invoice",key:e})}finally{ce(null),ue(0)}})(n._id),loading:re===n._id&&me<100,disabled:null!==re&&re!==n._id})}),i.jsx(E,{title:"Email",children:i.jsx(D,{type:"text",icon:i.jsx(o,{}),onClick:()=>{return e=n._id,J(e),void Z(!0);var e},disabled:null!==re})})]}),re===n._id&&i.jsx(C,{percent:me,size:"small",status:"active",style:{marginBottom:0,marginTop:4}})]})}];return i.jsxs(L,{children:[de,i.jsxs("div",{className:"invoice-list-container",children:[i.jsx(w,{children:i.jsxs(S,{direction:"vertical",style:{width:"100%"},size:"large",children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx(W,{level:2,style:{margin:0},children:"Invoices"}),i.jsx(S,{children:i.jsx(E,{title:"Refresh",children:i.jsx(D,{icon:i.jsx(l,{}),onClick:()=>ve(),loading:be})})})]}),i.jsx(w,{size:"small",title:i.jsxs(S,{children:[i.jsx(c,{})," Filters"]}),children:i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:[i.jsxs("div",{style:{minWidth:"200px",flex:1},children:[i.jsx(B,{strong:!0,children:"Search"}),i.jsx(N,{placeholder:"Search by invoice #, company...",value:_,onChange:e=>T(e.target.value),prefix:i.jsx(d,{}),allowClear:!0})]}),i.jsxs("div",{style:{minWidth:"150px"},children:[i.jsx(B,{strong:!0,children:"Status"}),i.jsxs(O,{style:{width:"100%"},placeholder:"Filter by status",value:R,onChange:Y,allowClear:!0,children:[i.jsx(U,{value:"pending",children:"Pending"}),i.jsx(U,{value:"paid",children:"Paid"}),i.jsx(U,{value:"cancelled",children:"Cancelled"})]})]}),i.jsxs("div",{style:{minWidth:"200px"},children:[i.jsx(B,{strong:!0,children:"Exhibition"}),i.jsx(O,{style:{width:"100%"},placeholder:"Filter by exhibition",value:G,onChange:q,loading:xe,allowClear:!0,children:he.map((e=>i.jsx(U,{value:e._id||e.id,children:e.name},e._id||e.id)))})]}),i.jsxs("div",{style:{minWidth:"300px"},children:[i.jsx(B,{strong:!0,children:"Date Range"}),i.jsx(z,{style:{width:"100%"},value:V,onChange:K})]}),i.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:i.jsx(D,{icon:i.jsx(r,{}),onClick:()=>{T(""),Y(null),q(null),K(null)},children:"Clear Filters"})})]})}),i.jsx($,{columns:Ie,dataSource:je,rowKey:"_id",loading:be,pagination:{current:h,pageSize:y,total:(null==(n=null==pe?void 0:pe.pagination)?void 0:n.total)||0,onChange:(e,i)=>{g(e),i&&f(i)},showSizeChanger:!0,showTotal:e=>`Total ${e} invoices`},onChange:(e,i,n)=>{n&&n.field&&(oe(n.field),se(n.order||"descend"))}})]})}),i.jsxs(M,{title:"Send Invoice via Email",open:X,onCancel:()=>Z(!1),onOk:async()=>{if(H&&Q)try{le.loading({content:"Sending email...",key:"email"}),await ge({id:H,email:Q,message:ie||void 0}).unwrap(),le.success({content:"Invoice sent via email successfully",key:"email"}),Z(!1),ee(""),ne(""),J(null)}catch(e){le.error({content:"Failed to send invoice via email",key:"email"})}},okText:"Send",confirmLoading:ye,children:[i.jsxs("div",{style:{marginBottom:16},children:[i.jsx(B,{strong:!0,children:"Email Address"}),i.jsx(N,{placeholder:"Enter recipient email",value:Q,onChange:e=>ee(e.target.value),style:{width:"100%"}})]}),i.jsxs("div",{children:[i.jsx(B,{strong:!0,children:"Message (Optional)"}),i.jsx(N.TextArea,{placeholder:"Enter optional message",value:ie,onChange:e=>ne(e.target.value),rows:4})]})]})]})]})}},Symbol.toStringTag,{value:"Module"}));export{Y as a,R as i};
