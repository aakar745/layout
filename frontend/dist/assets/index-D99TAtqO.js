import{j as e}from"./vendor-pdf-Cn0rG44s.js";import{y as se,z as $,G as v,n as N,H as z,e as R,k as ce,S as A,t as xe,ai as we,Z as re,al as Se,h as T,K as W,a6 as B,T as pe,f as _,a7 as ue,D as he,a as Ce,q as me,an as F,F as ke,v as K,w as b,i as ge,d as Ae,ac as Te,o as De,M as Y,ao as Re,r as k,ad as $e,af as _e}from"./vendor-antd-B8jUXf3i.js";import{b as je,u as de}from"./vendor-redux-rS0pI56E.js";import{O as ie,P as Ne,Q as ze,R as Be,q as Ee,z as Pe,b as Le,T as Fe}from"./index-bCNJQtew.js";import{V as Me,q as E,l as U,e as G,c as qe,Q as We,X as Ue}from"./vendor-antd-icons-BoTJB7uA.js";import{u as He}from"./reduxHooks-BvSvK4-5.js";import{u as ne,w as Oe,F as Ve}from"./FileSaver.min-D2Up8sHb.js";import{u as fe}from"./vendor-react-DW9h-haf.js";import"./vendor-http-t--hEgTQ.js";import"./vendor-ui-BmMA_ojr.js";import"./vendor-canvas-DrFPvyt4.js";const Ke=({bookings:t,paginationTotal:p,stats:h,statsLoading:i=!1})=>{const x=h||{total:p!==void 0?p:t.length,pending:t.filter(r=>r.status==="pending").length,approved:t.filter(r=>r.status==="approved").length,rejected:t.filter(r=>r.status==="rejected").length,confirmed:t.filter(r=>r.status==="confirmed").length,cancelled:t.filter(r=>r.status==="cancelled").length,totalRevenue:t.filter(r=>r.status==="confirmed"||r.status==="approved").reduce((r,n)=>r+n.amount,0),totalBaseAmount:t.reduce((r,n)=>{var s;return r+(((s=n.calculations)==null?void 0:s.totalBaseAmount)||0)},0)};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(N,{})}):e.jsx(z,{title:e.jsxs(R,{title:"Total count across all pages",children:["Total Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:x.total,prefix:e.jsx(Me,{})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(N,{})}):e.jsx(z,{title:e.jsxs(R,{title:"Count of all pending bookings",children:["Pending Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:x.pending,prefix:e.jsx(ce,{style:{color:"#faad14"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(N,{})}):e.jsx(z,{title:e.jsxs(R,{title:"Count of all approved bookings",children:["Approved Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:x.approved,prefix:e.jsx(U,{style:{color:"#52c41a"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(N,{})}):e.jsx(z,{title:e.jsxs(R,{title:"Count of all confirmed bookings",children:["Confirmed Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:x.confirmed,prefix:e.jsx(U,{style:{color:"#52c41a"}})})})})]}),e.jsxs(se,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(N,{})}):e.jsx(z,{title:e.jsxs(R,{title:"Count of all rejected bookings",children:["Rejected Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:x.rejected,prefix:e.jsx(G,{style:{color:"#f5222d"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(N,{})}):e.jsx(z,{title:e.jsxs(R,{title:"Count of all cancelled bookings",children:["Cancelled Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:x.cancelled,prefix:e.jsx(G,{style:{color:"#f5222d"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(N,{})}):e.jsx(z,{title:e.jsxs(R,{title:"Total revenue from all bookings",children:["Total Revenue ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:x.totalRevenue,precision:0,prefix:"₹"})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(N,{})}):e.jsx(z,{title:e.jsxs(R,{title:"Total base amount before taxes and discounts",children:["Total Base Amount ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:x.totalBaseAmount,precision:0,prefix:"₹",valueStyle:{color:"#1890ff"}})})})]})]})},{RangePicker:Ye}=Se,Ge=({filters:t,exhibitions:p,onFilterChange:h,onRefresh:i})=>e.jsx(v,{style:{marginBottom:"24px"},children:e.jsxs(A,{wrap:!0,children:[e.jsx(xe,{placeholder:"Search by company name",prefix:e.jsx(we,{}),value:t.search,onChange:u=>h({...t,search:u.target.value}),style:{width:200},allowClear:!0}),e.jsx(re,{placeholder:"Filter by exhibition",value:t.exhibition,onChange:u=>h({...t,exhibition:u}),style:{minWidth:200},allowClear:!0,options:p.map(u=>({label:u.name,value:u._id}))}),e.jsx(re,{mode:"multiple",placeholder:"Filter by status",value:t.status,onChange:u=>h({...t,status:u}),style:{minWidth:200},options:[{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"},{label:"Confirmed",value:"confirmed"},{label:"Cancelled",value:"cancelled"}]}),e.jsx(Ye,{onChange:u=>{var x,f;return h({...t,dateRange:u?[((x=u[0])==null?void 0:x.toISOString())||"",((f=u[1])==null?void 0:f.toISOString())||""]:null})}}),e.jsx(T,{icon:e.jsx(qe,{}),onClick:i,children:"Refresh"})]})}),{Title:jt,Text:j}=pe,Qe=({selectedBooking:t,isDetailsModalVisible:p,setIsDetailsModalVisible:h,setSelectedBooking:i,setIsStatusModalVisible:u,setSelectedStatus:x,setRejectionReasonText:f,formatBookingNumber:r})=>e.jsx(W,{title:"Booking Details",open:p,onCancel:()=>{h(!1),i(null)},footer:[e.jsx(T,{type:"primary",disabled:!t,onClick:()=>{t&&(x(t.status),f(t.rejectionReason||""),u(!0))},children:"Update Status"},"updateStatus"),e.jsx(T,{onClick:()=>{h(!1),i(null)},children:"Close"},"close")],width:800,children:t&&e.jsxs(A,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs(B,{bordered:!0,column:2,children:[e.jsxs(B.Item,{label:"Booking Number",span:2,children:[r(t._id,t.createdAt),e.jsxs(j,{type:"secondary",style:{marginLeft:8,fontSize:"12px"},children:["(ID: ",t._id,")"]})]}),e.jsx(B.Item,{label:"Exhibition",span:2,children:t.exhibitionId.name}),e.jsxs(B.Item,{label:"Status",span:2,children:[e.jsx(_,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()}),t.rejectionReason&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(j,{type:"secondary",children:"Rejection Reason:"}),e.jsx("br",{}),e.jsx(j,{children:t.rejectionReason})]})]}),e.jsx(B.Item,{label:"Customer Name",children:t.customerName}),e.jsx(B.Item,{label:"Customer Email",children:t.customerEmail}),e.jsx(B.Item,{label:"Customer Phone",children:t.customerPhone}),e.jsx(B.Item,{label:"Company Name",children:t.companyName})]}),e.jsx(v,{title:"Stall Details",size:"small",children:e.jsx(ue,{dataSource:t.stallIds,pagination:!1,rowKey:"_id",columns:[{title:"Stall Number",dataIndex:"number",key:"number"},{title:"Stall Type",key:"type",render:n=>n.type||"-"},{title:"Dimensions",key:"dimensions",render:n=>e.jsx(_,{color:"blue",children:n.dimensions?`${n.dimensions.width}x${n.dimensions.height}m`:"No dimensions"})},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"rate",render:n=>`₹${n.toLocaleString()}`},{title:"Base Amount",key:"baseAmount",render:n=>{const s=t.calculations.stalls.find(a=>a.stallId===n._id);return s?`₹${s.baseAmount.toLocaleString()}`:"-"}},{title:"Discount",key:"discount",render:n=>{const s=t.calculations.stalls.find(a=>a.stallId===n._id);return s!=null&&s.discount?e.jsx(R,{title:e.jsx("div",{children:s.discount.type==="percentage"&&` (${s.discount.value}%)`}),children:e.jsxs(_,{color:"red",children:["-₹",s.discount.amount.toLocaleString(),s.discount.type==="percentage"&&` (${s.discount.value}%)`]})}):"-"}}]})}),e.jsx(v,{title:"Financial Summary",size:"small",children:e.jsxs(A,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(j,{children:"Total Base Amount:"}),e.jsxs(j,{children:["₹",t.calculations.totalBaseAmount.toLocaleString()]})]}),t.calculations.totalDiscountAmount>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(j,{children:"Total Discount:"}),e.jsxs(j,{type:"danger",children:["-₹",t.calculations.totalDiscountAmount.toLocaleString()]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(j,{children:"Amount after Discount:"}),e.jsxs(j,{children:["₹",t.calculations.totalAmountAfterDiscount.toLocaleString()]})]}),e.jsx(he,{style:{margin:"8px 0"}}),t.calculations.taxes.map(n=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(j,{children:[n.name," (",n.rate,"%):"]}),e.jsxs(j,{children:["₹",n.amount.toLocaleString()]})]},`tax-${n.name}-${n.rate}`)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[e.jsx(j,{strong:!0,children:"Total Amount (incl. Taxes):"}),e.jsxs(j,{strong:!0,children:["₹",t.amount.toLocaleString()]})]})]})})]})}),Xe=({selectedBooking:t,isStatusModalVisible:p,setIsStatusModalVisible:h,selectedStatus:i,setSelectedStatus:u,rejectionReasonText:x,setRejectionReasonText:f,formatBookingNumber:r,refreshAfterAction:n})=>{const s=je(),[a,l]=Ce.useState(!1),{refetch:g}=ie({page:1,limit:100}),d=async(y,D,o)=>{try{l(!0),await s(Ne({id:y,status:D,...o&&{rejectionReason:o}})).unwrap(),b.success(`Booking ${D} successfully`),n(),h(!1),w(null),D==="approved"&&setTimeout(async()=>{await g()},1e3)}catch{b.error("Failed to update booking status")}finally{l(!1)}},w=y=>{};return e.jsx(W,{title:"Update Booking Status",open:p,onCancel:()=>{h(!1),f("")},footer:null,width:600,children:t&&e.jsxs("div",{children:[e.jsx(v,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(me,{style:{fontSize:"18px"}}),e.jsx("span",{children:"Booking Information"})]}),style:{marginBottom:16},variant:"borderless",size:"small",children:e.jsxs(A,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(_,{color:"processing",children:r(t._id,t.createdAt)}),e.jsx(_,{color:"default",children:t.exhibitionId.name}),e.jsx(_,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()})]}),e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx(j,{strong:!0,children:"Stall Details:"}),e.jsx("div",{style:{marginTop:"4px"},children:t.stallIds.map((y,D)=>e.jsxs(_,{style:{margin:"2px"},children:["#",y.number," ",y.type&&`(${y.type})`]},y._id))})]}),e.jsx(he,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(j,{strong:!0,style:{minWidth:"120px"},children:"Company:"}),e.jsx(j,{children:t.companyName})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(j,{strong:!0,style:{minWidth:"120px"},children:"Current Status:"}),e.jsx(_,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()})]})]})}),e.jsxs(v,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(We,{style:{fontSize:"18px"}}),e.jsx("span",{children:"Update Status"})]}),variant:"borderless",size:"small",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx(j,{strong:!0,children:"Select New Status:"}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsxs(F.Group,{value:i,onChange:y=>u(y.target.value),buttonStyle:"solid",style:{display:"flex",flexWrap:"nowrap",overflowX:"auto"},children:[e.jsx(F.Button,{value:"pending",style:{flex:"0 0 auto"},children:e.jsxs(A,{children:[e.jsx(ce,{style:{color:"#faad14"}}),"Pending"]})}),e.jsx(F.Button,{value:"approved",style:{flex:"0 0 auto"},children:e.jsxs(A,{children:[e.jsx(U,{style:{color:"#52c41a"}}),"Approved"]})}),e.jsx(F.Button,{value:"rejected",style:{flex:"0 0 auto"},children:e.jsxs(A,{children:[e.jsx(G,{style:{color:"#f5222d"}}),"Rejected"]})}),e.jsx(F.Button,{value:"confirmed",style:{flex:"0 0 auto"},children:e.jsxs(A,{children:[e.jsx(U,{style:{color:"#1890ff"}}),"Confirmed"]})}),e.jsx(F.Button,{value:"cancelled",style:{flex:"0 0 auto"},children:e.jsxs(A,{children:[e.jsx(G,{style:{color:"#ff7875"}}),"Cancelled"]})})]})})]}),i==="rejected"&&e.jsx("div",{children:e.jsx(ke.Item,{label:e.jsx(j,{strong:!0,children:"Rejection Reason:"}),required:i==="rejected",rules:[{required:!0,message:"Please provide a reason for rejection"}],help:"This will be visible to the customer",children:e.jsx(xe.TextArea,{rows:4,value:x,onChange:y=>f(y.target.value),placeholder:"Provide a reason for rejection",style:{marginTop:8}})})}),i==="approved"&&e.jsx(K,{message:"Approval Confirmation",description:"By approving this booking, the stalls will be reserved but not yet confirmed. Customer will be notified.",type:"success",showIcon:!0,style:{marginTop:8}}),i==="confirmed"&&e.jsx(K,{message:"Confirmation Notice",description:"By confirming this booking, the stalls will be marked as booked. This should be done after payment is received.",type:"info",showIcon:!0,style:{marginTop:8}}),i==="cancelled"&&e.jsx(K,{message:"Cancellation Warning",description:"By cancelling this booking, all stalls will be marked as available again.",type:"warning",showIcon:!0,style:{marginTop:8}}),i==="pending"&&e.jsx(K,{message:"Return to Pending",description:"This booking will be moved back to pending status.",type:"warning",showIcon:!0,style:{marginTop:8}})]}),e.jsxs("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end",gap:"8px"},children:[e.jsx(T,{onClick:()=>{h(!1),f("")},children:"Cancel"}),e.jsx(T,{type:"primary",onClick:()=>{if(i==="rejected"&&!x.trim()){b.error("Rejection reason is required when rejecting a booking");return}d(t._id,i,i==="rejected"?x:void 0)},loading:a,disabled:i==="rejected"&&!x.trim(),children:"Update Status"})]})]})]})})},Ze=(t,p,h)=>{W.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(ge,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Booking"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete booking ",e.jsx("strong",{children:h(t._id,t.createdAt)}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data including invoices."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(T,{onClick:()=>W.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(T,{danger:!0,type:"primary",onClick:()=>{p(t._id),W.destroyAll()},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},Je=t=>{const p=fe(),{data:h,isLoading:i,error:u,refetch:x}=ie({page:1,limit:100}),f=n=>{if(i||u||!h)return null;const a=(h.data||[]).find(l=>l.bookingId&&typeof l.bookingId=="object"&&l.bookingId._id===n);return a==null?void 0:a._id},r=async n=>{if(i){b.loading("Loading invoice data...");return}let s=f(n._id);if(s)p(`/invoice/${s}`);else{const a="invoice-loading";if(b.loading({content:"Checking for invoice...",key:a}),await x(),s=f(n._id),s){b.success({content:"Invoice found!",key:a,duration:1}),p(`/invoice/${s}`);return}const l=new Date(n.createdAt),g=new Date(Date.now()-30*60*1e3);if(l>g||n.status==="approved"){b.info({content:"Invoice is still being generated. Checking again in a moment...",key:a});let w=0;const y=5,D=[2e3,3e3,5e3,8e3,1e4],o=async()=>{w++,await x();const M=f(n._id);if(M)b.success({content:"Invoice is ready!",key:a,duration:1}),p(`/invoice/${M}`);else if(w<y){const H=D[w]||5e3,ae=H/1e3;b.info({content:`Attempt ${w}/${y}: Invoice not ready yet. Trying again in ${ae} seconds...`,key:a}),setTimeout(o,H)}else b.warning({content:"Invoice generation is taking longer than expected. Please try refreshing the page in a few moments.",key:a})};setTimeout(o,D[0])}else b.error({content:"No invoice found for this booking. Please contact support if this persists.",key:a})}};return[{title:"Booking Number",dataIndex:"_id",key:"bookingNumber",fixed:"left",width:170,render:(n,s)=>e.jsx(T,{type:"link",onClick:()=>{t.setSelectedBooking(s),t.setIsDetailsModalVisible(!0)},children:t.formatBookingNumber(n,s.createdAt)})},{title:"Exhibition",dataIndex:["exhibitionId","name"],key:"exhibition",width:250,render:(n,s)=>s.exhibitionId.name},{title:"Company Name",dataIndex:"companyName",key:"company",width:250,render:n=>n||"N/A"},{title:"Stall No.",key:"stallNumber",width:120,render:(n,s)=>e.jsx("span",{children:s.stallIds.map((a,l)=>e.jsxs("span",{children:[a.number,l<s.stallIds.length-1?", ":""]},`stall-${a._id||l}`))})},{title:"Stall Type",key:"stallType",width:120,render:(n,s)=>{const a=Array.from(new Set(s.stallIds.map(l=>l.type)));return e.jsx("span",{children:a.map((l,g)=>e.jsxs("span",{children:[l,g<a.length-1?", ":""]},`type-${l}-${g}`))})}},{title:"Dimensions",key:"dimensions",width:150,render:(n,s)=>e.jsx("span",{children:s.stallIds.map((a,l)=>e.jsxs("span",{children:[a.dimensions?`${a.dimensions.width}m × ${a.dimensions.height}m`:"No dimensions",l<s.stallIds.length-1?", ":""]},`dim-${a._id||l}`))})},{title:"Area (sqm)",key:"area",width:120,render:(n,s)=>{const a=s.stallIds.reduce((l,g)=>g.dimensions?l+g.dimensions.width*g.dimensions.height:l,0);return e.jsxs("span",{children:[Math.round(a)," sqm"]})}},{title:"Base Amount",dataIndex:["calculations","totalBaseAmount"],key:"baseAmount",width:150,render:n=>`₹${n.toLocaleString()}`},{title:"Discount",key:"discount",width:150,render:(n,s)=>{const a=s.calculations.totalDiscountAmount;if(!a||a===0)return"-";const l=s.calculations.stalls.filter(d=>d.discount).map(d=>d.discount);if(l.length===0)return"-";const g=l[0];return e.jsx(R,{title:e.jsx("div",{children:l.map((d,w)=>e.jsxs("div",{children:[d==null?void 0:d.name,": ",(d==null?void 0:d.type)==="percentage"?`${d==null?void 0:d.value}%`:`₹${d==null?void 0:d.value}`,e.jsx("br",{}),"Amount: ₹",d==null?void 0:d.amount.toLocaleString()]},`discount-${w}-${(d==null?void 0:d.name)||"unnamed"}`))}),children:e.jsxs(_,{color:"red",children:["-₹",a.toLocaleString(),(g==null?void 0:g.type)==="percentage"&&` (${g.value}%)`,l.length>1&&" +"]})})}},{title:"Total Amount",dataIndex:"amount",key:"amount",width:150,render:n=>`₹${n.toLocaleString()}`},{title:"Status",dataIndex:"status",key:"status",width:120,render:n=>e.jsx(_,{color:n==="confirmed"?"success":n==="approved"?"blue":n==="pending"?"warning":n==="rejected"?"error":"default",children:n.toUpperCase()})},{title:"Created At",dataIndex:"createdAt",key:"createdAt",width:200,render:n=>Ae(n).format("MMM D, YYYY HH:mm")},{title:"Actions",key:"actions",fixed:"right",width:220,render:(n,s)=>e.jsxs(A,{children:[e.jsx(R,{title:"View Details",children:e.jsx(T,{icon:e.jsx(Te,{}),onClick:()=>{t.setSelectedBooking(s),t.setIsDetailsModalVisible(!0)}})}),e.jsx(De,{overlay:e.jsxs(Y,{children:[s.status!=="cancelled"&&t.hasPermission("view_bookings")&&e.jsx(Y.Item,{icon:e.jsx(me,{}),disabled:i,onClick:()=>r(s),children:"View Invoice"},"invoice"),e.jsx(Y.Item,{icon:e.jsx(U,{}),onClick:()=>{t.setSelectedBooking(s),t.setSelectedStatus(s.status),t.setRejectionReasonText(s.rejectionReason||""),t.setIsStatusModalVisible(!0)},children:"Update Status"},"updateStatus"),t.hasPermission("bookings_delete")&&e.jsx(Y.Item,{icon:e.jsx(ge,{}),danger:!0,onClick:()=>{Ze(s,t.handleDelete,t.formatBookingNumber)},children:"Delete"},"delete")]}),trigger:["click"],children:e.jsx(T,{icon:e.jsx(Ue,{})})})]})}]},et=t=>{const{bookings:p,loading:h,pagination:i,fetchBookingsWithPagination:u}=t,x=Je(t),f=(r,n,s,a)=>e.jsx("div",{className:"ant-table-pagination ant-table-pagination-right",style:{padding:"16px 24px",margin:0,display:"flex",justifyContent:"flex-end"},children:e.jsx(Re,{current:r,pageSize:n,total:s,showTotal:l=>`Total ${l} items`,showSizeChanger:!0,pageSizeOptions:["5","10","20","50","100"],onChange:l=>a(l,n),onShowSizeChange:(l,g)=>a(l,g),size:"default"})});return e.jsxs(e.Fragment,{children:[e.jsx(ue,{columns:x,dataSource:p,loading:h,rowKey:"_id",scroll:{x:1800},pagination:!1}),f(i.page,i.limit,i.total,(r,n)=>u(r,n))]})},{Title:tt,Text:nt}=pe,ft=()=>{const t=je(),{bookings:p,loading:h,pagination:i,stats:u,statsLoading:x}=de(m=>m.booking),{exhibitions:f}=de(m=>m.exhibition),[r,n]=k.useState(null),[s,a]=k.useState(!1),[l,g]=k.useState(!1),[d,w]=k.useState("pending"),[y,D]=k.useState(""),[o,M]=k.useState({search:"",status:[],dateRange:null,exhibition:null}),H=fe(),{data:ae,isLoading:st,error:it,refetch:at}=ie({page:1,limit:100}),{hasPermission:ye}=He(),P=k.useCallback((m=1,S=10)=>{const C={page:m,limit:S};o.search&&(C.search=o.search),o.exhibition&&(C.exhibitionId=o.exhibition),o.status&&o.status.length>0&&(C.status=o.status),o.dateRange&&o.dateRange.length===2&&(C.startDate=o.dateRange[0],C.endDate=o.dateRange[1]),t(ze(C))},[t,o]),O=k.useCallback(()=>{t(Be())},[t]),Q=k.useCallback(()=>{P(i.page,i.limit),O()},[P,O,i.page,i.limit]);k.useEffect(()=>{P(i.page,i.limit),O()},[P,O,i.page,i.limit]),k.useEffect(()=>{t(Ee())},[t]),k.useEffect(()=>{p.length>0&&[...new Set(p.map(S=>S.exhibitionId._id))].forEach(S=>{t(Pe(S))})},[p,t]);const be=async m=>{try{await t(Fe(m)).unwrap(),b.success("Booking deleted successfully"),Q()}catch(S){b.error((S==null?void 0:S.message)||"Failed to delete booking")}},ve=m=>{M(m),P(1,i.limit)},X=Array.isArray(p)?p:[],V=(m,S)=>{const C=new Date(S).getFullYear(),L=X.find(c=>c._id===m);if(!L)return`--/${C}/--`;const J=(X.filter(c=>c.exhibitionId._id===L.exhibitionId._id).sort((c,ee)=>new Date(c.createdAt).getTime()-new Date(ee.createdAt).getTime()).findIndex(c=>c._id===m)+1).toString().padStart(2,"0"),q=f.find(c=>c._id===L.exhibitionId._id);return`${(q==null?void 0:q.invoicePrefix)||L.exhibitionId.invoicePrefix||"BK"}/${C}/${J}`},Ie=async()=>{try{b.loading({content:"Preparing export...",key:"export"});const m={};o.search&&(m.search=o.search),o.exhibition&&(m.exhibitionId=o.exhibition),o.status&&o.status.length>0&&(m.status=o.status),o.dateRange&&o.dateRange.length===2&&(m.startDate=o.dateRange[0],m.endDate=o.dateRange[1]);const C=(await Le.get("/bookings/export",{params:m})).data;if(!Array.isArray(C))throw new Error("Invalid data format received");const L=C.map(c=>{const ee=c.stallIds.reduce((I,te)=>te.dimensions?I+te.dimensions.width*te.dimensions.height:I,0);return{"Booking Number":V(c._id,c.createdAt),Exhibition:c.exhibitionId.name,"Company Name":c.companyName||"N/A","Customer Name":c.customerName,"Customer Email":c.customerEmail,"Customer Phone":c.customerPhone,"Stall Numbers":c.stallIds.map(I=>I.number).join(", "),"Stall Types":Array.from(new Set(c.stallIds.map(I=>I.type||(I.stallTypeId&&typeof I.stallTypeId=="object"?I.stallTypeId.name:"-")))).join(", "),Dimensions:c.stallIds.map(I=>I.dimensions?`${I.dimensions.width}m × ${I.dimensions.height}m`:"No dimensions").join(", "),"Total Area (sqm)":Math.round(ee),"Base Amount":Math.round(c.calculations.totalBaseAmount),Discount:Math.round(c.calculations.totalDiscountAmount),"Total Amount":Math.round(c.calculations.totalAmount),Status:c.status.toUpperCase(),"Created Date":new Date(c.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}}),le=ne.json_to_sheet(L),Z=ne.book_new();ne.book_append_sheet(Z,le,"Bookings");const J=Oe(Z,{bookType:"xlsx",type:"array"}),q=new Blob([J],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),oe=new Date().toISOString().split("T")[0];Ve.saveAs(q,`bookings_export_${oe}.xlsx`),b.success({content:"Export successful!",key:"export",duration:2})}catch(m){console.error("Export error:",m),b.error({content:"Failed to export bookings",key:"export",duration:2})}};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(se,{gutter:[24,24],align:"middle",children:[e.jsx($,{flex:"auto",children:e.jsxs(A,{direction:"vertical",size:4,children:[e.jsx(tt,{level:4,style:{margin:0},children:"Stall Bookings"}),e.jsx(nt,{type:"secondary",children:"Manage exhibition stall bookings"})]})}),e.jsx($,{children:e.jsxs(A,{children:[e.jsx(T,{icon:e.jsx($e,{}),onClick:Ie,size:"large",children:"Export"}),e.jsx(T,{type:"primary",size:"large",icon:e.jsx(_e,{}),onClick:()=>H("/bookings/create"),children:"Create Booking"})]})})]})}),e.jsx(Ke,{bookings:p,paginationTotal:i.total,stats:u,statsLoading:x}),e.jsx(Ge,{filters:o,exhibitions:f,onFilterChange:ve,onRefresh:Q}),e.jsx(v,{className:"info-card",styles:{body:{padding:0,overflow:"auto"},header:{paddingBottom:12}},title:"Booking List",children:e.jsx(et,{bookings:X,loading:h,fetchBookingsWithPagination:P,pagination:i,setSelectedBooking:n,setIsDetailsModalVisible:a,setIsStatusModalVisible:g,setSelectedStatus:w,setRejectionReasonText:D,formatBookingNumber:V,handleDelete:be,hasPermission:ye})}),e.jsx(Qe,{selectedBooking:r,isDetailsModalVisible:s,setIsDetailsModalVisible:a,setSelectedBooking:n,setIsStatusModalVisible:g,setSelectedStatus:w,setRejectionReasonText:D,formatBookingNumber:V}),e.jsx(Xe,{selectedBooking:r,isStatusModalVisible:l,setIsStatusModalVisible:g,selectedStatus:d,setSelectedStatus:w,rejectionReasonText:y,setRejectionReasonText:D,formatBookingNumber:V,refreshAfterAction:Q})]})};export{ft as default};
