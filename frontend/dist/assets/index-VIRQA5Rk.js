import{j as t,O,P as V,R as _,H as N,T as S,I as U,J as q,D as J,U as X,V as $,W as G}from"./index-0Suq5uxL.js";import{l as K,k as Q,u as k,j as Y,i as I,r as o}from"./vendor-react-BNeW3y6d.js";import"./vendor-canvas-BRbMLhVA.js";import{ae as Z,a5 as ee,S as C,a1 as te,c as D,aT as se,aP as ae}from"./vendor-antd--VDS8NUg.js";import"./vendor-utils-CtctGR1F.js";import"./vendor-styling-CU6mz1ss.js";const ie=({exhibitionId:i,destination:x="layout",label:f="Back to Layout"})=>{const c=k(),{currentExhibition:n}=I(s=>s.exhibition);return t.jsxs("div",{style:{marginBottom:"24px",position:"sticky",top:"16px",zIndex:10},children:[t.jsx(D,{icon:t.jsx(ae,{}),onClick:()=>c(J(n,x),{state:{exhibitionId:i}}),type:"default",size:"large",style:{borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",background:"white",borderColor:"transparent",fontWeight:500,padding:"0 16px",height:"42px",display:"flex",alignItems:"center",transition:"all 0.3s ease"},className:"back-button-hover",children:t.jsx("span",{style:{marginLeft:8},children:f})}),t.jsx("style",{children:`
        .back-button-hover:hover {
          transform: translateX(-5px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: #f0f5ff;
          border-color: #d6e4ff;
        }
      `})]})},ne=[{value:"all",label:"All Types"},{value:"sofa",label:"Sofas"},{value:"chair",label:"Chairs"},{value:"table",label:"Tables"},{value:"desk",label:"Desks"},{value:"plant",label:"Plants"},{value:"entrance",label:"Entrances"},{value:"exit",label:"Exits"},{value:"info",label:"Information"},{value:"restroom",label:"Restrooms"},{value:"food",label:"Food Areas"},{value:"custom",label:"Custom"}],xe=()=>{var w,F,j;const{message:i}=Z.useApp(),{id:x}=K(),f=Q(),c=k(),n=Y(),s=((w=f.state)==null?void 0:w.exhibitionId)||x,{currentExhibition:r,fixtures:p,halls:E,stalls:z,loading:re}=I(e=>e.exhibition),l=o.useRef(null),[R,d]=o.useState(!1),[m,b]=o.useState(null),[u,H]=o.useState({width:0,height:0}),[h,T]=o.useState("all"),[A,g]=o.useState([]);o.useEffect(()=>{if(!s){i.error("Exhibition ID not found"),c("/exhibitions");return}},[s,c,i]),o.useEffect(()=>{(async()=>{try{await n(N(s)).unwrap(),await n(S({exhibitionId:s})).unwrap(),await n(U(s)).unwrap(),await n(q({exhibitionId:s})).unwrap()}catch{i.error("Failed to load data")}})()},[s,n,i]),o.useEffect(()=>{g(h==="all"?p:p.filter(e=>e.type===h))},[p,h]),o.useEffect(()=>{const e=()=>{if(l.current){const{clientWidth:P,clientHeight:W}=l.current;H({width:Math.max(P||400,400),height:Math.max(W||400,400)})}};e();const a=new ResizeObserver(e);return l.current&&a.observe(l.current),window.addEventListener("resize",e),()=>{a.disconnect(),window.removeEventListener("resize",e)}},[]);const v=()=>{b(null),d(!0)},B=e=>{b(e),d(!!e)},y=async e=>{try{e.id||e._id?(await n(X({exhibitionId:s,id:e.id||e._id||"",data:e})).unwrap(),i.success("Fixture updated successfully")):(await n($({exhibitionId:s,data:e})).unwrap(),i.success("Fixture created successfully")),await n(S({exhibitionId:s})).unwrap(),d(!1)}catch(a){console.error("Failed to save fixture:",a),i.error(a.message||"Failed to save fixture")}},L=async e=>{try{const a=e.id||e._id;if(!a)throw new Error("Fixture ID is required");await n(G({exhibitionId:s,id:a})).unwrap(),i.success("Fixture deleted successfully"),d(!1),b(null)}catch(a){console.error("Failed to delete fixture:",a),i.error(a.message||"Failed to delete fixture")}},M=e=>{T(e)};return t.jsxs("div",{style:{padding:"24px",height:"100vh",display:"flex",flexDirection:"column"},children:[t.jsx(ie,{exhibitionId:s}),t.jsxs(ee,{title:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(C,{children:t.jsx("span",{children:"Fixture Management"})}),t.jsxs(C,{children:[t.jsx(te,{style:{width:180},value:h,onChange:M,options:ne}),t.jsx(D,{type:"primary",icon:t.jsx(se,{}),onClick:v,children:"Add Fixture"})]})]}),styles:{body:{flex:1,padding:0,overflow:"hidden",minHeight:"400px",position:"relative",background:"#fafafa"}},style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:"500px"},children:[t.jsx("div",{style:{padding:"8px 16px",background:"#f0f7ff",borderBottom:"1px solid #d6e8ff",color:"#0050b3",fontSize:"14px"},children:"Halls and stalls are shown for reference. Place fixtures relative to these elements to enhance visitor navigation."}),t.jsx("div",{ref:l,style:{position:"absolute",top:33,left:0,right:0,bottom:0,overflow:"hidden"},children:t.jsx(O,{children:u.width>0&&u.height>0&&(r==null?void 0:r.dimensions)&&t.jsx(V,{width:u.width,height:u.height,exhibitionWidth:r.dimensions.width,exhibitionHeight:r.dimensions.height,halls:E,stalls:z,fixtures:A,selectedFixture:m,onSelectFixture:B,onFixtureChange:y,onAddFixture:v,isFixtureMode:!0})})})]}),t.jsx(_,{visible:R,fixture:m,onCancel:()=>d(!1),onSubmit:y,onDelete:L,exhibitionWidth:((F=r==null?void 0:r.dimensions)==null?void 0:F.width)||100,exhibitionHeight:((j=r==null?void 0:r.dimensions)==null?void 0:j.height)||100})]})};export{xe as default};
