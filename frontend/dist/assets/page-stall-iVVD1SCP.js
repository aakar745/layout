import{r as e,R as s,j as t,T as l,ao as a,k as i,g as r}from"./vendor-others-aeGeD6f-.js";import{c as n,u as d,a as o}from"./vendor-react-i7tvbPTl.js";import{r as c}from"./store-D4NI4RZ9.js";import{c as u,s as m}from"./services-DHEt1Qtz.js";import"./page-dashboard-984XnN9x.js";import{R as h,C as x,e as p,T as j,f as v,I as y,c as g,z as f,l as S,g as b,o as w,i as C}from"./vendor-antd-core-CLD06I8y.js";import{B as k}from"./vendor-antd-buttons-wjEWA2x8.js";import{F as T}from"./vendor-antd-table-CA0XBoxE.js";import{F as A}from"./vendor-antd-form-DJHhvp8w.js";import{M as I}from"./vendor-antd-modal-1GBGM2fb.js";const{Title:P,Text:_}=j,{Option:q}=v,z=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=n(),m=d(),{stalls:j,loading:C}=o((e=>e.exhibition)),[A,I]=e.useState([]),[z,F]=e.useState([]),[M,N]=e.useState(null),[$,E]=e.useState(null),[L,O]=e.useState(!1),B=s.useMemo((()=>Math.max(...j.map((e=>e.ratePerSqm*e.dimensions.width*e.dimensions.height)),1e6)),[j]),R=s.useMemo((()=>{const e=Math.pow(10,Math.floor(Math.log10(B)));return Math.ceil(B/e)*e}),[B]),[D,V]=e.useState(""),[U,H]=e.useState(null),[K,G]=e.useState([0,R]),[J,Q]=e.useState("number"),[W,X]=e.useState("ascend");e.useEffect((()=>{(async()=>{try{O(!0);const e=await u.getActiveExhibitions();I(e.data)}catch(e){}finally{O(!1)}})()}),[]),e.useEffect((()=>{if(M){(async()=>{try{O(!0);const e=await u.getHalls(M);F(e.data)}catch(e){}finally{O(!1)}})()}else F([])}),[M]);const Y=s.useMemo((()=>j.filter((e=>{const s=!D||e.number.toLowerCase().includes(D.toLowerCase()),t=!U||e.status===U,l=!$||e.hallId===$,a=e.ratePerSqm*e.dimensions.width*e.dimensions.height,i=a>=K[0]&&a<=K[1];return s&&t&&l&&i})).sort(((e,s)=>"number"===J?"ascend"===W?e.number.localeCompare(s.number):s.number.localeCompare(e.number):0))),[j,D,U,$,K,J,W]),Z=e=>{switch(e){case"available":return"success";case"booked":return"warning";case"reserved":return"processing";case"sold":return"error";default:return"default"}},ee=(e=>{const s=e.reduce(((e,s)=>{var t,l;return(null==(t=null==s?void 0:s.dimensions)?void 0:t.width)&&(null==(l=null==s?void 0:s.dimensions)?void 0:l.height)?e+s.dimensions.width*s.dimensions.height:e}),0);return{totalStalls:e.length,totalSize:s}})(Y);return t.jsx("div",{className:"dashboard-container",children:t.jsx("div",{style:{marginBottom:"24px"},children:t.jsxs(h,{gutter:[24,24],children:[t.jsx(x,{span:24,children:t.jsxs(p,{direction:"vertical",size:4,style:{width:"100%"},children:[t.jsx(P,{level:4,style:{margin:0},children:"Stalls"}),t.jsx(_,{type:"secondary",children:"Manage your exhibition stalls"})]})}),t.jsx(x,{span:24,children:t.jsxs(h,{gutter:[16,16],align:"middle",children:[t.jsx(x,{xs:24,sm:12,md:6,children:t.jsx(v,{style:{width:"100%"},placeholder:"Select Exhibition",value:M,onChange:e=>{N(e),E(null),m({type:"exhibition/clearStalls"})},allowClear:!0,children:A.map((e=>t.jsx(q,{value:e._id||e.id,children:e.name},e._id||e.id)))})}),t.jsx(x,{xs:24,sm:12,md:6,children:t.jsx(v,{style:{width:"100%"},placeholder:"Select Hall",value:$,onChange:e=>{E(e),m(M&&e?c({exhibitionId:M,hallId:e}):{type:"exhibition/clearStalls"})},disabled:!M||0===z.length,allowClear:!0,children:z.map((e=>t.jsx(q,{value:e._id||e.id,children:e.name},e._id||e.id)))})}),t.jsx(x,{xs:24,sm:12,md:6,children:t.jsx(y,{placeholder:"Search by stall number",prefix:t.jsx(l,{}),value:D,onChange:e=>V(e.target.value),allowClear:!0})}),t.jsx(x,{xs:24,sm:12,md:6,children:t.jsxs(v,{style:{width:"100%"},placeholder:"Filter by status",value:U,onChange:H,allowClear:!0,children:[t.jsx(q,{value:"available",children:"Available"}),t.jsx(q,{value:"booked",children:"Booked"}),t.jsx(q,{value:"reserved",children:"Reserved"}),t.jsx(q,{value:"sold",children:"Sold"})]})})]})}),t.jsx(x,{span:24,children:t.jsx(g,{size:"small",children:t.jsxs(h,{gutter:16,children:[t.jsx(x,{xs:12,sm:12,md:6,children:t.jsx(f,{title:"Total Stalls",value:ee.totalStalls,prefix:t.jsx(a,{})})}),t.jsx(x,{xs:12,sm:12,md:6,children:t.jsx(f,{title:"Total Area",value:ee.totalSize,suffix:"sqm",prefix:t.jsx(i,{}),precision:2})})]})})}),t.jsx(x,{span:24,children:t.jsx(g,{size:"small",title:"Price Range Filter",children:t.jsxs(h,{gutter:16,children:[t.jsx(x,{span:24,style:{marginBottom:16},children:t.jsxs(p,{children:[t.jsx(k,{size:"small",onClick:()=>G([0,5e5]),children:"Under ₹5L"}),t.jsx(k,{size:"small",onClick:()=>G([5e5,1e6]),children:"₹5L - ₹10L"}),t.jsx(k,{size:"small",onClick:()=>G([1e6,2e6]),children:"₹10L - ₹20L"}),t.jsx(k,{size:"small",onClick:()=>G([2e6,R]),children:"Above ₹20L"}),t.jsx(k,{size:"small",onClick:()=>G([0,R]),children:"All"})]})}),t.jsx(x,{span:16,children:t.jsx(S,{range:!0,min:0,max:R,value:K,onChange:e=>G(e),step:Math.max(1e3,Math.floor(R/1e3)),tooltip:{formatter:e=>`₹${(e||0).toLocaleString()}`}})}),t.jsx(x,{span:4,children:t.jsx(b,{style:{width:"100%"},min:0,max:K[1],value:K[0],onChange:e=>G([e||0,K[1]]),formatter:e=>`₹ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?Number(e.replace(/[^\d.-]/g,"")):0,step:1e3})}),t.jsx(x,{span:4,children:t.jsx(b,{style:{width:"100%"},min:K[0],max:R,value:K[1],onChange:e=>G([K[0],e||R]),formatter:e=>`₹ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?Number(e.replace(/[^\d.-]/g,"")):0,step:1e3})})]})})}),t.jsx(x,{span:24,children:t.jsx(T,{columns:[{title:"Stall Number",dataIndex:"number",key:"number",sorter:(e,s)=>e.number.localeCompare(s.number),defaultSortOrder:"ascend"},{title:"Type",dataIndex:["stallType","name"],key:"type",render:(e,s)=>{var t;return(null==(t=s.stallType)?void 0:t.name)||"N/A"}},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"ratePerSqm",render:e=>e?`₹${e.toLocaleString()}`:"N/A",sorter:(e,s)=>(e.ratePerSqm||0)-(s.ratePerSqm||0)},{title:"Area (sqm)",key:"area",render:(e,s)=>{var t,l;if((null==(t=null==s?void 0:s.dimensions)?void 0:t.width)&&(null==(l=null==s?void 0:s.dimensions)?void 0:l.height)){return`${s.dimensions.width*s.dimensions.height} sqm`}return"N/A"},sorter:(e,s)=>{var t,l,a,i;return((null==(t=e.dimensions)?void 0:t.width)||0)*((null==(l=e.dimensions)?void 0:l.height)||0)-((null==(a=s.dimensions)?void 0:a.width)||0)*((null==(i=s.dimensions)?void 0:i.height)||0)}},{title:"Dimensions",key:"dimensions",render:(e,s)=>{var t,l;return(null==(t=null==s?void 0:s.dimensions)?void 0:t.width)&&(null==(l=null==s?void 0:s.dimensions)?void 0:l.height)?`${s.dimensions.width}m × ${s.dimensions.height}m`:"N/A"}},{title:"Total Price",key:"totalPrice",render:(e,s)=>{var t,l;if((null==(t=null==s?void 0:s.dimensions)?void 0:t.width)&&(null==(l=null==s?void 0:s.dimensions)?void 0:l.height)&&s.ratePerSqm){return`₹${(s.ratePerSqm*s.dimensions.width*s.dimensions.height).toLocaleString()}`}return"N/A"},sorter:(e,s)=>{var t,l,a,i;return(e.ratePerSqm||0)*((null==(t=e.dimensions)?void 0:t.width)||0)*((null==(l=e.dimensions)?void 0:l.height)||0)-(s.ratePerSqm||0)*((null==(a=s.dimensions)?void 0:a.width)||0)*((null==(i=s.dimensions)?void 0:i.height)||0)}},{title:"Status",dataIndex:"status",key:"status",render:e=>t.jsx(w,{color:Z(e),style:{textTransform:"capitalize"},children:e||"N/A"}),filters:[{text:"Available",value:"available"},{text:"Booked",value:"booked"},{text:"Reserved",value:"reserved"},{text:"Sold",value:"sold"}],onFilter:(e,s)=>s.status===e},{title:"Actions",key:"actions",render:(e,s)=>t.jsxs(p,{children:[t.jsx("a",{onClick:()=>r(`/stall/edit/${s._id||s.id}`),children:"Edit"}),t.jsx("a",{onClick:()=>r(`/stall/view/${s._id||s.id}`),children:"View"})]})}],dataSource:Y,rowKey:e=>e._id||e.id,loading:L||C,pagination:{total:Y.length,pageSize:10,showSizeChanger:!0,showTotal:e=>`Total ${e} stalls`},onChange:(e,s,t)=>{t.field&&(Q(t.field),X(t.order))}})})]})})})}},Symbol.toStringTag,{value:"Module"})),{Title:F,Text:M}=j,{TextArea:N}=y,{Search:$}=y,{Option:E}=v,L=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{n();const{message:s}=C.useApp(),[l,a]=e.useState(!1),[i]=A.useForm(),[d,o]=e.useState(!1),[c,u]=e.useState([]),[j,f]=e.useState(!1),[S,b]=e.useState(null);e.useEffect((()=>{P()}),[]),e.useEffect((()=>{var e;if(l&&S){const s=(null==(e=S.features)?void 0:e.map((e=>e.feature)).join(", "))||"";setTimeout((()=>{i.setFieldsValue({name:S.name,description:S.description,features:s,status:S.status})}),0)}else l&&(i.resetFields(),i.setFieldsValue({status:"active"}))}),[S,i,l]);const P=async()=>{try{f(!0);const e=await m.getStallTypes();u(e.data)}catch(e){s.error("Failed to fetch stall types: "+e.message)}finally{f(!1)}},_=[{title:"Type Name",dataIndex:"name",key:"name",sorter:(e,s)=>e.name.localeCompare(s.name)},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0},{title:"Features",dataIndex:"features",key:"features",render:e=>t.jsx(p,{wrap:!0,children:null==e?void 0:e.map((({feature:e})=>t.jsx(w,{children:e},e)))})},{title:"Status",dataIndex:"status",key:"status",render:e=>t.jsx(w,{color:"active"===e?"success":"default",children:e.toUpperCase()})},{title:"Actions",key:"actions",render:(e,l)=>t.jsxs(p,{children:[t.jsx(k,{type:"link",onClick:()=>(e=>{b(e),a(!0)})(l),children:"Edit"}),t.jsx(k,{type:"link",danger:!0,onClick:()=>(async e=>{try{await m.deleteStallType(e._id),s.success("Stall type deleted successfully"),P()}catch(t){s.error("Failed to delete stall type: "+t.message)}})(l),children:"Delete"})]})}];return t.jsxs("div",{className:"dashboard-container",children:[t.jsx("div",{style:{marginBottom:"24px"},children:t.jsxs(h,{justify:"space-between",align:"middle",children:[t.jsx(x,{children:t.jsxs(p,{direction:"vertical",size:4,children:[t.jsx(F,{level:4,style:{margin:0},children:"Stall Types"}),t.jsx(M,{type:"secondary",children:"Manage your stall types and configurations"})]})}),t.jsx(x,{children:t.jsxs(p,{children:[t.jsx($,{placeholder:"Search stall types",style:{width:200},onSearch:e=>{}}),t.jsx(k,{type:"primary",icon:t.jsx(r,{}),onClick:()=>a(!0),children:"Add Stall Type"})]})})]})}),t.jsx(g,{className:"info-card",children:t.jsx(T,{columns:_,dataSource:c,rowKey:e=>e._id,loading:j})}),t.jsx(I,{title:S?"Edit Stall Type":"Add Stall Type",open:l,onCancel:()=>{a(!1),b(null),i.resetFields()},footer:null,destroyOnClose:!1,children:t.jsxs(A,{form:i,layout:"vertical",onFinish:async e=>{try{o(!0);const t={name:e.name,description:e.description,status:e.status,features:e.features?e.features.split(",").map((e=>({feature:e.trim()}))):[]};S?(await m.updateStallType(S._id,t),s.success("Stall type updated successfully")):(await m.createStallType(t),s.success("Stall type created successfully")),a(!1),b(null),i.resetFields(),P()}catch(t){s.error(`Failed to ${S?"update":"create"} stall type: `+t.message)}finally{o(!1)}},initialValues:{status:"active"},preserve:!0,children:[t.jsx(A.Item,{name:"name",label:"Type Name",rules:[{required:!0,message:"Please enter stall type name"}],children:t.jsx(y,{placeholder:"e.g., 1 Side Open"})}),t.jsx(A.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter description"}],children:t.jsx(N,{rows:4,placeholder:"Enter description"})}),t.jsx(A.Item,{name:"features",label:"Features",children:t.jsx(y,{placeholder:"Enter features (comma-separated)",allowClear:!0})}),t.jsx(A.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select status"}],children:t.jsxs(v,{children:[t.jsx(E,{value:"active",children:"Active"}),t.jsx(E,{value:"inactive",children:"Inactive"})]})}),t.jsx(A.Item,{children:t.jsxs(k,{type:"primary",htmlType:"submit",loading:d,block:!0,children:[S?"Update":"Create"," Stall Type"]})})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{L as a,z as i};
