import{j as e,G as A}from"./index-BRKtYmDF.js";import{r as h,u as _,X as D}from"./vendor-react-BNeW3y6d.js";/* empty css                       */import{N as n,X as g,T as U,l as I,c as y,a5 as p,a6 as o,a7 as x,a4 as R,S as V,aa as M,K as F,D as H,Q as B,$ as b,aj as O}from"./vendor-antd-Dz3j4xaK.js";import"./vendor-utils-CsjRLf7T.js";import"./vendor-styling-BEMjND7I.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:k,Text:u,Paragraph:m}=U,{Option:W}=R,{TextArea:X}=F,ie=()=>{var E,T;const[d,v]=h.useState([]),[t,f]=h.useState(null),[$,C]=h.useState(!1),[q,P]=h.useState(!1),j=_(),[S]=D(),[c]=n.useForm();h.useEffect(()=>{L()},[]),h.useEffect(()=>{const i=S.get("exhibition");if(i&&d.length>0){const r=d.find(s=>s._id===i);r&&(f(r),w(r))}},[S,d]);const L=async()=>{C(!0);try{const i=await fetch("/api/exhibitions",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(i.ok){const r=await i.json();v(Array.isArray(r)?r:r.data||[])}else g.error("Failed to fetch exhibitions")}catch(i){console.error("Error fetching exhibitions:",i),g.error("Error fetching exhibitions")}finally{C(!1)}},w=i=>{var s,a,l;const r=i.serviceChargeConfig||{isEnabled:!1,title:"Service Charges",description:"Pay service charges for stall positioning and setup",pricingRules:{smallStallThreshold:50,smallStallPrice:2e3,largeStallPrice:2500}};c.setFieldsValue({isEnabled:r.isEnabled,title:r.title,description:r.description,smallStallThreshold:((s=r.pricingRules)==null?void 0:s.smallStallThreshold)||50,smallStallPrice:((a=r.pricingRules)==null?void 0:a.smallStallPrice)||2e3,largeStallPrice:((l=r.pricingRules)==null?void 0:l.largeStallPrice)||2500})},N=i=>{const r=d.find(s=>s._id===i);if(r){f(r),w(r);const s=new URLSearchParams(S);s.set("exhibition",i),j(`?${s.toString()}`,{replace:!0})}},z=async i=>{if(!t){g.error("Please select an exhibition");return}P(!0);try{const r={isEnabled:i.isEnabled,title:i.title,description:i.description,pricingRules:{smallStallThreshold:i.smallStallThreshold,smallStallPrice:i.smallStallPrice,largeStallPrice:i.largeStallPrice}},s=await fetch(`/api/service-charges/config/${t._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(r)});if(s.ok)g.success("Configuration saved successfully"),v(a=>a.map(l=>l._id===t._id?{...l,serviceChargeConfig:r}:l)),f(a=>a?{...a,serviceChargeConfig:r}:null);else{const a=await s.json();g.error(a.message||"Failed to save configuration")}}catch(r){console.error("Error saving configuration:",r),g.error("Error saving configuration")}finally{P(!1)}};return e.jsxs("div",{className:"service-charges-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs(k,{level:2,children:[e.jsx(I,{})," Service Charge Settings"]}),e.jsx(y,{onClick:()=>j("/service-charges"),children:"Back to Service Charges"})]}),e.jsxs(p,{gutter:24,children:[e.jsx(o,{span:8,children:e.jsxs(x,{title:"Select Exhibition",loading:$,style:{height:"fit-content"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(u,{type:"secondary",style:{fontSize:"14px"},children:"Choose an exhibition to configure service charges"})}),e.jsx(R,{placeholder:"Choose an exhibition...",style:{width:"100%",marginBottom:16},value:t==null?void 0:t._id,onChange:N,showSearch:!0,optionFilterProp:"children",dropdownStyle:{maxHeight:400,overflow:"auto",padding:"4px"},size:"large",filterOption:(i,r)=>{const s=d.find(l=>l._id===(r==null?void 0:r.value));return s?`${s.name} ${s.venue}`.toLowerCase().includes(i.toLowerCase()):!1},children:d.map(i=>{var r;return e.jsx(W,{value:i._id,children:e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsx("div",{style:{fontWeight:500,marginBottom:4},children:i.name}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{children:["ðŸ“ ",i.venue]}),((r=i.serviceChargeConfig)==null?void 0:r.isEnabled)&&e.jsx("span",{style:{color:"#52c41a"},children:"âœ“ Enabled"})]})]})},i._id)})})]})}),e.jsx(o,{span:16,children:t?e.jsxs(V,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(x,{title:"Service Charge Configuration",extra:e.jsx(y,{type:"primary",icon:e.jsx(O,{}),loading:q,onClick:()=>c.submit(),children:"Save Configuration"}),children:e.jsxs(n,{form:c,layout:"vertical",onFinish:z,children:[e.jsx(p,{gutter:16,children:e.jsx(o,{span:24,children:e.jsx(n.Item,{name:"isEnabled",label:"Enable Service Charges",valuePropName:"checked",children:e.jsx(M,{checkedChildren:"Enabled",unCheckedChildren:"Disabled"})})})}),e.jsx(p,{gutter:16,children:e.jsx(o,{span:12,children:e.jsx(n.Item,{name:"title",label:"Title",rules:[{required:!0,message:"Please enter a title"}],children:e.jsx(F,{placeholder:"e.g., Service Charges"})})})}),e.jsx(p,{gutter:16,children:e.jsx(o,{span:24,children:e.jsx(n.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:e.jsx(X,{rows:3,placeholder:"Brief description of service charges"})})})}),e.jsx(H,{children:"Pricing Rules"}),e.jsx(B,{message:"Stall-Based Pricing",description:"Service charges are calculated based on stall area. Configure the threshold and prices below.",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(p,{gutter:16,children:[e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"smallStallThreshold",label:"Small Stall Threshold (sqm)",rules:[{required:!0,message:"Please enter threshold"}],children:e.jsx(b,{style:{width:"100%"},placeholder:"50",min:1,max:1e3,addonAfter:"sqm"})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"smallStallPrice",label:"Small Stall Price (â‚¹)",rules:[{required:!0,message:"Please enter price"}],children:e.jsx(b,{style:{width:"100%"},placeholder:"2000",min:1,max:1e5,formatter:i=>`â‚¹ ${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:i=>Number((i==null?void 0:i.replace(/â‚¹\s?|(,*)/g,""))||0)})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"largeStallPrice",label:"Large Stall Price (â‚¹)",rules:[{required:!0,message:"Please enter price"}],children:e.jsx(b,{style:{width:"100%"},placeholder:"2500",min:1,max:1e5,formatter:i=>`â‚¹ ${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:i=>Number((i==null?void 0:i.replace(/â‚¹\s?|(,*)/g,""))||0)})})})]}),e.jsx(B,{message:"Pricing Logic",description:e.jsxs("div",{children:[e.jsxs("p",{children:["â€¢ Stalls with area â‰¤ ",c.getFieldValue("smallStallThreshold")||50," sqm will be charged â‚¹",c.getFieldValue("smallStallPrice")||2e3]}),e.jsxs("p",{style:{margin:0},children:["â€¢ Stalls with area > ",c.getFieldValue("smallStallThreshold")||50," sqm will be charged â‚¹",c.getFieldValue("largeStallPrice")||2500]})]}),type:"warning",showIcon:!0,style:{marginBottom:16}})]})}),((E=t.serviceChargeConfig)==null?void 0:E.isEnabled)&&e.jsxs(x,{title:"Stall Management",children:[e.jsx(m,{children:e.jsx(u,{strong:!0,children:"Manage Stalls:"})}),e.jsxs(m,{children:["Use the ",e.jsx(y,{type:"link",onClick:()=>j("/service-charge-stalls"),style:{padding:0},children:"Stall Management"})," page to add, edit, and import stall data. This data is used for auto-filling exhibitor company names in the public service charge form."]})]}),((T=t.serviceChargeConfig)==null?void 0:T.isEnabled)&&e.jsxs(x,{title:"Public Form Access",children:[e.jsx(m,{children:e.jsx(u,{strong:!0,children:"Public Form URL:"})}),e.jsx(m,{copyable:!0,children:`${window.location.origin}${A(t,"service-charge")}`}),e.jsx(m,{type:"secondary",children:"This URL can be shared with vendors to access the service charge payment form directly. No login is required for vendors to use this form."})]})]}):e.jsx(x,{style:{minHeight:400},children:e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},children:[e.jsx(I,{style:{fontSize:64,color:"#d9d9d9",marginBottom:24}}),e.jsx(k,{level:3,type:"secondary",style:{marginBottom:16},children:"Select an Exhibition"}),e.jsx(m,{type:"secondary",style:{fontSize:"16px",maxWidth:400,lineHeight:1.6},children:"Choose an exhibition from the dropdown to configure service charges, pricing rules, and payment settings for vendors."}),e.jsx("div",{style:{marginTop:24,padding:16,background:"#f8f9fa",borderRadius:8,border:"1px solid #e9ecef"},children:e.jsxs(u,{type:"secondary",style:{fontSize:"14px"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Enable service charges to allow vendors to make payments based on stall area without logging in to the system."]})})]})})})]})]})};export{ie as default};
