import{j as e,d as K,m as Y,e as q,r as H}from"./index-DoSueJxk.js";import{r as y,l as J,k as Q}from"./vendor-react-dkbxt9Jf.js";import{K as f,ag as M,J as A,D as X,a1 as V,$ as U,a0 as L,N as $,T as W,S as j,c as w,Y as Z,ah as ee,ai as se,A as ie,a as B,aj as te,R as le,O as re,ak as ae,al as oe}from"./vendor-antd-mFVHvrVJ.js";import{u as ne}from"./reduxHooks-Be1Cl4uN.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const{Text:N}=W,ce=[{key:"dashboard_view",label:"View Dashboard",group:"Dashboard"},{key:"dashboard_manage",label:"Manage Dashboard",group:"Dashboard"},{key:"users_view",label:"View Users",group:"Users"},{key:"users_create",label:"Create Users",group:"Users"},{key:"users_edit",label:"Edit Users",group:"Users"},{key:"users_delete",label:"Delete Users",group:"Users"},{key:"roles_view",label:"View Roles",group:"Roles"},{key:"roles_create",label:"Create Roles",group:"Roles"},{key:"roles_edit",label:"Edit Roles",group:"Roles"},{key:"roles_delete",label:"Delete Roles",group:"Roles"},{key:"exhibitions_view",label:"View Exhibitions",group:"Exhibitions"},{key:"exhibitions_create",label:"Create Exhibitions",group:"Exhibitions"},{key:"exhibitions_edit",label:"Edit Exhibitions",group:"Exhibitions"},{key:"exhibitions_delete",label:"Delete Exhibitions",group:"Exhibitions"},{key:"view_stalls",label:"View Stalls",group:"Stalls"},{key:"create_stalls",label:"Create Stalls",group:"Stalls"},{key:"edit_stalls",label:"Edit Stalls",group:"Stalls"},{key:"delete_stalls",label:"Delete Stalls",group:"Stalls"},{key:"view_stall_types",label:"View Stall Types",group:"Stall Types"},{key:"create_stall_types",label:"Create Stall Types",group:"Stall Types"},{key:"edit_stall_types",label:"Edit Stall Types",group:"Stall Types"},{key:"delete_stall_types",label:"Delete Stall Types",group:"Stall Types"},{key:"view_bookings",label:"View Bookings",group:"Bookings"},{key:"create_bookings",label:"Create Bookings",group:"Bookings"},{key:"edit_bookings",label:"Edit Bookings",group:"Bookings"},{key:"delete_bookings",label:"Delete Bookings",group:"Bookings"},{key:"view_amenities",label:"View Amenities",group:"Amenities"},{key:"create_amenities",label:"Create Amenities",group:"Amenities"},{key:"edit_amenities",label:"Edit Amenities",group:"Amenities"},{key:"delete_amenities",label:"Delete Amenities",group:"Amenities"},{key:"view_letters",label:"View Letters",group:"Letters"},{key:"send_letters",label:"Send Letters",group:"Letters"},{key:"delete_letters",label:"Delete Letters",group:"Letters"},{key:"view_invoices",label:"View Invoices",group:"Invoices"},{key:"create_invoices",label:"Create Invoices",group:"Invoices"},{key:"edit_invoices",label:"Edit Invoices",group:"Invoices"},{key:"delete_invoices",label:"Delete Invoices",group:"Invoices"},{key:"view_service_charges",label:"View Service Charges",group:"Service Charges"},{key:"manage_service_charges",label:"Manage Service Charges",group:"Service Charges"},{key:"create_service_charges",label:"Create Service Charges",group:"Service Charges"},{key:"edit_service_charges",label:"Edit Service Charges",group:"Service Charges"},{key:"delete_service_charges",label:"Delete Service Charges",group:"Service Charges"},{key:"view_exhibitors",label:"View Exhibitors",group:"Exhibitors"},{key:"create_exhibitors",label:"Create Exhibitors",group:"Exhibitors"},{key:"edit_exhibitors",label:"Edit Exhibitors",group:"Exhibitors"},{key:"delete_exhibitors",label:"Delete Exhibitors",group:"Exhibitors"},{key:"view_activities",label:"View Activity Logs",group:"Activity"},{key:"manage_activities",label:"Manage Activity Logs",group:"Activity"},{key:"delete_activities",label:"Delete Activity Logs",group:"Activity"},{key:"analytics_view",label:"View Analytics",group:"Analytics"},{key:"analytics_export",label:"Export Analytics",group:"Analytics"},{key:"view_notifications",label:"View Notifications",group:"Notifications"},{key:"manage_notifications",label:"Manage Notifications",group:"Notifications"},{key:"send_notifications",label:"Send Notifications",group:"Notifications"},{key:"settings_view",label:"View Settings",group:"Settings"},{key:"settings_edit",label:"Edit Settings",group:"Settings"}],P=ce.reduce((r,a)=>(r[a.group]||(r[a.group]=[]),r[a.group].push({key:a.key,label:a.label}),r),{}),de=({visible:r,onCancel:a,onSave:h,role:o,loading:k})=>{const[n]=f.useForm(),m=!!o,[c,x]=y.useState([]);y.useEffect(()=>{if(r)if(o){const t=o.permissions||[];n.setFieldsValue({name:o.name,description:o.description,permissions:t}),x(t)}else n.resetFields(),x([])},[r,o,n]);const p=()=>{n.setFieldsValue({permissions:c}),n.validateFields().then(t=>{h(t)})},_=t=>{const d=P[t].map(l=>l.key);return d.length>0&&d.every(l=>c.includes(l))},S=(t,d)=>{let l;d?l=[...c,t]:l=c.filter(g=>g!==t),x(l)},v=(t,d)=>{const l=P[t].map(u=>u.key);let g;if(d){const u=l.filter(T=>!c.includes(T));g=[...c,...u]}else g=c.filter(u=>!l.includes(u));x(g)},E=t=>c.includes(t);return e.jsx(M,{title:m?"Edit Role":"Add New Role",open:r,onCancel:a,width:700,footer:[e.jsx(w,{onClick:a,children:"Cancel"},"cancel"),e.jsx(w,{type:"primary",loading:k,onClick:p,children:m?"Update":"Create"},"submit")],children:e.jsxs(f,{form:n,layout:"vertical",initialValues:{name:"",description:"",permissions:[]},children:[e.jsx(f.Item,{name:"name",label:"Role Name",rules:[{required:!0,message:"Please enter a role name"}],children:e.jsx(A,{placeholder:"e.g., Administrator, Editor, Viewer"})}),e.jsx(f.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please provide a description"}],children:e.jsx(A.TextArea,{placeholder:"Describe the purpose of this role",rows:3})}),e.jsx(X,{plain:!0,children:"Permissions"}),e.jsx(f.Item,{name:"permissions",hidden:!0,children:e.jsx(A,{})}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 8px"},children:Object.entries(P).map(([t,d])=>e.jsx(V,{size:"small",title:e.jsxs(j,{children:[e.jsx(N,{strong:!0,children:t}),e.jsx($,{checked:_(t),onChange:l=>v(t,l.target.checked),children:"Select All"})]}),style:{marginBottom:16},children:e.jsx(U,{gutter:[16,12],children:d.map(l=>e.jsx(L,{span:12,children:e.jsx($,{checked:E(l.key),onChange:g=>S(l.key,g.target.checked),children:e.jsx(N,{children:l.label})})},l.key))})},t))})]})})},{Title:C,Paragraph:F,Text:b}=W,{confirm:ge}=M;function I({allowed:r}){return r?e.jsx(re,{className:"text-success",style:{color:"#52c41a",fontSize:16}}):e.jsx(ae,{className:"text-danger",style:{color:"#f5222d",fontSize:16}})}function be(){const{message:r,notification:a}=Z.useApp(),h=J(),{roles:o,loading:k,error:n}=Q(s=>s.role),[m,c]=y.useState(""),[x,p]=y.useState(!1),[_,S]=y.useState(null),{hasPermission:v}=ne();y.useEffect(()=>{h(K())},[h]),y.useEffect(()=>{n&&a.error({message:"Error",description:n})},[n,a]);const E=()=>{S(null),p(!0)},t=s=>{S(s),p(!0)},d=s=>{_?h(Y({id:_._id,roleData:s})).unwrap().then(()=>{p(!1),r.success("Role updated successfully")}).catch(i=>{r.error(`Failed to update role: ${i.message}`)}):h(q(s)).unwrap().then(()=>{p(!1),r.success("Role created successfully")}).catch(i=>{r.error(`Failed to create role: ${i.message}`)})},l=s=>{ge({title:"Are you sure you want to delete this role?",icon:e.jsx(oe,{}),content:`This will permanently delete the ${s.name} role. This action cannot be undone.`,okText:"Yes, delete it",okType:"danger",cancelText:"Cancel",onOk(){h(H(s._id)).unwrap().then(()=>{r.success(`${s.name} role deleted successfully`)}).catch(i=>{r.error(`Failed to delete role: ${i.message}`)})}})},g=[{title:"Role",dataIndex:"name",key:"name",render:(s,i)=>e.jsxs(j,{children:[e.jsx(ie,{style:{backgroundColor:G(i.name)},children:s.charAt(0).toUpperCase()}),e.jsx(b,{strong:!0,children:s})]})},{title:"Description",dataIndex:"description",key:"description",render:s=>e.jsx(b,{type:"secondary",children:s})},{title:"Read",key:"read",align:"center",render:(s,i)=>e.jsx(I,{allowed:u(i)})},{title:"Write",key:"write",align:"center",render:(s,i)=>e.jsx(I,{allowed:T(i)})},{title:"Delete",key:"delete",align:"center",render:(s,i)=>e.jsx(I,{allowed:z(i)})},{title:"Actions",key:"actions",align:"right",render:(s,i)=>e.jsxs(j,{children:[v("roles_edit")&&e.jsx(B,{title:i.name==="Administrator"?"Administrator role cannot be edited":"Edit role",children:e.jsx(w,{type:"primary",shape:"circle",icon:e.jsx(te,{}),size:"small",onClick:()=>t(i),disabled:i.name==="Administrator"})}),v("roles_delete")&&e.jsx(B,{title:"Delete role",children:e.jsx(w,{danger:!0,shape:"circle",icon:e.jsx(le,{}),size:"small",onClick:()=>l(i),disabled:i.name==="Administrator"})})]})}],u=s=>s.permissions.some(i=>i.endsWith("_view")),T=s=>s.permissions.some(i=>i.endsWith("_create")||i.endsWith("_edit")),z=s=>s.permissions.some(i=>i.endsWith("_delete")),G=s=>{const i=["#1677ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#eb2f96"];let R=0;for(let D=0;D<s.length;D++)R=s.charCodeAt(D)+((R<<5)-R);return i[Math.abs(R)%i.length]},O=o.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.description.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{style:{padding:"12px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(C,{level:2,children:"Roles & Permissions"}),e.jsx(F,{children:"Manage role-based access control and permissions for your users."})]}),e.jsxs(V,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},loading:k&&o.length===0,children:[e.jsxs(U,{gutter:16,style:{marginBottom:16},children:[e.jsx(L,{span:16,children:e.jsx(A,{placeholder:"Search roles...",allowClear:!0,value:m,onChange:s=>c(s.target.value),prefix:e.jsx(b,{type:"secondary",style:{fontSize:16},children:"ðŸ”"})})}),e.jsx(L,{span:8,style:{textAlign:"right"},children:v("roles_create")&&e.jsx(w,{type:"primary",icon:e.jsx(ee,{}),style:{borderRadius:6},onClick:E,children:"Add Role"})})]}),e.jsx(se,{columns:g,dataSource:O,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(s,i)=>`Showing ${i[0]}-${i[1]} of ${s} roles`},style:{marginTop:8},loading:k&&o.length>0})]}),e.jsx(V,{title:e.jsx(C,{level:4,style:{margin:0},children:"Role Management Tips"}),style:{marginTop:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[e.jsxs(j,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(C,{level:5,children:"Best Practices"}),e.jsxs("ul",{style:{paddingLeft:20},children:[e.jsx("li",{children:e.jsx(b,{children:"Follow the principle of least privilege"})}),e.jsx("li",{children:e.jsx(b,{children:"Regularly audit user roles"})}),e.jsx("li",{children:e.jsx(b,{children:"Document role responsibilities"})})]})]}),e.jsxs(j,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(C,{level:5,children:"Role Inheritance"}),e.jsx(F,{children:"Higher-level roles automatically include permissions from lower-level roles to ensure consistency."})]})]})}),e.jsx(de,{visible:x,onCancel:()=>p(!1),onSave:d,role:_,loading:k})]})}export{be as default};
