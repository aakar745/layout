import{j as e,b as w,s as F}from"./index-DoSueJxk.js";import{r as t,l as S,k as T}from"./vendor-react-dkbxt9Jf.js";import{Y as R,K as r,$ as i,a0 as n,T as U,a1 as N,n as b,A as q,f as j,J as l,z as B,P as L,Q as d,c as k,aa as $,W as M}from"./vendor-antd-mFVHvrVJ.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const{Title:g,Text:P}=U,{TabPane:y}=b,_=()=>{const{notification:I}=R.useApp(),[z]=r.useForm(),[c]=r.useForm(),[D,K]=t.useState(!1),[v,u]=t.useState(!1),[A,m]=t.useState(!1),[p,h]=t.useState(null),x=S(),s=T(a=>a.auth.user);t.useEffect(()=>{(async()=>{try{m(!0);const o=await w.getProfile();o.data&&x(F({user:o.data,token:localStorage.getItem("token")||""}))}catch{M.error("Failed to fetch profile")}finally{m(!1)}})()},[x]);const C=async a=>{try{h(null),u(!0),await w.changePassword({currentPassword:a.currentPassword,newPassword:a.newPassword}),I.success({message:"Success",description:"Password has been changed successfully"}),c.resetFields()}catch(o){h(o.response?.data?.message||"Failed to change password. Please try again.")}finally{u(!1)}},E=()=>s?.role?typeof s.role=="string"?s.role:typeof s.role=="object"&&"name"in s.role?s.role.name:"User":"User";return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx(i,{gutter:[24,24],align:"middle",children:e.jsxs(n,{flex:"auto",children:[e.jsx(g,{level:4,children:"My Account"}),e.jsx(P,{type:"secondary",children:"Manage your account settings and change your password"})]})})}),e.jsx(N,{loading:A,children:e.jsxs(b,{defaultActiveKey:"account",children:[e.jsx(y,{tab:"Account Information",children:e.jsxs(i,{gutter:32,children:[e.jsx(n,{span:6,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:[e.jsx(q,{size:100,icon:e.jsx(j,{}),style:{backgroundColor:"#1890ff",marginBottom:16},children:s?.username?.charAt(0).toUpperCase()||"U"}),e.jsx(g,{level:4,children:s?.username}),e.jsx(P,{type:"secondary",children:E()})]})}),e.jsx(n,{span:18,children:e.jsx(r,{layout:"vertical",initialValues:{username:s?.username,email:s?.email},disabled:!0,children:e.jsxs(i,{gutter:16,children:[e.jsx(n,{span:12,children:e.jsx(r.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter your username"}],children:e.jsx(l,{prefix:e.jsx(j,{}),placeholder:"Username"})})}),e.jsx(n,{span:12,children:e.jsx(r.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter your email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(l,{prefix:e.jsx(B,{}),placeholder:"Email Address"})})})]})})})]})},"account"),e.jsxs(y,{tab:"Change Password",children:[p&&e.jsx(L,{message:"Error",description:p,type:"error",showIcon:!0,style:{marginBottom:24}}),e.jsxs(r,{form:c,layout:"vertical",onFinish:C,children:[e.jsx(r.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(l.Password,{prefix:e.jsx(d,{}),placeholder:"Current Password"})}),e.jsx(r.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter your new password"},{min:8,message:"Password must be at least 8 characters"}],children:e.jsx(l.Password,{prefix:e.jsx(d,{}),placeholder:"New Password"})}),e.jsx(r.Item,{name:"confirmPassword",label:"Confirm New Password",dependencies:["newPassword"],rules:[{required:!0,message:"Please confirm your new password"},({getFieldValue:a})=>({validator(o,f){return!f||a("newPassword")===f?Promise.resolve():Promise.reject(new Error("The two passwords do not match"))}})],children:e.jsx(l.Password,{prefix:e.jsx(d,{}),placeholder:"Confirm New Password"})}),e.jsx(r.Item,{children:e.jsx(k,{type:"primary",htmlType:"submit",loading:v,icon:e.jsx($,{}),children:"Update Password"})})]})]},"password")]})})]})};export{_ as default};
