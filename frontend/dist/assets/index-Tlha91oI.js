import{j as e,I as A,F as I,J as k,P as q,Q as O,D as v}from"./index-BfjvBafq.js";import{R as V,l as _,k as W,u as L,j as U,i as M,r as f}from"./vendor-react-BNeW3y6d.js";import"./vendor-canvas-BRbMLhVA.js";import{N as b,Z as D,K as X,$ as z,S as H,c as y,R as J,X as K,a7 as Q,bk as Y,b5 as Z,aj as G,a$ as ee}from"./vendor-antd-sZZBSykP.js";import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";const se=({visible:u,hall:s,exhibitionWidth:r,exhibitionHeight:i,onCancel:n,onSubmit:t,onDelete:p})=>{const[l]=b.useForm();V.useEffect(()=>{u&&(s?l.setFieldsValue({name:s.name,width:s.dimensions.width,height:s.dimensions.height}):l.setFieldsValue({name:"",width:Math.min(10,r),height:Math.min(10,i)}))},[u,s,r,i,l]);const o=async()=>{var j,g;const m=await l.validateFields(),c=s?{...s,_id:s._id,id:s.id||s._id,name:m.name,dimensions:{x:((j=s.dimensions)==null?void 0:j.x)||0,y:((g=s.dimensions)==null?void 0:g.y)||0,width:m.width,height:m.height},exhibitionId:s.exhibitionId}:{name:m.name,dimensions:{x:0,y:0,width:m.width,height:m.height}};t(c),l.resetFields()},C=()=>{s&&p&&D.confirm({title:"Delete Hall",content:`Are you sure you want to delete hall "${s.name}"? This action cannot be undone.`,okText:"Yes, Delete",cancelText:"No, Cancel",okButtonProps:{className:"confirm-delete-button"},centered:!0,onOk:()=>p(s)})};return e.jsx(D,{title:s?"Edit Hall":"Add New Hall",open:u,onCancel:()=>{l.resetFields(),n()},footer:null,width:400,destroyOnClose:!0,className:"hall-form-modal",children:e.jsxs(b,{form:l,layout:"vertical",style:{marginTop:"16px"},children:[e.jsx(b.Item,{name:"name",label:e.jsxs("span",{style:{color:"#000"},children:["Hall Name ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter hall name"}],children:e.jsx(X,{placeholder:"Enter hall name"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(b.Item,{name:"width",label:e.jsxs("span",{style:{color:"#000"},children:["Width (meters) ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter width"},{type:"number",min:5,message:"Width must be at least 5 meters"},{type:"number",max:r,message:`Width cannot exceed ${r} meters`}],children:e.jsx(z,{min:5,max:r,style:{width:"100%"},placeholder:"Enter width"})}),e.jsx(b.Item,{name:"height",label:e.jsxs("span",{style:{color:"#000"},children:["Height (meters) ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter height"},{type:"number",min:5,message:"Height must be at least 5 meters"},{type:"number",max:i,message:`Height cannot exceed ${i} meters`}],children:e.jsx(z,{min:5,max:i,style:{width:"100%"},placeholder:"Enter height"})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"32px",gap:"8px"},children:[e.jsx(H,{children:s&&p&&e.jsx(y,{className:"delete-button",icon:e.jsx(J,{}),onClick:C,children:"Delete Hall"})}),e.jsxs(H,{children:[e.jsx(y,{onClick:()=>{l.resetFields(),n()},children:"Cancel"}),e.jsx(y,{type:"primary",onClick:o,className:"update-button",children:s?"Update Hall":"Create Hall"})]})]})]})})},te=({exhibitionId:u,destination:s="layout",label:r="Back to Layout"})=>{const i=L(),{currentExhibition:n}=M(t=>t.exhibition);return e.jsxs("div",{style:{marginBottom:"24px",position:"sticky",top:"16px",zIndex:10},children:[e.jsx(y,{icon:e.jsx(ee,{}),onClick:()=>i(I(n,s),{state:{exhibitionId:u}}),type:"default",size:"large",style:{borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",background:"white",borderColor:"transparent",fontWeight:500,padding:"0 16px",height:"42px",display:"flex",alignItems:"center",transition:"all 0.3s ease"},className:"back-button-hover",children:e.jsx("span",{style:{marginLeft:8},children:r})}),e.jsx("style",{children:`
        .back-button-hover:hover {
          transform: translateX(-5px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: #f0f5ff;
          border-color: #d6e4ff;
        }
      `})]})},de=()=>{var E,R,N;const{id:u}=_(),s=W(),r=L(),i=U(),n=((E=s.state)==null?void 0:E.exhibitionId)||u,{currentExhibition:t,halls:p}=M(a=>a.exhibition),l=f.useRef(null),[o,C]=K.useMessage(),[m,c]=f.useState(!1),[j,g]=f.useState(null),[w,$]=f.useState({width:0,height:0});f.useEffect(()=>{const a=()=>{if(l.current){const{clientWidth:h,clientHeight:x}=l.current;$({width:Math.max(h||400,400),height:Math.max(x||400,400)})}};a();const d=new ResizeObserver(a);return l.current&&d.observe(l.current),window.addEventListener("resize",a),()=>{d.disconnect(),window.removeEventListener("resize",a)}},[]),f.useEffect(()=>{if(!n){o.error("Exhibition ID not found"),r("/exhibition");return}i(A(n))},[n,i,r,o]),f.useEffect(()=>{var a,d;if(t){if(!((a=t.dimensions)!=null&&a.width)||!((d=t.dimensions)!=null&&d.height)){o.info("Please set up exhibition space first"),r(I(t,"space"),{state:{exhibitionId:n}});return}i(k(n))}},[t,n,i,r,o]);const S=()=>{g(null),c(!0)},B=a=>{g(a),c(!!a)},F=async a=>{var d;try{a.id?(await v.updateHall(n,a.id,a),o.success("Hall updated successfully"),c(!1)):(await v.createHall(n,a),o.success("Hall created successfully"),c(!1)),i(k(n))}catch(h){console.error("Hall operation failed:",h),((d=h.response)==null?void 0:d.status)===409?o.warning({content:h.response.data.message,duration:6,style:{marginTop:"20vh"}}):(o.error(h.message||"Failed to save hall"),c(!1))}},T=async a=>{var d,h;try{const x=a._id||a.id;if(!x)throw new Error("Hall ID is required");await v.deleteHall(n,x),o.success("Hall deleted successfully"),c(!1),g(null),i(k(n))}catch(x){console.error("Failed to delete hall:",x),o.error(((h=(d=x.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to delete hall")}},P=async()=>{try{await v.saveLayout(n,p),o.success("Layout saved successfully")}catch{o.error("Failed to save layout")}};return e.jsxs("div",{style:{padding:"24px",height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(te,{exhibitionId:n}),C,e.jsx(Q,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(H,{children:[e.jsx("span",{children:"Hall Management"}),e.jsx(y,{icon:e.jsx(Y,{}),onClick:()=>r(I(t,"space"),{state:{exhibitionId:n}}),children:"Back to Space Setup"})]}),e.jsxs(H,{children:[e.jsx(y,{type:"primary",icon:e.jsx(Z,{}),onClick:S,children:"Add Hall"}),e.jsx(y,{type:"primary",icon:e.jsx(G,{}),onClick:P,disabled:!p.length,children:"Save Layout"})]})]}),styles:{body:{flex:1,padding:0,overflow:"hidden",minHeight:"400px",position:"relative",background:"#fafafa"}},style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:"500px"},children:e.jsx("div",{ref:l,style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden"},children:e.jsx(q,{children:w.width>0&&w.height>0&&(t==null?void 0:t.dimensions)&&e.jsx(O,{width:w.width,height:w.height,exhibitionWidth:t.dimensions.width,exhibitionHeight:t.dimensions.height,halls:p,selectedHall:j,onSelectHall:B,onHallChange:F,onAddHall:S})})})}),e.jsx(se,{visible:m,hall:j,onCancel:()=>c(!1),onSubmit:F,onDelete:T,exhibitionWidth:((R=t==null?void 0:t.dimensions)==null?void 0:R.width)||100,exhibitionHeight:((N=t==null?void 0:t.dimensions)==null?void 0:N.height)||100})]})};export{de as default};
