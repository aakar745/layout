import{j as e,a as E,X as U,Y as V}from"./index-DoSueJxk.js";import{r as b,k as q,X as H,u as _}from"./vendor-react-dkbxt9Jf.js";import{K as u,a1 as X,S as k,c as f,aE as Y,aQ as z,z as J,aX as K,U as Q,ag as $,J as O,W as x}from"./vendor-antd-mFVHvrVJ.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const Z=a=>{if(!a)return 0;const v=a.shapeType||"rectangle";if(v==="rectangle")return a.width*a.height;if(v==="l-shape"&&a.lShape){const{rect1Width:s,rect1Height:A,rect2Width:I,rect2Height:d}=a.lShape;return s*A+I*d}return a.width*a.height},ee=({booking:a})=>{const[v,s]=b.useState(null),[A,I]=b.useState(!0),d=q(l=>l.settings.settings);b.useEffect(()=>{(async()=>{I(!0);try{if(a.exhibitionId.headerLogo){const i=a.exhibitionId.headerLogo;s(`${E.defaults.baseURL}/public/uploads/${i}`),console.log("Using exhibition header logo:",i)}else if(d?.logo){const i=d.logo;s(`${E.defaults.baseURL}/public/uploads/${i}`),console.log("Using global settings logo:",i)}else{const i=`${E.defaults.baseURL}/public/logo`;s(i),console.log("Using public logo endpoint:",i)}}catch(i){console.error("Error loading logo:",i),s(null)}finally{I(!1)}})()},[a.exhibitionId.headerLogo,d?.logo]);const P=()=>{const l=new Date(a.exhibitionId.startDate||""),i=new Date(a.exhibitionId.endDate||""),S={};let t=new Date(l);for(;t<=i;){const L=t.toLocaleString("default",{month:"short",year:"numeric"});S[L]||(S[L]=[]),S[L].push(t.getDate().toString().padStart(2,"0")),t=new Date(t),t.setDate(t.getDate()+1)}const F=Object.entries(S).map(([L,G])=>`${G.join(", ")} ${L}`);return`${a.exhibitionId.name||"ABSE"} (${F.join(" & ")})`},g=l=>{const i=new Date(l);return{date:i.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),time:i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}},N=a.stallIds.map((l,i)=>{const S=l,t=Z(l.dimensions),F=t*l.ratePerSqm;return{key:l._id,sn:i+1,stallNo:l.number,stallType:S.stallTypeId?.name||"Standard",dimensions:l.dimensions.shapeType==="l-shape"?"L-Shape":`${l.dimensions.width}m x ${l.dimensions.height}m`,area:t.toFixed(0),rate:l.ratePerSqm.toFixed(0),amount:F}}),r=N.reduce((l,i)=>l+i.amount,0),m=a.calculations,n=m.stalls[0]?.discount!==void 0&&m.stalls[0]?.discount!==null,w=n?m.stalls[0]?.discount:null,T=w?.type||"percentage",j=w?.value||0;let y=0;n&&j>0&&(T==="percentage"?y=Math.round(r*j/100*100)/100:T==="fixed"&&(y=Math.min(j,r)));const c=r-y,o=m.taxes.find(l=>l.name.includes("GST")),h=o?o.rate:18,D=Math.round(c*h/100*100)/100,C=c+D,R=r,p=y,B=c,M=D,W=C;return e.jsx("div",{className:"invoice-container",children:e.jsxs("div",{className:"proforma-invoice",children:[e.jsxs("div",{className:"header-section",children:[e.jsx("div",{className:"logo-cell",children:A?e.jsx("div",{className:"logo-loading",children:"Loading..."}):v?e.jsx("img",{src:v,alt:a.exhibitionId.companyName,className:"logo-image",onError:()=>s(null)}):a.exhibitionId.companyName}),e.jsxs("div",{className:"title-company",children:[e.jsx("div",{className:"title-cell",children:"PROFORMA INVOICE"}),e.jsx("div",{className:"company-cell",children:a.exhibitionId.companyName})]})]}),e.jsxs("div",{className:"bill-to-section",children:[e.jsx("div",{className:"bill-to-cell",children:"Bill To"}),e.jsxs("div",{className:"bill-to-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"label-cell",children:"Company Name"}),e.jsx("div",{className:"value-cell",children:a.companyName}),e.jsx("div",{className:"date-label-cell",children:"Date"}),e.jsx("div",{className:"date-value-cell",children:g(a.createdAt).date})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"label-cell",children:"Phone No."}),e.jsx("div",{className:"value-cell",children:a.customerPhone}),e.jsx("div",{className:"date-label-cell",children:"Time"}),e.jsx("div",{className:"date-value-cell",children:g(a.createdAt).time})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"label-cell",children:"GST No."}),e.jsx("div",{className:"value-cell",children:a.customerGSTIN}),e.jsx("div",{className:"date-label-cell",children:"Invoice No"}),e.jsx("div",{className:"date-value-cell",children:a.invoiceNumber})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"label-cell",children:"Address"}),e.jsx("div",{className:"value-cell",children:a.customerAddress})]})]})]}),e.jsxs("div",{className:"expo-venue-section",children:[e.jsxs("div",{className:"expo-column",children:[e.jsx("div",{className:"heading",children:"Expo Name"}),e.jsx("div",{className:"content",children:P()})]}),e.jsxs("div",{className:"venue-column",children:[e.jsx("div",{className:"heading",children:"Venue"}),e.jsx("div",{className:"content",children:a.exhibitionId.venue})]})]}),e.jsx("div",{className:"section-header stall-summary-header",children:"Stall Summary"}),e.jsxs("div",{className:"stall-table",children:[e.jsxs("div",{className:"stall-header",children:[e.jsx("div",{className:"stall-header-cell",children:"S/N"}),e.jsx("div",{className:"stall-header-cell",children:"Stall No."}),e.jsx("div",{className:"stall-header-cell",children:"Stall Type"}),e.jsx("div",{className:"stall-header-cell",children:"Dimensions"}),e.jsx("div",{className:"stall-header-cell",children:"Area (sqm)"}),e.jsx("div",{className:"stall-header-cell",children:"Rate (per sqm)"}),e.jsx("div",{className:"stall-header-cell",children:"Amount"})]}),N.map(l=>e.jsxs("div",{className:"stall-row",children:[e.jsx("div",{className:"stall-cell",children:l.sn}),e.jsx("div",{className:"stall-cell",children:l.stallNo}),e.jsx("div",{className:"stall-cell",children:l.stallType}),e.jsx("div",{className:"stall-cell",children:l.dimensions}),e.jsx("div",{className:"stall-cell",children:l.area}),e.jsx("div",{className:"stall-cell",children:Number(l.rate).toLocaleString("en-IN")}),e.jsx("div",{className:"stall-cell",children:l.amount.toLocaleString("en-IN")})]},l.key))]}),e.jsx("div",{className:"section-header",children:"Calculation Summary"}),e.jsxs("div",{className:"calc-table",children:[e.jsxs("div",{className:"calc-row",children:[e.jsx("div",{className:"calc-label",children:"Total Basic Amount"}),e.jsxs("div",{className:"calc-value",children:["₹",R.toLocaleString("en-IN")]})]}),n&&p>0&&e.jsxs("div",{className:"calc-row",children:[e.jsx("div",{className:"calc-label",children:T==="percentage"?`Discount (${j}%)`:`Discount (Fixed ₹${j.toLocaleString("en-IN")})`}),e.jsxs("div",{className:"calc-value",children:["-₹",p.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"calc-row",children:[e.jsx("div",{className:"calc-label",children:n&&p>0?"Amount after Discount":"Net Amount"}),e.jsxs("div",{className:"calc-value",children:["₹",B.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"calc-row",children:[e.jsxs("div",{className:"calc-label",children:["GST (",h,"%)"]}),e.jsxs("div",{className:"calc-value",children:["₹",M.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"calc-row total-row",children:[e.jsx("div",{className:"calc-label",children:"Total Amount"}),e.jsxs("div",{className:"calc-value",children:["₹",W.toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"details-section",children:[e.jsxs("div",{className:"bank-details",children:[e.jsx("div",{className:"details-header",children:"Bank Details"}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"Bank Name"}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.bankName})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"Account No."}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.bankAccount})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"Name"}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.bankAccountName})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"Branch"}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.bankBranch})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"IFSC CODE"}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.bankIFSC})]})]}),e.jsxs("div",{className:"company-details",children:[e.jsx("div",{className:"details-header",children:"Company Details"}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"CIN No."}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.companyCIN})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"Pan No."}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.companyPAN})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"SAC CODE"}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.companySAC})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"GST No."}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.companyGST})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"Email"}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.companyEmail})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"Website"}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.companyWebsite})]}),e.jsxs("div",{className:"details-row",children:[e.jsx("div",{className:"detail-label",children:"Address"}),e.jsx("div",{className:"detail-value",children:a.exhibitionId.companyAddress})]})]})]}),e.jsxs("div",{className:"instruction-section",children:[e.jsx("div",{className:"instruction-header",children:"PI Instruction"}),e.jsx("div",{className:"instruction-content",dangerouslySetInnerHTML:{__html:a.exhibitionId.piInstructions||"THIS INVOICE IS PROFORMA INVOICE DO NOT CLAIM ANY GOVERNMENT CREDITS ON THIS PROFORMA INVOICE. FINAL INVOICE WOULD BE RAISED AFTER 100% PAYMENT."}})]}),e.jsxs("div",{className:"instruction-section",children:[e.jsx("div",{className:"instruction-header",children:"Terms & Conditions"}),e.jsx("div",{className:"instruction-content",dangerouslySetInnerHTML:{__html:a.exhibitionId.termsAndConditions||'All cheques / Drafts should be payable to "AAKAR EXHIBITION Private Limited". This bill is payable as per agreed terms. All delayed payments will be charged interest @ 18% p.a. All Complaints / Disputes, if any on this bill should reach us within 15 days on receipt of bill, failing which the bill becomes fully payable. Subject to Ahmedabad Jurisdiction.'}})]}),e.jsx("div",{className:"signature-section",children:e.jsxs("div",{style:{textAlign:"center",color:"#333"},children:[e.jsxs("div",{style:{marginBottom:"0px"},children:["For, ",a.exhibitionId.companyName]}),e.jsx("div",{style:{borderTop:"1px solid black",minWidth:"200px",display:"inline-block",margin:"0 auto"}}),e.jsx("div",{style:{marginTop:"0px"},children:"Authorised Signature"})]})})]})})},ne=()=>{const{id:a}=H(),v=_(),{data:s,isLoading:A}=U(a||""),[I,d]=b.useState(!1),[P,g]=b.useState(!1),[N]=u.useForm(),[r,m]=b.useState(0),[n,w]=b.useState(!1),T=async()=>{if(a)try{w(!0),m(0),x.loading({content:"Preparing invoice...",key:"download"});const c=await V(`/invoices/${a}/download?force=false`,!1,D=>{const C=D.total,R=D.loaded;if(C){const p=Math.round(R*100/C);m(p),p%25===0&&x.loading({content:`Downloading: ${p}% complete`,key:"download"})}}),o=window.URL.createObjectURL(new Blob([c.data])),h=document.createElement("a");h.href=o,h.setAttribute("download",`invoice-${a}.pdf`),document.body.appendChild(h),h.click(),h.remove(),window.URL.revokeObjectURL(o),x.success({content:"Invoice downloaded successfully",key:"download"})}catch(c){console.error("Download error:",c),x.error({content:"Failed to download invoice",key:"download"})}finally{w(!1),m(0)}},j=async c=>{try{await E.post(`/invoices/${a}/share/email`,c),x.success("Invoice shared via email successfully"),d(!1),N.resetFields()}catch(o){console.error("Email sharing error:",o),x.error("Failed to share invoice via email")}},y=async c=>{try{await E.post(`/invoices/${a}/share/whatsapp`,c),x.success("Invoice shared via WhatsApp successfully"),g(!1),N.resetFields()}catch(o){console.error("WhatsApp sharing error:",o),x.error("Failed to share invoice via WhatsApp")}};return A||!s?e.jsx("div",{children:"Loading..."}):(console.log("Invoice data:",s),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(X,{title:"Invoice Details",extra:e.jsxs(k,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(k,{children:[e.jsx(f,{icon:e.jsx(Y,{}),onClick:()=>v(-1),disabled:n,children:"Back"}),e.jsx(f,{type:"primary",icon:e.jsx(z,{}),onClick:T,loading:n&&r<100,disabled:n&&r>=100,children:"Download"}),e.jsx(f,{icon:e.jsx(J,{}),onClick:()=>d(!0),disabled:n,children:"Share via Email"}),e.jsx(f,{icon:e.jsx(K,{}),onClick:()=>g(!0),disabled:n,children:"Share via WhatsApp"})]}),n&&e.jsx(Q,{percent:r,size:"small",status:"active",style:{marginBottom:0,marginTop:4}})]}),children:e.jsx(ee,{booking:{...s.bookingId,customerGSTIN:s.bookingId.customerGSTIN||"",invoiceNumber:s.invoiceNumber,exhibitionId:{...s.bookingId.exhibitionId,companyName:s.bookingId.exhibitionId.companyName||"Company Name",bankName:s.bookingId.exhibitionId.bankName||"",bankAccount:s.bookingId.exhibitionId.bankAccount||"",bankAccountName:s.bookingId.exhibitionId.bankAccountName||"",bankBranch:s.bookingId.exhibitionId.bankBranch||"",bankIFSC:s.bookingId.exhibitionId.bankIFSC||"",companyCIN:s.bookingId.exhibitionId.companyCIN||"",companyPAN:s.bookingId.exhibitionId.companyPAN||"",companySAC:s.bookingId.exhibitionId.companySAC||"",companyGST:s.bookingId.exhibitionId.companyGST||"",companyEmail:s.bookingId.exhibitionId.companyEmail||"",companyWebsite:s.bookingId.exhibitionId.companyWebsite||"",companyAddress:s.bookingId.exhibitionId.companyAddress||"",headerLogo:s.bookingId.exhibitionId.headerLogo||void 0},calculations:{...s.bookingId.calculations,stalls:s.bookingId.calculations.stalls.map(c=>({discount:c.discount?{...c.discount,type:c.discount.type||"percentage",value:c.discount.value}:void 0}))}}})}),e.jsx($,{title:"Share Invoice via Email",open:I,onCancel:()=>d(!1),footer:null,children:e.jsxs(u,{form:N,onFinish:j,layout:"vertical",children:[e.jsx(u.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter email address"},{type:"email",message:"Please enter a valid email address"}],children:e.jsx(O,{placeholder:"Enter email address"})}),e.jsx(u.Item,{name:"message",label:"Message (Optional)",children:e.jsx(O.TextArea,{placeholder:"Enter optional message"})}),e.jsx(u.Item,{children:e.jsx(f,{type:"primary",htmlType:"submit",children:"Send"})})]})}),e.jsx($,{title:"Share Invoice via WhatsApp",open:P,onCancel:()=>g(!1),footer:null,children:e.jsxs(u,{form:N,onFinish:y,layout:"vertical",children:[e.jsx(u.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^\+?[1-9]\d{9,14}$/,message:"Please enter a valid phone number"}],children:e.jsx(O,{placeholder:"Enter phone number with country code"})}),e.jsx(u.Item,{children:e.jsx(f,{type:"primary",htmlType:"submit",children:"Send"})})]})})]}))};export{ne as default};
