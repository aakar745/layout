import{j as s}from"./vendor-pdf-Cn0rG44s.js";import{r,a as P,y as w,z as a,S as A,T as X,Z as v,t as Y,ai as ee,G as R,H as M,h as S,a0 as te,W as N,a7 as se,f as ie}from"./vendor-antd-B8jUXf3i.js";import{b as ne,u as ae}from"./vendor-redux-rS0pI56E.js";import{x as _,B as le}from"./index-4IR4xblb.js";import{u as re}from"./vendor-react-DW9h-haf.js";import{$ as oe,I as de}from"./vendor-antd-icons-BoTJB7uA.js";import"./vendor-http-t--hEgTQ.js";import"./vendor-ui-BmMA_ojr.js";import"./vendor-canvas-DrFPvyt4.js";const{Title:he,Text:ce}=X,{Option:x}=v,we=()=>{const q=re(),C=ne(),{stalls:g,loading:H}=ae(e=>e.exhibition),[B,D]=r.useState([]),[z,E]=r.useState([]),[h,O]=r.useState(null),[f,F]=r.useState(null),[G,j]=r.useState(!1),k=P.useMemo(()=>Math.max(...g.map(e=>e.ratePerSqm*e.dimensions.width*e.dimensions.height),1e6),[g]),m=P.useMemo(()=>{const e=Math.pow(10,Math.floor(Math.log10(k)));return Math.ceil(k/e)*e},[k]),[b,K]=r.useState(""),[y,U]=r.useState(null),[d,c]=r.useState([0,m]),[L,V]=r.useState("number"),[$,W]=r.useState("ascend"),Z=e=>{O(e),F(null),C({type:"exhibition/clearStalls"})},J=e=>{F(e),C(h&&e?le({exhibitionId:h,hallId:e}):{type:"exhibition/clearStalls"})};r.useEffect(()=>{(async()=>{try{j(!0),console.log("Fetching exhibitions...");const t=await _.getActiveExhibitions();console.log("Exhibitions response:",t.data),D(t.data)}catch(t){console.error("Failed to fetch exhibitions:",t)}finally{j(!1)}})()},[]),r.useEffect(()=>{h?(async()=>{try{j(!0),console.log("Fetching halls for exhibition:",h);const t=await _.getHalls(h);console.log("Halls response:",t.data),E(t.data)}catch(t){console.error("Failed to fetch halls:",t)}finally{j(!1)}})():E([])},[h]);const T=P.useMemo(()=>{console.log("Filtering stalls from Redux:",g);const e=g.filter(t=>{const i=!b||t.number.toLowerCase().includes(b.toLowerCase()),n=!y||t.status===y,l=!f||t.hallId===f,o=t.ratePerSqm*t.dimensions.width*t.dimensions.height,u=o>=d[0]&&o<=d[1];return i&&n&&l&&u}).sort((t,i)=>L==="number"?$==="ascend"?t.number.localeCompare(i.number):i.number.localeCompare(t.number):0);return console.log("Filtered stalls:",e),e},[g,b,y,f,d,L,$]),Q=e=>{switch(e){case"available":return"success";case"booked":return"warning";case"reserved":return"processing";case"sold":return"error";default:return"default"}},I=(e=>{const t=e.reduce((i,n)=>{var l,o;return(l=n==null?void 0:n.dimensions)!=null&&l.width&&((o=n==null?void 0:n.dimensions)!=null&&o.height)?i+n.dimensions.width*n.dimensions.height:i},0);return{totalStalls:e.length,totalSize:t}})(T);return s.jsx("div",{className:"dashboard-container",children:s.jsx("div",{style:{marginBottom:"24px"},children:s.jsxs(w,{gutter:[24,24],children:[s.jsx(a,{span:24,children:s.jsxs(A,{direction:"vertical",size:4,style:{width:"100%"},children:[s.jsx(he,{level:4,style:{margin:0},children:"Stalls"}),s.jsx(ce,{type:"secondary",children:"Manage your exhibition stalls"})]})}),s.jsx(a,{span:24,children:s.jsxs(w,{gutter:[16,16],align:"middle",children:[s.jsx(a,{xs:24,sm:12,md:6,children:s.jsx(v,{style:{width:"100%"},placeholder:"Select Exhibition",value:h,onChange:Z,allowClear:!0,children:B.map(e=>s.jsx(x,{value:e._id||e.id,children:e.name},e._id||e.id))})}),s.jsx(a,{xs:24,sm:12,md:6,children:s.jsx(v,{style:{width:"100%"},placeholder:"Select Hall",value:f,onChange:J,disabled:!h||z.length===0,allowClear:!0,children:z.map(e=>s.jsx(x,{value:e._id||e.id,children:e.name},e._id||e.id))})}),s.jsx(a,{xs:24,sm:12,md:6,children:s.jsx(Y,{placeholder:"Search by stall number",prefix:s.jsx(ee,{}),value:b,onChange:e=>K(e.target.value),allowClear:!0})}),s.jsx(a,{xs:24,sm:12,md:6,children:s.jsxs(v,{style:{width:"100%"},placeholder:"Filter by status",value:y,onChange:U,allowClear:!0,children:[s.jsx(x,{value:"available",children:"Available"}),s.jsx(x,{value:"booked",children:"Booked"}),s.jsx(x,{value:"reserved",children:"Reserved"}),s.jsx(x,{value:"sold",children:"Sold"})]})})]})}),s.jsx(a,{span:24,children:s.jsx(R,{size:"small",children:s.jsxs(w,{gutter:16,children:[s.jsx(a,{xs:12,sm:12,md:6,children:s.jsx(M,{title:"Total Stalls",value:I.totalStalls,prefix:s.jsx(oe,{})})}),s.jsx(a,{xs:12,sm:12,md:6,children:s.jsx(M,{title:"Total Area",value:I.totalSize,suffix:"sqm",prefix:s.jsx(de,{}),precision:2})})]})})}),s.jsx(a,{span:24,children:s.jsx(R,{size:"small",title:"Price Range Filter",children:s.jsxs(w,{gutter:16,children:[s.jsx(a,{span:24,style:{marginBottom:16},children:s.jsxs(A,{children:[s.jsx(S,{size:"small",onClick:()=>c([0,5e5]),children:"Under ₹5L"}),s.jsx(S,{size:"small",onClick:()=>c([5e5,1e6]),children:"₹5L - ₹10L"}),s.jsx(S,{size:"small",onClick:()=>c([1e6,2e6]),children:"₹10L - ₹20L"}),s.jsx(S,{size:"small",onClick:()=>c([2e6,m]),children:"Above ₹20L"}),s.jsx(S,{size:"small",onClick:()=>c([0,m]),children:"All"})]})}),s.jsx(a,{span:16,children:s.jsx(te,{range:!0,min:0,max:m,value:d,onChange:e=>c(e),step:Math.max(1e3,Math.floor(m/1e3)),tooltip:{formatter:e=>`₹${(e||0).toLocaleString()}`}})}),s.jsx(a,{span:4,children:s.jsx(N,{style:{width:"100%"},min:0,max:d[1],value:d[0],onChange:e=>c([e||0,d[1]]),formatter:e=>`₹ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?Number(e.replace(/[^\d.-]/g,"")):0,step:1e3})}),s.jsx(a,{span:4,children:s.jsx(N,{style:{width:"100%"},min:d[0],max:m,value:d[1],onChange:e=>c([d[0],e||m]),formatter:e=>`₹ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?Number(e.replace(/[^\d.-]/g,"")):0,step:1e3})})]})})}),s.jsx(a,{span:24,children:s.jsx(se,{columns:[{title:"Stall Number",dataIndex:"number",key:"number",sorter:(e,t)=>e.number.localeCompare(t.number),defaultSortOrder:"ascend"},{title:"Type",dataIndex:["stallType","name"],key:"type",render:(e,t)=>{var i;return((i=t.stallType)==null?void 0:i.name)||"N/A"}},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"ratePerSqm",render:e=>e?`₹${e.toLocaleString()}`:"N/A",sorter:(e,t)=>(e.ratePerSqm||0)-(t.ratePerSqm||0)},{title:"Area (sqm)",key:"area",render:(e,t)=>{var i,n;return(i=t==null?void 0:t.dimensions)!=null&&i.width&&((n=t==null?void 0:t.dimensions)!=null&&n.height)?`${t.dimensions.width*t.dimensions.height} sqm`:"N/A"},sorter:(e,t)=>{var l,o,u,p;const i=(((l=e.dimensions)==null?void 0:l.width)||0)*(((o=e.dimensions)==null?void 0:o.height)||0),n=(((u=t.dimensions)==null?void 0:u.width)||0)*(((p=t.dimensions)==null?void 0:p.height)||0);return i-n}},{title:"Dimensions",key:"dimensions",render:(e,t)=>{var i,n;return(i=t==null?void 0:t.dimensions)!=null&&i.width&&((n=t==null?void 0:t.dimensions)!=null&&n.height)?`${t.dimensions.width}m × ${t.dimensions.height}m`:"N/A"}},{title:"Total Price",key:"totalPrice",render:(e,t)=>{var i,n;return(i=t==null?void 0:t.dimensions)!=null&&i.width&&((n=t==null?void 0:t.dimensions)!=null&&n.height)&&t.ratePerSqm?`₹${(t.ratePerSqm*t.dimensions.width*t.dimensions.height).toLocaleString()}`:"N/A"},sorter:(e,t)=>{var l,o,u,p;const i=(e.ratePerSqm||0)*(((l=e.dimensions)==null?void 0:l.width)||0)*(((o=e.dimensions)==null?void 0:o.height)||0),n=(t.ratePerSqm||0)*(((u=t.dimensions)==null?void 0:u.width)||0)*(((p=t.dimensions)==null?void 0:p.height)||0);return i-n}},{title:"Status",dataIndex:"status",key:"status",render:e=>s.jsx(ie,{color:Q(e),style:{textTransform:"capitalize"},children:e||"N/A"}),filters:[{text:"Available",value:"available"},{text:"Booked",value:"booked"},{text:"Reserved",value:"reserved"},{text:"Sold",value:"sold"}],onFilter:(e,t)=>t.status===e},{title:"Actions",key:"actions",render:(e,t)=>s.jsxs(A,{children:[s.jsx("a",{onClick:()=>q(`/stall/edit/${t._id||t.id}`),children:"Edit"}),s.jsx("a",{onClick:()=>q(`/stall/view/${t._id||t.id}`),children:"View"})]})}],dataSource:T,rowKey:e=>e._id||e.id,loading:G||H,pagination:{total:T.length,pageSize:10,showSizeChanger:!0,showTotal:e=>`Total ${e} stalls`},onChange:(e,t,i)=>{i.field&&(V(i.field),W(i.order))}})})]})})})};export{we as default};
