const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/services-DHEt1Qtz.js","assets/vendor-utils-CTzFqUk0.js","assets/vendor-canvas-BOVIu3pe.js","assets/vendor-others-aeGeD6f-.js","assets/vendor-ui-BOD89xu8.js","assets/vendor-react-i7tvbPTl.js","assets/component-exhibition-CuwlJtEU.js","assets/vendor-editor-HOXaQDhO.js","assets/vendor-antd-core-CLD06I8y.js","assets/vendor-antd-buttons-wjEWA2x8.js","assets/vendor-antd-modal-1GBGM2fb.js","assets/vendor-antd-form-DJHhvp8w.js","assets/component-layout-BTsCaDZB.js","assets/store-D4NI4RZ9.js","assets/component-auth-ClRi3ofU.js","assets/vendor-antd-table-CA0XBoxE.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./page-amenities-Cf9BkOfe.js";import{j as t,V as i,i as s,F as n,A as a,a6 as l,T as o,U as r,R as d,a7 as c,C as x,q as u,Z as m,a8 as h,r as p,X as g,g as j,a2 as y,a3 as f,a4 as b}from"./vendor-others-aeGeD6f-.js";import{a as v,u as S,c as k}from"./vendor-react-i7tvbPTl.js";import{u as I,i as A,g as w,j as C,f as T,k as $,l as B,m as _,n as D}from"./store-D4NI4RZ9.js";import{R as N,C as P,c as R,b as F,z,k as E,e as L,I as q,f as M,d as V,n as W,T as O,o as U,D as Q,x as Z,A as H,s as Y,v as G,M as K,F as X,g as J}from"./vendor-antd-core-CLD06I8y.js";import{B as ee}from"./vendor-antd-buttons-wjEWA2x8.js";import"./page-dashboard-984XnN9x.js";import{d as te}from"./vendor-utils-CTzFqUk0.js";import{M as ie}from"./vendor-antd-modal-1GBGM2fb.js";import{F as se}from"./vendor-antd-table-CA0XBoxE.js";import{F as ne}from"./vendor-antd-form-DJHhvp8w.js";import{c as ae,e as le}from"./services-DHEt1Qtz.js";const oe=()=>{const{user:e}=v((e=>e.auth)),t=t=>{if(!e||!e.role||!e.role.permissions)return!1;const i=e.role.permissions;if(i.includes(t))return!0;if(i.includes("*")||i.includes("all")||i.includes("admin")||i.includes("superadmin")||i.includes("full_access"))return!0;const s=t.split("_");if(2===s.length){const e=s[0],t=s[1],n=[`${e}.*`,`*.${t}`,`view_${e}`,`${e}_view`,`${e}s_${t}`,`${t}_${e}`,e.endsWith("s")?`${e.slice(0,-1)}_${t}`:`${e}s_${t}`,`${e}_${"view"===t?"read":t}`,`${"view"===t?"read":t}_${e}`];for(const s of n)if(i.includes(s))return!0}return!1};return{hasPermission:t,hasAnyPermission:e=>e.some((e=>t(e))),hasAllPermissions:e=>e.every((e=>t(e)))}},re=({bookings:e,paginationTotal:o,stats:r,statsLoading:d=!1})=>{const c=r||{total:void 0!==o?o:e.length,pending:e.filter((e=>"pending"===e.status)).length,approved:e.filter((e=>"approved"===e.status)).length,rejected:e.filter((e=>"rejected"===e.status)).length,confirmed:e.filter((e=>"confirmed"===e.status)).length,cancelled:e.filter((e=>"cancelled"===e.status)).length,totalRevenue:e.filter((e=>"confirmed"===e.status||"approved"===e.status)).reduce(((e,t)=>e+t.amount),0),totalBaseAmount:e.reduce(((e,t)=>{var i;return e+((null==(i=t.calculations)?void 0:i.totalBaseAmount)||0)}),0)};return t.jsxs(t.Fragment,{children:[t.jsxs(N,{gutter:[16,16],style:{marginBottom:"24px"},children:[t.jsx(P,{xs:24,sm:12,md:6,children:t.jsx(R,{children:d?t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsx(F,{})}):t.jsx(z,{title:t.jsxs(E,{title:"Total count across all pages",children:["Total Bookings ",t.jsx(s,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.total,prefix:t.jsx(i,{})})})}),t.jsx(P,{xs:24,sm:12,md:6,children:t.jsx(R,{children:d?t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsx(F,{})}):t.jsx(z,{title:t.jsxs(E,{title:"Count of all pending bookings",children:["Pending Bookings ",t.jsx(s,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.pending,prefix:t.jsx(n,{style:{color:"#faad14"}})})})}),t.jsx(P,{xs:24,sm:12,md:6,children:t.jsx(R,{children:d?t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsx(F,{})}):t.jsx(z,{title:t.jsxs(E,{title:"Count of all approved bookings",children:["Approved Bookings ",t.jsx(s,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.approved,prefix:t.jsx(a,{style:{color:"#52c41a"}})})})}),t.jsx(P,{xs:24,sm:12,md:6,children:t.jsx(R,{children:d?t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsx(F,{})}):t.jsx(z,{title:t.jsxs(E,{title:"Count of all confirmed bookings",children:["Confirmed Bookings ",t.jsx(s,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.confirmed,prefix:t.jsx(a,{style:{color:"#52c41a"}})})})})]}),t.jsxs(N,{gutter:[16,16],style:{marginBottom:"24px"},children:[t.jsx(P,{xs:24,sm:12,md:6,children:t.jsx(R,{children:d?t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsx(F,{})}):t.jsx(z,{title:t.jsxs(E,{title:"Count of all rejected bookings",children:["Rejected Bookings ",t.jsx(s,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.rejected,prefix:t.jsx(l,{style:{color:"#f5222d"}})})})}),t.jsx(P,{xs:24,sm:12,md:6,children:t.jsx(R,{children:d?t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsx(F,{})}):t.jsx(z,{title:t.jsxs(E,{title:"Count of all cancelled bookings",children:["Cancelled Bookings ",t.jsx(s,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.cancelled,prefix:t.jsx(l,{style:{color:"#f5222d"}})})})}),t.jsx(P,{xs:24,sm:12,md:6,children:t.jsx(R,{children:d?t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsx(F,{})}):t.jsx(z,{title:t.jsxs(E,{title:"Total revenue from all bookings",children:["Total Revenue ",t.jsx(s,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.totalRevenue,precision:0,prefix:"₹"})})}),t.jsx(P,{xs:24,sm:12,md:6,children:t.jsx(R,{children:d?t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:t.jsx(F,{})}):t.jsx(z,{title:t.jsxs(E,{title:"Total base amount before taxes and discounts",children:["Total Base Amount ",t.jsx(s,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.totalBaseAmount,precision:0,prefix:"₹",valueStyle:{color:"#1890ff"}})})})]})]})},{RangePicker:de}=V,ce=({filters:e,exhibitions:i,onFilterChange:s,onRefresh:n})=>t.jsx(R,{style:{marginBottom:"24px"},children:t.jsxs(L,{wrap:!0,children:[t.jsx(q,{placeholder:"Search by company name",prefix:t.jsx(o,{}),value:e.search,onChange:t=>s({...e,search:t.target.value}),style:{width:200},allowClear:!0}),t.jsx(M,{placeholder:"Filter by exhibition",value:e.exhibition,onChange:t=>s({...e,exhibition:t}),style:{minWidth:200},allowClear:!0,options:i.map((e=>({label:e.name,value:e._id})))}),t.jsx(M,{mode:"multiple",placeholder:"Filter by status",value:e.status,onChange:t=>s({...e,status:t}),style:{minWidth:200},options:[{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"},{label:"Confirmed",value:"confirmed"},{label:"Cancelled",value:"cancelled"}]}),t.jsx(de,{onChange:t=>{var i,n;return s({...e,dateRange:t?[(null==(i=t[0])?void 0:i.toISOString())||"",(null==(n=t[1])?void 0:n.toISOString())||""]:null})}}),t.jsx(ee,{icon:t.jsx(r,{}),onClick:n,children:"Refresh"})]})}),{Title:xe,Text:ue}=O,me=({selectedBooking:e,isDetailsModalVisible:i,setIsDetailsModalVisible:s,setSelectedBooking:n,setIsStatusModalVisible:a,setSelectedStatus:l,setRejectionReasonText:o,formatBookingNumber:r})=>t.jsx(ie,{title:"Booking Details",open:i,onCancel:()=>{s(!1),n(null)},footer:[t.jsx(ee,{type:"primary",disabled:!e,onClick:()=>{e&&(l(e.status),o(e.rejectionReason||""),a(!0))},children:"Update Status"},"updateStatus"),t.jsx(ee,{onClick:()=>{s(!1),n(null)},children:"Close"},"close")],width:800,children:e&&t.jsxs(L,{direction:"vertical",size:"large",style:{width:"100%"},children:[t.jsxs(W,{bordered:!0,column:2,children:[t.jsxs(W.Item,{label:"Booking Number",span:2,children:[r(e._id,e.createdAt),t.jsxs(ue,{type:"secondary",style:{marginLeft:8,fontSize:"12px"},children:["(ID: ",e._id,")"]})]}),t.jsx(W.Item,{label:"Exhibition",span:2,children:e.exhibitionId.name}),t.jsxs(W.Item,{label:"Status",span:2,children:[t.jsx(U,{color:"confirmed"===e.status?"success":"approved"===e.status?"blue":"pending"===e.status?"warning":"rejected"===e.status?"error":"default",children:e.status.toUpperCase()}),e.rejectionReason&&t.jsxs("div",{style:{marginTop:8},children:[t.jsx(ue,{type:"secondary",children:"Rejection Reason:"}),t.jsx("br",{}),t.jsx(ue,{children:e.rejectionReason})]})]}),t.jsx(W.Item,{label:"Customer Name",children:e.customerName}),t.jsx(W.Item,{label:"Customer Email",children:e.customerEmail}),t.jsx(W.Item,{label:"Customer Phone",children:e.customerPhone}),t.jsx(W.Item,{label:"Company Name",children:e.companyName})]}),t.jsx(R,{title:"Stall Details",size:"small",children:t.jsx(se,{dataSource:e.stallIds,pagination:!1,rowKey:"_id",columns:[{title:"Stall Number",dataIndex:"number",key:"number"},{title:"Stall Type",key:"type",render:e=>e.type||"-"},{title:"Dimensions",key:"dimensions",render:e=>t.jsx(U,{color:"blue",children:e.dimensions?`${e.dimensions.width}x${e.dimensions.height}m`:"No dimensions"})},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"rate",render:e=>`₹${e.toLocaleString()}`},{title:"Base Amount",key:"baseAmount",render:t=>{const i=e.calculations.stalls.find((e=>e.stallId===t._id));return i?`₹${i.baseAmount.toLocaleString()}`:"-"}},{title:"Discount",key:"discount",render:i=>{const s=e.calculations.stalls.find((e=>e.stallId===i._id));return(null==s?void 0:s.discount)?t.jsx(E,{title:t.jsx("div",{children:"percentage"===s.discount.type&&` (${s.discount.value}%)`}),children:t.jsxs(U,{color:"red",children:["-₹",s.discount.amount.toLocaleString(),"percentage"===s.discount.type&&` (${s.discount.value}%)`]})}):"-"}}]})}),t.jsx(R,{title:"Financial Summary",size:"small",children:t.jsxs(L,{direction:"vertical",style:{width:"100%"},size:"small",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(ue,{children:"Total Base Amount:"}),t.jsxs(ue,{children:["₹",e.calculations.totalBaseAmount.toLocaleString()]})]}),e.calculations.totalDiscountAmount>0&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(ue,{children:"Total Discount:"}),t.jsxs(ue,{type:"danger",children:["-₹",e.calculations.totalDiscountAmount.toLocaleString()]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(ue,{children:"Amount after Discount:"}),t.jsxs(ue,{children:["₹",e.calculations.totalAmountAfterDiscount.toLocaleString()]})]}),t.jsx(Q,{style:{margin:"8px 0"}}),e.calculations.taxes.map((e=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsxs(ue,{children:[e.name," (",e.rate,"%):"]}),t.jsxs(ue,{children:["₹",e.amount.toLocaleString()]})]},`tax-${e.name}-${e.rate}`))),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[t.jsx(ue,{strong:!0,children:"Total Amount (incl. Taxes):"}),t.jsxs(ue,{strong:!0,children:["₹",e.amount.toLocaleString()]})]})]})})]})}),he=({selectedBooking:e,isStatusModalVisible:i,setIsStatusModalVisible:s,selectedStatus:o,setSelectedStatus:r,rejectionReasonText:u,setRejectionReasonText:m,formatBookingNumber:h,refreshAfterAction:p})=>{const g=S(),[j,y]=d.useState(!1),{refetch:f}=I({page:1,limit:100}),b=e=>{};return t.jsx(ie,{title:"Update Booking Status",open:i,onCancel:()=>{s(!1),m("")},footer:null,width:600,children:e&&t.jsxs("div",{children:[t.jsx(R,{title:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx(c,{style:{fontSize:"18px"}}),t.jsx("span",{children:"Booking Information"})]}),style:{marginBottom:16},variant:"borderless",size:"small",children:t.jsxs(L,{direction:"vertical",size:8,style:{width:"100%"},children:[t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[t.jsx(U,{color:"processing",children:h(e._id,e.createdAt)}),t.jsx(U,{color:"default",children:e.exhibitionId.name}),t.jsx(U,{color:"confirmed"===e.status?"success":"approved"===e.status?"blue":"pending"===e.status?"warning":"rejected"===e.status?"error":"default",children:e.status.toUpperCase()})]}),t.jsxs("div",{style:{marginTop:"8px"},children:[t.jsx(ue,{strong:!0,children:"Stall Details:"}),t.jsx("div",{style:{marginTop:"4px"},children:e.stallIds.map(((e,i)=>t.jsxs(U,{style:{margin:"2px"},children:["#",e.number," ",e.type&&`(${e.type})`]},e._id)))})]}),t.jsx(Q,{style:{margin:"8px 0"}}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[t.jsx(ue,{strong:!0,style:{minWidth:"120px"},children:"Company:"}),t.jsx(ue,{children:e.companyName})]}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[t.jsx(ue,{strong:!0,style:{minWidth:"120px"},children:"Current Status:"}),t.jsx(U,{color:"confirmed"===e.status?"success":"approved"===e.status?"blue":"pending"===e.status?"warning":"rejected"===e.status?"error":"default",children:e.status.toUpperCase()})]})]})}),t.jsxs(R,{title:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx(x,{style:{fontSize:"18px"}}),t.jsx("span",{children:"Update Status"})]}),variant:"borderless",size:"small",children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[t.jsxs("div",{children:[t.jsx(ue,{strong:!0,children:"Select New Status:"}),t.jsx("div",{style:{marginTop:"16px"},children:t.jsxs(Z.Group,{value:o,onChange:e=>r(e.target.value),buttonStyle:"solid",style:{display:"flex",flexWrap:"nowrap",overflowX:"auto"},children:[t.jsx(Z.Button,{value:"pending",style:{flex:"0 0 auto"},children:t.jsxs(L,{children:[t.jsx(n,{style:{color:"#faad14"}}),"Pending"]})}),t.jsx(Z.Button,{value:"approved",style:{flex:"0 0 auto"},children:t.jsxs(L,{children:[t.jsx(a,{style:{color:"#52c41a"}}),"Approved"]})}),t.jsx(Z.Button,{value:"rejected",style:{flex:"0 0 auto"},children:t.jsxs(L,{children:[t.jsx(l,{style:{color:"#f5222d"}}),"Rejected"]})}),t.jsx(Z.Button,{value:"confirmed",style:{flex:"0 0 auto"},children:t.jsxs(L,{children:[t.jsx(a,{style:{color:"#1890ff"}}),"Confirmed"]})}),t.jsx(Z.Button,{value:"cancelled",style:{flex:"0 0 auto"},children:t.jsxs(L,{children:[t.jsx(l,{style:{color:"#ff7875"}}),"Cancelled"]})})]})})]}),"rejected"===o&&t.jsx("div",{children:t.jsx(ne.Item,{label:t.jsx(ue,{strong:!0,children:"Rejection Reason:"}),required:"rejected"===o,rules:[{required:!0,message:"Please provide a reason for rejection"}],help:"This will be visible to the customer",children:t.jsx(q.TextArea,{rows:4,value:u,onChange:e=>m(e.target.value),placeholder:"Provide a reason for rejection",style:{marginTop:8}})})}),"approved"===o&&t.jsx(H,{message:"Approval Confirmation",description:"By approving this booking, the stalls will be reserved but not yet confirmed. Customer will be notified.",type:"success",showIcon:!0,style:{marginTop:8}}),"confirmed"===o&&t.jsx(H,{message:"Confirmation Notice",description:"By confirming this booking, the stalls will be marked as booked. This should be done after payment is received.",type:"info",showIcon:!0,style:{marginTop:8}}),"cancelled"===o&&t.jsx(H,{message:"Cancellation Warning",description:"By cancelling this booking, all stalls will be marked as available again.",type:"warning",showIcon:!0,style:{marginTop:8}}),"pending"===o&&t.jsx(H,{message:"Return to Pending",description:"This booking will be moved back to pending status.",type:"warning",showIcon:!0,style:{marginTop:8}})]}),t.jsxs("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end",gap:"8px"},children:[t.jsx(ee,{onClick:()=>{s(!1),m("")},children:"Cancel"}),t.jsx(ee,{type:"primary",onClick:()=>{"rejected"!==o||u.trim()?(async(e,t,i)=>{try{y(!0),await g(A({id:e,status:t,...i&&{rejectionReason:i}})).unwrap(),Y.success(`Booking ${t} successfully`),p(),s(!1),b(null),"approved"===t&&setTimeout((async()=>{await f()}),1e3)}catch(n){Y.error("Failed to update booking status")}finally{y(!1)}})(e._id,o,"rejected"===o?u:void 0):Y.error("Rejection reason is required when rejecting a booking")},loading:j,disabled:"rejected"===o&&!u.trim(),children:"Update Status"})]})]})]})})},pe=e=>{const i=k(),{data:s,isLoading:n,error:l,refetch:o}=I({page:1,limit:100}),r=e=>{if(n||l||!s)return null;const t=(s.data||[]).find((t=>t.bookingId&&"object"==typeof t.bookingId&&t.bookingId._id===e));return null==t?void 0:t._id};return[{title:"Booking Number",dataIndex:"_id",key:"bookingNumber",fixed:"left",width:170,render:(i,s)=>t.jsx(ee,{type:"link",onClick:()=>{e.setSelectedBooking(s),e.setIsDetailsModalVisible(!0)},children:e.formatBookingNumber(i,s.createdAt)})},{title:"Exhibition",dataIndex:["exhibitionId","name"],key:"exhibition",width:250,render:(e,t)=>t.exhibitionId.name},{title:"Company Name",dataIndex:"companyName",key:"company",width:250,render:e=>e||"N/A"},{title:"Stall No.",key:"stallNumber",width:120,render:(e,i)=>t.jsx("span",{children:i.stallIds.map(((e,s)=>t.jsxs("span",{children:[e.number,s<i.stallIds.length-1?", ":""]},`stall-${e._id||s}`)))})},{title:"Stall Type",key:"stallType",width:120,render:(e,i)=>{const s=Array.from(new Set(i.stallIds.map((e=>e.type))));return t.jsx("span",{children:s.map(((e,i)=>t.jsxs("span",{children:[e,i<s.length-1?", ":""]},`type-${e}-${i}`)))})}},{title:"Dimensions",key:"dimensions",width:150,render:(e,i)=>t.jsx("span",{children:i.stallIds.map(((e,s)=>t.jsxs("span",{children:[e.dimensions?`${e.dimensions.width}m × ${e.dimensions.height}m`:"No dimensions",s<i.stallIds.length-1?", ":""]},`dim-${e._id||s}`)))})},{title:"Area (sqm)",key:"area",width:120,render:(e,i)=>{const s=i.stallIds.reduce(((e,t)=>t.dimensions?e+t.dimensions.width*t.dimensions.height:e),0);return t.jsxs("span",{children:[Math.round(s)," sqm"]})}},{title:"Base Amount",dataIndex:["calculations","totalBaseAmount"],key:"baseAmount",width:150,render:e=>`₹${e.toLocaleString()}`},{title:"Discount",key:"discount",width:150,render:(e,i)=>{const s=i.calculations.totalDiscountAmount;if(!s||0===s)return"-";const n=i.calculations.stalls.filter((e=>e.discount)).map((e=>e.discount));if(0===n.length)return"-";const a=n[0];return t.jsx(E,{title:t.jsx("div",{children:n.map(((e,i)=>t.jsxs("div",{children:[null==e?void 0:e.name,": ","percentage"===(null==e?void 0:e.type)?`${null==e?void 0:e.value}%`:`₹${null==e?void 0:e.value}`,t.jsx("br",{}),"Amount: ₹",null==e?void 0:e.amount.toLocaleString()]},`discount-${i}-${(null==e?void 0:e.name)||"unnamed"}`)))}),children:t.jsxs(U,{color:"red",children:["-₹",s.toLocaleString(),"percentage"===(null==a?void 0:a.type)&&` (${a.value}%)`,n.length>1&&" +"]})})}},{title:"Total Amount",dataIndex:"amount",key:"amount",width:150,render:e=>`₹${e.toLocaleString()}`},{title:"Status",dataIndex:"status",key:"status",width:120,render:e=>t.jsx(U,{color:"confirmed"===e?"success":"approved"===e?"blue":"pending"===e?"warning":"rejected"===e?"error":"default",children:e.toUpperCase()})},{title:"Created At",dataIndex:"createdAt",key:"createdAt",width:200,render:e=>te(e).format("MMM D, YYYY HH:mm")},{title:"Actions",key:"actions",fixed:"right",width:220,render:(s,l)=>t.jsxs(L,{children:[t.jsx(E,{title:"View Details",children:t.jsx(ee,{icon:t.jsx(m,{}),onClick:()=>{e.setSelectedBooking(l),e.setIsDetailsModalVisible(!0)}})}),t.jsx(G,{overlay:t.jsxs(K,{children:["cancelled"!==l.status&&e.hasPermission("view_bookings")&&t.jsx(K.Item,{icon:t.jsx(c,{}),disabled:n,onClick:()=>(async e=>{if(n)return void Y.loading("Loading invoice data...");let t=r(e._id);if(t)i(`/invoice/${t}`);else{const s="invoice-loading";if(Y.loading({content:"Checking for invoice...",key:s}),await o(),t=r(e._id),t)return Y.success({content:"Invoice found!",key:s,duration:1}),void i(`/invoice/${t}`);if(new Date(e.createdAt)>new Date(Date.now()-18e5)||"approved"===e.status){Y.info({content:"Invoice is still being generated. Checking again in a moment...",key:s});let t=0;const n=5,a=[2e3,3e3,5e3,8e3,1e4],l=async()=>{t++,await o();const d=r(e._id);if(d)Y.success({content:"Invoice is ready!",key:s,duration:1}),i(`/invoice/${d}`);else if(t<n){const e=a[t]||5e3,i=e/1e3;Y.info({content:`Attempt ${t}/${n}: Invoice not ready yet. Trying again in ${i} seconds...`,key:s}),setTimeout(l,e)}else Y.warning({content:"Invoice generation is taking longer than expected. Please try refreshing the page in a few moments.",key:s})};setTimeout(l,a[0])}else Y.error({content:"No invoice found for this booking. Please contact support if this persists.",key:s})}})(l),children:"View Invoice"},"invoice"),t.jsx(K.Item,{icon:t.jsx(a,{}),onClick:()=>{e.setSelectedBooking(l),e.setSelectedStatus(l.status),e.setRejectionReasonText(l.rejectionReason||""),e.setIsStatusModalVisible(!0)},children:"Update Status"},"updateStatus"),e.hasPermission("bookings_delete")&&t.jsx(K.Item,{icon:t.jsx(u,{}),danger:!0,onClick:()=>{((e,i,s)=>{ie.confirm({title:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[t.jsx(u,{style:{color:"#F04438",fontSize:"22px"}}),t.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Booking"})]}),content:t.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[t.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete booking ",t.jsx("strong",{children:s(e._id,e.createdAt)}),"?"]}),t.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data including invoices."})]}),footer:t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[t.jsx(ee,{onClick:()=>ie.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),t.jsx(ee,{danger:!0,type:"primary",onClick:()=>{i(e._id),ie.destroyAll()},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})})(l,e.handleDelete,e.formatBookingNumber)},children:"Delete"},"delete")]}),trigger:["click"],children:t.jsx(ee,{icon:t.jsx(h,{})})})]})}]},ge=e=>{const{bookings:i,loading:s,pagination:n,fetchBookingsWithPagination:a}=e,l=pe(e);return t.jsxs(t.Fragment,{children:[t.jsx(se,{columns:l,dataSource:i,loading:s,rowKey:"_id",scroll:{x:1800},pagination:!1}),(o=n.page,r=n.limit,d=n.total,c=(e,t)=>a(e,t),t.jsx("div",{className:"ant-table-pagination ant-table-pagination-right",style:{padding:"16px 24px",margin:0,display:"flex",justifyContent:"flex-end"},children:t.jsx(X,{current:o,pageSize:r,total:d,showTotal:e=>`Total ${e} items`,showSizeChanger:!0,pageSizeOptions:["5","10","20","50","100"],onChange:e=>c(e,r),onShowSizeChange:(e,t)=>c(e,t),size:"default"})}))]});var o,r,d,c},{Title:je,Text:ye}=O,fe=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const i=S(),{bookings:s,loading:n,pagination:a,stats:l,statsLoading:o}=v((e=>e.booking)),{exhibitions:r}=v((e=>e.exhibition)),[d,c]=p.useState(null),[x,u]=p.useState(!1),[m,h]=p.useState(!1),[A,_]=p.useState("pending"),[D,F]=p.useState(""),[z,E]=p.useState({search:"",status:[],dateRange:null,exhibition:null}),q=k(),{data:M,isLoading:V,error:W,refetch:O}=I({page:1,limit:100}),{hasPermission:U}=oe(),Q=p.useCallback(((e=1,t=10)=>{const s={page:e,limit:t};z.search&&(s.search=z.search),z.exhibition&&(s.exhibitionId=z.exhibition),z.status&&z.status.length>0&&(s.status=z.status),z.dateRange&&2===z.dateRange.length&&(s.startDate=z.dateRange[0],s.endDate=z.dateRange[1]),i(w(s))}),[i,z]),Z=p.useCallback((()=>{i(C())}),[i]),H=p.useCallback((()=>{Q(a.page,a.limit),Z()}),[Q,Z,a.page,a.limit]);p.useEffect((()=>{Q(a.page,a.limit),Z()}),[Q,Z,a.page,a.limit]),p.useEffect((()=>{i(T())}),[i]),p.useEffect((()=>{if(s.length>0){[...new Set(s.map((e=>e.exhibitionId._id)))].forEach((e=>{i($(e))}))}}),[s,i]);const G=Array.isArray(s)?s:[],K=(e,t)=>{const i=new Date(t).getFullYear(),s=G.find((t=>t._id===e));if(!s)return`--/${i}/--`;const n=(G.filter((e=>e.exhibitionId._id===s.exhibitionId._id)).sort(((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())).findIndex((t=>t._id===e))+1).toString().padStart(2,"0"),a=r.find((e=>e._id===s.exhibitionId._id));return`${(null==a?void 0:a.invoicePrefix)||s.exhibitionId.invoicePrefix||"BK"}/${i}/${n}`};return t.jsxs("div",{className:"dashboard-container",children:[t.jsx("div",{style:{marginBottom:"24px"},children:t.jsxs(N,{gutter:[24,24],align:"middle",children:[t.jsx(P,{flex:"auto",children:t.jsxs(L,{direction:"vertical",size:4,children:[t.jsx(je,{level:4,style:{margin:0},children:"Stall Bookings"}),t.jsx(ye,{type:"secondary",children:"Manage exhibition stall bookings"})]})}),t.jsx(P,{children:t.jsxs(L,{children:[t.jsx(ee,{icon:t.jsx(g,{}),onClick:async()=>{try{Y.loading({content:"Preparing export...",key:"export"});const t={};z.search&&(t.search=z.search),z.exhibition&&(t.exhibitionId=z.exhibition),z.status&&z.status.length>0&&(t.status=z.status),z.dateRange&&2===z.dateRange.length&&(t.startDate=z.dateRange[0],t.endDate=z.dateRange[1]);const i=(await e((async()=>{const{default:e}=await import("./services-DHEt1Qtz.js").then((e=>e.v));return{default:e}}),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))).default,s=(await i.get("/bookings/export",{params:t})).data;if(!Array.isArray(s))throw new Error("Invalid data format received");const n=s.map((e=>{const t=e.stallIds.reduce(((e,t)=>t.dimensions?e+t.dimensions.width*t.dimensions.height:e),0);return{"Booking Number":K(e._id,e.createdAt),Exhibition:e.exhibitionId.name,"Company Name":e.companyName||"N/A","Customer Name":e.customerName,"Customer Email":e.customerEmail,"Customer Phone":e.customerPhone,"Stall Numbers":e.stallIds.map((e=>e.number)).join(", "),"Stall Types":Array.from(new Set(e.stallIds.map((e=>e.type||(e.stallTypeId&&"object"==typeof e.stallTypeId?e.stallTypeId.name:"-"))))).join(", "),Dimensions:e.stallIds.map((e=>e.dimensions?`${e.dimensions.width}m × ${e.dimensions.height}m`:"No dimensions")).join(", "),"Total Area (sqm)":Math.round(t),"Base Amount":Math.round(e.calculations.totalBaseAmount),Discount:Math.round(e.calculations.totalDiscountAmount),"Total Amount":Math.round(e.calculations.totalAmount),Status:e.status.toUpperCase(),"Created Date":new Date(e.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}})),a=y.json_to_sheet(n),l=y.book_new();y.book_append_sheet(l,a,"Bookings");const o=f(l,{bookType:"xlsx",type:"array"}),r=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=(new Date).toISOString().split("T")[0];b.saveAs(r,`bookings_export_${d}.xlsx`),Y.success({content:"Export successful!",key:"export",duration:2})}catch(t){Y.error({content:"Failed to export bookings",key:"export",duration:2})}},size:"large",children:"Export"}),t.jsx(ee,{type:"primary",size:"large",icon:t.jsx(j,{}),onClick:()=>q("/bookings/create"),children:"Create Booking"})]})})]})}),t.jsx(re,{bookings:s,paginationTotal:a.total,stats:l,statsLoading:o}),t.jsx(ce,{filters:z,exhibitions:r,onFilterChange:e=>{E(e),Q(1,a.limit)},onRefresh:H}),t.jsx(R,{className:"info-card",styles:{body:{padding:0,overflow:"auto"},header:{paddingBottom:12}},title:"Booking List",children:t.jsx(ge,{bookings:G,loading:n,fetchBookingsWithPagination:Q,pagination:a,setSelectedBooking:c,setIsDetailsModalVisible:u,setIsStatusModalVisible:h,setSelectedStatus:_,setRejectionReasonText:F,formatBookingNumber:K,handleDelete:async e=>{try{await i(B(e)).unwrap(),Y.success("Booking deleted successfully"),H()}catch(t){Y.error((null==t?void 0:t.message)||"Failed to delete booking")}},hasPermission:U})}),t.jsx(me,{selectedBooking:d,isDetailsModalVisible:x,setIsDetailsModalVisible:u,setSelectedBooking:c,setIsStatusModalVisible:h,setSelectedStatus:_,setRejectionReasonText:F,formatBookingNumber:K}),t.jsx(he,{selectedBooking:d,isStatusModalVisible:m,setIsStatusModalVisible:h,selectedStatus:A,setSelectedStatus:_,rejectionReasonText:D,setRejectionReasonText:F,formatBookingNumber:K,refreshAfterAction:H})]})}},Symbol.toStringTag,{value:"Module"})),{Title:be,Text:ve}=O,Se=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var e,i,n;const[a]=ne.useForm(),[l]=ne.useForm(),[o,r]=p.useState(!1),[d,c]=p.useState([]),[x,u]=p.useState(!1),[m,h]=p.useState([]),[g,y]=p.useState(null),[f,b]=p.useState(),[I,A]=p.useState([]),[w,C]=p.useState({}),[$,B]=p.useState([]),[F,z]=p.useState(0),V=k(),W=S(),{loading:Z}=v((e=>e.booking)),{exhibitions:H=[],loading:G}=v((e=>e.exhibition)),{exhibitors:K=[],loading:X}=v((e=>e.exhibitor)),{isAuthenticated:te}=v((e=>e.auth));p.useEffect((()=>{if(!te)return Y.error("Please login to create a booking"),void V("/login");W(T()),W(_())}),[W,te,V]);const oe=e=>Math.round(e.ratePerSqm*e.dimensions.width*e.dimensions.height*100)/100,re=H.map((e=>({label:e.name,value:e._id||e.id}))),de=K.map((e=>({label:e.companyName,value:e._id})));d.map((e=>({label:`Stall ${e.number} (${e.dimensions.width}m × ${e.dimensions.height}m = ${(e.dimensions.width*e.dimensions.height).toFixed(2)} sqm) - ₹${e.ratePerSqm.toLocaleString()}/sq.m`,value:e._id||e.id})));const ce=()=>{var e;return(null==(e=null==g?void 0:g.amenities)?void 0:e.length)?g.amenities.filter((e=>{const t=e._id||e.id;return t&&I.includes(t.toString())})).map((e=>{const t=(e._id||e.id).toString();return{id:t,name:e.name,type:e.type,rate:e.rate,description:e.description,quantity:w[t]||1}})):[]};return t.jsxs("div",{style:{padding:"24px"},children:[t.jsxs(N,{gutter:[24,24],children:[t.jsx(P,{span:24,children:t.jsxs(L,{direction:"vertical",size:4,children:[t.jsx(be,{level:2,style:{margin:0},children:"Create Booking"}),t.jsx(O.Text,{type:"secondary",children:"Create a new stall booking"})]})}),t.jsx(P,{span:24,children:t.jsx(R,{children:t.jsx(ne,{form:a,layout:"vertical",onFinish:async e=>{var t,i;try{const s=K.find((t=>t._id===e.exhibitorId));if(!s)throw new Error("Selected exhibitor not found");const[n,a,l]=e.discountId?e.discountId.split("-"):[],o=null==(t=null==g?void 0:g.discountConfig)?void 0:t.find((t=>`${t.name}-${t.value}-${t.type}`===e.discountId)),r=m.map((e=>{const t=e._id||e.id;if(!t)throw new Error(`Invalid stall ID for stall number ${e.number}`);return{stall:e,stallId:t,baseAmount:oe(e)}})),d=r.reduce(((e,{baseAmount:t})=>e+t),0),c=r.map((({stall:e,stallId:t,baseAmount:i})=>{const s=o?((e,t,i)=>{if(!(null==i?void 0:i.isActive))return 0;let s=0;if("percentage"===i.type)s=e*(Math.max(0,Math.min(100,i.value))/100);else{const n=e/t*i.value;s=Math.min(n,e)}return Math.round(100*s)/100})(i,d,o):0;return{stallId:t,number:e.number,baseAmount:i,discount:o?{name:o.name,type:o.type,value:o.value,amount:s}:void 0,amountAfterDiscount:Math.round(100*(i-s))/100}})),x=c.reduce(((e,t)=>{var i;return e+((null==(i=t.discount)?void 0:i.amount)||0)}),0),u=Math.round(100*(d-x))/100,h=(null==(i=null==g?void 0:g.taxConfig)?void 0:i.filter((e=>e.isActive)).map((e=>({name:e.name,rate:e.rate,amount:Math.round(u*e.rate/100*100)/100}))))||[],p=h.reduce(((e,t)=>e+t.amount),0),j=Math.round(100*(u+p))/100,y={exhibitionId:e.exhibitionId,exhibitorId:e.exhibitorId,stallIds:c.map((e=>e.stallId)),customerName:s.contactPerson,customerEmail:s.email,customerPhone:s.phone,customerAddress:s.address||"N/A",customerGSTIN:s.gstNumber||"N/A",customerPAN:s.panNumber||"N/A",companyName:s.companyName,discount:o?{name:o.name,type:o.type,value:o.value}:void 0,amount:j,calculations:{stalls:c,totalBaseAmount:d,totalDiscountAmount:x,totalAmountAfterDiscount:u,taxes:h,totalTaxAmount:p,totalAmount:j}};$.length&&(y.basicAmenities=$.filter((e=>e.calculatedQuantity>0)).map((e=>({name:e.name,type:e.type,perSqm:e.perSqm,quantity:e.quantity,calculatedQuantity:e.calculatedQuantity,description:e.description})))),I.length&&(y.extraAmenities=ce());const f=await W(D(y)).unwrap();f&&f.invoiceId?(Y.success("Booking created successfully! Redirecting to invoice..."),setTimeout((()=>{V(`/invoice/${f.invoiceId}`)}),2e3)):(Y.success("Booking created successfully"),V("/bookings")),f&&f.warning&&Y.warning(f.warning)}catch(s){Y.error("Failed to create booking")}},style:{maxWidth:800},children:t.jsxs(N,{gutter:16,children:[t.jsx(P,{span:12,children:t.jsx(ne.Item,{name:"exhibitionId",label:"Exhibition",rules:[{required:!0,message:"Please select an exhibition"}],children:t.jsx(M,{placeholder:"Select exhibition",loading:G,options:re,onChange:async e=>{try{u(!0),a.setFieldValue("stallIds",[]),a.setFieldValue("discountId",void 0),a.setFieldValue("extraAmenities",[]),h([]),A([]),B([]),z(0);const t=await ae.getExhibition(e);y(t.data);const i=(await ae.getStalls(e)).data.filter((e=>"available"===e.status));c(i)}catch(t){Y.error("Failed to fetch exhibition data")}finally{u(!1)}}})})}),t.jsx(P,{span:12,children:t.jsx(ne.Item,{name:"exhibitorId",label:t.jsxs(L,{children:[t.jsx("span",{children:"Exhibitor"}),t.jsx(ee,{type:"link",icon:t.jsx(j,{}),onClick:()=>r(!0),style:{padding:0},children:"Add Exhibitor"})]}),rules:[{required:!0,message:"Please select an exhibitor"}],children:t.jsx(M,{showSearch:!0,placeholder:"Select exhibitor",loading:X,options:de,filterOption:(e,t)=>{var i;return((null==(i=null==t?void 0:t.label)?void 0:i.toString())??"").toLowerCase().includes(e.toLowerCase())}})})}),t.jsx(P,{span:24,children:t.jsx(ne.Item,{name:"stallIds",label:"Select Stalls",rules:[{required:!0,message:"Please select at least one stall"}],children:t.jsx(M,{mode:"multiple",placeholder:x?"Loading stalls...":"Select stalls",loading:x,onChange:e=>{var t;const i=d.filter((t=>{const i=t._id||t.id;return i&&e.includes(i)}));h(i);const s=i.reduce(((e,t)=>e+t.dimensions.width*t.dimensions.height),0);if(z(s),null==(t=null==g?void 0:g.basicAmenities)?void 0:t.length){const e=g.basicAmenities.map((e=>{const t=Math.floor(s/e.perSqm)*e.quantity;return{...e,calculatedQuantity:t>0?t:0,key:e._id||e.id}}));B(e)}},options:d.map((e=>({label:`Stall ${e.number} (${e.dimensions.width}m × ${e.dimensions.height}m = ${(e.dimensions.width*e.dimensions.height).toFixed(2)} sqm) - ₹${e.ratePerSqm.toLocaleString()}/sq.m`,value:e._id||e.id})))})})}),m.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(P,{span:24,children:t.jsx(R,{title:"Selected Stalls Summary",size:"small",children:t.jsx(se,{dataSource:m.map((e=>({...e,key:e._id||e.id}))),pagination:!1,size:"small",columns:[{title:"Stall Number",dataIndex:"number",key:"number"},{title:"Stall Type",key:"type",render:(e,t)=>{var i,s;return(null==(i=t.stallType)?void 0:i.name)||("object"==typeof t.stallTypeId?null==(s=t.stallTypeId)?void 0:s.name:"Not specified")}},{title:"Dimensions",key:"dimensions",render:(e,t)=>`${t.dimensions.width}m × ${t.dimensions.height}m`},{title:"Area (sqm)",key:"area",render:(e,t)=>(t.dimensions.width*t.dimensions.height).toFixed(2)},{title:"Rate/sq.m",dataIndex:"ratePerSqm",key:"rate",render:e=>`₹${e.toLocaleString()}`},{title:"Base Amount",key:"baseAmount",render:(e,t)=>`₹${oe(t).toLocaleString()}`}],summary:()=>{const e=m.reduce(((e,t)=>e+oe(t)),0);return t.jsxs(se.Summary.Row,{children:[t.jsx(se.Summary.Cell,{index:0,colSpan:5,children:t.jsx("strong",{children:"Total Base Amount"})}),t.jsx(se.Summary.Cell,{index:1,children:t.jsxs("strong",{children:["₹",e.toLocaleString()]})})]},"summary")}})})}),t.jsx(P,{span:24,children:t.jsx(R,{title:"Stall Amenities",size:"small",children:t.jsxs(N,{gutter:[16,24],children:[t.jsxs(P,{span:24,children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(O.Title,{level:5,style:{margin:0},children:t.jsxs(L,{children:[t.jsx("span",{children:"Included Basic Amenities"}),t.jsx(U,{color:"green",children:"Based on stall area"})]})}),t.jsxs(O.Text,{type:"secondary",children:["The following amenities are included based on your total stall area of ",F.toFixed(2)," sqm."]})]}),(null==(e=null==g?void 0:g.basicAmenities)?void 0:e.length)?t.jsx(se,{dataSource:$.filter((e=>e.calculatedQuantity>0)),columns:[{title:"Name",dataIndex:"name",key:"name",render:(e,i)=>t.jsxs(L,{children:[t.jsx(O.Text,{strong:!0,children:e}),t.jsx(U,{color:"blue",children:i.type})]})},{title:"Quantity",dataIndex:"calculatedQuantity",key:"calculatedQuantity",width:120,render:e=>t.jsxs(U,{color:"green",children:[e," ",1===e?"unit":"units"]})},{title:"Allocation",dataIndex:"perSqm",key:"perSqm",width:180,render:(e,i)=>t.jsx(E,{title:i.description,children:t.jsxs(O.Text,{type:"secondary",children:[t.jsx(s,{style:{marginRight:5}}),"1 ",i.quantity>1?`set of ${i.quantity}`:"unit"," per ",e," sqm"]})})},{title:"Status",key:"status",width:100,align:"right",render:()=>t.jsx(O.Text,{type:"success",children:"Included"})}],pagination:!1,size:"small",locale:{emptyText:t.jsx(O.Text,{children:"No basic amenities qualify based on the selected stall area."})}}):t.jsx(O.Text,{type:"secondary",children:"No basic amenities have been configured for this exhibition."})]}),t.jsxs(P,{span:24,children:[t.jsx(Q,{style:{margin:"12px 0 24px"}}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(O.Title,{level:5,style:{margin:0},children:t.jsxs(L,{children:[t.jsx("span",{children:"Additional Amenities"}),t.jsx(U,{color:"blue",children:"Optional"})]})}),t.jsx(O.Text,{type:"secondary",children:"Select any additional amenities for the booking."})]}),(null==(i=null==g?void 0:g.amenities)?void 0:i.length)?t.jsxs(t.Fragment,{children:[t.jsx(ne.Item,{name:"extraAmenities",label:"Select Additional Amenities",children:t.jsx(M,{mode:"multiple",placeholder:"Select amenities",style:{width:"100%"},onChange:e=>{const t={...w};e.forEach((e=>{I.includes(e)||(t[e]=1)})),Object.keys(t).forEach((i=>{e.includes(i)||delete t[i]})),C(t),A(e)},optionLabelProp:"label",options:g.amenities.map((e=>({label:`${e.name} (${e.rate?`₹${e.rate.toLocaleString()}`:"N/A"})`,value:e._id||e.id,key:e._id||e.id})))})}),I.length>0&&t.jsxs("div",{style:{marginTop:16},children:[t.jsx(O.Text,{strong:!0,children:"Selected Amenities:"}),t.jsx(se,{dataSource:ce(),columns:[{title:"Name",dataIndex:"name",key:"name",render:(e,i)=>t.jsxs(L,{align:"center",children:[t.jsx(O.Text,{strong:!0,children:e}),t.jsx(U,{color:"blue",children:i.type}),t.jsx(O.Text,{type:"secondary",style:{fontSize:"13px"},children:i.description||""})]})},{title:"Rate",dataIndex:"rate",key:"rate",width:120,align:"right",render:e=>t.jsxs(O.Text,{strong:!0,style:{color:"#1890ff"},children:["₹",e.toLocaleString("en-IN")]})},{title:"Quantity",dataIndex:"quantity",key:"quantity",width:120,render:(e,i)=>t.jsx(J,{min:1,value:w[i.id]||1,onChange:e=>{return t=i.id,s=e||1,void C((e=>({...e,[t]:s})));var t,s},style:{width:"100%"}})},{title:"Total",key:"total",width:120,align:"right",render:(e,i)=>{const s=w[i.id]||1,n=i.rate*s;return t.jsxs(O.Text,{strong:!0,style:{color:"#1890ff"},children:["₹",n.toLocaleString("en-IN")]})}}],pagination:!1,size:"small"})]})]}):t.jsx(O.Text,{type:"secondary",children:"No additional amenities have been configured for this exhibition."})]})]})})}),t.jsx(P,{span:24,children:t.jsxs(R,{title:"Price Calculations",size:"small",children:[t.jsx(N,{gutter:[16,16],children:t.jsx(P,{span:12,children:t.jsx(ne.Item,{name:"discountId",label:"Available Discounts",children:t.jsx(M,{placeholder:"Select discount",allowClear:!0,onChange:e=>{b(e),a.setFieldValue("discountId",e)},options:null==(n=null==g?void 0:g.discountConfig)?void 0:n.map((e=>({label:`${e.name} (${"percentage"===e.type?e.value+"%":"₹"+e.value})${e.isActive?"":" - Inactive"}`,value:`${e.name}-${e.value}-${e.type}`,disabled:!e.isActive})))})})})}),t.jsx("div",{style:{background:"#fafafa",padding:"16px",borderRadius:"8px",marginTop:"16px"},children:t.jsx(L,{direction:"vertical",style:{width:"100%"},size:"small",children:(()=>{const{baseAmount:e,selectedDiscount:i,discountAmount:s,amountAfterDiscount:n,taxes:a,totalAmount:l}=(()=>{var e,t;const i=m.reduce(((e,t)=>e+oe(t)),0),s=null==(e=null==g?void 0:g.discountConfig)?void 0:e.find((e=>`${e.name}-${e.value}-${e.type}`===f&&e.isActive)),n=s?"percentage"===s.type?Math.round(i*s.value/100*100)/100:Math.min(s.value,i):0,a=Math.round(100*(i-n))/100,l=(null==(t=null==g?void 0:g.taxConfig)?void 0:t.filter((e=>e.isActive)).map((e=>({name:e.name,rate:e.rate,amount:Math.round(a*e.rate/100*100)/100}))))||[],o=l.reduce(((e,t)=>e+t.amount),0),r=Math.round(100*(a+o))/100;return{baseAmount:i,selectedDiscount:s,discountAmount:n,amountAfterDiscount:a,taxes:l,totalTaxAmount:o,totalAmount:r}})();return t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(ve,{children:"Total Base Amount:"}),t.jsxs(ve,{children:["₹",e.toLocaleString()]})]}),i&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsxs(ve,{children:["Discount (","percentage"===i.type?`${i.value}%`:`₹${i.value.toLocaleString()}`,"):"]}),t.jsxs(ve,{type:"danger",children:["-₹",s.toLocaleString()]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(ve,{children:"Amount after Discount:"}),t.jsxs(ve,{children:["₹",n.toLocaleString()]})]}),t.jsx(Q,{style:{margin:"8px 0"}}),a.map((e=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsxs(ve,{children:[e.name," (",e.rate,"%):"]}),t.jsxs(ve,{children:["₹",e.amount.toLocaleString()]})]},`tax-${e.name}`))),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[t.jsx(ve,{strong:!0,children:"Total Amount (incl. Taxes):"}),t.jsxs(ve,{strong:!0,children:["₹",l.toLocaleString()]})]})]})})()})})]})})]}),t.jsx(P,{span:24,children:t.jsx(ne.Item,{children:t.jsxs(L,{children:[t.jsx(ee,{type:"primary",htmlType:"submit",loading:Z,children:"Create Booking"}),t.jsx(ee,{onClick:()=>V("/bookings"),children:"Cancel"})]})})})]})})})})]}),t.jsx(ie,{title:t.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:"#101828"},children:"Add Exhibitor"}),open:o,onCancel:()=>{r(!1),l.resetFields()},width:800,footer:t.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-start",padding:"20px 24px"},children:[t.jsx(ee,{onClick:()=>{r(!1),l.resetFields()},style:{height:"40px",padding:"10px 16px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",backgroundColor:"white"},children:"Cancel"}),t.jsx(ee,{type:"primary",onClick:l.submit,style:{height:"40px",padding:"10px 16px",borderRadius:"8px",border:"none",backgroundColor:"#6941C6",color:"white",fontWeight:500,fontSize:"14px",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Add Exhibitor"})]}),styles:{body:{padding:"24px",maxHeight:"calc(100vh - 200px)",overflowY:"auto"},header:{borderBottom:"1px solid #E5E7EB",padding:"24px"},footer:{borderTop:"1px solid #E5E7EB",padding:0}},style:{top:20},children:t.jsx(ne,{form:l,layout:"vertical",onFinish:async e=>{try{const t=await le.createExhibitor(e);Y.success("Exhibitor added successfully"),W(_()),a.setFieldsValue({exhibitorId:t.data._id}),r(!1),l.resetFields()}catch(t){const e=(null==t?void 0:t.message)||"Failed to add exhibitor";Y.error(e),"User with this email already exists"===e&&l.setFields([{name:"contactEmail",errors:["This email is already registered"]}])}},requiredMark:!1,children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"32px"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#101828",marginBottom:"24px"},children:"Company Information"}),t.jsx(ne.Item,{name:"companyName",label:"Company Name",rules:[{required:!0,message:"Please enter company name"}],children:t.jsx(q,{})}),t.jsx(ne.Item,{name:"address",label:"Address",rules:[{required:!0,message:"Please enter address"}],children:t.jsx(q.TextArea,{rows:3})}),t.jsx(ne.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:t.jsx(q,{})}),t.jsx(ne.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:t.jsx(q,{})}),t.jsx(ne.Item,{name:"pinCode",label:"PIN Code",rules:[{required:!0,message:"Please enter PIN code"},{pattern:/^\d{6}$/,message:"Please enter a valid 6-digit PIN code"}],children:t.jsx(q,{})}),t.jsx(ne.Item,{name:"status",label:"Status",initialValue:"active",children:t.jsxs(M,{children:[t.jsx(M.Option,{value:"active",children:t.jsx("div",{style:{display:"inline-flex",padding:"2px 8px",borderRadius:"16px",fontSize:"12px",fontWeight:500,backgroundColor:"#F6FEF9",color:"#039855",border:"1px solid #ABEFC6",alignItems:"center",height:"22px"},children:"ACTIVE"})}),t.jsx(M.Option,{value:"inactive",children:t.jsx("div",{style:{display:"inline-flex",padding:"2px 8px",borderRadius:"16px",fontSize:"12px",fontWeight:500,backgroundColor:"#FEF3F2",color:"#D92D20",border:"1px solid #FDA29B",alignItems:"center",height:"22px"},children:"INACTIVE"})})]})})]}),t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#101828",marginBottom:"24px"},children:"Contact & Legal Information"}),t.jsx(ne.Item,{name:"contactPerson",label:"Contact Person",rules:[{required:!0,message:"Please enter contact person"}],children:t.jsx(q,{})}),t.jsx(ne.Item,{name:"contactEmail",label:"Email",rules:[{required:!0,message:"Please enter email"},{type:"email",message:"Please enter a valid email"}],children:t.jsx(q,{})}),t.jsx(ne.Item,{name:"contactPhone",label:"Phone",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^\d{10}$/,message:"Please enter a valid 10-digit phone number"}],children:t.jsx(q,{})}),t.jsx(ne.Item,{name:"panNumber",label:"PAN Number",rules:[{pattern:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,message:"Please enter a valid PAN number"}],children:t.jsx(q,{placeholder:"ABCDE1234F"})}),t.jsx(ne.Item,{name:"gstNumber",label:"GST Number",rules:[{pattern:/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,message:"Please enter a valid GST number"}],children:t.jsx(q,{placeholder:"27AAPFU0939F1ZV"})})]})]})})})]})}},Symbol.toStringTag,{value:"Module"}));export{Se as a,fe as i,oe as u};
