import{j as e}from"./vendor-pdf-Cn0rG44s.js";import{r as m,F as i,G as T,S as k,h as d,ad as D,P as R,K as f,t as x,w as n}from"./vendor-antd-B8jUXf3i.js";import{X as W,Y as $,Z as L,b as j}from"./index-4IR4xblb.js";import{b as M,u as B}from"./vendor-react-DW9h-haf.js";import{S as G,u as U,T as V}from"./vendor-antd-icons-BoTJB7uA.js";import"./vendor-redux-rS0pI56E.js";import"./vendor-http-t--hEgTQ.js";import"./vendor-ui-BmMA_ojr.js";import"./vendor-canvas-DrFPvyt4.js";const J=()=>{const{id:s}=M(),w=B(),{data:o,isLoading:S}=W(s||""),[A,h]=m.useState(!1),[N,p]=m.useState(!1),[c]=i.useForm(),[b,u]=m.useState(0),[t,g]=m.useState(!1),C=async()=>{if(s)try{g(!0),u(0),n.loading({content:"Preparing invoice...",key:"download"});const a=await L(`/invoices/${s}/download?force=false`,!1,y=>{const v=y.total,P=y.loaded;if(v){const I=Math.round(P*100/v);u(I),I%25===0&&n.loading({content:`Downloading: ${I}% complete`,key:"download"})}}),r=window.URL.createObjectURL(new Blob([a.data])),l=document.createElement("a");l.href=r,l.setAttribute("download",`invoice-${s}.pdf`),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(r),n.success({content:"Invoice downloaded successfully",key:"download"})}catch(a){console.error("Download error:",a),n.error({content:"Failed to download invoice",key:"download"})}finally{g(!1),u(0)}},E=async a=>{try{await j.post(`/invoices/${s}/share/email`,a),n.success("Invoice shared via email successfully"),h(!1),c.resetFields()}catch(r){console.error("Email sharing error:",r),n.error("Failed to share invoice via email")}},F=async a=>{try{await j.post(`/invoices/${s}/share/whatsapp`,a),n.success("Invoice shared via WhatsApp successfully"),p(!1),c.resetFields()}catch(r){console.error("WhatsApp sharing error:",r),n.error("Failed to share invoice via WhatsApp")}};return S||!o?e.jsx("div",{children:"Loading..."}):(console.log("Invoice data:",o),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(T,{title:"Invoice Details",extra:e.jsxs(k,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(k,{children:[e.jsx(d,{icon:e.jsx(G,{}),onClick:()=>w(-1),disabled:t,children:"Back"}),e.jsx(d,{type:"primary",icon:e.jsx(D,{}),onClick:C,loading:t&&b<100,disabled:t&&b>=100,children:"Download"}),e.jsx(d,{icon:e.jsx(U,{}),onClick:()=>h(!0),disabled:t,children:"Share via Email"}),e.jsx(d,{icon:e.jsx(V,{}),onClick:()=>p(!0),disabled:t,children:"Share via WhatsApp"})]}),t&&e.jsx(R,{percent:b,size:"small",status:"active",style:{marginBottom:0,marginTop:4}})]}),children:e.jsx($,{booking:{...o.bookingId,customerGSTIN:o.bookingId.customerGSTIN||"",invoiceNumber:o.invoiceNumber,exhibitionId:{...o.bookingId.exhibitionId,companyName:o.bookingId.exhibitionId.companyName||"Company Name",bankName:o.bookingId.exhibitionId.bankName||"",bankAccount:o.bookingId.exhibitionId.bankAccount||"",bankAccountName:o.bookingId.exhibitionId.bankAccountName||"",bankBranch:o.bookingId.exhibitionId.bankBranch||"",bankIFSC:o.bookingId.exhibitionId.bankIFSC||"",companyCIN:o.bookingId.exhibitionId.companyCIN||"",companyPAN:o.bookingId.exhibitionId.companyPAN||"",companySAC:o.bookingId.exhibitionId.companySAC||"",companyGST:o.bookingId.exhibitionId.companyGST||"",companyEmail:o.bookingId.exhibitionId.companyEmail||"",companyWebsite:o.bookingId.exhibitionId.companyWebsite||"",companyAddress:o.bookingId.exhibitionId.companyAddress||"",headerLogo:o.bookingId.exhibitionId.headerLogo||void 0},calculations:{...o.bookingId.calculations,stalls:o.bookingId.calculations.stalls.map(a=>({discount:a.discount?{...a.discount,type:a.discount.type||"percentage",value:a.discount.value}:void 0}))}}})}),e.jsx(f,{title:"Share Invoice via Email",open:A,onCancel:()=>h(!1),footer:null,children:e.jsxs(i,{form:c,onFinish:E,layout:"vertical",children:[e.jsx(i.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter email address"},{type:"email",message:"Please enter a valid email address"}],children:e.jsx(x,{placeholder:"Enter email address"})}),e.jsx(i.Item,{name:"message",label:"Message (Optional)",children:e.jsx(x.TextArea,{placeholder:"Enter optional message"})}),e.jsx(i.Item,{children:e.jsx(d,{type:"primary",htmlType:"submit",children:"Send"})})]})}),e.jsx(f,{title:"Share Invoice via WhatsApp",open:N,onCancel:()=>p(!1),footer:null,children:e.jsxs(i,{form:c,onFinish:F,layout:"vertical",children:[e.jsx(i.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^\+?[1-9]\d{9,14}$/,message:"Please enter a valid phone number"}],children:e.jsx(x,{placeholder:"Enter phone number with country code"})}),e.jsx(i.Item,{children:e.jsx(d,{type:"primary",htmlType:"submit",children:"Send"})})]})})]}))};export{J as default};
