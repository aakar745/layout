const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BfjvBafq.js","assets/vendor-react-BNeW3y6d.js","assets/vendor-utils-BlPUcn-b.js","assets/vendor-antd-sZZBSykP.js","assets/vendor-styling-ULYxIwmc.js","assets/vendor-canvas-BRbMLhVA.js","assets/index-Bppz5v0Z.css"])))=>i.map(i=>d[i]);
import{j as e,Y as K,ab as ae,C as Fe,a2 as Ye,a as Ue,a5 as Ke}from"./index-BfjvBafq.js";import{r as p,j as Ve,i as Ae}from"./vendor-react-BNeW3y6d.js";import{u as xe,a as Ge,F as He}from"./vendor-export-CrAKd1if.js";import{a7 as V,T as re,a5 as je,a6 as _,a4 as ie,K as Je,bb as We,bf as Ze,S as J,c as le,j as Xe,bd as et,D as tt,b as B,v as st,a1 as Ce,aB as at,H as it,E as ne,am as me,Q as lt,b0 as nt,B as fe,p as rt,bq as ot,M as se,aR as ct,b6 as dt,l as ut,ah as pt,d as xt,n as ke,b3 as mt,ar as he,br as ft}from"./vendor-antd-sZZBSykP.js";import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:ht,Text:H}=re,{Option:L}=ie,{RangePicker:gt}=Ze,bt=({exhibitionId:j,exhibitions:y,exhibitionsLoading:h,onExhibitionChange:A,typeFilter:Q,setTypeFilter:C,bookingStatusFilter:x,setBookingStatusFilter:k,searchQuery:M,setSearchQuery:z,dateRange:q,setDateRange:F,resetFilters:G})=>{var $,W;const R=g=>{z(g.target.value)},I=g=>{F(g)};return e.jsxs(V,{className:"amenities-filters",children:[e.jsx(ht,{level:5,className:"filter-heading",children:"Filters"}),e.jsxs(je,{gutter:[16,16],children:[e.jsx(_,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(H,{className:"filter-label",children:"Exhibition"}),e.jsx(ie,{placeholder:"Select an exhibition",style:{width:"100%"},loading:h,onChange:A,value:j,children:y.map(g=>e.jsx(L,{value:g._id,children:g.name},g._id))})]})}),e.jsx(_,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(H,{className:"filter-label",children:"Amenity Type"}),e.jsxs(ie,{mode:"multiple",placeholder:"Select types",style:{width:"100%"},value:Q,onChange:C,maxTagCount:2,children:[e.jsx(L,{value:"facility",children:"Facility"}),e.jsx(L,{value:"service",children:"Service"}),e.jsx(L,{value:"equipment",children:"Equipment"}),e.jsx(L,{value:"other",children:"Other"})]})]})}),e.jsx(_,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(H,{className:"filter-label",children:"Booking Status"}),e.jsxs(ie,{mode:"multiple",placeholder:"Select statuses",style:{width:"100%"},value:x,onChange:k,maxTagCount:2,children:[e.jsx(L,{value:"confirmed",children:"Confirmed"}),e.jsx(L,{value:"approved",children:"Approved"}),e.jsx(L,{value:"pending",children:"Pending"}),e.jsx(L,{value:"rejected",children:"Rejected"}),e.jsx(L,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(_,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(H,{className:"filter-label",children:"Search"}),e.jsx(Je,{placeholder:"Search amenities",prefix:e.jsx(We,{}),value:M,onChange:R,allowClear:!0})]})}),e.jsx(_,{xs:24,md:16,lg:12,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(H,{className:"filter-label",children:"Booking Date Range"}),e.jsx(gt,{style:{width:"100%"},onChange:I,value:q})]})}),e.jsx(_,{xs:24,md:8,lg:12,children:e.jsx("div",{className:"filter-group",style:{display:"flex",justifyContent:"flex-end",alignItems:"flex-end",height:"100%"},children:e.jsxs(J,{children:[e.jsx(le,{icon:e.jsx(Xe,{}),onClick:G,children:"Reset"}),e.jsx(le,{type:"primary",icon:e.jsx(et,{}),children:"Apply Filters"})]})})})]}),(Q.length>0||x.length>0||M||q)&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"filter-divider"}),e.jsxs("div",{children:[e.jsx(H,{className:"filter-label",children:"Active Filters:"}),e.jsxs("div",{style:{marginTop:8},children:[Q.map(g=>e.jsxs(B,{closable:!0,onClose:()=>C(Q.filter(E=>E!==g)),className:`amenity-tag amenity-tag-${g}`,children:["Type: ",g]},`type-${g}`)),x.map(g=>e.jsxs(B,{closable:!0,onClose:()=>k(x.filter(E=>E!==g)),color:"blue",children:["Status: ",g]},`status-${g}`)),M&&e.jsxs(B,{closable:!0,onClose:()=>z(""),color:"purple",children:["Search: ",M]}),q&&e.jsxs(B,{closable:!0,onClose:()=>F(null),color:"green",children:["Date Range: ",($=q[0])==null?void 0:$.format("MMM DD, YYYY")," - ",(W=q[1])==null?void 0:W.format("MMM DD, YYYY")]})]})]})]})]})},{Text:Ct}=re,jt=({basicAmenities:j,extraAmenities:y,bookedStalls:h,calculatedAmenities:A})=>e.jsxs(je,{gutter:[24,24],children:[e.jsx(_,{xs:24,sm:12,md:6,children:e.jsxs(V,{className:"stats-card stats-primary",bordered:!1,children:[e.jsx(st,{style:{fontSize:24,color:"#1890ff"}}),e.jsx("div",{className:"stats-value",children:j.length}),e.jsx("div",{className:"stats-label",children:"Basic Amenities"})]})}),e.jsx(_,{xs:24,sm:12,md:6,children:e.jsxs(V,{className:"stats-card stats-secondary",bordered:!1,children:[e.jsx(Ce,{style:{fontSize:24,color:"#52c41a"}}),e.jsx("div",{className:"stats-value",children:y.length}),e.jsx("div",{className:"stats-label",children:"Extra Amenities"})]})}),e.jsx(_,{xs:24,sm:12,md:6,children:e.jsxs(V,{className:"stats-card stats-tertiary",bordered:!1,children:[e.jsx(at,{style:{fontSize:24,color:"#fa8c16"}}),e.jsx("div",{className:"stats-value",children:h}),e.jsx("div",{className:"stats-label",children:"Booked Stalls"})]})}),e.jsx(_,{xs:24,sm:12,md:6,children:e.jsxs(V,{className:"stats-card stats-quaternary",bordered:!1,children:[e.jsx(it,{style:{fontSize:24,color:"#722ed1"}}),e.jsx("div",{className:"stats-value",children:A}),e.jsx("div",{className:"stats-label",children:"Calculated Amenities"})]})})]}),{Text:O,Title:Te}=re,we=j=>{switch(j){case"facility":return{color:"#e6f7ff",borderColor:"#91d5ff",textColor:"#1890ff"};case"service":return{color:"#f6ffed",borderColor:"#b7eb8f",textColor:"#52c41a"};case"equipment":return{color:"#fff7e6",borderColor:"#ffd591",textColor:"#fa8c16"};default:return{color:"#f9f0ff",borderColor:"#d3adf7",textColor:"#722ed1"}}},ge=({title:j,amenities:y,loading:h,onExport:A,isDynamicColumns:Q=!1,isCalculated:C=!1,exhibitionId:x,amenityViewType:k="basic"})=>{const[M,z]=p.useState([]),[q,F]=p.useState([]),[G,R]=p.useState(!1),I=p.useMemo(()=>C?k==="basic"?y.filter(o=>o.hasOwnProperty("calculatedQuantity")||o.hasOwnProperty("perSqm")):k==="extra"?y.filter(o=>o.hasOwnProperty("rate")&&!o.hasOwnProperty("perSqm")):y:y,[y,C,k]);p.useEffect(()=>{if(!x){F([]),R(!1);return}R(!0),setTimeout(()=>{R(!1)},500)},[x]);const $=()=>{const o=new Map,u=new Map;I.forEach(s=>{if(s.isExtraAmenity&&s.isBookingLevel){u.has(s.bookingId)||u.set(s.bookingId,{key:`booking-${s.bookingId}`,companyName:s.exhibitorName||"Unknown",stallNumber:s.stallNumber,dimension:s.dimensions,stallType:s.stallType,area:s.area||0,bookingDate:s.bookingDate?new Date(s.bookingDate).toISOString().slice(0,10):"-",status:s.bookingStatus||"-",amenities:{},isBookingLevel:!0,stallCount:s.stallCount||1});const d=u.get(s.bookingId);s.booked&&s.quantity>0&&(d.amenities[s.name]=s.quantity)}else if(s.stallId&&s.stallNumber&&!s.isBookingLevel){o.has(s.stallId)||o.set(s.stallId,{key:s.stallId,companyName:s.exhibitorName||"Unknown",stallNumber:s.stallNumber,dimension:ae(s.dimensions),stallType:s.stallType||"-",area:K(s.dimensions),bookingDate:s.bookingDate?new Date(s.bookingDate).toISOString().slice(0,10):"-",status:s.bookingStatus||"-",amenities:{},isBookingLevel:!1});const d=o.get(s.stallId);if(s.hasOwnProperty("calculatedQuantity"))d.amenities[s.name]=s.calculatedQuantity;else if(s.hasOwnProperty("perSqm")){const m=typeof d.area=="number"?d.area:0,P=Math.floor(m/s.perSqm)*s.quantity;d.amenities[s.name]=P>0?P:s.quantity}}});let f=[];return k==="basic"&&(f=[...f,...Array.from(o.values()).filter(s=>Object.keys(s.amenities).length>0)]),k==="extra"&&(f=[...f,...Array.from(u.values()).filter(s=>Object.keys(s.amenities).length>0)]),f},W=()=>{const o=new Set;return I.forEach(u=>{const f=s=>C?!0:j.toLowerCase().includes("basic")?s.hasOwnProperty("perSqm"):j.toLowerCase().includes("additional")||j.toLowerCase().includes("extra")?s.hasOwnProperty("rate"):!0;u.name&&f(u)&&o.add(u.name)}),Array.from(o)},g=()=>{const o=[{title:"Company Name",dataIndex:"companyName",key:"companyName",fixed:"left",width:180,render:d=>e.jsx(O,{strong:!0,children:d}),sorter:(d,m)=>d.companyName.localeCompare(m.companyName)},{title:"Stall No.",dataIndex:"stallNumber",key:"stallNumber",width:150,render:(d,m)=>m.isBookingLevel?e.jsx(fe,{status:"processing",text:d}):e.jsx(fe,{status:"success",text:d}),sorter:(d,m)=>d.stallNumber.localeCompare(m.stallNumber)},{title:"Dimension",dataIndex:"dimension",key:"dimension",width:120},{title:"Stall Type",dataIndex:"stallType",key:"stallType",width:120},{title:"Area (SQM)",dataIndex:"area",key:"area",width:100,render:d=>typeof d=="number"?d.toFixed(2):d,sorter:(d,m)=>{const P=typeof d.area=="number"?d.area:0,N=typeof m.area=="number"?m.area:0;return P-N}}],f=W().map(d=>({title:d,dataIndex:["amenities",d],key:d,width:100,render:m=>m==null?"-":m===0?e.jsx(O,{type:"secondary",children:"0"}):m==="âœ“"?e.jsx(fe,{status:"success"}):e.jsx(O,{strong:!0,children:m}),sorter:(m,P)=>{const N=m.amenities[d]||0,ee=P.amenities[d]||0;return N-ee}})),s={title:"Actions",key:"actions",width:80,fixed:"right",render:(d,m)=>e.jsx(rt,{overlay:e.jsxs(se,{children:[e.jsx(se.Item,{icon:e.jsx(ct,{}),children:"View Details"},"view"),e.jsx(se.Item,{icon:e.jsx(dt,{}),children:"Edit"},"edit"),e.jsx(se.Item,{icon:e.jsx(ut,{}),children:"Settings"},"settings")]}),trigger:["click"],children:e.jsx(le,{type:"text",icon:e.jsx(ot,{})})})};return[...o,...f,s]},E=o=>{z(o)},X=$(),ye=o=>e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Te,{level:5,children:"Stall Details"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:[Object.entries(o).map(([u,f])=>["key","amenities"].includes(u)?null:e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs(O,{type:"secondary",style:{fontSize:"12px"},children:[u.charAt(0).toUpperCase()+u.slice(1).replace(/([A-Z])/g," $1"),":"]}),e.jsx("div",{children:e.jsx(O,{strong:!0,children:f==null?"-":typeof f=="object"?JSON.stringify(f):String(f)})})]},u)),e.jsxs("div",{style:{marginBottom:"8px",gridColumn:"1 / -1"},children:[e.jsx(O,{type:"secondary",style:{fontSize:"12px"},children:"Amenities:"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"4px"},children:Object.entries(o.amenities||{}).map(([u,f])=>e.jsxs(B,{color:"blue",children:[u,": ",f==="âœ“"?"Available":f]},u))})]})]})]});return e.jsx(V,{className:"amenities-card",title:e.jsxs(J,{children:[e.jsx(Te,{level:5,style:{margin:0},children:j}),C&&e.jsxs(e.Fragment,{children:[e.jsx(B,{color:"green",children:"Calculated"}),k==="basic"&&e.jsx(B,{color:"blue",children:"Basic Amenities"}),k==="extra"&&e.jsx(B,{color:"purple",children:"Extra Amenities"})]})]}),extra:e.jsx(J,{children:e.jsx(le,{type:"primary",icon:e.jsx(nt,{}),onClick:A,disabled:I.length===0,children:"Export"})}),children:I.length===0?e.jsx(ne,{image:ne.PRESENTED_IMAGE_SIMPLE,description:"No amenities data available"}):j.toLowerCase().includes("basic")&&!C?e.jsx(me,{dataSource:I.map((o,u)=>({key:o._id||o.id||`basic-${u}`,...o})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(o,u)=>e.jsxs(J,{children:[e.jsx(O,{strong:!0,children:o}),e.jsx(B,{color:we(u.type).textColor,children:u.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Per SQM",dataIndex:"perSqm",key:"perSqm",render:o=>o?`1 per ${o} sqm`:"-"},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:o=>e.jsx(B,{color:"blue",children:o})}],loading:h,pagination:{pageSize:10},className:"amenities-table"}):(j.toLowerCase().includes("additional")||j.toLowerCase().includes("extra"))&&!C?e.jsx(me,{dataSource:I.map((o,u)=>({key:o._id||o.id||`extra-${u}`,...o})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(o,u)=>e.jsxs(J,{children:[e.jsx(O,{strong:!0,children:o}),e.jsx(B,{color:we(u.type).textColor,children:u.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Rate",dataIndex:"rate",key:"rate",render:o=>e.jsxs(O,{style:{color:"#1890ff"},children:["â‚¹",o.toLocaleString()]})}],loading:h,pagination:{pageSize:10},className:"amenities-table"}):X.length===0?e.jsx(lt,{message:"No stall data available",description:"Amenities exist but could not be linked to stalls. Make sure stalls are booked and have amenities assigned.",type:"info",showIcon:!0}):e.jsx(me,{dataSource:X,columns:g(),loading:h||G,pagination:{pageSize:10},className:"amenities-table",scroll:{x:"max-content"},expandable:{expandedRowKeys:M,onExpandedRowsChange:E,expandedRowRender:ye}})})},{Title:yt,Text:ve}=re,{TabPane:kt}=ke,be=(j,y)=>{const h=xe.json_to_sheet(j),A=xe.book_new();xe.book_append_sheet(A,h,"Amenities");const Q=Ge(A,{bookType:"xlsx",type:"array"}),C=new Blob([Q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});He.saveAs(C,`${y}.xlsx`)},Et=()=>{const j=Ve(),{message:y}=pt.useApp(),{exhibitions:h,loading:A}=Ae(a=>a.exhibition),{bookings:Q,loading:C}=Ae(a=>a.booking),[x,k]=p.useState(null),[M,z]=p.useState([]),[q,F]=p.useState([]),[G,R]=p.useState([]),[I,$]=p.useState([]),[W,g]=p.useState(!1),[E,X]=p.useState({}),[ye,o]=p.useState(!1),[u,f]=p.useState({current:1,pageSize:10,total:0}),[s,d]=p.useState([]),[m,P]=p.useState([]),[N,ee]=p.useState(""),[Y,Se]=p.useState(null),[Ee,oe]=p.useState(0),[De,ce]=p.useState(0),[Be,_e]=p.useState("basic"),[U,Me]=p.useState("basic");p.useEffect(()=>{j(Fe()),j(Ye({page:1,limit:100}))},[j]);const qe=async(a,i=1,c=10)=>{try{g(!0);const n=await Ue.get("/bookings",{params:{exhibitionId:a,includeDetails:!0,populate:"stallIds.stallTypeId",page:i,limit:c}});if(n&&n.data){const r=n.data.data.map(l=>{const t={...l};return t.stallIds&&(t.stallIds=t.stallIds.map(b=>(b.stallTypeId&&typeof b.stallTypeId=="object"&&(b.type=b.stallTypeId.name),b))),t}).filter(l=>l.exhibitionId._id===a&&["confirmed","approved"].includes(l.status));$(r),f({current:n.data.pagination.page,pageSize:n.data.pagination.limit,total:n.data.pagination.total})}else $([]),f({current:1,pageSize:10,total:0})}catch(n){console.error("Error fetching complete booking data:",n),$([]),f({current:1,pageSize:10,total:0})}finally{g(!1)}};p.useEffect(()=>{if(x&&h.length>0){const a=h.find(i=>i._id===x);a&&(z(a.basicAmenities||[]),F(a.amenities||[]),qe(x,u.current,u.pageSize))}else z([]),F([]),R([]),oe(0),ce(0),$([])},[x,h]),p.useEffect(()=>{if(x&&h.length>0&&I.length>0){const a=h.find(i=>i._id===x);if(a){const i=I.flatMap(r=>r.stallIds.map(l=>{const t=l.type||(l.stallTypeId&&typeof l.stallTypeId=="object"?l.stallTypeId.name:E[l.stallTypeId])||"-";return{stallId:l._id,stallNumber:l.number,bookingId:r._id,exhibitorName:r.companyName,bookingDate:r.createdAt,dimensions:l.dimensions,area:K(l.dimensions),status:r.status,stallType:t}})),c=I.flatMap(r=>!r.basicAmenities||r.basicAmenities.length===0?r.stallIds.flatMap(l=>{const t=K(l.dimensions),b=l.type||(l.stallTypeId&&typeof l.stallTypeId=="object"?l.stallTypeId.name:E[l.stallTypeId])||"-";return(a.basicAmenities||[]).map(S=>{const T=Math.floor(t/S.perSqm)*S.quantity;return{...S,calculatedQuantity:T>0?T:S.quantity,stallId:l._id,stallNumber:l.number,bookingId:r._id,exhibitorId:r.exhibitorId||"",exhibitorName:r.companyName,bookingDate:r.createdAt,dimensions:l.dimensions,area:t,bookingStatus:r.status,stallType:b}})}):r.basicAmenities.flatMap(l=>r.stallIds.map(t=>{const b=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:E[t.stallTypeId])||"-";return{...l,stallId:t._id,stallNumber:t.number,bookingId:r._id,exhibitorId:r.exhibitorId||"",exhibitorName:r.companyName,bookingDate:r.createdAt,dimensions:t.dimensions,area:K(t.dimensions),bookingStatus:r.status,stallType:b}}))),n=I.flatMap(r=>!r.extraAmenities||r.extraAmenities.length===0?[]:r.extraAmenities.map(l=>{var te;const t=r.stallIds.map(w=>ae(w.dimensions)).join(", "),b=r.stallIds.map(w=>w.type||(w.stallTypeId&&typeof w.stallTypeId=="object"?w.stallTypeId.name:E[w.stallTypeId])||"-"),S=[...new Set(b)],T=S.length===1?S[0]:S.join(", ");return{...l,booked:!0,stallId:((te=r.stallIds[0])==null?void 0:te._id)||"",stallNumber:r.stallIds.map(w=>w.number).join(", "),bookingId:r._id,exhibitorId:r.exhibitorId||"",exhibitorName:r.companyName,bookingDate:r.createdAt,dimensions:t,area:r.stallIds.reduce((w,Z)=>w+K(Z.dimensions),0),bookingStatus:r.status,stallType:T,allStalls:r.stallIds,isExtraAmenity:!0,isBookingLevel:!0,stallCount:r.stallIds.length,quantity:l.quantity||1}}));let D=n;if(n.length===0&&a.amenities&&a.amenities.length>0){const r=new Set;D=I.flatMap(l=>r.has(l._id)?[]:(r.add(l._id),(a.amenities||[]).map((t,b)=>{var Ie,Ne;const S=(Ie=l.extraAmenities)==null?void 0:Ie.find(v=>v.name===t.name),T=!!S,te=l.stallIds.map(v=>ae(v.dimensions)).join(", "),w=l.stallIds.map(v=>v.type||(v.stallTypeId&&typeof v.stallTypeId=="object"?v.stallTypeId.name:E[v.stallTypeId])||"-"),Z=[...new Set(w)],Qe=Z.length===1?Z[0]:Z.join(", ");return{...t,id:`sim-booking-${l._id}-${b}`,booked:T,stallId:((Ne=l.stallIds[0])==null?void 0:Ne._id)||"",stallNumber:l.stallIds.map(v=>v.number).join(", "),bookingId:l._id,exhibitorId:l.exhibitorId||"",exhibitorName:l.companyName||"Unknown",bookingDate:l.createdAt||new Date().toISOString(),dimensions:te,area:l.stallIds.reduce((v,ze)=>v+K(ze.dimensions),0),bookingStatus:l.status||"approved",stallType:Qe,allStalls:l.stallIds,isExtraAmenity:!0,isBookingLevel:!0,stallCount:l.stallIds.length,quantity:T?(S==null?void 0:S.quantity)||1:0}})))}R([...c,...D]),oe(i.length),ce(c.length+D.length)}}else x&&h.length>0&&(R([]),oe(0),ce(0))},[x,h,I,E]);const de=p.useMemo(()=>{let a=M;if(s.length>0&&(a=a.filter(i=>s.includes(i.type))),N){const i=N.toLowerCase();a=a.filter(c=>c.name.toLowerCase().includes(i)||c.type.toLowerCase().includes(i)||c.description&&c.description.toLowerCase().includes(i))}return a},[M,s,N]),ue=p.useMemo(()=>{let a=q;if(s.length>0&&(a=a.filter(i=>s.includes(i.type))),N){const i=N.toLowerCase();a=a.filter(c=>c.name.toLowerCase().includes(i)||c.type.toLowerCase().includes(i)||c.description&&c.description.toLowerCase().includes(i))}return a},[q,s,N]),pe=p.useMemo(()=>{let a=G;if(s.length>0&&(a=a.filter(i=>s.includes(i.type))),m.length>0&&(a=a.filter(i=>m.includes(i.bookingStatus))),N){const i=N.toLowerCase();a=a.filter(c=>c.name.toLowerCase().includes(i)||c.type.toLowerCase().includes(i)||c.description&&c.description.toLowerCase().includes(i)||c.stallNumber&&c.stallNumber.toLowerCase().includes(i)||c.exhibitorName&&c.exhibitorName.toLowerCase().includes(i))}if(Y&&Y[0]&&Y[1]){const i=Y[0].startOf("day"),c=Y[1].endOf("day");a=a.filter(n=>{if(!n.bookingDate)return!1;const D=xt(n.bookingDate);return D.isAfter(i)&&D.isBefore(c)})}return a},[G,s,m,N,Y]),Le=()=>{d([]),P([]),ee(""),Se(null)},Re=()=>{if(de.length===0){y.warning("No basic amenities to export");return}const a=de.map(n=>({Name:n.name,Type:n.type,Description:n.description||"","Per Sq. Meter":n.perSqm,"Quantity Per Unit":n.quantity,ID:n._id||n.id})),i=h.find(n=>n._id===x),c=`${(i==null?void 0:i.name)||"Exhibition"}_Basic_Amenities`;be(a,c),y.success("Basic amenities exported successfully")},$e=()=>{if(ue.length===0){y.warning("No extra amenities to export");return}const a=ue.map(n=>({Name:n.name,Type:n.type,Description:n.description||"",Rate:n.rate,ID:n._id||n.id})),i=h.find(n=>n._id===x),c=`${(i==null?void 0:i.name)||"Exhibition"}_Extra_Amenities`;be(a,c),y.success("Extra amenities exported successfully")},Pe=()=>{if(pe.length===0){y.warning("No calculated amenities to export");return}const a=new Map,i=new Map;pe.filter(t=>U==="basic"?t.hasOwnProperty("calculatedQuantity")||t.hasOwnProperty("perSqm"):U==="extra"?t.hasOwnProperty("rate")&&!t.hasOwnProperty("perSqm"):!0).forEach(t=>{if(t.isExtraAmenity&&t.isBookingLevel){i.has(t.bookingId)||i.set(t.bookingId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,"Total Area (SQM)":t.area||0,"Stall Count":t.stallCount||1,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-","Booking Type":"Extra Amenities"});const b=i.get(t.bookingId);t.booked&&t.quantity>0&&(b[t.name]=t.quantity)}else if(t.stallId&&t.stallNumber){if(!a.has(t.stallId)){const S=t.dimensions||{width:0,height:0},T=K(S);a.set(t.stallId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,Dimension:ae(S),"Stall Type":t.stallType||"-","Area (SQM)":typeof T=="number"?T:0,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-","Booking Type":"Basic Amenities"})}const b=a.get(t.stallId);if(t.hasOwnProperty("calculatedQuantity"))b[t.name]=t.calculatedQuantity;else if(t.hasOwnProperty("perSqm")){const S=typeof b["Area (SQM)"]=="number"?b["Area (SQM)"]:0,T=Math.floor(S/t.perSqm)*t.quantity;b[t.name]=T>0?T:t.quantity}}});let n=[];U==="basic"&&(n=[...n,...Array.from(a.values())]),U==="extra"&&(n=[...n,...Array.from(i.values())]);const D=h.find(t=>t._id===x),r=U==="basic"?"Basic":"Extra",l=`${(D==null?void 0:D.name)||"Exhibition"}_${r}_Calculated_Amenities`;be(n,l),y.success(`${r} calculated amenities exported successfully`)},Oe=async()=>{try{o(!0);const{default:a}=await Ke(async()=>{const{default:c}=await import("./index-BfjvBafq.js").then(n=>n.af);return{default:c}},__vite__mapDeps([0,1,2,3,4,5,6])),i=await a.getStallTypes();if(i&&i.data){const c={};i.data.forEach(n=>{n._id&&(c[n._id]=n.name)}),X(c)}}catch(a){console.error("Error fetching stall types:",a)}finally{o(!1)}};return p.useEffect(()=>{x&&Oe()},[x]),e.jsxs("div",{className:"amenities-container",children:[e.jsxs("div",{className:"amenities-header",children:[e.jsx(yt,{level:4,className:"amenities-title",children:"Amenities Management"}),e.jsx(ve,{type:"secondary",children:"View, filter, and export amenities data. See calculated amenities for booked stalls."})]}),e.jsx(bt,{exhibitionId:x,exhibitions:h,exhibitionsLoading:A,onExhibitionChange:k,typeFilter:s,setTypeFilter:d,bookingStatusFilter:m,setBookingStatusFilter:P,searchQuery:N,setSearchQuery:ee,dateRange:Y,setDateRange:Se,resetFilters:Le}),x&&e.jsx("div",{style:{marginBottom:24},children:e.jsx(jt,{basicAmenities:M,extraAmenities:q,bookedStalls:Ee,calculatedAmenities:De})}),x?e.jsx(ke,{activeKey:Be,onChange:_e,className:"amenities-tabs",items:[{key:"basic",label:e.jsxs("span",{children:[e.jsx(mt,{}),"Basic Amenities"]}),children:e.jsx(ge,{title:"Basic Amenities",amenities:de,loading:A,onExport:Re,exhibitionId:x})},{key:"extra",label:e.jsxs("span",{children:[e.jsx(Ce,{}),"Extra Amenities"]}),children:e.jsx(ge,{title:"Additional Amenities",amenities:ue,loading:A,onExport:$e,exhibitionId:x})},{key:"calculated",label:e.jsxs("span",{children:[e.jsx(ft,{}),"Calculated Amenities"]}),children:e.jsxs(e.Fragment,{children:[e.jsx(je,{gutter:[0,16],children:e.jsx(_,{span:24,children:e.jsx(V,{className:"filter-card",children:e.jsxs(J,{children:[e.jsx(ve,{strong:!0,children:"View: "}),e.jsxs(he.Group,{value:U,onChange:a=>Me(a.target.value),optionType:"button",buttonStyle:"solid",children:[e.jsx(he.Button,{value:"basic",children:"Basic Amenities"}),e.jsx(he.Button,{value:"extra",children:"Extra Amenities"})]})]})})})}),e.jsx(ge,{title:"Calculated Amenities",amenities:pe,loading:A,onExport:Pe,isDynamicColumns:!0,isCalculated:!0,exhibitionId:x,amenityViewType:U})]})}]}):e.jsx("div",{style:{marginTop:24,textAlign:"center",padding:48,background:"#fff",borderRadius:8},children:e.jsx(ne,{description:"Please select an exhibition to view amenities",image:ne.PRESENTED_IMAGE_SIMPLE})})]})};export{Et as default};
