const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-4IR4xblb.js","assets/vendor-pdf-Cn0rG44s.js","assets/vendor-antd-B8jUXf3i.js","assets/vendor-redux-rS0pI56E.js","assets/vendor-react-DW9h-haf.js","assets/vendor-http-t--hEgTQ.js","assets/vendor-antd-icons-BoTJB7uA.js","assets/vendor-ui-BmMA_ojr.js","assets/vendor-canvas-DrFPvyt4.js","assets/index-B5bI3597.css"])))=>i.map(i=>d[i]);
import{j as e,_ as Oe}from"./vendor-pdf-Cn0rG44s.js";import{G as Y,T as ae,y as me,z as _,Z as ee,t as Qe,ai as ze,al as Fe,S as G,h as te,D as Ye,f as k,r as u,E as se,a7 as ce,v as Ue,ad as Ve,B as ge,o as Ge,ap as Ke,M as H,ac as Je,ag as Ze,a4 as We,d as He,m as we,an as X}from"./vendor-antd-B8jUXf3i.js";import{b as Xe,u as ye}from"./vendor-redux-rS0pI56E.js";import{q as et,Q as tt,b as st}from"./index-4IR4xblb.js";import{u as ue,w as at,F as it}from"./FileSaver.min-D2Up8sHb.js";import{c as nt,V as rt,j as lt,J as Ae,r as ot,a1 as dt,d as ct,a2 as ut,a3 as pt}from"./vendor-antd-icons-BoTJB7uA.js";import"./vendor-react-DW9h-haf.js";import"./vendor-http-t--hEgTQ.js";import"./vendor-ui-BmMA_ojr.js";import"./vendor-canvas-DrFPvyt4.js";const{Title:xt,Text:V}=ae,{Option:$}=ee,{RangePicker:mt}=Fe,ht=({exhibitionId:g,exhibitions:y,exhibitionsLoading:f,onExhibitionChange:A,typeFilter:L,setTypeFilter:T,bookingStatusFilter:p,setBookingStatusFilter:C,searchQuery:D,setSearchQuery:O,dateRange:q,setDateRange:Q,resetFilters:U})=>{var P,K;const B=j=>{O(j.target.value)},N=j=>{Q(j)};return e.jsxs(Y,{className:"amenities-filters",children:[e.jsx(xt,{level:5,className:"filter-heading",children:"Filters"}),e.jsxs(me,{gutter:[16,16],children:[e.jsx(_,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Exhibition"}),e.jsx(ee,{placeholder:"Select an exhibition",style:{width:"100%"},loading:f,onChange:A,value:g,children:y.map(j=>e.jsx($,{value:j._id,children:j.name},j._id))})]})}),e.jsx(_,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Amenity Type"}),e.jsxs(ee,{mode:"multiple",placeholder:"Select types",style:{width:"100%"},value:L,onChange:T,maxTagCount:2,children:[e.jsx($,{value:"facility",children:"Facility"}),e.jsx($,{value:"service",children:"Service"}),e.jsx($,{value:"equipment",children:"Equipment"}),e.jsx($,{value:"other",children:"Other"})]})]})}),e.jsx(_,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Booking Status"}),e.jsxs(ee,{mode:"multiple",placeholder:"Select statuses",style:{width:"100%"},value:p,onChange:C,maxTagCount:2,children:[e.jsx($,{value:"confirmed",children:"Confirmed"}),e.jsx($,{value:"approved",children:"Approved"}),e.jsx($,{value:"pending",children:"Pending"}),e.jsx($,{value:"rejected",children:"Rejected"}),e.jsx($,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(_,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Search"}),e.jsx(Qe,{placeholder:"Search amenities",prefix:e.jsx(ze,{}),value:D,onChange:B,allowClear:!0})]})}),e.jsx(_,{xs:24,md:16,lg:12,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Booking Date Range"}),e.jsx(mt,{style:{width:"100%"},onChange:N,value:q})]})}),e.jsx(_,{xs:24,md:8,lg:12,children:e.jsx("div",{className:"filter-group",style:{display:"flex",justifyContent:"flex-end",alignItems:"flex-end",height:"100%"},children:e.jsxs(G,{children:[e.jsx(te,{icon:e.jsx(nt,{}),onClick:U,children:"Reset"}),e.jsx(te,{type:"primary",icon:e.jsx(rt,{}),children:"Apply Filters"})]})})})]}),(L.length>0||p.length>0||D||q)&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"filter-divider"}),e.jsxs("div",{children:[e.jsx(V,{className:"filter-label",children:"Active Filters:"}),e.jsxs("div",{style:{marginTop:8},children:[L.map(j=>e.jsxs(k,{closable:!0,onClose:()=>T(L.filter(v=>v!==j)),className:`amenity-tag amenity-tag-${j}`,children:["Type: ",j]},`type-${j}`)),p.map(j=>e.jsxs(k,{closable:!0,onClose:()=>C(p.filter(v=>v!==j)),color:"blue",children:["Status: ",j]},`status-${j}`)),D&&e.jsxs(k,{closable:!0,onClose:()=>O(""),color:"purple",children:["Search: ",D]}),q&&e.jsxs(k,{closable:!0,onClose:()=>Q(null),color:"green",children:["Date Range: ",(P=q[0])==null?void 0:P.format("MMM DD, YYYY")," - ",(K=q[1])==null?void 0:K.format("MMM DD, YYYY")]})]})]})]})]})},{Text:vt}=ae,ft=({basicAmenities:g,extraAmenities:y,bookedStalls:f,calculatedAmenities:A})=>e.jsxs(me,{gutter:[24,24],children:[e.jsx(_,{xs:24,sm:12,md:6,children:e.jsxs(Y,{className:"stats-card stats-primary",bordered:!1,children:[e.jsx(lt,{style:{fontSize:24,color:"#1890ff"}}),e.jsx("div",{className:"stats-value",children:g.length}),e.jsx("div",{className:"stats-label",children:"Basic Amenities"})]})}),e.jsx(_,{xs:24,sm:12,md:6,children:e.jsxs(Y,{className:"stats-card stats-secondary",bordered:!1,children:[e.jsx(Ae,{style:{fontSize:24,color:"#52c41a"}}),e.jsx("div",{className:"stats-value",children:y.length}),e.jsx("div",{className:"stats-label",children:"Extra Amenities"})]})}),e.jsx(_,{xs:24,sm:12,md:6,children:e.jsxs(Y,{className:"stats-card stats-tertiary",bordered:!1,children:[e.jsx(ot,{style:{fontSize:24,color:"#fa8c16"}}),e.jsx("div",{className:"stats-value",children:f}),e.jsx("div",{className:"stats-label",children:"Booked Stalls"})]})}),e.jsx(_,{xs:24,sm:12,md:6,children:e.jsxs(Y,{className:"stats-card stats-quaternary",bordered:!1,children:[e.jsx(dt,{style:{fontSize:24,color:"#722ed1"}}),e.jsx("div",{className:"stats-value",children:A}),e.jsx("div",{className:"stats-label",children:"Calculated Amenities"})]})})]}),{Text:R,Title:Se}=ae,Ie=g=>{switch(g){case"facility":return{color:"#e6f7ff",borderColor:"#91d5ff",textColor:"#1890ff"};case"service":return{color:"#f6ffed",borderColor:"#b7eb8f",textColor:"#52c41a"};case"equipment":return{color:"#fff7e6",borderColor:"#ffd591",textColor:"#fa8c16"};default:return{color:"#f9f0ff",borderColor:"#d3adf7",textColor:"#722ed1"}}},pe=({title:g,amenities:y,loading:f,onExport:A,isDynamicColumns:L=!1,isCalculated:T=!1,exhibitionId:p,amenityViewType:C="all"})=>{const[D,O]=u.useState([]),[q,Q]=u.useState([]),[U,B]=u.useState(!1),N=u.useMemo(()=>!T||C==="all"?y:C==="basic"?y.filter(r=>r.hasOwnProperty("calculatedQuantity")||r.hasOwnProperty("perSqm")):C==="extra"?y.filter(r=>r.hasOwnProperty("rate")&&!r.hasOwnProperty("perSqm")):y,[y,T,C]);u.useEffect(()=>{if(!p){Q([]),B(!1);return}B(!0),setTimeout(()=>{B(!1)},500)},[p]);const P=()=>{const r=new Map;return N.forEach(s=>{var S,x;if(s.stallId&&s.stallNumber){r.has(s.stallId)||r.set(s.stallId,{key:s.stallId,companyName:s.exhibitorName||"Unknown",stallNumber:s.stallNumber,dimension:s.dimensions?`${s.dimensions.width}x${s.dimensions.height}m`:"-",stallType:s.stallType||"-",area:s.area||((S=s.dimensions)!=null&&S.width&&((x=s.dimensions)!=null&&x.height)?s.dimensions.width*s.dimensions.height:"-"),bookingDate:s.bookingDate?new Date(s.bookingDate).toISOString().slice(0,10):"-",status:s.bookingStatus||"-",amenities:{}});const m=r.get(s.stallId);if(s.hasOwnProperty("calculatedQuantity"))m.amenities[s.name]=s.calculatedQuantity;else if(s.hasOwnProperty("perSqm")){const w=typeof m.area=="number"?m.area:0,I=Math.floor(w/s.perSqm)*s.quantity;m.amenities[s.name]=I>0?I:s.quantity}else if(s.hasOwnProperty("booked")&&s.booked){let w=1;typeof s.quantity=="number"?w=s.quantity:typeof s.quantity=="string"&&(w=parseInt(s.quantity,10),isNaN(w)&&(w=1)),m.amenities[s.name]=w}else s.hasOwnProperty("rate")&&(m.amenities[s.name]=0)}}),Array.from(r.values()).filter(s=>Object.keys(s.amenities).length>0)},K=()=>{const r=new Set;return N.forEach(h=>{const s=S=>T?!0:g.toLowerCase().includes("basic")?S.hasOwnProperty("perSqm"):g.toLowerCase().includes("additional")||g.toLowerCase().includes("extra")?S.hasOwnProperty("rate"):!0;h.name&&s(h)&&r.add(h.name)}),Array.from(r)},j=()=>{const r=[{title:"Company Name",dataIndex:"companyName",key:"companyName",fixed:"left",width:180,render:x=>e.jsx(R,{strong:!0,children:x}),sorter:(x,m)=>x.companyName.localeCompare(m.companyName)},{title:"Stall No.",dataIndex:"stallNumber",key:"stallNumber",width:100,render:x=>e.jsx(ge,{status:"success",text:x}),sorter:(x,m)=>x.stallNumber.localeCompare(m.stallNumber)},{title:"Dimension",dataIndex:"dimension",key:"dimension",width:120},{title:"Stall Type",dataIndex:"stallType",key:"stallType",width:120},{title:"Area (SQM)",dataIndex:"area",key:"area",width:100,render:x=>typeof x=="number"?x.toFixed(2):x,sorter:(x,m)=>{const w=typeof x.area=="number"?x.area:0,I=typeof m.area=="number"?m.area:0;return w-I}}],s=K().map(x=>({title:x,dataIndex:["amenities",x],key:x,width:100,render:m=>m==null?"-":m===0?e.jsx(R,{type:"secondary",children:"0"}):m==="✓"?e.jsx(ge,{status:"success"}):e.jsx(R,{strong:!0,children:m}),sorter:(m,w)=>{const I=m.amenities[x]||0,Z=w.amenities[x]||0;return I-Z}})),S={title:"Actions",key:"actions",width:80,fixed:"right",render:(x,m)=>e.jsx(Ge,{overlay:e.jsxs(H,{children:[e.jsx(H.Item,{icon:e.jsx(Je,{}),children:"View Details"},"view"),e.jsx(H.Item,{icon:e.jsx(Ze,{}),children:"Edit"},"edit"),e.jsx(H.Item,{icon:e.jsx(ct,{}),children:"Settings"},"settings")]}),trigger:["click"],children:e.jsx(te,{type:"text",icon:e.jsx(Ke,{})})})};return[...r,...s,S]},v=r=>{O(r)},J=P(),he=r=>e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Se,{level:5,children:"Stall Details"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:[Object.entries(r).map(([h,s])=>["key","amenities"].includes(h)?null:e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs(R,{type:"secondary",style:{fontSize:"12px"},children:[h.charAt(0).toUpperCase()+h.slice(1).replace(/([A-Z])/g," $1"),":"]}),e.jsx("div",{children:e.jsx(R,{strong:!0,children:s==null?"-":typeof s=="object"?JSON.stringify(s):String(s)})})]},h)),e.jsxs("div",{style:{marginBottom:"8px",gridColumn:"1 / -1"},children:[e.jsx(R,{type:"secondary",style:{fontSize:"12px"},children:"Amenities:"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"4px"},children:Object.entries(r.amenities||{}).map(([h,s])=>e.jsxs(k,{color:"blue",children:[h,": ",s==="✓"?"Available":s]},h))})]})]})]});return e.jsx(Y,{className:"amenities-card",title:e.jsxs(G,{children:[e.jsx(Se,{level:5,style:{margin:0},children:g}),T&&e.jsxs(e.Fragment,{children:[e.jsx(k,{color:"green",children:"Calculated"}),C==="basic"&&e.jsx(k,{color:"blue",children:"Basic Amenities"}),C==="extra"&&e.jsx(k,{color:"purple",children:"Extra Amenities"}),C==="all"&&e.jsx(k,{color:"orange",children:"All Amenities"})]})]}),extra:e.jsx(G,{children:e.jsx(te,{type:"primary",icon:e.jsx(Ve,{}),onClick:A,disabled:N.length===0,children:"Export"})}),children:N.length===0?e.jsx(se,{image:se.PRESENTED_IMAGE_SIMPLE,description:"No amenities data available"}):g.toLowerCase().includes("basic")&&!T?e.jsx(ce,{dataSource:N.map((r,h)=>({key:r._id||r.id||`basic-${h}`,...r})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(r,h)=>e.jsxs(G,{children:[e.jsx(R,{strong:!0,children:r}),e.jsx(k,{color:Ie(h.type).textColor,children:h.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Per SQM",dataIndex:"perSqm",key:"perSqm",render:r=>r?`1 per ${r} sqm`:"-"},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:r=>e.jsx(k,{color:"blue",children:r})}],loading:f,pagination:{pageSize:10},className:"amenities-table"}):(g.toLowerCase().includes("additional")||g.toLowerCase().includes("extra"))&&!T?e.jsx(ce,{dataSource:N.map((r,h)=>({key:r._id||r.id||`extra-${h}`,...r})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(r,h)=>e.jsxs(G,{children:[e.jsx(R,{strong:!0,children:r}),e.jsx(k,{color:Ie(h.type).textColor,children:h.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Rate",dataIndex:"rate",key:"rate",render:r=>e.jsxs(R,{style:{color:"#1890ff"},children:["₹",r.toLocaleString()]})}],loading:f,pagination:{pageSize:10},className:"amenities-table"}):J.length===0?e.jsx(Ue,{message:"No stall data available",description:"Amenities exist but could not be linked to stalls. Make sure stalls are booked and have amenities assigned.",type:"info",showIcon:!0}):e.jsx(ce,{dataSource:J,columns:j(),loading:f||U,pagination:{pageSize:10},className:"amenities-table",scroll:{x:"max-content"},expandable:{expandedRowKeys:D,onExpandedRowsChange:v,expandedRowRender:he}})})},{Title:jt,Text:Ne}=ae,{TabPane:Et}=we,xe=(g,y)=>{const f=ue.json_to_sheet(g),A=ue.book_new();ue.book_append_sheet(A,f,"Amenities");const L=at(A,{bookType:"xlsx",type:"array"}),T=new Blob([L],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});it.saveAs(T,`${y}.xlsx`)},kt=()=>{const g=Xe(),{message:y}=We.useApp(),{exhibitions:f,loading:A}=ye(a=>a.exhibition),{bookings:L,loading:T}=ye(a=>a.booking),[p,C]=u.useState(null),[D,O]=u.useState([]),[q,Q]=u.useState([]),[U,B]=u.useState([]),[N,P]=u.useState([]),[K,j]=u.useState(!1),[v,J]=u.useState({}),[he,r]=u.useState(!1),[h,s]=u.useState({current:1,pageSize:10,total:0}),[S,x]=u.useState([]),[m,w]=u.useState([]),[I,Z]=u.useState(""),[z,fe]=u.useState(null),[Te,ie]=u.useState(0),[Ce,ne]=u.useState(0),[ve,Ee]=u.useState("basic"),[F,ke]=u.useState("basic");u.useEffect(()=>{g(et()),g(tt({page:1,limit:100}))},[g]);const _e=async(a,i=1,o=10)=>{try{j(!0);const n=await st.get("/bookings",{params:{exhibitionId:a,includeDetails:!0,populate:"stallIds.stallTypeId",page:i,limit:o}});if(n&&n.data){const d=n.data.data.map(t=>{const l={...t};return l.stallIds&&(l.stallIds=l.stallIds.map(c=>(c.stallTypeId&&typeof c.stallTypeId=="object"&&(c.type=c.stallTypeId.name),c))),l}).filter(t=>t.exhibitionId._id===a&&["confirmed","approved"].includes(t.status));P(d),s({current:n.data.pagination.page,pageSize:n.data.pagination.limit,total:n.data.pagination.total})}else P([]),s({current:1,pageSize:10,total:0})}catch(n){console.error("Error fetching complete booking data:",n),P([]),s({current:1,pageSize:10,total:0})}finally{j(!1)}};u.useEffect(()=>{if(p&&f.length>0){const a=f.find(i=>i._id===p);a&&(O(a.basicAmenities||[]),Q(a.amenities||[]),_e(p,h.current,h.pageSize))}else O([]),Q([]),B([]),ie(0),ne(0),P([])},[p,f]),u.useEffect(()=>{if(p&&f.length>0&&N.length>0){const a=f.find(i=>i._id===p);if(a){const i=N.flatMap(d=>d.stallIds.map(t=>{const l=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:v[t.stallTypeId])||"-";return{stallId:t._id,stallNumber:t.number,bookingId:d._id,exhibitorName:d.companyName,bookingDate:d.createdAt,dimensions:t.dimensions,area:t.dimensions.width*t.dimensions.height,status:d.status,stallType:l}})),o=N.flatMap(d=>!d.basicAmenities||d.basicAmenities.length===0?d.stallIds.flatMap(t=>{const l=t.dimensions.width*t.dimensions.height,c=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:v[t.stallTypeId])||"-";return(a.basicAmenities||[]).map(E=>{const b=Math.floor(l/E.perSqm)*E.quantity;return{...E,calculatedQuantity:b>0?b:E.quantity,stallId:t._id,stallNumber:t.number,bookingId:d._id,exhibitorId:d.exhibitorId||"",exhibitorName:d.companyName,bookingDate:d.createdAt,dimensions:t.dimensions,area:l,bookingStatus:d.status,stallType:c}})}):d.basicAmenities.flatMap(t=>d.stallIds.map(l=>{const c=l.type||(l.stallTypeId&&typeof l.stallTypeId=="object"?l.stallTypeId.name:v[l.stallTypeId])||"-";return{...t,stallId:l._id,stallNumber:l.number,bookingId:d._id,exhibitorId:d.exhibitorId||"",exhibitorName:d.companyName,bookingDate:d.createdAt,dimensions:l.dimensions,area:l.dimensions.width*l.dimensions.height,bookingStatus:d.status,stallType:c}}))),n=N.flatMap(d=>!d.extraAmenities||d.extraAmenities.length===0?[]:d.extraAmenities.flatMap(t=>d.stallIds.map(l=>{const c=l.type||(l.stallTypeId&&typeof l.stallTypeId=="object"?l.stallTypeId.name:v[l.stallTypeId])||"-";return{...t,booked:!0,stallId:l._id,stallNumber:l.number,bookingId:d._id,exhibitorId:d.exhibitorId||"",exhibitorName:d.companyName,bookingDate:d.createdAt,dimensions:l.dimensions,area:l.dimensions.width*l.dimensions.height,bookingStatus:d.status,stallType:c,isExtraAmenity:!0,quantity:t.quantity||1}})));let M=n;n.length===0&&a.amenities&&a.amenities.length>0&&(M=N.flatMap(t=>t.stallIds).flatMap((t,l)=>(a.amenities||[]).map((c,E)=>{var be;const b=N.find(de=>de.stallIds.some(Le=>Le._id===t._id)),W=(be=b==null?void 0:b.extraAmenities)==null?void 0:be.find(de=>de.name===c.name),je=!!W,Pe=`sim-${l}-${E}-${Date.now()}`,Re=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:v[t.stallTypeId])||"-";return{...c,id:Pe,booked:je,stallId:t._id,stallNumber:t.number,bookingId:(b==null?void 0:b._id)||"",exhibitorId:(b==null?void 0:b.exhibitorId)||"",exhibitorName:(b==null?void 0:b.companyName)||"Unknown",bookingDate:(b==null?void 0:b.createdAt)||new Date().toISOString(),dimensions:t.dimensions,area:t.dimensions.width*t.dimensions.height,bookingStatus:(b==null?void 0:b.status)||"approved",stallType:Re,isExtraAmenity:!0,quantity:je?(W==null?void 0:W.quantity)||1:0}}))),B([...o,...M]),ie(i.length),ne(o.length+M.length)}}else p&&f.length>0&&(B([]),ie(0),ne(0))},[p,f,N,v]);const re=u.useMemo(()=>{let a=D;if(S.length>0&&(a=a.filter(i=>S.includes(i.type))),I){const i=I.toLowerCase();a=a.filter(o=>o.name.toLowerCase().includes(i)||o.type.toLowerCase().includes(i)||o.description&&o.description.toLowerCase().includes(i))}return a},[D,S,I]),le=u.useMemo(()=>{let a=q;if(S.length>0&&(a=a.filter(i=>S.includes(i.type))),I){const i=I.toLowerCase();a=a.filter(o=>o.name.toLowerCase().includes(i)||o.type.toLowerCase().includes(i)||o.description&&o.description.toLowerCase().includes(i))}return a},[q,S,I]),oe=u.useMemo(()=>{let a=U;if(S.length>0&&(a=a.filter(i=>S.includes(i.type))),m.length>0&&(a=a.filter(i=>m.includes(i.bookingStatus))),I){const i=I.toLowerCase();a=a.filter(o=>o.name.toLowerCase().includes(i)||o.type.toLowerCase().includes(i)||o.description&&o.description.toLowerCase().includes(i)||o.stallNumber&&o.stallNumber.toLowerCase().includes(i)||o.exhibitorName&&o.exhibitorName.toLowerCase().includes(i))}if(z&&z[0]&&z[1]){const i=z[0].startOf("day"),o=z[1].endOf("day");a=a.filter(n=>{if(!n.bookingDate)return!1;const M=He(n.bookingDate);return M.isAfter(i)&&M.isBefore(o)})}return a},[U,S,m,I,z]),De=()=>{x([]),w([]),Z(""),fe(null)},qe=()=>{if(re.length===0){y.warning("No basic amenities to export");return}const a=re.map(n=>({Name:n.name,Type:n.type,Description:n.description||"","Per Sq. Meter":n.perSqm,"Quantity Per Unit":n.quantity,ID:n._id||n.id})),i=f.find(n=>n._id===p),o=`${(i==null?void 0:i.name)||"Exhibition"}_Basic_Amenities`;xe(a,o),y.success("Basic amenities exported successfully")},Me=()=>{if(le.length===0){y.warning("No extra amenities to export");return}const a=le.map(n=>({Name:n.name,Type:n.type,Description:n.description||"",Rate:n.rate,ID:n._id||n.id})),i=f.find(n=>n._id===p),o=`${(i==null?void 0:i.name)||"Exhibition"}_Extra_Amenities`;xe(a,o),y.success("Extra amenities exported successfully")},$e=()=>{if(oe.length===0){y.warning("No calculated amenities to export");return}const a=new Map;oe.filter(t=>F==="all"?!0:F==="basic"?t.hasOwnProperty("calculatedQuantity")||t.hasOwnProperty("perSqm"):F==="extra"?t.hasOwnProperty("rate")&&!t.hasOwnProperty("perSqm"):!0).forEach(t=>{if(t.stallId&&t.stallNumber){if(!a.has(t.stallId)){const c=t.dimensions||{width:0,height:0},E=t.area||(c.width&&c.height?c.width*c.height:0);a.set(t.stallId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,Dimension:c?`${c.width}x${c.height}m`:"-","Stall Type":t.stallType||"-","Area (SQM)":typeof E=="number"?E:0,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-"})}const l=a.get(t.stallId);if(t.hasOwnProperty("calculatedQuantity"))l[t.name]=t.calculatedQuantity;else if(t.hasOwnProperty("perSqm")){const c=typeof l["Area (SQM)"]=="number"?l["Area (SQM)"]:0,E=Math.floor(c/t.perSqm)*t.quantity;l[t.name]=E>0?E:t.quantity}else if(t.hasOwnProperty("booked")&&t.booked){let c=1;typeof t.quantity=="number"?c=t.quantity:typeof t.quantity=="string"&&(c=parseInt(t.quantity,10),isNaN(c)&&(c=1)),l[t.name]=c}else t.hasOwnProperty("rate")&&(l[t.name]=0)}});const o=Array.from(a.values()),n=f.find(t=>t._id===p),M=F==="basic"?"Basic":F==="extra"?"Extra":"All",d=`${(n==null?void 0:n.name)||"Exhibition"}_${M}_Calculated_Amenities`;xe(o,d),y.success(`${M} calculated amenities exported successfully`)},Be=async()=>{try{r(!0);const{default:a}=await Oe(async()=>{const{default:o}=await import("./index-4IR4xblb.js").then(n=>n.$);return{default:o}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),i=await a.getStallTypes();if(i&&i.data){const o={};i.data.forEach(n=>{n._id&&(o[n._id]=n.name)}),J(o)}}catch(a){console.error("Error fetching stall types:",a)}finally{r(!1)}};return u.useEffect(()=>{p&&Be()},[p]),e.jsxs("div",{className:"amenities-container",children:[e.jsxs("div",{className:"amenities-header",children:[e.jsx(jt,{level:4,className:"amenities-title",children:"Amenities Management"}),e.jsx(Ne,{type:"secondary",children:"View, filter, and export amenities data. See calculated amenities for booked stalls."})]}),e.jsx(ht,{exhibitionId:p,exhibitions:f,exhibitionsLoading:A,onExhibitionChange:C,typeFilter:S,setTypeFilter:x,bookingStatusFilter:m,setBookingStatusFilter:w,searchQuery:I,setSearchQuery:Z,dateRange:z,setDateRange:fe,resetFilters:De}),p&&e.jsx("div",{style:{marginBottom:24},children:e.jsx(ft,{basicAmenities:D,extraAmenities:q,bookedStalls:Te,calculatedAmenities:Ce})}),p?e.jsx(we,{activeKey:ve,onChange:Ee,className:"amenities-tabs",items:[{key:"basic",label:e.jsxs("span",{children:[e.jsx(ut,{}),"Basic Amenities"]}),children:e.jsx(pe,{title:"Basic Amenities",amenities:re,loading:A,onExport:qe,exhibitionId:p})},{key:"extra",label:e.jsxs("span",{children:[e.jsx(Ae,{}),"Extra Amenities"]}),children:e.jsx(pe,{title:"Additional Amenities",amenities:le,loading:A,onExport:Me,exhibitionId:p})},{key:"calculated",label:e.jsxs("span",{children:[e.jsx(pt,{}),"Calculated Amenities"]}),children:e.jsxs(e.Fragment,{children:[e.jsx(me,{gutter:[0,16],children:e.jsx(_,{span:24,children:e.jsx(Y,{className:"filter-card",children:e.jsxs(G,{children:[e.jsx(Ne,{strong:!0,children:"View: "}),e.jsxs(X.Group,{value:F,onChange:a=>ke(a.target.value),optionType:"button",buttonStyle:"solid",children:[e.jsx(X.Button,{value:"basic",children:"Basic Amenities"}),e.jsx(X.Button,{value:"extra",children:"Extra Amenities"}),e.jsx(X.Button,{value:"all",children:"All Amenities"})]})]})})})}),e.jsx(pe,{title:"Calculated Amenities",amenities:oe,loading:A,onExport:$e,isDynamicColumns:!0,isCalculated:!0,exhibitionId:p,amenityViewType:F})]})}]}):e.jsx("div",{style:{marginTop:24,textAlign:"center",padding:48,background:"#fff",borderRadius:8},children:e.jsx(se,{description:"Please select an exhibition to view amenities",image:se.PRESENTED_IMAGE_SIMPLE})})]})};export{kt as default};
