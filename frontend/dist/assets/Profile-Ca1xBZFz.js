import{j as e,f as j,g as T}from"./index-ZeXq6Cnq.js";import{r as n,j as U,i as N}from"./vendor-react-BNeW3y6d.js";import{ae as R,H as r,a6 as d,a7 as l,T as q,a5 as B,n as I,A as L,f as g,I as i,ao as k,N as M,O as c,c as $,ag as D,U as z}from"./vendor-antd-DmzwxccF.js";import"./vendor-utils-D9BQhWAM.js";import"./vendor-styling-C4kvkEn0.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:P,Text:y}=q,{TabPane:b}=I,X=()=>{var w;const{notification:v}=R.useApp(),[H]=r.useForm(),[m]=r.useForm(),[K,O]=n.useState(!1),[A,u]=n.useState(!1),[C,p]=n.useState(!1),[h,f]=n.useState(null),x=U(),s=N(a=>a.auth.user);n.useEffect(()=>{(async()=>{try{p(!0);const o=await j.getProfile();o.data&&x(T({user:o.data,token:localStorage.getItem("token")||""}))}catch{z.error("Failed to fetch profile")}finally{p(!1)}})()},[x]);const E=async a=>{var o,t;try{f(null),u(!0),await j.changePassword({currentPassword:a.currentPassword,newPassword:a.newPassword}),v.success({message:"Success",description:"Password has been changed successfully"}),m.resetFields()}catch(S){f(((t=(o=S.response)==null?void 0:o.data)==null?void 0:t.message)||"Failed to change password. Please try again.")}finally{u(!1)}},F=()=>s!=null&&s.role?typeof s.role=="string"?s.role:typeof s.role=="object"&&"name"in s.role?s.role.name:"User":"User";return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx(d,{gutter:[24,24],align:"middle",children:e.jsxs(l,{flex:"auto",children:[e.jsx(P,{level:4,children:"My Account"}),e.jsx(y,{type:"secondary",children:"Manage your account settings and change your password"})]})})}),e.jsx(B,{loading:C,children:e.jsxs(I,{defaultActiveKey:"account",children:[e.jsx(b,{tab:"Account Information",children:e.jsxs(d,{gutter:32,children:[e.jsx(l,{span:6,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:[e.jsx(L,{size:100,icon:e.jsx(g,{}),style:{backgroundColor:"#1890ff",marginBottom:16},children:((w=s==null?void 0:s.username)==null?void 0:w.charAt(0).toUpperCase())||"U"}),e.jsx(P,{level:4,children:s==null?void 0:s.username}),e.jsx(y,{type:"secondary",children:F()})]})}),e.jsx(l,{span:18,children:e.jsx(r,{layout:"vertical",initialValues:{username:s==null?void 0:s.username,email:s==null?void 0:s.email},disabled:!0,children:e.jsxs(d,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(r.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter your username"}],children:e.jsx(i,{prefix:e.jsx(g,{}),placeholder:"Username"})})}),e.jsx(l,{span:12,children:e.jsx(r.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter your email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(i,{prefix:e.jsx(k,{}),placeholder:"Email Address"})})})]})})})]})},"account"),e.jsxs(b,{tab:"Change Password",children:[h&&e.jsx(M,{message:"Error",description:h,type:"error",showIcon:!0,style:{marginBottom:24}}),e.jsxs(r,{form:m,layout:"vertical",onFinish:E,children:[e.jsx(r.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(i.Password,{prefix:e.jsx(c,{}),placeholder:"Current Password"})}),e.jsx(r.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter your new password"},{min:8,message:"Password must be at least 8 characters"}],children:e.jsx(i.Password,{prefix:e.jsx(c,{}),placeholder:"New Password"})}),e.jsx(r.Item,{name:"confirmPassword",label:"Confirm New Password",dependencies:["newPassword"],rules:[{required:!0,message:"Please confirm your new password"},({getFieldValue:a})=>({validator(o,t){return!t||a("newPassword")===t?Promise.resolve():Promise.reject(new Error("The two passwords do not match"))}})],children:e.jsx(i.Password,{prefix:e.jsx(c,{}),placeholder:"Confirm New Password"})}),e.jsx(r.Item,{children:e.jsx($,{type:"primary",htmlType:"submit",loading:A,icon:e.jsx(D,{}),children:"Update Password"})})]})]},"password")]})})]})};export{X as default};
