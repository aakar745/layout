import{j as a,w as x,A as E,D as l}from"./index-aoH9EzMk.js";import{aO as D,aX as I,G as L,u as P,F as T,p as R,r as d,ab as b,bK as j,e as y}from"./vendor-Be5M1UDi.js";import{E as q}from"./ExhibitionForm-DawnZYuS.js";import"./apis-CU9I9MMq.js";import"./canvas-C-A9eff5.js";import"./editor-DT5Rg6kW.js";const K=()=>{var h;const{message:e}=D.useApp(),{id:F}=I(),o=(h=L().state)==null?void 0:h.exhibitionId,c=P(),r=T(),{currentExhibition:t,loading:u,error:m}=R(i=>i.exhibition),[g,C]=d.useState(!1);d.useEffect(()=>{(async()=>{if(!o){e.error("Exhibition ID not found"),c("/exhibition");return}try{await r(E(o)).unwrap()}catch(s){e.error(s.message||"Failed to fetch exhibition"),c("/exhibition")}finally{C(!0)}})()},[o,r,e,c]),d.useEffect(()=>{m&&e.error(m)},[m,e]);const A=async i=>{var s,f;if(!(!o||!t))try{const[p,N]=i.dateRange,S={name:i.name,description:i.description,venue:i.venue,startDate:p.toISOString(),endDate:N.toISOString(),status:i.status,isActive:i.isActive,invoicePrefix:i.invoicePrefix,stallRates:i.stallRates||[],dimensions:t.dimensions,taxConfig:i.taxConfig||[],discountConfig:i.discountConfig||[],publicDiscountConfig:i.publicDiscountConfig||[],companyName:i.companyName,companyContactNo:i.companyContactNo,companyEmail:i.companyEmail,companyAddress:i.companyAddress,companyWebsite:i.companyWebsite,companyPAN:i.companyPAN,companyGST:i.companyGST,companySAC:i.companySAC,companyCIN:i.companyCIN,termsAndConditions:i.termsAndConditions,piInstructions:i.piInstructions,bankName:i.bankName,bankBranch:i.bankBranch,bankIFSC:i.bankIFSC,bankAccountName:i.bankAccountName,bankAccount:i.bankAccount,headerTitle:i.headerTitle,headerSubtitle:i.headerSubtitle,headerDescription:i.headerDescription,headerLogo:i.headerLogo,sponsorLogos:i.sponsorLogos||[],footerText:i.footerText,footerLogo:i.footerLogo,contactEmail:i.contactEmail,contactPhone:i.contactPhone,footerLinks:i.footerLinks||[],amenities:((s=i.amenities)==null?void 0:s.map(n=>({type:n.type,name:n.name,description:n.description,rate:n.rate})))||[],basicAmenities:((f=i.basicAmenities)==null?void 0:f.map(n=>({type:n.type,name:n.name,description:n.description,perSqm:n.perSqm,quantity:n.quantity})))||[],specialRequirements:i.specialRequirements};await r(l({id:o,data:S})).unwrap(),e.success("Exhibition updated successfully"),c(x(t),{state:{exhibitionId:o}})}catch(p){e.error(p.message||"Failed to update exhibition")}};if(!g)return a.jsx(b,{loading:!0});if(!o)return a.jsx(j,{to:"/exhibition",replace:!0});if(u||!t)return a.jsx(b,{loading:!0});const k={name:t.name,description:t.description,venue:t.venue,dateRange:[y(t.startDate),y(t.endDate)],status:t.status,isActive:t.isActive,invoicePrefix:t.invoicePrefix,stallRates:t.stallRates||[],taxConfig:t.taxConfig||[],discountConfig:t.discountConfig||[],publicDiscountConfig:t.publicDiscountConfig||[],companyName:t.companyName,companyContactNo:t.companyContactNo,companyEmail:t.companyEmail,companyAddress:t.companyAddress,companyWebsite:t.companyWebsite,companyPAN:t.companyPAN,companyGST:t.companyGST,companySAC:t.companySAC,companyCIN:t.companyCIN,termsAndConditions:t.termsAndConditions,piInstructions:t.piInstructions,bankName:t.bankName,bankBranch:t.bankBranch,bankIFSC:t.bankIFSC,bankAccountName:t.bankAccountName,bankAccount:t.bankAccount,headerTitle:t.headerTitle,headerSubtitle:t.headerSubtitle,headerDescription:t.headerDescription,headerLogo:t.headerLogo,sponsorLogos:t.sponsorLogos||[],footerText:t.footerText,footerLogo:t.footerLogo,contactEmail:t.contactEmail,contactPhone:t.contactPhone,footerLinks:t.footerLinks||[],amenities:t.amenities||[],basicAmenities:t.basicAmenities||[],specialRequirements:t.specialRequirements};return a.jsx(b,{title:"Edit Exhibition",extra:a.jsx("a",{onClick:()=>c(x(t),{state:{exhibitionId:o}}),children:"Back to Details"}),children:a.jsx(q,{initialValues:k,onSubmit:A,submitText:"Update Exhibition"})})};export{K as default};
