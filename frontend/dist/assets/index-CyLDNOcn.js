import{j as e}from"./vendor-pdf-Cn0rG44s.js";import{F as w,r as m,K as W,t as C,D as O,G as B,y as M,z as V,C as $,T as L,S as R,h as _,a4 as q,af as H,a7 as Y,A as Q,e as F,ag as J,i as X,u as Z,ah as ee}from"./vendor-antd-B8jUXf3i.js";import{b as se,u as ie}from"./vendor-redux-rS0pI56E.js";import{d as te,m as re,e as le,r as oe}from"./index-4IR4xblb.js";import{u as ne}from"./reduxHooks-BvSvK4-5.js";import{Q as ae}from"./vendor-antd-icons-BoTJB7uA.js";import"./vendor-react-DW9h-haf.js";import"./vendor-http-t--hEgTQ.js";import"./vendor-ui-BmMA_ojr.js";import"./vendor-canvas-DrFPvyt4.js";const{Text:U}=L,de=[{key:"dashboard_view",label:"View Dashboard",group:"Dashboard"},{key:"dashboard_manage",label:"Manage Dashboard",group:"Dashboard"},{key:"users_view",label:"View Users",group:"Users"},{key:"users_create",label:"Create Users",group:"Users"},{key:"users_edit",label:"Edit Users",group:"Users"},{key:"users_delete",label:"Delete Users",group:"Users"},{key:"roles_view",label:"View Roles",group:"Roles"},{key:"roles_create",label:"Create Roles",group:"Roles"},{key:"roles_edit",label:"Edit Roles",group:"Roles"},{key:"roles_delete",label:"Delete Roles",group:"Roles"},{key:"exhibitions_view",label:"View Exhibitions",group:"Exhibitions"},{key:"exhibitions_create",label:"Create Exhibitions",group:"Exhibitions"},{key:"exhibitions_edit",label:"Edit Exhibitions",group:"Exhibitions"},{key:"exhibitions_delete",label:"Delete Exhibitions",group:"Exhibitions"},{key:"bookings_view",label:"View Bookings",group:"Bookings"},{key:"bookings_create",label:"Create Bookings",group:"Bookings"},{key:"bookings_edit",label:"Edit Bookings",group:"Bookings"},{key:"bookings_delete",label:"Delete Bookings",group:"Bookings"},{key:"exhibitors_view",label:"View Exhibitors",group:"Exhibitors"},{key:"exhibitors_create",label:"Create Exhibitors",group:"Exhibitors"},{key:"exhibitors_edit",label:"Edit Exhibitors",group:"Exhibitors"},{key:"exhibitors_delete",label:"Delete Exhibitors",group:"Exhibitors"},{key:"settings_view",label:"View Settings",group:"Settings"},{key:"settings_edit",label:"Edit Settings",group:"Settings"}],D=de.reduce((l,o)=>(l[o.group]||(l[o.group]=[]),l[o.group].push({key:o.key,label:o.label}),l),{}),ce=({visible:l,onCancel:o,onSave:u,role:n,loading:f})=>{const[a]=w.useForm(),g=!!n,[d,b]=m.useState([]);m.useEffect(()=>{if(l)if(n){const t=n.permissions||[];a.setFieldsValue({name:n.name,description:n.description,permissions:t}),b(t)}else a.resetFields(),b([])},[l,n,a]);const p=()=>{a.setFieldsValue({permissions:d}),a.validateFields().then(t=>{u(t)})},j=t=>{const c=D[t].map(r=>r.key);return c.length>0&&c.every(r=>d.includes(r))},E=(t,c)=>{let r;c?r=[...d,t]:r=d.filter(h=>h!==t),b(r)},k=(t,c)=>{const r=D[t].map(x=>x.key);let h;if(c){const x=r.filter(A=>!d.includes(A));h=[...d,...x]}else h=d.filter(x=>!r.includes(x));b(h)},P=t=>d.includes(t);return e.jsx(W,{title:g?"Edit Role":"Add New Role",open:l,onCancel:o,width:700,footer:[e.jsx(_,{onClick:o,children:"Cancel"},"cancel"),e.jsx(_,{type:"primary",loading:f,onClick:p,children:g?"Update":"Create"},"submit")],children:e.jsxs(w,{form:a,layout:"vertical",initialValues:{name:"",description:"",permissions:[]},children:[e.jsx(w.Item,{name:"name",label:"Role Name",rules:[{required:!0,message:"Please enter a role name"}],children:e.jsx(C,{placeholder:"e.g., Administrator, Editor, Viewer"})}),e.jsx(w.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please provide a description"}],children:e.jsx(C.TextArea,{placeholder:"Describe the purpose of this role",rows:3})}),e.jsx(O,{plain:!0,children:"Permissions"}),e.jsx(w.Item,{name:"permissions",hidden:!0,children:e.jsx(C,{})}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 8px"},children:Object.entries(D).map(([t,c])=>e.jsx(B,{size:"small",title:e.jsxs(R,{children:[e.jsx(U,{strong:!0,children:t}),e.jsx($,{checked:j(t),onChange:r=>k(t,r.target.checked),children:"Select All"})]}),style:{marginBottom:16},children:e.jsx(M,{gutter:[16,12],children:c.map(r=>e.jsx(V,{span:12,children:e.jsx($,{checked:P(r.key),onChange:h=>E(r.key,h.target.checked),children:e.jsx(U,{children:r.label})})},r.key))})},t))})]})})},{Title:S,Paragraph:z,Text:y}=L,{confirm:he}=W;function I({allowed:l}){return l?e.jsx(Z,{className:"text-success",style:{color:"#52c41a",fontSize:16}}):e.jsx(ee,{className:"text-danger",style:{color:"#f5222d",fontSize:16}})}function we(){const{message:l,notification:o}=q.useApp(),u=se(),{roles:n,loading:f,error:a}=ie(s=>s.role),[g,d]=m.useState(""),[b,p]=m.useState(!1),[j,E]=m.useState(null),{hasPermission:k}=ne();m.useEffect(()=>{u(te())},[u]),m.useEffect(()=>{a&&o.error({message:"Error",description:a})},[a,o]);const P=()=>{E(null),p(!0)},t=s=>{E(s),p(!0)},c=s=>{j?u(re({id:j._id,roleData:s})).unwrap().then(()=>{p(!1),l.success("Role updated successfully")}).catch(i=>{l.error(`Failed to update role: ${i.message}`)}):u(le(s)).unwrap().then(()=>{p(!1),l.success("Role created successfully")}).catch(i=>{l.error(`Failed to create role: ${i.message}`)})},r=s=>{he({title:"Are you sure you want to delete this role?",icon:e.jsx(ae,{}),content:`This will permanently delete the ${s.name} role. This action cannot be undone.`,okText:"Yes, delete it",okType:"danger",cancelText:"Cancel",onOk(){u(oe(s._id)).unwrap().then(()=>{l.success(`${s.name} role deleted successfully`)}).catch(i=>{l.error(`Failed to delete role: ${i.message}`)})}})},h=[{title:"Role",dataIndex:"name",key:"name",render:(s,i)=>e.jsxs(R,{children:[e.jsx(Q,{style:{backgroundColor:N(i.name)},children:s.charAt(0).toUpperCase()}),e.jsx(y,{strong:!0,children:s})]})},{title:"Description",dataIndex:"description",key:"description",render:s=>e.jsx(y,{type:"secondary",children:s})},{title:"Read",key:"read",align:"center",render:(s,i)=>e.jsx(I,{allowed:x(i)})},{title:"Write",key:"write",align:"center",render:(s,i)=>e.jsx(I,{allowed:A(i)})},{title:"Delete",key:"delete",align:"center",render:(s,i)=>e.jsx(I,{allowed:G(i)})},{title:"Actions",key:"actions",align:"right",render:(s,i)=>e.jsxs(R,{children:[k("roles_edit")&&e.jsx(F,{title:i.name==="Administrator"?"Administrator role cannot be edited":"Edit role",children:e.jsx(_,{type:"primary",shape:"circle",icon:e.jsx(J,{}),size:"small",onClick:()=>t(i),disabled:i.name==="Administrator"})}),k("roles_delete")&&e.jsx(F,{title:"Delete role",children:e.jsx(_,{danger:!0,shape:"circle",icon:e.jsx(X,{}),size:"small",onClick:()=>r(i),disabled:i.name==="Administrator"})})]})}],x=s=>s.permissions.some(i=>i.endsWith("_view")),A=s=>s.permissions.some(i=>i.endsWith("_create")||i.endsWith("_edit")),G=s=>s.permissions.some(i=>i.endsWith("_delete")),N=s=>{const i=["#1677ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#eb2f96"];let v=0;for(let T=0;T<s.length;T++)v=s.charCodeAt(T)+((v<<5)-v);return i[Math.abs(v)%i.length]},K=n.filter(s=>s.name.toLowerCase().includes(g.toLowerCase())||s.description.toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{style:{padding:"12px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(S,{level:2,children:"Roles & Permissions"}),e.jsx(z,{children:"Manage role-based access control and permissions for your users."})]}),e.jsxs(B,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},loading:f&&n.length===0,children:[e.jsxs(M,{gutter:16,style:{marginBottom:16},children:[e.jsx(V,{span:16,children:e.jsx(C,{placeholder:"Search roles...",allowClear:!0,value:g,onChange:s=>d(s.target.value),prefix:e.jsx(y,{type:"secondary",style:{fontSize:16},children:"ðŸ”"})})}),e.jsx(V,{span:8,style:{textAlign:"right"},children:k("roles_create")&&e.jsx(_,{type:"primary",icon:e.jsx(H,{}),style:{borderRadius:6},onClick:P,children:"Add Role"})})]}),e.jsx(Y,{columns:h,dataSource:K,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(s,i)=>`Showing ${i[0]}-${i[1]} of ${s} roles`},style:{marginTop:8},loading:f&&n.length>0})]}),e.jsx(B,{title:e.jsx(S,{level:4,style:{margin:0},children:"Role Management Tips"}),style:{marginTop:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[e.jsxs(R,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(S,{level:5,children:"Best Practices"}),e.jsxs("ul",{style:{paddingLeft:20},children:[e.jsx("li",{children:e.jsx(y,{children:"Follow the principle of least privilege"})}),e.jsx("li",{children:e.jsx(y,{children:"Regularly audit user roles"})}),e.jsx("li",{children:e.jsx(y,{children:"Document role responsibilities"})})]})]}),e.jsxs(R,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(S,{level:5,children:"Role Inheritance"}),e.jsx(z,{children:"Higher-level roles automatically include permissions from lower-level roles to ensure consistency."})]})]})}),e.jsx(ce,{visible:b,onCancel:()=>p(!1),onSave:c,role:j,loading:f})]})}export{we as default};
