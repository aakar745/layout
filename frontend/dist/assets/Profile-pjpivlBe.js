import{j as e,a as j,s as T}from"./index-aoH9EzMk.js";import{aO as R,Z as r,r as n,F as U,p as N,a9 as d,aa as l,T as q,ab as B,w as I,A as L,l as g,Y as i,ah as k,a1 as M,a2 as c,i as $,aQ as D,a5 as z}from"./vendor-Be5M1UDi.js";import"./apis-CU9I9MMq.js";import"./canvas-C-A9eff5.js";const{Title:P,Text:y}=q,{TabPane:b}=I,G=()=>{var f;const{notification:v}=R.useApp(),[K]=r.useForm(),[m]=r.useForm(),[O,Q]=n.useState(!1),[A,u]=n.useState(!1),[C,h]=n.useState(!1),[p,x]=n.useState(null),w=U(),s=N(a=>a.auth.user);n.useEffect(()=>{(async()=>{try{h(!0);const t=await j.getProfile();t.data&&w(T({user:t.data,token:localStorage.getItem("token")||""}))}catch{z.error("Failed to fetch profile")}finally{h(!1)}})()},[w]);const E=async a=>{var t,o;try{x(null),u(!0),await j.changePassword({currentPassword:a.currentPassword,newPassword:a.newPassword}),v.success({message:"Success",description:"Password has been changed successfully"}),m.resetFields()}catch(S){x(((o=(t=S.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to change password. Please try again.")}finally{u(!1)}},F=()=>s!=null&&s.role?typeof s.role=="string"?s.role:typeof s.role=="object"&&"name"in s.role?s.role.name:"User":"User";return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx(d,{gutter:[24,24],align:"middle",children:e.jsxs(l,{flex:"auto",children:[e.jsx(P,{level:4,children:"My Account"}),e.jsx(y,{type:"secondary",children:"Manage your account settings and change your password"})]})})}),e.jsx(B,{loading:C,children:e.jsxs(I,{defaultActiveKey:"account",children:[e.jsx(b,{tab:"Account Information",children:e.jsxs(d,{gutter:32,children:[e.jsx(l,{span:6,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:[e.jsx(L,{size:100,icon:e.jsx(g,{}),style:{backgroundColor:"#1890ff",marginBottom:16},children:((f=s==null?void 0:s.username)==null?void 0:f.charAt(0).toUpperCase())||"U"}),e.jsx(P,{level:4,children:s==null?void 0:s.username}),e.jsx(y,{type:"secondary",children:F()})]})}),e.jsx(l,{span:18,children:e.jsx(r,{layout:"vertical",initialValues:{username:s==null?void 0:s.username,email:s==null?void 0:s.email},disabled:!0,children:e.jsxs(d,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(r.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter your username"}],children:e.jsx(i,{prefix:e.jsx(g,{}),placeholder:"Username"})})}),e.jsx(l,{span:12,children:e.jsx(r.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter your email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(i,{prefix:e.jsx(k,{}),placeholder:"Email Address"})})})]})})})]})},"account"),e.jsxs(b,{tab:"Change Password",children:[p&&e.jsx(M,{message:"Error",description:p,type:"error",showIcon:!0,style:{marginBottom:24}}),e.jsxs(r,{form:m,layout:"vertical",onFinish:E,children:[e.jsx(r.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(i.Password,{prefix:e.jsx(c,{}),placeholder:"Current Password"})}),e.jsx(r.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter your new password"},{min:8,message:"Password must be at least 8 characters"}],children:e.jsx(i.Password,{prefix:e.jsx(c,{}),placeholder:"New Password"})}),e.jsx(r.Item,{name:"confirmPassword",label:"Confirm New Password",dependencies:["newPassword"],rules:[{required:!0,message:"Please confirm your new password"},({getFieldValue:a})=>({validator(t,o){return!o||a("newPassword")===o?Promise.resolve():Promise.reject(new Error("The two passwords do not match"))}})],children:e.jsx(i.Password,{prefix:e.jsx(c,{}),placeholder:"Confirm New Password"})}),e.jsx(r.Item,{children:e.jsx($,{type:"primary",htmlType:"submit",loading:A,icon:e.jsx(D,{}),children:"Update Password"})})]})]},"password")]})})]})};export{G as default};
