const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-core-BUxrPMxd.js","assets/vendor-react-core-GL8v-krj.js","assets/vendor-ui-utils-C1xmPZI8.js","assets/vendor-canvas-DygNVcxM.js","assets/vendor-deps-j0W__MH0.js","assets/vendor-react-dom-22Ywsp5_.js","assets/vendor-antd-core-1s5t57SE.js","assets/vendor-antd-icons-C-4QrCZ0.js","assets/vendor-date-utils-CEjhVsrT.js","assets/vendor-react-core-f_XpeFrr.css","assets/vendor-redux-9XI87JsB.js","assets/app-auth-pav3ebXF.js","assets/vendor-react-router-BoDVXa_L.js","assets/vendor-http-t--hEgTQ.js","assets/app-admin-iCKr2TyV.js","assets/app-dashboard-DAvQsPhE.js","assets/app-dashboard-CUgo7HtP.css","assets/app-core-DU_-Labf.css"])))=>i.map(i=>d[i]);
import{j as e,R as ut,r as I}from"./vendor-react-core-GL8v-krj.js";import{c as de,a as xt,u as Ze,b as be}from"./vendor-redux-9XI87JsB.js";import{f as at,a as mt}from"./app-exhibition-Vu8xGXtg.js";import{u as Ge}from"./app-invoice-D3-oPHO9.js";import{R as le,C,a as B,o as ne,j as ie,g as Q,S as w,I as V,b as G,p as pt,B as R,M as ve,i as se,T as $,h as q,e as ae,D as Ee,q as je,F as A,m as _e,s as S,r as ht,t as De,u as gt,v as ft}from"./vendor-antd-core-1s5t57SE.js";import{t as yt,p as J,m as ot,u as Ie,v as Le,j as jt,w as bt,x as rt,h as vt,e as lt,n as St,y as kt,z as It,c as dt}from"./vendor-antd-icons-C-4QrCZ0.js";import"./app-dashboard-DAvQsPhE.js";import{u as At}from"./app-admin-iCKr2TyV.js";import{u as Qe,w as Ct,F as wt}from"./vendor-export-UJ8MX7yK.js";import{d as Tt}from"./vendor-date-utils-CEjhVsrT.js";import{u as Ke}from"./vendor-react-router-BoDVXa_L.js";import{j as ce,m as nt,l as $t}from"./app-core-BUxrPMxd.js";import{f as it}from"./app-exhibitor-CjvJHpDU.js";const _t="modulepreload",Dt=function(t){return"/"+t},st={},Bt=function(i,a,l){let c=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),m=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));c=Promise.allSettled(a.map(o=>{if(o=Dt(o),o in st)return;st[o]=!0;const d=o.endsWith(".css"),r=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${r}`))return;const x=document.createElement("link");if(x.rel=d?"stylesheet":_t,d||(x.as="script"),x.crossOrigin="",x.href=o,m&&x.setAttribute("nonce",m),document.head.appendChild(x),d)return new Promise((b,y)=>{x.addEventListener("load",b),x.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${o}`)))})}))}function h(g){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=g,window.dispatchEvent(m),!m.defaultPrevented)throw g}return c.then(g=>{for(const m of g||[])m.status==="rejected"&&h(m.reason);return i().catch(h)})},Pt={bookings:[],currentBooking:null,loading:!1,statsLoading:!1,error:null,pagination:{total:0,page:1,limit:10,pages:0},stats:{total:0,pending:0,approved:0,rejected:0,confirmed:0,cancelled:0,totalRevenue:0,totalBaseAmount:0}},Be=de("booking/fetchBookings",async(t={},{rejectWithValue:i})=>{var a,l;try{const c={};return t.page&&(c.page=t.page),t.limit&&(c.limit=t.limit),(await ce.get("/bookings",{params:c})).data}catch(c){return i(((l=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to fetch bookings")}}),Ue=de("booking/fetchBooking",async t=>(await ce.get(`/bookings/${t}`)).data),Pe=de("booking/createBooking",async t=>(await ce.post("/bookings",t)).data),Ne=de("booking/updateStatus",async({id:t,status:i,rejectionReason:a})=>(await ce.patch(`/bookings/${t}`,{status:i,...a&&{rejectionReason:a}})).data),He=de("booking/updatePaymentStatus",async({id:t,paymentStatus:i,paymentDetails:a})=>(await ce.patch(`/bookings/${t}/payment`,{paymentStatus:i,paymentDetails:a})).data),Re=de("booking/deleteBooking",async t=>(await ce.delete(`/bookings/${t}`),t)),Fe=de("booking/fetchBookingStats",async(t,{rejectWithValue:i})=>{var a,l;try{return(await ce.get("/bookings/stats")).data}catch(c){return i(((l=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to fetch booking statistics")}}),ct=xt({name:"booking",initialState:Pt,reducers:{clearCurrentBooking:t=>{t.currentBooking=null},clearBookingError:t=>{t.error=null}},extraReducers:t=>{t.addCase(Be.pending,i=>{i.loading=!0,i.error=null}).addCase(Be.fulfilled,(i,a)=>{i.loading=!1,i.bookings=a.payload.data||[],a.payload.pagination&&(i.pagination=a.payload.pagination)}).addCase(Be.rejected,(i,a)=>{i.loading=!1,i.error=a.error.message||"Failed to fetch bookings"}).addCase(Ue.pending,i=>{i.loading=!0,i.error=null}).addCase(Ue.fulfilled,(i,a)=>{i.loading=!1,i.currentBooking=a.payload}).addCase(Ue.rejected,(i,a)=>{i.loading=!1,i.error=a.error.message||"Failed to fetch booking"}).addCase(Pe.pending,i=>{i.loading=!0,i.error=null}).addCase(Pe.fulfilled,(i,a)=>{i.loading=!1,i.bookings.unshift(a.payload),i.currentBooking=a.payload}).addCase(Pe.rejected,(i,a)=>{i.loading=!1,i.error=a.error.message||"Failed to create booking"}).addCase(Ne.pending,i=>{i.loading=!0,i.error=null}).addCase(Ne.fulfilled,(i,a)=>{var c;i.loading=!1;const l=i.bookings.findIndex(h=>h._id===a.payload._id);l!==-1&&(i.bookings[l]=a.payload),((c=i.currentBooking)==null?void 0:c._id)===a.payload._id&&(i.currentBooking=a.payload)}).addCase(Ne.rejected,(i,a)=>{i.loading=!1,i.error=a.error.message||"Failed to update booking status"}).addCase(He.pending,i=>{i.loading=!0,i.error=null}).addCase(He.fulfilled,(i,a)=>{var c;i.loading=!1;const l=i.bookings.findIndex(h=>h._id===a.payload._id);l!==-1&&(i.bookings[l]=a.payload),((c=i.currentBooking)==null?void 0:c._id)===a.payload._id&&(i.currentBooking=a.payload)}).addCase(He.rejected,(i,a)=>{i.loading=!1,i.error=a.error.message||"Failed to update payment status"}).addCase(Fe.pending,i=>{i.statsLoading=!0,i.error=null}).addCase(Fe.fulfilled,(i,a)=>{i.statsLoading=!1,i.stats=a.payload}).addCase(Fe.rejected,(i,a)=>{i.statsLoading=!1,i.error=a.error.message||"Failed to fetch booking statistics"}).addCase(Re.pending,i=>{i.loading=!0,i.error=null}).addCase(Re.fulfilled,(i,a)=>{var l;i.loading=!1,i.bookings=i.bookings.filter(c=>c._id!==a.payload),((l=i.currentBooking)==null?void 0:l._id)===a.payload&&(i.currentBooking=null)}).addCase(Re.rejected,(i,a)=>{i.loading=!1,i.error=a.error.message||"Failed to delete booking"})}}),{clearCurrentBooking:rn,clearBookingError:ln}=ct.actions,dn=ct.reducer,Nt=({bookings:t,paginationTotal:i,stats:a,statsLoading:l=!1})=>{const h=a||{total:i!==void 0?i:t.length,pending:t.filter(m=>m.status==="pending").length,approved:t.filter(m=>m.status==="approved").length,rejected:t.filter(m=>m.status==="rejected").length,confirmed:t.filter(m=>m.status==="confirmed").length,cancelled:t.filter(m=>m.status==="cancelled").length,totalRevenue:t.filter(m=>m.status==="confirmed"||m.status==="approved").reduce((m,o)=>m+o.amount,0),totalBaseAmount:t.reduce((m,o)=>{var d;return m+(((d=o.calculations)==null?void 0:d.totalBaseAmount)||0)},0)};return e.jsxs(e.Fragment,{children:[e.jsxs(le,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx(C,{xs:24,sm:12,md:6,children:e.jsx(B,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(ne,{})}):e.jsx(ie,{title:e.jsxs(Q,{title:"Total count across all pages",children:["Total Bookings ",e.jsx(J,{style:{fontSize:"14px",marginLeft:4}})]}),value:h.total,prefix:e.jsx(yt,{})})})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsx(B,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(ne,{})}):e.jsx(ie,{title:e.jsxs(Q,{title:"Count of all pending bookings",children:["Pending Bookings ",e.jsx(J,{style:{fontSize:"14px",marginLeft:4}})]}),value:h.pending,prefix:e.jsx(ot,{style:{color:"#faad14"}})})})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsx(B,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(ne,{})}):e.jsx(ie,{title:e.jsxs(Q,{title:"Count of all approved bookings",children:["Approved Bookings ",e.jsx(J,{style:{fontSize:"14px",marginLeft:4}})]}),value:h.approved,prefix:e.jsx(Ie,{style:{color:"#52c41a"}})})})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsx(B,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(ne,{})}):e.jsx(ie,{title:e.jsxs(Q,{title:"Count of all confirmed bookings",children:["Confirmed Bookings ",e.jsx(J,{style:{fontSize:"14px",marginLeft:4}})]}),value:h.confirmed,prefix:e.jsx(Ie,{style:{color:"#52c41a"}})})})})]}),e.jsxs(le,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx(C,{xs:24,sm:12,md:6,children:e.jsx(B,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(ne,{})}):e.jsx(ie,{title:e.jsxs(Q,{title:"Count of all rejected bookings",children:["Rejected Bookings ",e.jsx(J,{style:{fontSize:"14px",marginLeft:4}})]}),value:h.rejected,prefix:e.jsx(Le,{style:{color:"#f5222d"}})})})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsx(B,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(ne,{})}):e.jsx(ie,{title:e.jsxs(Q,{title:"Count of all cancelled bookings",children:["Cancelled Bookings ",e.jsx(J,{style:{fontSize:"14px",marginLeft:4}})]}),value:h.cancelled,prefix:e.jsx(Le,{style:{color:"#f5222d"}})})})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsx(B,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(ne,{})}):e.jsx(ie,{title:e.jsxs(Q,{title:"Total revenue from all bookings",children:["Total Revenue ",e.jsx(J,{style:{fontSize:"14px",marginLeft:4}})]}),value:h.totalRevenue,precision:0,prefix:"₹"})})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsx(B,{children:l?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(ne,{})}):e.jsx(ie,{title:e.jsxs(Q,{title:"Total base amount before taxes and discounts",children:["Total Base Amount ",e.jsx(J,{style:{fontSize:"14px",marginLeft:4}})]}),value:h.totalBaseAmount,precision:0,prefix:"₹",valueStyle:{color:"#1890ff"}})})})]})]})},{RangePicker:Rt}=pt,Ft=({filters:t,exhibitions:i,onFilterChange:a,onRefresh:l})=>e.jsx(B,{style:{marginBottom:"24px"},children:e.jsxs(w,{wrap:!0,children:[e.jsx(V,{placeholder:"Search by company name",prefix:e.jsx(jt,{}),value:t.search,onChange:c=>a({...t,search:c.target.value}),style:{width:200},allowClear:!0}),e.jsx(G,{placeholder:"Filter by exhibition",value:t.exhibition,onChange:c=>a({...t,exhibition:c}),style:{minWidth:200},allowClear:!0,options:i.map(c=>({label:c.name,value:c._id}))}),e.jsx(G,{mode:"multiple",placeholder:"Filter by status",value:t.status,onChange:c=>a({...t,status:c}),style:{minWidth:200},options:[{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"},{label:"Confirmed",value:"confirmed"},{label:"Cancelled",value:"cancelled"}]}),e.jsx(Rt,{onChange:c=>{var h,g;return a({...t,dateRange:c?[((h=c[0])==null?void 0:h.toISOString())||"",((g=c[1])==null?void 0:g.toISOString())||""]:null})}}),e.jsx(R,{icon:e.jsx(bt,{}),onClick:l,children:"Refresh"})]})}),{Title:cn,Text:_}=$,Et=({selectedBooking:t,isDetailsModalVisible:i,setIsDetailsModalVisible:a,setSelectedBooking:l,setIsStatusModalVisible:c,setSelectedStatus:h,setRejectionReasonText:g,formatBookingNumber:m})=>e.jsx(ve,{title:"Booking Details",open:i,onCancel:()=>{a(!1),l(null)},footer:[e.jsx(R,{type:"primary",disabled:!t,onClick:()=>{t&&(h(t.status),g(t.rejectionReason||""),c(!0))},children:"Update Status"},"updateStatus"),e.jsx(R,{onClick:()=>{a(!1),l(null)},children:"Close"},"close")],width:800,children:t&&e.jsxs(w,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs(se,{bordered:!0,column:2,children:[e.jsxs(se.Item,{label:"Booking Number",span:2,children:[m(t._id,t.createdAt),e.jsxs(_,{type:"secondary",style:{marginLeft:8,fontSize:"12px"},children:["(ID: ",t._id,")"]})]}),e.jsx(se.Item,{label:"Exhibition",span:2,children:t.exhibitionId.name}),e.jsxs(se.Item,{label:"Status",span:2,children:[e.jsx(q,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()}),t.rejectionReason&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(_,{type:"secondary",children:"Rejection Reason:"}),e.jsx("br",{}),e.jsx(_,{children:t.rejectionReason})]})]}),e.jsx(se.Item,{label:"Customer Name",children:t.customerName}),e.jsx(se.Item,{label:"Customer Email",children:t.customerEmail}),e.jsx(se.Item,{label:"Customer Phone",children:t.customerPhone}),e.jsx(se.Item,{label:"Company Name",children:t.companyName})]}),e.jsx(B,{title:"Stall Details",size:"small",children:e.jsx(ae,{dataSource:t.stallIds,pagination:!1,rowKey:"_id",columns:[{title:"Stall Number",dataIndex:"number",key:"number"},{title:"Stall Type",key:"type",render:o=>o.type||"-"},{title:"Dimensions",key:"dimensions",render:o=>e.jsx(q,{color:"blue",children:o.dimensions?`${o.dimensions.width}x${o.dimensions.height}m`:"No dimensions"})},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"rate",render:o=>`₹${o.toLocaleString()}`},{title:"Base Amount",key:"baseAmount",render:o=>{const d=t.calculations.stalls.find(r=>r.stallId===o._id);return d?`₹${d.baseAmount.toLocaleString()}`:"-"}},{title:"Discount",key:"discount",render:o=>{const d=t.calculations.stalls.find(r=>r.stallId===o._id);return d!=null&&d.discount?e.jsx(Q,{title:e.jsx("div",{children:d.discount.type==="percentage"&&` (${d.discount.value}%)`}),children:e.jsxs(q,{color:"red",children:["-₹",d.discount.amount.toLocaleString(),d.discount.type==="percentage"&&` (${d.discount.value}%)`]})}):"-"}}]})}),e.jsx(B,{title:"Financial Summary",size:"small",children:e.jsxs(w,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(_,{children:"Total Base Amount:"}),e.jsxs(_,{children:["₹",t.calculations.totalBaseAmount.toLocaleString()]})]}),t.calculations.totalDiscountAmount>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(_,{children:"Total Discount:"}),e.jsxs(_,{type:"danger",children:["-₹",t.calculations.totalDiscountAmount.toLocaleString()]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(_,{children:"Amount after Discount:"}),e.jsxs(_,{children:["₹",t.calculations.totalAmountAfterDiscount.toLocaleString()]})]}),e.jsx(Ee,{style:{margin:"8px 0"}}),t.calculations.taxes.map(o=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(_,{children:[o.name," (",o.rate,"%):"]}),e.jsxs(_,{children:["₹",o.amount.toLocaleString()]})]},`tax-${o.name}-${o.rate}`)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[e.jsx(_,{strong:!0,children:"Total Amount (incl. Taxes):"}),e.jsxs(_,{strong:!0,children:["₹",t.amount.toLocaleString()]})]})]})})]})}),Lt=({selectedBooking:t,isStatusModalVisible:i,setIsStatusModalVisible:a,selectedStatus:l,setSelectedStatus:c,rejectionReasonText:h,setRejectionReasonText:g,formatBookingNumber:m,refreshAfterAction:o})=>{const d=Ze(),[r,x]=ut.useState(!1),{refetch:b}=Ge({page:1,limit:100}),y=async(T,F,f)=>{try{x(!0),await d(Ne({id:T,status:F,...f&&{rejectionReason:f}})).unwrap(),S.success(`Booking ${F} successfully`),o(),a(!1),P(null),F==="approved"&&setTimeout(async()=>{await b()},1e3)}catch{S.error("Failed to update booking status")}finally{x(!1)}},P=T=>{};return e.jsx(ve,{title:"Update Booking Status",open:i,onCancel:()=>{a(!1),g("")},footer:null,width:600,children:t&&e.jsxs("div",{children:[e.jsx(B,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(rt,{style:{fontSize:"18px"}}),e.jsx("span",{children:"Booking Information"})]}),style:{marginBottom:16},variant:"borderless",size:"small",children:e.jsxs(w,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(q,{color:"processing",children:m(t._id,t.createdAt)}),e.jsx(q,{color:"default",children:t.exhibitionId.name}),e.jsx(q,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()})]}),e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx(_,{strong:!0,children:"Stall Details:"}),e.jsx("div",{style:{marginTop:"4px"},children:t.stallIds.map((T,F)=>e.jsxs(q,{style:{margin:"2px"},children:["#",T.number," ",T.type&&`(${T.type})`]},T._id))})]}),e.jsx(Ee,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(_,{strong:!0,style:{minWidth:"120px"},children:"Company:"}),e.jsx(_,{children:t.companyName})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(_,{strong:!0,style:{minWidth:"120px"},children:"Current Status:"}),e.jsx(q,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()})]})]})}),e.jsxs(B,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(vt,{style:{fontSize:"18px"}}),e.jsx("span",{children:"Update Status"})]}),variant:"borderless",size:"small",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx(_,{strong:!0,children:"Select New Status:"}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsxs(je.Group,{value:l,onChange:T=>c(T.target.value),buttonStyle:"solid",style:{display:"flex",flexWrap:"nowrap",overflowX:"auto"},children:[e.jsx(je.Button,{value:"pending",style:{flex:"0 0 auto"},children:e.jsxs(w,{children:[e.jsx(ot,{style:{color:"#faad14"}}),"Pending"]})}),e.jsx(je.Button,{value:"approved",style:{flex:"0 0 auto"},children:e.jsxs(w,{children:[e.jsx(Ie,{style:{color:"#52c41a"}}),"Approved"]})}),e.jsx(je.Button,{value:"rejected",style:{flex:"0 0 auto"},children:e.jsxs(w,{children:[e.jsx(Le,{style:{color:"#f5222d"}}),"Rejected"]})}),e.jsx(je.Button,{value:"confirmed",style:{flex:"0 0 auto"},children:e.jsxs(w,{children:[e.jsx(Ie,{style:{color:"#1890ff"}}),"Confirmed"]})}),e.jsx(je.Button,{value:"cancelled",style:{flex:"0 0 auto"},children:e.jsxs(w,{children:[e.jsx(Le,{style:{color:"#ff7875"}}),"Cancelled"]})})]})})]}),l==="rejected"&&e.jsx("div",{children:e.jsx(A.Item,{label:e.jsx(_,{strong:!0,children:"Rejection Reason:"}),required:l==="rejected",rules:[{required:!0,message:"Please provide a reason for rejection"}],help:"This will be visible to the customer",children:e.jsx(V.TextArea,{rows:4,value:h,onChange:T=>g(T.target.value),placeholder:"Provide a reason for rejection",style:{marginTop:8}})})}),l==="approved"&&e.jsx(_e,{message:"Approval Confirmation",description:"By approving this booking, the stalls will be reserved but not yet confirmed. Customer will be notified.",type:"success",showIcon:!0,style:{marginTop:8}}),l==="confirmed"&&e.jsx(_e,{message:"Confirmation Notice",description:"By confirming this booking, the stalls will be marked as booked. This should be done after payment is received.",type:"info",showIcon:!0,style:{marginTop:8}}),l==="cancelled"&&e.jsx(_e,{message:"Cancellation Warning",description:"By cancelling this booking, all stalls will be marked as available again.",type:"warning",showIcon:!0,style:{marginTop:8}}),l==="pending"&&e.jsx(_e,{message:"Return to Pending",description:"This booking will be moved back to pending status.",type:"warning",showIcon:!0,style:{marginTop:8}})]}),e.jsxs("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end",gap:"8px"},children:[e.jsx(R,{onClick:()=>{a(!1),g("")},children:"Cancel"}),e.jsx(R,{type:"primary",onClick:()=>{if(l==="rejected"&&!h.trim()){S.error("Rejection reason is required when rejecting a booking");return}y(t._id,l,l==="rejected"?h:void 0)},loading:r,disabled:l==="rejected"&&!h.trim(),children:"Update Status"})]})]})]})})},qt=(t,i,a)=>{ve.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(lt,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Booking"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete booking ",e.jsx("strong",{children:a(t._id,t.createdAt)}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data including invoices."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(R,{onClick:()=>ve.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(R,{danger:!0,type:"primary",onClick:()=>{i(t._id),ve.destroyAll()},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},zt=t=>{const i=Ke(),{data:a,isLoading:l,error:c,refetch:h}=Ge({page:1,limit:100}),g=o=>{if(l||c||!a)return null;const r=(a.data||[]).find(x=>x.bookingId&&typeof x.bookingId=="object"&&x.bookingId._id===o);return r==null?void 0:r._id},m=async o=>{if(l){S.loading("Loading invoice data...");return}let d=g(o._id);if(d)i(`/invoice/${d}`);else{const r="invoice-loading";if(S.loading({content:"Checking for invoice...",key:r}),await h(),d=g(o._id),d){S.success({content:"Invoice found!",key:r,duration:1}),i(`/invoice/${d}`);return}const x=new Date(o.createdAt),b=new Date(Date.now()-30*60*1e3);if(x>b||o.status==="approved"){S.info({content:"Invoice is still being generated. Checking again in a moment...",key:r});let P=0;const T=5,F=[2e3,3e3,5e3,8e3,1e4],f=async()=>{P++,await h();const K=g(o._id);if(K)S.success({content:"Invoice is ready!",key:r,duration:1}),i(`/invoice/${K}`);else if(P<T){const oe=F[P]||5e3,Ae=oe/1e3;S.info({content:`Attempt ${P}/${T}: Invoice not ready yet. Trying again in ${Ae} seconds...`,key:r}),setTimeout(f,oe)}else S.warning({content:"Invoice generation is taking longer than expected. Please try refreshing the page in a few moments.",key:r})};setTimeout(f,F[0])}else S.error({content:"No invoice found for this booking. Please contact support if this persists.",key:r})}};return[{title:"Booking Number",dataIndex:"_id",key:"bookingNumber",fixed:"left",width:170,render:(o,d)=>e.jsx(R,{type:"link",onClick:()=>{t.setSelectedBooking(d),t.setIsDetailsModalVisible(!0)},children:t.formatBookingNumber(o,d.createdAt)})},{title:"Exhibition",dataIndex:["exhibitionId","name"],key:"exhibition",width:250,render:(o,d)=>d.exhibitionId.name},{title:"Company Name",dataIndex:"companyName",key:"company",width:250,render:o=>o||"N/A"},{title:"Stall No.",key:"stallNumber",width:120,render:(o,d)=>e.jsx("span",{children:d.stallIds.map((r,x)=>e.jsxs("span",{children:[r.number,x<d.stallIds.length-1?", ":""]},`stall-${r._id||x}`))})},{title:"Stall Type",key:"stallType",width:120,render:(o,d)=>{const r=Array.from(new Set(d.stallIds.map(x=>x.type)));return e.jsx("span",{children:r.map((x,b)=>e.jsxs("span",{children:[x,b<r.length-1?", ":""]},`type-${x}-${b}`))})}},{title:"Dimensions",key:"dimensions",width:150,render:(o,d)=>e.jsx("span",{children:d.stallIds.map((r,x)=>e.jsxs("span",{children:[r.dimensions?`${r.dimensions.width}m × ${r.dimensions.height}m`:"No dimensions",x<d.stallIds.length-1?", ":""]},`dim-${r._id||x}`))})},{title:"Area (sqm)",key:"area",width:120,render:(o,d)=>{const r=d.stallIds.reduce((x,b)=>b.dimensions?x+b.dimensions.width*b.dimensions.height:x,0);return e.jsxs("span",{children:[Math.round(r)," sqm"]})}},{title:"Base Amount",dataIndex:["calculations","totalBaseAmount"],key:"baseAmount",width:150,render:o=>`₹${o.toLocaleString()}`},{title:"Discount",key:"discount",width:150,render:(o,d)=>{const r=d.calculations.totalDiscountAmount;if(!r||r===0)return"-";const x=d.calculations.stalls.filter(y=>y.discount).map(y=>y.discount);if(x.length===0)return"-";const b=x[0];return e.jsx(Q,{title:e.jsx("div",{children:x.map((y,P)=>e.jsxs("div",{children:[y==null?void 0:y.name,": ",(y==null?void 0:y.type)==="percentage"?`${y==null?void 0:y.value}%`:`₹${y==null?void 0:y.value}`,e.jsx("br",{}),"Amount: ₹",y==null?void 0:y.amount.toLocaleString()]},`discount-${P}-${(y==null?void 0:y.name)||"unnamed"}`))}),children:e.jsxs(q,{color:"red",children:["-₹",r.toLocaleString(),(b==null?void 0:b.type)==="percentage"&&` (${b.value}%)`,x.length>1&&" +"]})})}},{title:"Total Amount",dataIndex:"amount",key:"amount",width:150,render:o=>`₹${o.toLocaleString()}`},{title:"Status",dataIndex:"status",key:"status",width:120,render:o=>e.jsx(q,{color:o==="confirmed"?"success":o==="approved"?"blue":o==="pending"?"warning":o==="rejected"?"error":"default",children:o.toUpperCase()})},{title:"Created At",dataIndex:"createdAt",key:"createdAt",width:200,render:o=>Tt(o).format("MMM D, YYYY HH:mm")},{title:"Actions",key:"actions",fixed:"right",width:220,render:(o,d)=>e.jsxs(w,{children:[e.jsx(Q,{title:"View Details",children:e.jsx(R,{icon:e.jsx(St,{}),onClick:()=>{t.setSelectedBooking(d),t.setIsDetailsModalVisible(!0)}})}),e.jsx(ht,{overlay:e.jsxs(De,{children:[d.status!=="cancelled"&&t.hasPermission("view_bookings")&&e.jsx(De.Item,{icon:e.jsx(rt,{}),disabled:l,onClick:()=>m(d),children:"View Invoice"},"invoice"),e.jsx(De.Item,{icon:e.jsx(Ie,{}),onClick:()=>{t.setSelectedBooking(d),t.setSelectedStatus(d.status),t.setRejectionReasonText(d.rejectionReason||""),t.setIsStatusModalVisible(!0)},children:"Update Status"},"updateStatus"),t.hasPermission("bookings_delete")&&e.jsx(De.Item,{icon:e.jsx(lt,{}),danger:!0,onClick:()=>{qt(d,t.handleDelete,t.formatBookingNumber)},children:"Delete"},"delete")]}),trigger:["click"],children:e.jsx(R,{icon:e.jsx(kt,{})})})]})}]},Mt=t=>{const{bookings:i,loading:a,pagination:l,fetchBookingsWithPagination:c}=t,h=zt(t),g=(m,o,d,r)=>e.jsx("div",{className:"ant-table-pagination ant-table-pagination-right",style:{padding:"16px 24px",margin:0,display:"flex",justifyContent:"flex-end"},children:e.jsx(gt,{current:m,pageSize:o,total:d,showTotal:x=>`Total ${x} items`,showSizeChanger:!0,pageSizeOptions:["5","10","20","50","100"],onChange:x=>r(x,o),onShowSizeChange:(x,b)=>r(x,b),size:"default"})});return e.jsxs(e.Fragment,{children:[e.jsx(ae,{columns:h,dataSource:i,loading:a,rowKey:"_id",scroll:{x:1800},pagination:!1}),g(l.page,l.limit,l.total,(m,o)=>c(m,o))]})},{Title:Wt,Text:Ot}=$,Vt=()=>{const t=Ze(),{bookings:i,loading:a,pagination:l,stats:c,statsLoading:h}=be(v=>v.booking),{exhibitions:g}=be(v=>v.exhibition),[m,o]=I.useState(null),[d,r]=I.useState(!1),[x,b]=I.useState(!1),[y,P]=I.useState("pending"),[T,F]=I.useState(""),[f,K]=I.useState({search:"",status:[],dateRange:null,exhibition:null}),oe=Ke(),{data:Ae,isLoading:qe,error:ue,refetch:xe}=Ge({page:1,limit:100}),{hasPermission:ze}=At(),ee=I.useCallback((v=1,z=10)=>{const O={page:v,limit:z};f.search&&(O.search=f.search),f.exhibition&&(O.exhibitionId=f.exhibition),f.status&&f.status.length>0&&(O.status=f.status),f.dateRange&&f.dateRange.length===2&&(O.startDate=f.dateRange[0],O.endDate=f.dateRange[1]),t(Be(O))},[t,f]),me=I.useCallback(()=>{t(Fe())},[t]),pe=I.useCallback(()=>{ee(l.page,l.limit),me()},[ee,me,l.page,l.limit]);I.useEffect(()=>{ee(l.page,l.limit),me()},[ee,me,l.page,l.limit]),I.useEffect(()=>{t(at())},[t]),I.useEffect(()=>{i.length>0&&[...new Set(i.map(z=>z.exhibitionId._id))].forEach(z=>{t(mt(z))})},[i,t]);const Me=async v=>{try{await t(Re(v)).unwrap(),S.success("Booking deleted successfully"),pe()}catch(z){S.error((z==null?void 0:z.message)||"Failed to delete booking")}},Ce=v=>{K(v),ee(1,l.limit)},Se=Array.isArray(i)?i:[],Y=(v,z)=>{const O=new Date(z).getFullYear(),X=Se.find(M=>M._id===v);if(!X)return`--/${O}/--`;const he=(Se.filter(M=>M.exhibitionId._id===X.exhibitionId._id).sort((M,k)=>new Date(M.createdAt).getTime()-new Date(k.createdAt).getTime()).findIndex(M=>M._id===v)+1).toString().padStart(2,"0"),te=g.find(M=>M._id===X.exhibitionId._id);return`${(te==null?void 0:te.invoicePrefix)||X.exhibitionId.invoicePrefix||"BK"}/${O}/${he}`},We=async()=>{try{S.loading({content:"Preparing export...",key:"export"});const v={};f.search&&(v.search=f.search),f.exhibition&&(v.exhibitionId=f.exhibition),f.status&&f.status.length>0&&(v.status=f.status),f.dateRange&&f.dateRange.length===2&&(v.startDate=f.dateRange[0],v.endDate=f.dateRange[1]);const X=(await(await Bt(async()=>{const{default:k}=await import("./app-core-BUxrPMxd.js").then(ge=>ge.B);return{default:k}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))).default.get("/bookings/export",{params:v})).data;if(!Array.isArray(X))throw new Error("Invalid data format received");const we=X.map(k=>{const ge=k.stallIds.reduce((E,n)=>n.dimensions?E+n.dimensions.width*n.dimensions.height:E,0);return{"Booking Number":Y(k._id,k.createdAt),Exhibition:k.exhibitionId.name,"Company Name":k.companyName||"N/A","Customer Name":k.customerName,"Customer Email":k.customerEmail,"Customer Phone":k.customerPhone,"Stall Numbers":k.stallIds.map(E=>E.number).join(", "),"Stall Types":Array.from(new Set(k.stallIds.map(E=>E.type||(E.stallTypeId&&typeof E.stallTypeId=="object"?E.stallTypeId.name:"-")))).join(", "),Dimensions:k.stallIds.map(E=>E.dimensions?`${E.dimensions.width}m × ${E.dimensions.height}m`:"No dimensions").join(", "),"Total Area (sqm)":Math.round(ge),"Base Amount":Math.round(k.calculations.totalBaseAmount),Discount:Math.round(k.calculations.totalDiscountAmount),"Total Amount":Math.round(k.calculations.totalAmount),Status:k.status.toUpperCase(),"Created Date":new Date(k.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}}),Te=Qe.json_to_sheet(we),he=Qe.book_new();Qe.book_append_sheet(he,Te,"Bookings");const te=Ct(he,{bookType:"xlsx",type:"array"}),$e=new Blob([te],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),M=new Date().toISOString().split("T")[0];wt.saveAs($e,`bookings_export_${M}.xlsx`),S.success({content:"Export successful!",key:"export",duration:2})}catch(v){console.error("Export error:",v),S.error({content:"Failed to export bookings",key:"export",duration:2})}};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(le,{gutter:[24,24],align:"middle",children:[e.jsx(C,{flex:"auto",children:e.jsxs(w,{direction:"vertical",size:4,children:[e.jsx(Wt,{level:4,style:{margin:0},children:"Stall Bookings"}),e.jsx(Ot,{type:"secondary",children:"Manage exhibition stall bookings"})]})}),e.jsx(C,{children:e.jsxs(w,{children:[e.jsx(R,{icon:e.jsx(It,{}),onClick:We,size:"large",children:"Export"}),e.jsx(R,{type:"primary",size:"large",icon:e.jsx(dt,{}),onClick:()=>oe("/bookings/create"),children:"Create Booking"})]})})]})}),e.jsx(Nt,{bookings:i,paginationTotal:l.total,stats:c,statsLoading:h}),e.jsx(Ft,{filters:f,exhibitions:g,onFilterChange:Ce,onRefresh:pe}),e.jsx(B,{className:"info-card",styles:{body:{padding:0,overflow:"auto"},header:{paddingBottom:12}},title:"Booking List",children:e.jsx(Mt,{bookings:Se,loading:a,fetchBookingsWithPagination:ee,pagination:l,setSelectedBooking:o,setIsDetailsModalVisible:r,setIsStatusModalVisible:b,setSelectedStatus:P,setRejectionReasonText:F,formatBookingNumber:Y,handleDelete:Me,hasPermission:ze})}),e.jsx(Et,{selectedBooking:m,isDetailsModalVisible:d,setIsDetailsModalVisible:r,setSelectedBooking:o,setIsStatusModalVisible:b,setSelectedStatus:P,setRejectionReasonText:F,formatBookingNumber:Y}),e.jsx(Lt,{selectedBooking:m,isStatusModalVisible:x,setIsStatusModalVisible:b,selectedStatus:y,setSelectedStatus:P,rejectionReasonText:T,setRejectionReasonText:F,formatBookingNumber:Y,refreshAfterAction:pe})]})},un=Object.freeze(Object.defineProperty({__proto__:null,default:Vt},Symbol.toStringTag,{value:"Module"})),{Title:Qt,Text:Z}=$,Ut=()=>{var k,ge,E;const[t]=A.useForm(),[i]=A.useForm(),[a,l]=I.useState(!1),[c,h]=I.useState([]),[g,m]=I.useState(!1),[o,d]=I.useState([]),[r,x]=I.useState(null),[b,y]=I.useState(),[P,T]=I.useState([]),[F,f]=I.useState({}),[K,oe]=I.useState([]),[Ae,qe]=I.useState(0),ue=Ke(),xe=Ze(),{loading:ze}=be(n=>n.booking),{exhibitions:ee=[],loading:me}=be(n=>n.exhibition),{exhibitors:pe=[],loading:Me}=be(n=>n.exhibitor),{isAuthenticated:Ce}=be(n=>n.auth);I.useEffect(()=>{if(!Ce){S.error("Please login to create a booking"),ue("/login");return}xe(at()),xe(it())},[xe,Ce,ue]);const Se=async n=>{try{m(!0),t.setFieldValue("stallIds",[]),t.setFieldValue("discountId",void 0),t.setFieldValue("extraAmenities",[]),d([]),T([]),oe([]),qe(0);const s=await nt.getExhibition(n);x(s.data);const j=(await nt.getStalls(n)).data.filter(L=>L.status==="available");h(j)}catch(s){console.error("Failed to fetch exhibition data:",s),S.error("Failed to fetch exhibition data")}finally{m(!1)}},Y=n=>Math.round(n.ratePerSqm*n.dimensions.width*n.dimensions.height*100)/100,We=n=>{var j;const s=c.filter(L=>{const N=L._id||L.id;return N&&n.includes(N)});d(s);const u=s.reduce((L,N)=>L+N.dimensions.width*N.dimensions.height,0);if(qe(u),(j=r==null?void 0:r.basicAmenities)!=null&&j.length){const L=r.basicAmenities.map(N=>{const H=Math.floor(u/N.perSqm)*N.quantity;return{...N,calculatedQuantity:H>0?H:0,key:N._id||N.id}});oe(L)}},v=(n,s,u)=>{if(!(u!=null&&u.isActive))return 0;let j=0;if(u.type==="percentage")j=n*(Math.max(0,Math.min(100,u.value))/100);else{const L=n/s*u.value;j=Math.min(L,n)}return Math.round(j*100)/100},z=async n=>{var s,u;try{const j=pe.find(p=>p._id===n.exhibitorId);if(!j)throw new Error("Selected exhibitor not found");const[L,N,H]=n.discountId?n.discountId.split("-"):[],W=(s=r==null?void 0:r.discountConfig)==null?void 0:s.find(p=>`${p.name}-${p.value}-${p.type}`===n.discountId),ke=o.map(p=>{const U=p._id||p.id;if(!U)throw new Error(`Invalid stall ID for stall number ${p.number}`);return{stall:p,stallId:U,baseAmount:Y(p)}}),D=ke.reduce((p,{baseAmount:U})=>p+U,0),re=ke.map(({stall:p,stallId:U,baseAmount:ye})=>{const tt=W?v(ye,D,W):0;return{stallId:U,number:p.number,baseAmount:ye,discount:W?{name:W.name,type:W.type,value:W.value,amount:tt}:void 0,amountAfterDiscount:Math.round((ye-tt)*100)/100}}),Ye=re.reduce((p,U)=>{var ye;return p+(((ye=U.discount)==null?void 0:ye.amount)||0)},0),Oe=Math.round((D-Ye)*100)/100,Xe=((u=r==null?void 0:r.taxConfig)==null?void 0:u.filter(p=>p.isActive).map(p=>({name:p.name,rate:p.rate,amount:Math.round(Oe*p.rate/100*100)/100})))||[],Je=Xe.reduce((p,U)=>p+U.amount,0),et=Math.round((Oe+Je)*100)/100,Ve={exhibitionId:n.exhibitionId,exhibitorId:n.exhibitorId,stallIds:re.map(p=>p.stallId),customerName:j.contactPerson,customerEmail:j.email,customerPhone:j.phone,customerAddress:j.address||"N/A",customerGSTIN:j.gstNumber||"N/A",customerPAN:j.panNumber||"N/A",companyName:j.companyName,discount:W?{name:W.name,type:W.type,value:W.value}:void 0,amount:et,calculations:{stalls:re,totalBaseAmount:D,totalDiscountAmount:Ye,totalAmountAfterDiscount:Oe,taxes:Xe,totalTaxAmount:Je,totalAmount:et}};K.length&&(Ve.basicAmenities=K.filter(p=>p.calculatedQuantity>0).map(p=>({name:p.name,type:p.type,perSqm:p.perSqm,quantity:p.quantity,calculatedQuantity:p.calculatedQuantity,description:p.description}))),P.length&&(Ve.extraAmenities=te());const fe=await xe(Pe(Ve)).unwrap();fe&&fe.invoiceId?(S.success("Booking created successfully! Redirecting to invoice..."),setTimeout(()=>{ue(`/invoice/${fe.invoiceId}`)},2e3)):(S.success("Booking created successfully"),ue("/bookings")),fe&&fe.warning&&S.warning(fe.warning)}catch(j){console.error("Error creating booking:",j),S.error("Failed to create booking")}},O=async n=>{try{const s=await $t.createExhibitor(n);S.success("Exhibitor added successfully"),xe(it()),t.setFieldsValue({exhibitorId:s.data._id}),l(!1),i.resetFields()}catch(s){const u=(s==null?void 0:s.message)||"Failed to add exhibitor";S.error(u),u==="User with this email already exists"&&i.setFields([{name:"contactEmail",errors:["This email is already registered"]}])}},X=ee.map(n=>({label:n.name,value:n._id||n.id})),we=pe.map(n=>({label:n.companyName,value:n._id}));c.map(n=>({label:`Stall ${n.number} (${n.dimensions.width}m × ${n.dimensions.height}m = ${(n.dimensions.width*n.dimensions.height).toFixed(2)} sqm) - ₹${n.ratePerSqm.toLocaleString()}/sq.m`,value:n._id||n.id}));const Te=n=>{y(n),t.setFieldValue("discountId",n)},he=()=>{var W,ke;const n=o.reduce((D,re)=>D+Y(re),0),s=(W=r==null?void 0:r.discountConfig)==null?void 0:W.find(D=>`${D.name}-${D.value}-${D.type}`===b&&D.isActive),u=s?s.type==="percentage"?Math.round(n*s.value/100*100)/100:Math.min(s.value,n):0,j=Math.round((n-u)*100)/100,L=((ke=r==null?void 0:r.taxConfig)==null?void 0:ke.filter(D=>D.isActive).map(D=>({name:D.name,rate:D.rate,amount:Math.round(j*D.rate/100*100)/100})))||[],N=L.reduce((D,re)=>D+re.amount,0),H=Math.round((j+N)*100)/100;return{baseAmount:n,selectedDiscount:s,discountAmount:u,amountAfterDiscount:j,taxes:L,totalTaxAmount:N,totalAmount:H}},te=()=>{var n;return(n=r==null?void 0:r.amenities)!=null&&n.length?r.amenities.filter(s=>{const u=s._id||s.id;return u&&P.includes(u.toString())}).map(s=>{const u=(s._id||s.id).toString();return{id:u,name:s.name,type:s.type,rate:s.rate,description:s.description,quantity:F[u]||1}}):[]},$e=n=>{const s={...F};n.forEach(u=>{P.includes(u)||(s[u]=1)}),Object.keys(s).forEach(u=>{n.includes(u)||delete s[u]}),f(s),T(n)},M=(n,s)=>{f(u=>({...u,[n]:s}))};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(le,{gutter:[24,24],children:[e.jsx(C,{span:24,children:e.jsxs(w,{direction:"vertical",size:4,children:[e.jsx(Qt,{level:2,style:{margin:0},children:"Create Booking"}),e.jsx($.Text,{type:"secondary",children:"Create a new stall booking"})]})}),e.jsx(C,{span:24,children:e.jsx(B,{children:e.jsx(A,{form:t,layout:"vertical",onFinish:z,style:{maxWidth:800},children:e.jsxs(le,{gutter:16,children:[e.jsx(C,{span:12,children:e.jsx(A.Item,{name:"exhibitionId",label:"Exhibition",rules:[{required:!0,message:"Please select an exhibition"}],children:e.jsx(G,{placeholder:"Select exhibition",loading:me,options:X,onChange:Se})})}),e.jsx(C,{span:12,children:e.jsx(A.Item,{name:"exhibitorId",label:e.jsxs(w,{children:[e.jsx("span",{children:"Exhibitor"}),e.jsx(R,{type:"link",icon:e.jsx(dt,{}),onClick:()=>l(!0),style:{padding:0},children:"Add Exhibitor"})]}),rules:[{required:!0,message:"Please select an exhibitor"}],children:e.jsx(G,{showSearch:!0,placeholder:"Select exhibitor",loading:Me,options:we,filterOption:(n,s)=>{var u;return(((u=s==null?void 0:s.label)==null?void 0:u.toString())??"").toLowerCase().includes(n.toLowerCase())}})})}),e.jsx(C,{span:24,children:e.jsx(A.Item,{name:"stallIds",label:"Select Stalls",rules:[{required:!0,message:"Please select at least one stall"}],children:e.jsx(G,{mode:"multiple",placeholder:g?"Loading stalls...":"Select stalls",loading:g,onChange:We,options:c.map(n=>({label:`Stall ${n.number} (${n.dimensions.width}m × ${n.dimensions.height}m = ${(n.dimensions.width*n.dimensions.height).toFixed(2)} sqm) - ₹${n.ratePerSqm.toLocaleString()}/sq.m`,value:n._id||n.id}))})})}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(C,{span:24,children:e.jsx(B,{title:"Selected Stalls Summary",size:"small",children:e.jsx(ae,{dataSource:o.map(n=>({...n,key:n._id||n.id})),pagination:!1,size:"small",columns:[{title:"Stall Number",dataIndex:"number",key:"number"},{title:"Stall Type",key:"type",render:(n,s)=>{var u,j;return((u=s.stallType)==null?void 0:u.name)||(typeof s.stallTypeId=="object"?(j=s.stallTypeId)==null?void 0:j.name:"Not specified")}},{title:"Dimensions",key:"dimensions",render:(n,s)=>`${s.dimensions.width}m × ${s.dimensions.height}m`},{title:"Area (sqm)",key:"area",render:(n,s)=>(s.dimensions.width*s.dimensions.height).toFixed(2)},{title:"Rate/sq.m",dataIndex:"ratePerSqm",key:"rate",render:n=>`₹${n.toLocaleString()}`},{title:"Base Amount",key:"baseAmount",render:(n,s)=>`₹${Y(s).toLocaleString()}`}],summary:()=>{const n=o.reduce((s,u)=>s+Y(u),0);return e.jsxs(ae.Summary.Row,{children:[e.jsx(ae.Summary.Cell,{index:0,colSpan:5,children:e.jsx("strong",{children:"Total Base Amount"})}),e.jsx(ae.Summary.Cell,{index:1,children:e.jsxs("strong",{children:["₹",n.toLocaleString()]})})]},"summary")}})})}),e.jsx(C,{span:24,children:e.jsx(B,{title:"Stall Amenities",size:"small",children:e.jsxs(le,{gutter:[16,24],children:[e.jsxs(C,{span:24,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx($.Title,{level:5,style:{margin:0},children:e.jsxs(w,{children:[e.jsx("span",{children:"Included Basic Amenities"}),e.jsx(q,{color:"green",children:"Based on stall area"})]})}),e.jsxs($.Text,{type:"secondary",children:["The following amenities are included based on your total stall area of ",Ae.toFixed(2)," sqm."]})]}),(k=r==null?void 0:r.basicAmenities)!=null&&k.length?e.jsx(ae,{dataSource:K.filter(n=>n.calculatedQuantity>0),columns:[{title:"Name",dataIndex:"name",key:"name",render:(n,s)=>e.jsxs(w,{children:[e.jsx($.Text,{strong:!0,children:n}),e.jsx(q,{color:"blue",children:s.type})]})},{title:"Quantity",dataIndex:"calculatedQuantity",key:"calculatedQuantity",width:120,render:n=>e.jsxs(q,{color:"green",children:[n," ",n===1?"unit":"units"]})},{title:"Allocation",dataIndex:"perSqm",key:"perSqm",width:180,render:(n,s)=>e.jsx(Q,{title:s.description,children:e.jsxs($.Text,{type:"secondary",children:[e.jsx(J,{style:{marginRight:5}}),"1 ",s.quantity>1?`set of ${s.quantity}`:"unit"," per ",n," sqm"]})})},{title:"Status",key:"status",width:100,align:"right",render:()=>e.jsx($.Text,{type:"success",children:"Included"})}],pagination:!1,size:"small",locale:{emptyText:e.jsx($.Text,{children:"No basic amenities qualify based on the selected stall area."})}}):e.jsx($.Text,{type:"secondary",children:"No basic amenities have been configured for this exhibition."})]}),e.jsxs(C,{span:24,children:[e.jsx(Ee,{style:{margin:"12px 0 24px"}}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx($.Title,{level:5,style:{margin:0},children:e.jsxs(w,{children:[e.jsx("span",{children:"Additional Amenities"}),e.jsx(q,{color:"blue",children:"Optional"})]})}),e.jsx($.Text,{type:"secondary",children:"Select any additional amenities for the booking."})]}),(ge=r==null?void 0:r.amenities)!=null&&ge.length?e.jsxs(e.Fragment,{children:[e.jsx(A.Item,{name:"extraAmenities",label:"Select Additional Amenities",children:e.jsx(G,{mode:"multiple",placeholder:"Select amenities",style:{width:"100%"},onChange:$e,optionLabelProp:"label",options:r.amenities.map(n=>({label:`${n.name} (${n.rate?`₹${n.rate.toLocaleString()}`:"N/A"})`,value:n._id||n.id,key:n._id||n.id}))})}),P.length>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx($.Text,{strong:!0,children:"Selected Amenities:"}),e.jsx(ae,{dataSource:te(),columns:[{title:"Name",dataIndex:"name",key:"name",render:(n,s)=>e.jsxs(w,{align:"center",children:[e.jsx($.Text,{strong:!0,children:n}),e.jsx(q,{color:"blue",children:s.type}),e.jsx($.Text,{type:"secondary",style:{fontSize:"13px"},children:s.description||""})]})},{title:"Rate",dataIndex:"rate",key:"rate",width:120,align:"right",render:n=>e.jsxs($.Text,{strong:!0,style:{color:"#1890ff"},children:["₹",n.toLocaleString("en-IN")]})},{title:"Quantity",dataIndex:"quantity",key:"quantity",width:120,render:(n,s)=>e.jsx(ft,{min:1,value:F[s.id]||1,onChange:u=>M(s.id,u||1),style:{width:"100%"}})},{title:"Total",key:"total",width:120,align:"right",render:(n,s)=>{const u=F[s.id]||1,j=s.rate*u;return e.jsxs($.Text,{strong:!0,style:{color:"#1890ff"},children:["₹",j.toLocaleString("en-IN")]})}}],pagination:!1,size:"small"})]})]}):e.jsx($.Text,{type:"secondary",children:"No additional amenities have been configured for this exhibition."})]})]})})}),e.jsx(C,{span:24,children:e.jsxs(B,{title:"Price Calculations",size:"small",children:[e.jsx(le,{gutter:[16,16],children:e.jsx(C,{span:12,children:e.jsx(A.Item,{name:"discountId",label:"Available Discounts",children:e.jsx(G,{placeholder:"Select discount",allowClear:!0,onChange:Te,options:(E=r==null?void 0:r.discountConfig)==null?void 0:E.map(n=>({label:`${n.name} (${n.type==="percentage"?n.value+"%":"₹"+n.value})${n.isActive?"":" - Inactive"}`,value:`${n.name}-${n.value}-${n.type}`,disabled:!n.isActive}))})})})}),e.jsx("div",{style:{background:"#fafafa",padding:"16px",borderRadius:"8px",marginTop:"16px"},children:e.jsx(w,{direction:"vertical",style:{width:"100%"},size:"small",children:(()=>{const{baseAmount:n,selectedDiscount:s,discountAmount:u,amountAfterDiscount:j,taxes:L,totalAmount:N}=he();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Z,{children:"Total Base Amount:"}),e.jsxs(Z,{children:["₹",n.toLocaleString()]})]}),s&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Z,{children:["Discount (",s.type==="percentage"?`${s.value}%`:`₹${s.value.toLocaleString()}`,"):"]}),e.jsxs(Z,{type:"danger",children:["-₹",u.toLocaleString()]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Z,{children:"Amount after Discount:"}),e.jsxs(Z,{children:["₹",j.toLocaleString()]})]}),e.jsx(Ee,{style:{margin:"8px 0"}}),L.map(H=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Z,{children:[H.name," (",H.rate,"%):"]}),e.jsxs(Z,{children:["₹",H.amount.toLocaleString()]})]},`tax-${H.name}`)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[e.jsx(Z,{strong:!0,children:"Total Amount (incl. Taxes):"}),e.jsxs(Z,{strong:!0,children:["₹",N.toLocaleString()]})]})]})})()})})]})})]}),e.jsx(C,{span:24,children:e.jsx(A.Item,{children:e.jsxs(w,{children:[e.jsx(R,{type:"primary",htmlType:"submit",loading:ze,children:"Create Booking"}),e.jsx(R,{onClick:()=>ue("/bookings"),children:"Cancel"})]})})})]})})})})]}),e.jsx(ve,{title:e.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:"#101828"},children:"Add Exhibitor"}),open:a,onCancel:()=>{l(!1),i.resetFields()},width:800,footer:e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-start",padding:"20px 24px"},children:[e.jsx(R,{onClick:()=>{l(!1),i.resetFields()},style:{height:"40px",padding:"10px 16px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",backgroundColor:"white"},children:"Cancel"}),e.jsx(R,{type:"primary",onClick:i.submit,style:{height:"40px",padding:"10px 16px",borderRadius:"8px",border:"none",backgroundColor:"#6941C6",color:"white",fontWeight:500,fontSize:"14px",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Add Exhibitor"})]}),styles:{body:{padding:"24px",maxHeight:"calc(100vh - 200px)",overflowY:"auto"},header:{borderBottom:"1px solid #E5E7EB",padding:"24px"},footer:{borderTop:"1px solid #E5E7EB",padding:0}},style:{top:20},children:e.jsx(A,{form:i,layout:"vertical",onFinish:O,requiredMark:!1,children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"32px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#101828",marginBottom:"24px"},children:"Company Information"}),e.jsx(A.Item,{name:"companyName",label:"Company Name",rules:[{required:!0,message:"Please enter company name"}],children:e.jsx(V,{})}),e.jsx(A.Item,{name:"address",label:"Address",rules:[{required:!0,message:"Please enter address"}],children:e.jsx(V.TextArea,{rows:3})}),e.jsx(A.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(V,{})}),e.jsx(A.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(V,{})}),e.jsx(A.Item,{name:"pinCode",label:"PIN Code",rules:[{required:!0,message:"Please enter PIN code"},{pattern:/^\d{6}$/,message:"Please enter a valid 6-digit PIN code"}],children:e.jsx(V,{})}),e.jsx(A.Item,{name:"status",label:"Status",initialValue:"active",children:e.jsxs(G,{children:[e.jsx(G.Option,{value:"active",children:e.jsx("div",{style:{display:"inline-flex",padding:"2px 8px",borderRadius:"16px",fontSize:"12px",fontWeight:500,backgroundColor:"#F6FEF9",color:"#039855",border:"1px solid #ABEFC6",alignItems:"center",height:"22px"},children:"ACTIVE"})}),e.jsx(G.Option,{value:"inactive",children:e.jsx("div",{style:{display:"inline-flex",padding:"2px 8px",borderRadius:"16px",fontSize:"12px",fontWeight:500,backgroundColor:"#FEF3F2",color:"#D92D20",border:"1px solid #FDA29B",alignItems:"center",height:"22px"},children:"INACTIVE"})})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#101828",marginBottom:"24px"},children:"Contact & Legal Information"}),e.jsx(A.Item,{name:"contactPerson",label:"Contact Person",rules:[{required:!0,message:"Please enter contact person"}],children:e.jsx(V,{})}),e.jsx(A.Item,{name:"contactEmail",label:"Email",rules:[{required:!0,message:"Please enter email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(V,{})}),e.jsx(A.Item,{name:"contactPhone",label:"Phone",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^\d{10}$/,message:"Please enter a valid 10-digit phone number"}],children:e.jsx(V,{})}),e.jsx(A.Item,{name:"panNumber",label:"PAN Number",rules:[{pattern:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,message:"Please enter a valid PAN number"}],children:e.jsx(V,{placeholder:"ABCDE1234F"})}),e.jsx(A.Item,{name:"gstNumber",label:"GST Number",rules:[{pattern:/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,message:"Please enter a valid GST number"}],children:e.jsx(V,{placeholder:"27AAPFU0939F1ZV"})})]})]})})})]})},xn=Object.freeze(Object.defineProperty({__proto__:null,default:Ut},Symbol.toStringTag,{value:"Module"}));export{Bt as _,xn as a,dn as b,Be as f,un as i};
