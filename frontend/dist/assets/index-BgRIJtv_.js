const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-core-L3PgNZOI.js","assets/vendor-react-core-B0uGejYc.js","assets/vendor-deps-DEOa4Mno.js","assets/vendor-ui-utils-CGs7t4cg.js","assets/vendor-canvas-CkLjwLEv.js","assets/vendor-antd-core-PMpIrrMR.js","assets/vendor-antd-icons-DK8C9GTH.js","assets/vendor-date-utils-3BRsAYU6.js","assets/vendor-redux-GR4hUpLs.js","assets/vendor-react-core-f_XpeFrr.css","assets/app-auth-Phoe3BrL.js","assets/vendor-http-t--hEgTQ.js","assets/app-admin-CoTkNL6t.js","assets/app-dashboard-OSBEAOF5.js","assets/app-dashboard-CUgo7HtP.css","assets/app-core-DU_-Labf.css"])))=>i.map(i=>d[i]);
import{f as Le,_ as Qe}from"./app-booking-XNzexAZp.js";import{j as e,r as u,u as ze,a as ge}from"./vendor-react-core-B0uGejYc.js";import{f as Fe}from"./app-exhibition-CF4MSB7I.js";import{u as ce,w as Ye,F as Ue}from"./vendor-export-B1ZyNMsV.js";import{d as Ve}from"./vendor-date-utils-3BRsAYU6.js";import{j as Ge}from"./app-core-L3PgNZOI.js";import{a as Y,T as ae,R as xe,C as D,b as ee,I as Ke,p as Je,S as G,B as te,D as We,h as k,E as se,e as ue,m as Xe,l as ye,r as Ze,t as Z,A as He,k as we,q as H}from"./vendor-antd-core-PMpIrrMR.js";import{j as et,w as tt,t as st,I as at,$ as Ae,X as it,aO as nt,z as rt,aq as lt,n as ot,d as dt,D as ct,aP as ut,aQ as pt}from"./vendor-antd-icons-DK8C9GTH.js";import"./app-invoice-DhWVRxD8.js";import"./vendor-redux-GR4hUpLs.js";import"./vendor-deps-DEOa4Mno.js";import"./vendor-ui-utils-CGs7t4cg.js";import"./vendor-canvas-CkLjwLEv.js";import"./app-dashboard-OSBEAOF5.js";import"./app-auth-Phoe3BrL.js";import"./vendor-http-t--hEgTQ.js";import"./app-admin-CoTkNL6t.js";import"./app-exhibitor-B2aggKuD.js";const{Title:mt,Text:V}=ae,{Option:$}=ee,{RangePicker:xt}=Je,ht=({exhibitionId:g,exhibitions:y,exhibitionsLoading:f,onExhibitionChange:A,typeFilter:O,setTypeFilter:T,bookingStatusFilter:p,setBookingStatusFilter:C,searchQuery:_,setSearchQuery:L,dateRange:q,setDateRange:Q,resetFilters:U})=>{var B,K;const P=j=>{L(j.target.value)},N=j=>{Q(j)};return e.jsxs(Y,{className:"amenities-filters",children:[e.jsx(mt,{level:5,className:"filter-heading",children:"Filters"}),e.jsxs(xe,{gutter:[16,16],children:[e.jsx(D,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Exhibition"}),e.jsx(ee,{placeholder:"Select an exhibition",style:{width:"100%"},loading:f,onChange:A,value:g,children:y.map(j=>e.jsx($,{value:j._id,children:j.name},j._id))})]})}),e.jsx(D,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Amenity Type"}),e.jsxs(ee,{mode:"multiple",placeholder:"Select types",style:{width:"100%"},value:O,onChange:T,maxTagCount:2,children:[e.jsx($,{value:"facility",children:"Facility"}),e.jsx($,{value:"service",children:"Service"}),e.jsx($,{value:"equipment",children:"Equipment"}),e.jsx($,{value:"other",children:"Other"})]})]})}),e.jsx(D,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Booking Status"}),e.jsxs(ee,{mode:"multiple",placeholder:"Select statuses",style:{width:"100%"},value:p,onChange:C,maxTagCount:2,children:[e.jsx($,{value:"confirmed",children:"Confirmed"}),e.jsx($,{value:"approved",children:"Approved"}),e.jsx($,{value:"pending",children:"Pending"}),e.jsx($,{value:"rejected",children:"Rejected"}),e.jsx($,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(D,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Search"}),e.jsx(Ke,{placeholder:"Search amenities",prefix:e.jsx(et,{}),value:_,onChange:P,allowClear:!0})]})}),e.jsx(D,{xs:24,md:16,lg:12,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(V,{className:"filter-label",children:"Booking Date Range"}),e.jsx(xt,{style:{width:"100%"},onChange:N,value:q})]})}),e.jsx(D,{xs:24,md:8,lg:12,children:e.jsx("div",{className:"filter-group",style:{display:"flex",justifyContent:"flex-end",alignItems:"flex-end",height:"100%"},children:e.jsxs(G,{children:[e.jsx(te,{icon:e.jsx(tt,{}),onClick:U,children:"Reset"}),e.jsx(te,{type:"primary",icon:e.jsx(st,{}),children:"Apply Filters"})]})})})]}),(O.length>0||p.length>0||_||q)&&e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"filter-divider"}),e.jsxs("div",{children:[e.jsx(V,{className:"filter-label",children:"Active Filters:"}),e.jsxs("div",{style:{marginTop:8},children:[O.map(j=>e.jsxs(k,{closable:!0,onClose:()=>T(O.filter(v=>v!==j)),className:`amenity-tag amenity-tag-${j}`,children:["Type: ",j]},`type-${j}`)),p.map(j=>e.jsxs(k,{closable:!0,onClose:()=>C(p.filter(v=>v!==j)),color:"blue",children:["Status: ",j]},`status-${j}`)),_&&e.jsxs(k,{closable:!0,onClose:()=>L(""),color:"purple",children:["Search: ",_]}),q&&e.jsxs(k,{closable:!0,onClose:()=>Q(null),color:"green",children:["Date Range: ",(B=q[0])==null?void 0:B.format("MMM DD, YYYY")," - ",(K=q[1])==null?void 0:K.format("MMM DD, YYYY")]})]})]})]})]})},{Text:Pt}=ae,ft=({basicAmenities:g,extraAmenities:y,bookedStalls:f,calculatedAmenities:A})=>e.jsxs(xe,{gutter:[24,24],children:[e.jsx(D,{xs:24,sm:12,md:6,children:e.jsxs(Y,{className:"stats-card stats-primary",bordered:!1,children:[e.jsx(at,{style:{fontSize:24,color:"#1890ff"}}),e.jsx("div",{className:"stats-value",children:g.length}),e.jsx("div",{className:"stats-label",children:"Basic Amenities"})]})}),e.jsx(D,{xs:24,sm:12,md:6,children:e.jsxs(Y,{className:"stats-card stats-secondary",bordered:!1,children:[e.jsx(Ae,{style:{fontSize:24,color:"#52c41a"}}),e.jsx("div",{className:"stats-value",children:y.length}),e.jsx("div",{className:"stats-label",children:"Extra Amenities"})]})}),e.jsx(D,{xs:24,sm:12,md:6,children:e.jsxs(Y,{className:"stats-card stats-tertiary",bordered:!1,children:[e.jsx(it,{style:{fontSize:24,color:"#fa8c16"}}),e.jsx("div",{className:"stats-value",children:f}),e.jsx("div",{className:"stats-label",children:"Booked Stalls"})]})}),e.jsx(D,{xs:24,sm:12,md:6,children:e.jsxs(Y,{className:"stats-card stats-quaternary",bordered:!1,children:[e.jsx(nt,{style:{fontSize:24,color:"#722ed1"}}),e.jsx("div",{className:"stats-value",children:A}),e.jsx("div",{className:"stats-label",children:"Calculated Amenities"})]})})]}),{Text:R,Title:Se}=ae,Ie=g=>{switch(g){case"facility":return{color:"#e6f7ff",borderColor:"#91d5ff",textColor:"#1890ff"};case"service":return{color:"#f6ffed",borderColor:"#b7eb8f",textColor:"#52c41a"};case"equipment":return{color:"#fff7e6",borderColor:"#ffd591",textColor:"#fa8c16"};default:return{color:"#f9f0ff",borderColor:"#d3adf7",textColor:"#722ed1"}}},pe=({title:g,amenities:y,loading:f,onExport:A,isDynamicColumns:O=!1,isCalculated:T=!1,exhibitionId:p,amenityViewType:C="all"})=>{const[_,L]=u.useState([]),[q,Q]=u.useState([]),[U,P]=u.useState(!1),N=u.useMemo(()=>!T||C==="all"?y:C==="basic"?y.filter(r=>r.hasOwnProperty("calculatedQuantity")||r.hasOwnProperty("perSqm")):C==="extra"?y.filter(r=>r.hasOwnProperty("rate")&&!r.hasOwnProperty("perSqm")):y,[y,T,C]);u.useEffect(()=>{if(!p){Q([]),P(!1);return}P(!0),setTimeout(()=>{P(!1)},500)},[p]);const B=()=>{const r=new Map;return N.forEach(s=>{var S,m;if(s.stallId&&s.stallNumber){r.has(s.stallId)||r.set(s.stallId,{key:s.stallId,companyName:s.exhibitorName||"Unknown",stallNumber:s.stallNumber,dimension:s.dimensions?`${s.dimensions.width}x${s.dimensions.height}m`:"-",stallType:s.stallType||"-",area:s.area||((S=s.dimensions)!=null&&S.width&&((m=s.dimensions)!=null&&m.height)?s.dimensions.width*s.dimensions.height:"-"),bookingDate:s.bookingDate?new Date(s.bookingDate).toISOString().slice(0,10):"-",status:s.bookingStatus||"-",amenities:{}});const x=r.get(s.stallId);if(s.hasOwnProperty("calculatedQuantity"))x.amenities[s.name]=s.calculatedQuantity;else if(s.hasOwnProperty("perSqm")){const w=typeof x.area=="number"?x.area:0,I=Math.floor(w/s.perSqm)*s.quantity;x.amenities[s.name]=I>0?I:s.quantity}else if(s.hasOwnProperty("booked")&&s.booked){let w=1;typeof s.quantity=="number"?w=s.quantity:typeof s.quantity=="string"&&(w=parseInt(s.quantity,10),isNaN(w)&&(w=1)),x.amenities[s.name]=w}else s.hasOwnProperty("rate")&&(x.amenities[s.name]=0)}}),Array.from(r.values()).filter(s=>Object.keys(s.amenities).length>0)},K=()=>{const r=new Set;return N.forEach(h=>{const s=S=>T?!0:g.toLowerCase().includes("basic")?S.hasOwnProperty("perSqm"):g.toLowerCase().includes("additional")||g.toLowerCase().includes("extra")?S.hasOwnProperty("rate"):!0;h.name&&s(h)&&r.add(h.name)}),Array.from(r)},j=()=>{const r=[{title:"Company Name",dataIndex:"companyName",key:"companyName",fixed:"left",width:180,render:m=>e.jsx(R,{strong:!0,children:m}),sorter:(m,x)=>m.companyName.localeCompare(x.companyName)},{title:"Stall No.",dataIndex:"stallNumber",key:"stallNumber",width:100,render:m=>e.jsx(ye,{status:"success",text:m}),sorter:(m,x)=>m.stallNumber.localeCompare(x.stallNumber)},{title:"Dimension",dataIndex:"dimension",key:"dimension",width:120},{title:"Stall Type",dataIndex:"stallType",key:"stallType",width:120},{title:"Area (SQM)",dataIndex:"area",key:"area",width:100,render:m=>typeof m=="number"?m.toFixed(2):m,sorter:(m,x)=>{const w=typeof m.area=="number"?m.area:0,I=typeof x.area=="number"?x.area:0;return w-I}}],s=K().map(m=>({title:m,dataIndex:["amenities",m],key:m,width:100,render:x=>x==null?"-":x===0?e.jsx(R,{type:"secondary",children:"0"}):x==="✓"?e.jsx(ye,{status:"success"}):e.jsx(R,{strong:!0,children:x}),sorter:(x,w)=>{const I=x.amenities[m]||0,W=w.amenities[m]||0;return I-W}})),S={title:"Actions",key:"actions",width:80,fixed:"right",render:(m,x)=>e.jsx(Ze,{overlay:e.jsxs(Z,{children:[e.jsx(Z.Item,{icon:e.jsx(ot,{}),children:"View Details"},"view"),e.jsx(Z.Item,{icon:e.jsx(dt,{}),children:"Edit"},"edit"),e.jsx(Z.Item,{icon:e.jsx(ct,{}),children:"Settings"},"settings")]}),trigger:["click"],children:e.jsx(te,{type:"text",icon:e.jsx(lt,{})})})};return[...r,...s,S]},v=r=>{L(r)},J=B(),he=r=>e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Se,{level:5,children:"Stall Details"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:[Object.entries(r).map(([h,s])=>["key","amenities"].includes(h)?null:e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs(R,{type:"secondary",style:{fontSize:"12px"},children:[h.charAt(0).toUpperCase()+h.slice(1).replace(/([A-Z])/g," $1"),":"]}),e.jsx("div",{children:e.jsx(R,{strong:!0,children:s==null?"-":typeof s=="object"?JSON.stringify(s):String(s)})})]},h)),e.jsxs("div",{style:{marginBottom:"8px",gridColumn:"1 / -1"},children:[e.jsx(R,{type:"secondary",style:{fontSize:"12px"},children:"Amenities:"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"4px"},children:Object.entries(r.amenities||{}).map(([h,s])=>e.jsxs(k,{color:"blue",children:[h,": ",s==="✓"?"Available":s]},h))})]})]})]});return e.jsx(Y,{className:"amenities-card",title:e.jsxs(G,{children:[e.jsx(Se,{level:5,style:{margin:0},children:g}),T&&e.jsxs(e.Fragment,{children:[e.jsx(k,{color:"green",children:"Calculated"}),C==="basic"&&e.jsx(k,{color:"blue",children:"Basic Amenities"}),C==="extra"&&e.jsx(k,{color:"purple",children:"Extra Amenities"}),C==="all"&&e.jsx(k,{color:"orange",children:"All Amenities"})]})]}),extra:e.jsx(G,{children:e.jsx(te,{type:"primary",icon:e.jsx(rt,{}),onClick:A,disabled:N.length===0,children:"Export"})}),children:N.length===0?e.jsx(se,{image:se.PRESENTED_IMAGE_SIMPLE,description:"No amenities data available"}):g.toLowerCase().includes("basic")&&!T?e.jsx(ue,{dataSource:N.map((r,h)=>({key:r._id||r.id||`basic-${h}`,...r})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(r,h)=>e.jsxs(G,{children:[e.jsx(R,{strong:!0,children:r}),e.jsx(k,{color:Ie(h.type).textColor,children:h.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Per SQM",dataIndex:"perSqm",key:"perSqm",render:r=>r?`1 per ${r} sqm`:"-"},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:r=>e.jsx(k,{color:"blue",children:r})}],loading:f,pagination:{pageSize:10},className:"amenities-table"}):(g.toLowerCase().includes("additional")||g.toLowerCase().includes("extra"))&&!T?e.jsx(ue,{dataSource:N.map((r,h)=>({key:r._id||r.id||`extra-${h}`,...r})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(r,h)=>e.jsxs(G,{children:[e.jsx(R,{strong:!0,children:r}),e.jsx(k,{color:Ie(h.type).textColor,children:h.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Rate",dataIndex:"rate",key:"rate",render:r=>e.jsxs(R,{style:{color:"#1890ff"},children:["₹",r.toLocaleString()]})}],loading:f,pagination:{pageSize:10},className:"amenities-table"}):J.length===0?e.jsx(Xe,{message:"No stall data available",description:"Amenities exist but could not be linked to stalls. Make sure stalls are booked and have amenities assigned.",type:"info",showIcon:!0}):e.jsx(ue,{dataSource:J,columns:j(),loading:f||U,pagination:{pageSize:10},className:"amenities-table",scroll:{x:"max-content"},expandable:{expandedRowKeys:_,onExpandedRowsChange:v,expandedRowRender:he}})})},{Title:jt,Text:Ne}=ae,{TabPane:Bt}=we,me=(g,y)=>{const f=ce.json_to_sheet(g),A=ce.book_new();ce.book_append_sheet(A,f,"Amenities");const O=Ye(A,{bookType:"xlsx",type:"array"}),T=new Blob([O],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ue.saveAs(T,`${y}.xlsx`)},Rt=()=>{const g=ze(),{message:y}=He.useApp(),{exhibitions:f,loading:A}=ge(a=>a.exhibition),{bookings:O,loading:T}=ge(a=>a.booking),[p,C]=u.useState(null),[_,L]=u.useState([]),[q,Q]=u.useState([]),[U,P]=u.useState([]),[N,B]=u.useState([]),[K,j]=u.useState(!1),[v,J]=u.useState({}),[he,r]=u.useState(!1),[h,s]=u.useState({current:1,pageSize:10,total:0}),[S,m]=u.useState([]),[x,w]=u.useState([]),[I,W]=u.useState(""),[z,fe]=u.useState(null),[Te,ie]=u.useState(0),[Ce,ne]=u.useState(0),[ve,Ee]=u.useState("basic"),[F,ke]=u.useState("basic");u.useEffect(()=>{g(Fe()),g(Le({page:1,limit:100}))},[g]);const De=async(a,i=1,o=10)=>{try{j(!0);const n=await Ge.get("/bookings",{params:{exhibitionId:a,includeDetails:!0,populate:"stallIds.stallTypeId",page:i,limit:o}});if(n&&n.data){const d=n.data.data.map(t=>{const l={...t};return l.stallIds&&(l.stallIds=l.stallIds.map(c=>(c.stallTypeId&&typeof c.stallTypeId=="object"&&(c.type=c.stallTypeId.name),c))),l}).filter(t=>t.exhibitionId._id===a&&["confirmed","approved"].includes(t.status));B(d),s({current:n.data.pagination.page,pageSize:n.data.pagination.limit,total:n.data.pagination.total})}else B([]),s({current:1,pageSize:10,total:0})}catch(n){console.error("Error fetching complete booking data:",n),B([]),s({current:1,pageSize:10,total:0})}finally{j(!1)}};u.useEffect(()=>{if(p&&f.length>0){const a=f.find(i=>i._id===p);a&&(L(a.basicAmenities||[]),Q(a.amenities||[]),De(p,h.current,h.pageSize))}else L([]),Q([]),P([]),ie(0),ne(0),B([])},[p,f]),u.useEffect(()=>{if(p&&f.length>0&&N.length>0){const a=f.find(i=>i._id===p);if(a){const i=N.flatMap(d=>d.stallIds.map(t=>{const l=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:v[t.stallTypeId])||"-";return{stallId:t._id,stallNumber:t.number,bookingId:d._id,exhibitorName:d.companyName,bookingDate:d.createdAt,dimensions:t.dimensions,area:t.dimensions.width*t.dimensions.height,status:d.status,stallType:l}})),o=N.flatMap(d=>!d.basicAmenities||d.basicAmenities.length===0?d.stallIds.flatMap(t=>{const l=t.dimensions.width*t.dimensions.height,c=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:v[t.stallTypeId])||"-";return(a.basicAmenities||[]).map(E=>{const b=Math.floor(l/E.perSqm)*E.quantity;return{...E,calculatedQuantity:b>0?b:E.quantity,stallId:t._id,stallNumber:t.number,bookingId:d._id,exhibitorId:d.exhibitorId||"",exhibitorName:d.companyName,bookingDate:d.createdAt,dimensions:t.dimensions,area:l,bookingStatus:d.status,stallType:c}})}):d.basicAmenities.flatMap(t=>d.stallIds.map(l=>{const c=l.type||(l.stallTypeId&&typeof l.stallTypeId=="object"?l.stallTypeId.name:v[l.stallTypeId])||"-";return{...t,stallId:l._id,stallNumber:l.number,bookingId:d._id,exhibitorId:d.exhibitorId||"",exhibitorName:d.companyName,bookingDate:d.createdAt,dimensions:l.dimensions,area:l.dimensions.width*l.dimensions.height,bookingStatus:d.status,stallType:c}}))),n=N.flatMap(d=>!d.extraAmenities||d.extraAmenities.length===0?[]:d.extraAmenities.flatMap(t=>d.stallIds.map(l=>{const c=l.type||(l.stallTypeId&&typeof l.stallTypeId=="object"?l.stallTypeId.name:v[l.stallTypeId])||"-";return{...t,booked:!0,stallId:l._id,stallNumber:l.number,bookingId:d._id,exhibitorId:d.exhibitorId||"",exhibitorName:d.companyName,bookingDate:d.createdAt,dimensions:l.dimensions,area:l.dimensions.width*l.dimensions.height,bookingStatus:d.status,stallType:c,isExtraAmenity:!0,quantity:t.quantity||1}})));let M=n;n.length===0&&a.amenities&&a.amenities.length>0&&(M=N.flatMap(t=>t.stallIds).flatMap((t,l)=>(a.amenities||[]).map((c,E)=>{var be;const b=N.find(de=>de.stallIds.some(Oe=>Oe._id===t._id)),X=(be=b==null?void 0:b.extraAmenities)==null?void 0:be.find(de=>de.name===c.name),je=!!X,Be=`sim-${l}-${E}-${Date.now()}`,Re=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:v[t.stallTypeId])||"-";return{...c,id:Be,booked:je,stallId:t._id,stallNumber:t.number,bookingId:(b==null?void 0:b._id)||"",exhibitorId:(b==null?void 0:b.exhibitorId)||"",exhibitorName:(b==null?void 0:b.companyName)||"Unknown",bookingDate:(b==null?void 0:b.createdAt)||new Date().toISOString(),dimensions:t.dimensions,area:t.dimensions.width*t.dimensions.height,bookingStatus:(b==null?void 0:b.status)||"approved",stallType:Re,isExtraAmenity:!0,quantity:je?(X==null?void 0:X.quantity)||1:0}}))),P([...o,...M]),ie(i.length),ne(o.length+M.length)}}else p&&f.length>0&&(P([]),ie(0),ne(0))},[p,f,N,v]);const re=u.useMemo(()=>{let a=_;if(S.length>0&&(a=a.filter(i=>S.includes(i.type))),I){const i=I.toLowerCase();a=a.filter(o=>o.name.toLowerCase().includes(i)||o.type.toLowerCase().includes(i)||o.description&&o.description.toLowerCase().includes(i))}return a},[_,S,I]),le=u.useMemo(()=>{let a=q;if(S.length>0&&(a=a.filter(i=>S.includes(i.type))),I){const i=I.toLowerCase();a=a.filter(o=>o.name.toLowerCase().includes(i)||o.type.toLowerCase().includes(i)||o.description&&o.description.toLowerCase().includes(i))}return a},[q,S,I]),oe=u.useMemo(()=>{let a=U;if(S.length>0&&(a=a.filter(i=>S.includes(i.type))),x.length>0&&(a=a.filter(i=>x.includes(i.bookingStatus))),I){const i=I.toLowerCase();a=a.filter(o=>o.name.toLowerCase().includes(i)||o.type.toLowerCase().includes(i)||o.description&&o.description.toLowerCase().includes(i)||o.stallNumber&&o.stallNumber.toLowerCase().includes(i)||o.exhibitorName&&o.exhibitorName.toLowerCase().includes(i))}if(z&&z[0]&&z[1]){const i=z[0].startOf("day"),o=z[1].endOf("day");a=a.filter(n=>{if(!n.bookingDate)return!1;const M=Ve(n.bookingDate);return M.isAfter(i)&&M.isBefore(o)})}return a},[U,S,x,I,z]),_e=()=>{m([]),w([]),W(""),fe(null)},qe=()=>{if(re.length===0){y.warning("No basic amenities to export");return}const a=re.map(n=>({Name:n.name,Type:n.type,Description:n.description||"","Per Sq. Meter":n.perSqm,"Quantity Per Unit":n.quantity,ID:n._id||n.id})),i=f.find(n=>n._id===p),o=`${(i==null?void 0:i.name)||"Exhibition"}_Basic_Amenities`;me(a,o),y.success("Basic amenities exported successfully")},Me=()=>{if(le.length===0){y.warning("No extra amenities to export");return}const a=le.map(n=>({Name:n.name,Type:n.type,Description:n.description||"",Rate:n.rate,ID:n._id||n.id})),i=f.find(n=>n._id===p),o=`${(i==null?void 0:i.name)||"Exhibition"}_Extra_Amenities`;me(a,o),y.success("Extra amenities exported successfully")},$e=()=>{if(oe.length===0){y.warning("No calculated amenities to export");return}const a=new Map;oe.filter(t=>F==="all"?!0:F==="basic"?t.hasOwnProperty("calculatedQuantity")||t.hasOwnProperty("perSqm"):F==="extra"?t.hasOwnProperty("rate")&&!t.hasOwnProperty("perSqm"):!0).forEach(t=>{if(t.stallId&&t.stallNumber){if(!a.has(t.stallId)){const c=t.dimensions||{width:0,height:0},E=t.area||(c.width&&c.height?c.width*c.height:0);a.set(t.stallId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,Dimension:c?`${c.width}x${c.height}m`:"-","Stall Type":t.stallType||"-","Area (SQM)":typeof E=="number"?E:0,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-"})}const l=a.get(t.stallId);if(t.hasOwnProperty("calculatedQuantity"))l[t.name]=t.calculatedQuantity;else if(t.hasOwnProperty("perSqm")){const c=typeof l["Area (SQM)"]=="number"?l["Area (SQM)"]:0,E=Math.floor(c/t.perSqm)*t.quantity;l[t.name]=E>0?E:t.quantity}else if(t.hasOwnProperty("booked")&&t.booked){let c=1;typeof t.quantity=="number"?c=t.quantity:typeof t.quantity=="string"&&(c=parseInt(t.quantity,10),isNaN(c)&&(c=1)),l[t.name]=c}else t.hasOwnProperty("rate")&&(l[t.name]=0)}});const o=Array.from(a.values()),n=f.find(t=>t._id===p),M=F==="basic"?"Basic":F==="extra"?"Extra":"All",d=`${(n==null?void 0:n.name)||"Exhibition"}_${M}_Calculated_Amenities`;me(o,d),y.success(`${M} calculated amenities exported successfully`)},Pe=async()=>{try{r(!0);const{default:a}=await Qe(async()=>{const{default:o}=await import("./app-core-L3PgNZOI.js").then(n=>n.C);return{default:o}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),i=await a.getStallTypes();if(i&&i.data){const o={};i.data.forEach(n=>{n._id&&(o[n._id]=n.name)}),J(o)}}catch(a){console.error("Error fetching stall types:",a)}finally{r(!1)}};return u.useEffect(()=>{p&&Pe()},[p]),e.jsxs("div",{className:"amenities-container",children:[e.jsxs("div",{className:"amenities-header",children:[e.jsx(jt,{level:4,className:"amenities-title",children:"Amenities Management"}),e.jsx(Ne,{type:"secondary",children:"View, filter, and export amenities data. See calculated amenities for booked stalls."})]}),e.jsx(ht,{exhibitionId:p,exhibitions:f,exhibitionsLoading:A,onExhibitionChange:C,typeFilter:S,setTypeFilter:m,bookingStatusFilter:x,setBookingStatusFilter:w,searchQuery:I,setSearchQuery:W,dateRange:z,setDateRange:fe,resetFilters:_e}),p&&e.jsx("div",{style:{marginBottom:24},children:e.jsx(ft,{basicAmenities:_,extraAmenities:q,bookedStalls:Te,calculatedAmenities:Ce})}),p?e.jsx(we,{activeKey:ve,onChange:Ee,className:"amenities-tabs",items:[{key:"basic",label:e.jsxs("span",{children:[e.jsx(ut,{}),"Basic Amenities"]}),children:e.jsx(pe,{title:"Basic Amenities",amenities:re,loading:A,onExport:qe,exhibitionId:p})},{key:"extra",label:e.jsxs("span",{children:[e.jsx(Ae,{}),"Extra Amenities"]}),children:e.jsx(pe,{title:"Additional Amenities",amenities:le,loading:A,onExport:Me,exhibitionId:p})},{key:"calculated",label:e.jsxs("span",{children:[e.jsx(pt,{}),"Calculated Amenities"]}),children:e.jsxs(e.Fragment,{children:[e.jsx(xe,{gutter:[0,16],children:e.jsx(D,{span:24,children:e.jsx(Y,{className:"filter-card",children:e.jsxs(G,{children:[e.jsx(Ne,{strong:!0,children:"View: "}),e.jsxs(H.Group,{value:F,onChange:a=>ke(a.target.value),optionType:"button",buttonStyle:"solid",children:[e.jsx(H.Button,{value:"basic",children:"Basic Amenities"}),e.jsx(H.Button,{value:"extra",children:"Extra Amenities"}),e.jsx(H.Button,{value:"all",children:"All Amenities"})]})]})})})}),e.jsx(pe,{title:"Calculated Amenities",amenities:oe,loading:A,onExport:$e,isDynamicColumns:!0,isCalculated:!0,exhibitionId:p,amenityViewType:F})]})}]}):e.jsx("div",{style:{marginTop:24,textAlign:"center",padding:48,background:"#fff",borderRadius:8},children:e.jsx(se,{description:"Please select an exhibition to view amenities",image:se.PRESENTED_IMAGE_SIMPLE})})]})};export{Rt as default};
