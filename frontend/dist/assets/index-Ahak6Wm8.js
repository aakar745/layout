import{j as e,d as J,g as de,h as me,c as ue,i as k,k as R,l as xe}from"./index-aoH9EzMk.js";import{ag as N,A as X,l as E,T as _,h as F,D as L,aR as f,aO as O,Z as d,F as W,p as I,r as x,Y as j,aF as M,aH as ee,i as h,a9 as Q,aa as A,ab as C,ac as q,a0 as he,bs as Z,S as y,f as T,bQ as je,o as pe,w as se,aS as ge,B as G,n as fe,bu as ve,bC as ye,j as we,aW as be}from"./vendor-Be5M1UDi.js";import"./apis-CU9I9MMq.js";import"./canvas-C-A9eff5.js";const{Text:Ae}=_,Ce=({visible:c,user:t,onClose:i})=>{if(!t)return null;const o=r=>typeof r=="string"?r:r&&typeof r=="object"&&r.name?r.name:"Unknown";return e.jsxs(N,{title:"User Details",open:c,onCancel:i,footer:null,width:600,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:20},children:[e.jsx(X,{size:64,icon:e.jsx(E,{}),style:{backgroundColor:"#1677ff"}}),e.jsxs("div",{style:{marginLeft:20},children:[e.jsx(Ae,{style:{fontSize:20,fontWeight:"bold"},children:t.name||t.username}),e.jsxs("div",{children:[e.jsx(F,{color:t.isActive?"success":"default",children:t.isActive?"Active":"Inactive"}),e.jsx(F,{color:"blue",children:o(t.role)})]})]})]}),e.jsx(L,{}),e.jsxs(f,{bordered:!0,column:1,children:[e.jsx(f.Item,{label:"Username",children:t.username}),e.jsx(f.Item,{label:"Email",children:t.email}),e.jsx(f.Item,{label:"Role",children:o(t.role)}),e.jsx(f.Item,{label:"Status",children:e.jsx(F,{color:t.isActive?"success":"default",children:t.isActive?"Active":"Inactive"})}),e.jsx(f.Item,{label:"Created At",children:new Date(t.createdAt).toLocaleString()}),e.jsx(f.Item,{label:"Updated At",children:new Date(t.updatedAt).toLocaleString()})]})]})},{Option:P}=M,{Text:Se}=_,Ie=({visible:c,user:t,onClose:i,onSuccess:o})=>{const{message:r}=O.useApp(),[u]=d.useForm(),m=W(),{roles:v,loading:w}=I(l=>l.role),{loading:g}=I(l=>l.user);x.useEffect(()=>{c&&t&&u.setFieldsValue({username:t.username,name:t.name||"",email:t.email,role:typeof t.role=="object"?t.role._id:t.role,isActive:t.isActive})},[c,t,u]),x.useEffect(()=>{c&&m(J())},[c,m]);const n=async()=>{if(t)try{const l=await u.validateFields(),p={username:l.username,name:l.name,email:l.email,role:l.role,isActive:l.isActive};l.password&&l.password.trim()!==""&&(p.password=l.password),m(de({id:t._id,userData:p})).unwrap().then(()=>{r.success("User updated successfully"),o(),i()}).catch(V=>{r.error(`Failed to update user: ${V}`)})}catch(l){console.error("Validation error:",l)}};return t?e.jsx(N,{title:"Edit User",open:c,onCancel:i,width:600,footer:[e.jsx(h,{onClick:i,children:"Cancel"},"cancel"),e.jsx(h,{type:"primary",loading:g,onClick:n,children:"Update User"},"submit")],children:e.jsxs(d,{form:u,layout:"vertical",children:[e.jsx(d.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter a username"}],children:e.jsx(j,{placeholder:"Username"})}),e.jsx(d.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:e.jsx(j,{placeholder:"Full name"})}),e.jsx(d.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter an email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(j,{placeholder:"Email address"})}),e.jsx(L,{children:e.jsx(Se,{type:"secondary",children:"Change Password (Optional)"})}),e.jsx(d.Item,{name:"password",label:"New Password",extra:"Leave blank to keep the current password",rules:[{min:6,message:"Password must be at least 6 characters"}],children:e.jsx(j.Password,{placeholder:"New password (optional)"})}),e.jsx(L,{}),e.jsx(d.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:e.jsx(M,{loading:w,children:v.length>0?v.map(l=>e.jsx(P,{value:l._id,children:l.name},l._id)):e.jsxs(e.Fragment,{children:[e.jsx(P,{value:"admin",children:"Admin"}),e.jsx(P,{value:"manager",children:"Manager"}),e.jsx(P,{value:"agent",children:"Agent"})]})})}),e.jsx(d.Item,{name:"isActive",label:"Status",valuePropName:"checked",children:e.jsx(ee,{checkedChildren:"Active",unCheckedChildren:"Inactive"})})]})}):null},{Option:$}=M,{Text:Le}=_,Ue=({visible:c,onClose:t,onSuccess:i})=>{const{message:o}=O.useApp(),[r]=d.useForm(),u=W(),{roles:m,loading:v}=I(n=>n.role),{loading:w}=I(n=>n.user);x.useEffect(()=>{c&&u(J())},[c,u]),x.useEffect(()=>{c&&r.resetFields()},[c,r]);const g=async()=>{try{const n=await r.validateFields(),l={username:n.username,name:n.name,email:n.email,password:n.password,role:n.role,isActive:n.status};u(me(l)).unwrap().then(p=>{o.success("User created successfully"),r.resetFields(),i(),t()}).catch(p=>{o.error(`Failed to create user: ${p}`)})}catch(n){console.error("Validation error:",n)}};return e.jsx(N,{title:"Create New User",open:c,onCancel:t,width:600,footer:[e.jsx(h,{onClick:t,children:"Cancel"},"cancel"),e.jsx(h,{type:"primary",loading:w,onClick:g,children:"Create User"},"submit")],children:e.jsxs(d,{form:r,layout:"vertical",requiredMark:!1,children:[e.jsx(d.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter a username"}],children:e.jsx(j,{placeholder:"Username"})}),e.jsx(d.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter the user name"}],children:e.jsx(j,{placeholder:"Full name"})}),e.jsx(d.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(j,{placeholder:"Email address"})}),e.jsx(d.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please enter password"},{min:6,message:"Password must be at least 6 characters"}],children:e.jsx(j.Password,{placeholder:"Enter password"})}),e.jsx(L,{}),e.jsx(d.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:e.jsx(M,{placeholder:"Select role",loading:v,children:m.length>0?m.map(n=>e.jsx($,{value:n._id,children:n.name},n._id)):e.jsxs(e.Fragment,{children:[e.jsx($,{value:"admin",children:"Admin"}),e.jsx($,{value:"manager",children:"Manager"}),e.jsx($,{value:"agent",children:"Agent"})]})})}),e.jsx(d.Item,{name:"status",label:"Status",valuePropName:"checked",initialValue:!0,children:e.jsx(ee,{checkedChildren:"Active",unCheckedChildren:"Inactive"})})]})})},{Title:ke,Paragraph:Re,Text:S}=_,{TabPane:B}=se,{confirm:Te}=N;function Ne(){const{message:c,notification:t}=O.useApp(),i=W(),{users:o,loading:r,error:u,selectedUser:m}=I(s=>s.user),[v,w]=x.useState(""),[g,n]=x.useState("all"),[l,p]=x.useState(!1),[V,K]=x.useState(!1),[ae,Y]=x.useState(!1),{hasPermission:D}=ue();x.useEffect(()=>{i(k())},[i]),x.useEffect(()=>{u&&t.error({message:"Error",description:u})},[u,t]),x.useEffect(()=>{m||(p(!1),K(!1))},[m]);const te=(s,a)=>{Te({title:"Are you sure you want to delete this user?",icon:e.jsx(be,{}),content:`This will permanently delete ${a}'s account. This action cannot be undone.`,okText:"Yes, delete",okType:"danger",cancelText:"Cancel",onOk:()=>{i(xe(s)).unwrap().then(()=>{c.success(`${a} has been deleted successfully.`)}).catch(U=>{c.error(`Failed to delete user: ${U}`)})}})},re=s=>{i(R(s)),p(!0)},le=s=>{i(R(s)),K(!0)},ne=()=>{Y(!0)},ie=[{title:"User",key:"user",render:(s,a)=>e.jsxs(y,{children:[e.jsx(X,{icon:e.jsx(E,{}),size:"large"}),e.jsxs(y,{direction:"vertical",size:0,children:[e.jsx(S,{strong:!0,children:a.name||a.username}),e.jsx(S,{type:"secondary",style:{fontSize:"12px"},children:a.email})]})]})},{title:"Role",dataIndex:"role",key:"role",render:s=>{const a=b(s);let U=a.toLowerCase()==="admin"||a.toLowerCase()==="administrator"?"#1677ff":a.toLowerCase()==="manager"?"#52c41a":"#faad14";return e.jsx(F,{color:U,style:{fontWeight:500,borderRadius:"4px"},children:a.toUpperCase()})},filters:[{text:"Admin",value:"admin"},{text:"Manager",value:"manager"},{text:"Agent",value:"agent"}],onFilter:(s,a)=>b(a.role).toLowerCase().indexOf(s.toLowerCase())===0},{title:"Status",key:"status",render:(s,a)=>e.jsx(y,{children:a.isActive?e.jsx(G,{status:"success",text:e.jsx(S,{style:{color:"#52c41a"},children:"Active"})}):e.jsx(G,{status:"default",text:e.jsx(S,{type:"secondary",children:"Inactive"})})}),filters:[{text:"Active",value:!0},{text:"Inactive",value:!1}],onFilter:(s,a)=>a.isActive===s},{title:"Last Active",key:"lastLogin",render:(s,a)=>e.jsxs(y,{children:[e.jsx(fe,{style:{color:"#8c8c8c"}}),e.jsx(S,{type:"secondary",children:a.lastLogin||"Never"})]})},{title:"Action",key:"action",render:(s,a)=>e.jsxs(y,{size:"small",children:[D("users_view")&&e.jsx(T,{title:"View details",children:e.jsx(h,{type:"text",icon:e.jsx(ve,{}),size:"small",onClick:()=>re(a)})}),D("users_edit")&&e.jsx(T,{title:"Edit user",children:e.jsx(h,{type:"text",icon:e.jsx(ye,{}),size:"small",onClick:()=>le(a)})}),D("users_delete")&&e.jsx(T,{title:"Delete user",children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(we,{}),size:"small",onClick:()=>te(a._id,a.name||a.username)})})]})}],H=s=>s.isActive?"active":"inactive",oe=o.filter(s=>(g==="all"||g==="active"&&H(s)==="active"||g==="inactive"&&H(s)==="inactive")&&Object.values(s).some(a=>typeof a=="string"&&a.toLowerCase().includes(v.toLowerCase()))),b=s=>typeof s=="string"?s:s&&typeof s=="object"&&s.name?s.name:"Unknown",ce={admin:o.filter(s=>{const a=b(s.role).toLowerCase();return a==="admin"||a==="administrator"}).length,manager:o.filter(s=>b(s.role).toLowerCase()==="manager").length,agent:o.filter(s=>b(s.role).toLowerCase()==="agent").length},z={active:o.filter(s=>s.isActive).length,inactive:o.filter(s=>!s.isActive).length};return e.jsxs("div",{style:{padding:"12px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(ke,{level:2,children:"User Management"}),e.jsx(Re,{children:"Manage user accounts, permissions, and access control."})]}),e.jsxs(Q,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(A,{xs:24,sm:8,children:e.jsx(C,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(q,{title:"Total Users",value:o.length,prefix:e.jsx(E,{}),valueStyle:{color:"#1677ff"},loading:r})})}),e.jsx(A,{xs:24,sm:8,children:e.jsx(C,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(q,{title:"Active Users",value:z.active,prefix:e.jsx(he,{}),valueStyle:{color:"#52c41a"},loading:r})})}),e.jsx(A,{xs:24,sm:8,children:e.jsx(C,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(q,{title:"Admin Users",value:ce.admin,prefix:e.jsx(E,{}),valueStyle:{color:"#faad14"},loading:r})})})]}),e.jsx(C,{style:{marginBottom:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsxs(Q,{gutter:[16,16],justify:"space-between",align:"middle",children:[e.jsx(A,{xs:24,md:12,children:e.jsx(j,{placeholder:"Search users...",prefix:e.jsx(Z,{style:{color:"rgba(0,0,0,.45)"}}),onChange:s=>w(s.target.value),allowClear:!0,size:"middle"})}),e.jsx(A,{xs:24,md:12,style:{textAlign:"right"},children:e.jsxs(y,{wrap:!0,children:[e.jsx(T,{title:"Refresh data",children:e.jsx(h,{icon:r?e.jsx(je,{}):e.jsx(Z,{}),onClick:()=>i(k()),disabled:r,children:"Refresh"})}),e.jsx(h,{type:"primary",icon:e.jsx(pe,{}),onClick:ne,children:"Add User"})]})})]})}),e.jsxs(C,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:[e.jsxs(se,{defaultActiveKey:"all",onChange:n,tabBarStyle:{marginBottom:24},children:[e.jsx(B,{tab:`All Users (${o.length})`},"all"),e.jsx(B,{tab:`Active (${z.active})`},"active"),e.jsx(B,{tab:`Inactive (${z.inactive})`},"inactive")]}),e.jsx(ge,{columns:ie,dataSource:oe,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(s,a)=>`${a[0]}-${a[1]} of ${s} users`},loading:r})]}),e.jsx(Ce,{user:o.find(s=>s._id===(m==null?void 0:m._id))||null,visible:l,onClose:()=>i(R(null))}),e.jsx(Ie,{user:o.find(s=>s._id===(m==null?void 0:m._id))||null,visible:V,onClose:()=>i(R(null)),onSuccess:()=>i(k())}),e.jsx(Ue,{visible:ae,onClose:()=>Y(!1),onSuccess:()=>i(k())})]})}export{Ne as default};
