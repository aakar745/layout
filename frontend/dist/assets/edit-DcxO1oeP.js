import{j as r,F as l,I as q,L as R}from"./index-BfjvBafq.js";import{l as j,k as F,u as B,j as w,i as z,r as b,N as G}from"./vendor-react-BNeW3y6d.js";import{E as W}from"./ExhibitionForm-BaDH-KI9.js";import{ah as O,a7 as f,d as C}from"./vendor-antd-sZZBSykP.js";import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";import"./vendor-canvas-BRbMLhVA.js";const Z=()=>{var h;const{message:a}=O.useApp(),{id:U}=j(),o=(h=F().state)==null?void 0:h.exhibitionId,c=B(),p=w(),{currentExhibition:t,loading:S,error:d}=z(e=>e.exhibition),[N,k]=b.useState(!1);b.useEffect(()=>{(async()=>{if(!o){a.error("Exhibition ID not found"),c("/exhibition");return}try{await p(q(o)).unwrap()}catch(m){a.error(m.message||"Failed to fetch exhibition"),c("/exhibition")}finally{k(!0)}})()},[o,p,a,c]),b.useEffect(()=>{d&&a.error(d)},[d,a]);const E=async e=>{var m,u,y,A;if(!(!o||!t))try{const[s,x]=e.dateRange||[null,null],g=(i,P)=>!i||!Array.isArray(i)?[]:i.filter(n=>n&&n.type&&n.name&&n.description&&(P==="extra"?typeof n.rate=="number"&&n.rate>=0:typeof n.perSqm=="number"&&n.perSqm>0&&typeof n.quantity=="number"&&n.quantity>0)),D=g(e.amenities,"extra"),L=g(e.basicAmenities,"basic"),T={name:e.name,description:e.description,venue:e.venue,startDate:s?s.toISOString():t.startDate,endDate:x?x.toISOString():t.endDate,status:e.status,isActive:e.isActive,invoicePrefix:e.invoicePrefix,dimensions:t.dimensions,stallRates:((m=e.stallRates)==null?void 0:m.map(i=>({stallTypeId:i.stallTypeId,rate:i.rate})))||[],taxConfig:((u=e.taxConfig)==null?void 0:u.map(i=>({name:i.name,rate:i.rate,isActive:i.isActive})))||[],discountConfig:((y=e.discountConfig)==null?void 0:y.map(i=>({name:i.name,type:i.type,value:i.value,isActive:i.isActive})))||[],publicDiscountConfig:((A=e.publicDiscountConfig)==null?void 0:A.map(i=>({name:i.name,type:i.type,value:i.value,isActive:i.isActive})))||[],companyName:e.companyName,companyContactNo:e.companyContactNo,companyEmail:e.companyEmail,companyAddress:e.companyAddress,companyWebsite:e.companyWebsite,companyPAN:e.companyPAN,companyGST:e.companyGST,companySAC:e.companySAC,companyCIN:e.companyCIN,termsAndConditions:e.termsAndConditions,piInstructions:e.piInstructions,bankName:e.bankName,bankBranch:e.bankBranch,bankIFSC:e.bankIFSC,bankAccountName:e.bankAccountName,bankAccount:e.bankAccount,headerTitle:e.headerTitle,headerSubtitle:e.headerSubtitle,headerDescription:e.headerDescription,headerLogo:e.headerLogo,sponsorLogos:e.sponsorLogos,footerText:e.footerText,footerLogo:e.footerLogo,contactEmail:e.contactEmail,contactPhone:e.contactPhone,footerLinks:e.footerLinks||[],amenities:D.map(i=>({type:i.type,name:i.name.trim(),description:i.description.trim(),rate:Number(i.rate)})),basicAmenities:L.map(i=>({type:i.type,name:i.name.trim(),description:i.description.trim(),perSqm:Number(i.perSqm),quantity:Number(i.quantity)})),specialRequirements:e.specialRequirements,letterSettings:e.letterSettings};await p(R({id:o,data:T})).unwrap(),a.success("Exhibition updated successfully"),c(l(t),{state:{exhibitionId:o}})}catch(s){console.error("Exhibition update error:",s),a.error(s.message||"Failed to update exhibition")}};if(!N)return r.jsx(f,{loading:!0});if(!o)return r.jsx(G,{to:"/exhibition",replace:!0});if(S||!t)return r.jsx(f,{loading:!0});const I={name:t.name,description:t.description,venue:t.venue,dateRange:[C(t.startDate),C(t.endDate)],status:t.status,isActive:t.isActive,invoicePrefix:t.invoicePrefix,stallRates:t.stallRates||[],taxConfig:t.taxConfig||[],discountConfig:t.discountConfig||[],publicDiscountConfig:t.publicDiscountConfig||[],companyName:t.companyName,companyContactNo:t.companyContactNo,companyEmail:t.companyEmail,companyAddress:t.companyAddress,companyWebsite:t.companyWebsite,companyPAN:t.companyPAN,companyGST:t.companyGST,companySAC:t.companySAC,companyCIN:t.companyCIN,termsAndConditions:t.termsAndConditions,piInstructions:t.piInstructions,bankName:t.bankName,bankBranch:t.bankBranch,bankIFSC:t.bankIFSC,bankAccountName:t.bankAccountName,bankAccount:t.bankAccount,headerTitle:t.headerTitle,headerSubtitle:t.headerSubtitle,headerDescription:t.headerDescription,headerLogo:t.headerLogo,sponsorLogos:t.sponsorLogos||[],footerText:t.footerText,footerLogo:t.footerLogo,contactEmail:t.contactEmail,contactPhone:t.contactPhone,footerLinks:t.footerLinks||[],amenities:t.amenities||[],basicAmenities:t.basicAmenities||[],specialRequirements:t.specialRequirements,letterSettings:t.letterSettings};return r.jsx(f,{title:"Edit Exhibition",extra:r.jsx("a",{onClick:()=>c(l(t),{state:{exhibitionId:o}}),children:"Back to Details"}),children:r.jsx(W,{initialValues:I,onSubmit:E,submitText:"Update Exhibition"})})};export{Z as default};
