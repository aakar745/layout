import{a as I,j as e}from"./index-BRKtYmDF.js";import{r as i,u as Se}from"./vendor-react-BNeW3y6d.js";import{u as T,w as fe,r as be}from"./vendor-export-bOGzw8O3.js";import{N as r,X as n,T as ve,a7 as M,a5 as w,a6 as c,a4 as B,K as E,bb as Ce,S as g,c as d,b5 as we,a9 as G,W as ee,am as Ee,Z as _,$ as S,aa as Ie,b0 as Ne,ae as Ae,C as Fe,b as te,d as ke,b6 as ze,bw as qe,R as $e}from"./vendor-antd-Dz3j4xaK.js";import"./vendor-utils-CsjRLf7T.js";import"./vendor-styling-BEMjND7I.js";import"./vendor-canvas-BRbMLhVA.js";const Pe=async(h,l)=>{const m=new URLSearchParams;return l!=null&&l.page&&m.append("page",l.page.toString()),l!=null&&l.limit&&m.append("limit",l.limit.toString()),l!=null&&l.search&&m.append("search",l.search),(l==null?void 0:l.active)!==void 0&&m.append("active",l.active.toString()),(await I.get(`/service-charge-stalls/${h}?${m}`)).data},Te=async(h,l)=>(await I.post(`/service-charge-stalls/${h}`,l)).data.data,De=async(h,l)=>(await I.put(`/service-charge-stalls/stall/${h}`,l)).data.data,Re=async h=>{await I.delete(`/service-charge-stalls/stall/${h}`)},Me=async(h,l)=>(await I.post(`/service-charge-stalls/${h}/import`,l)).data.data,{Option:V}=B,{Title:D,Text:o}=ve,Ke=()=>{var K,X,Z;const[h,l]=i.useState([]),[m,H]=i.useState([]),[x,se]=i.useState(""),[le,U]=i.useState(!1),[re,N]=i.useState(!1),[ae,A]=i.useState(!1),[ie,F]=i.useState(!1),[L,k]=i.useState(null),[W,z]=i.useState(null),[u,q]=i.useState([]),[ne,Y]=i.useState(!1),[_e,Ve]=i.useState(!1),[f,O]=i.useState({search:"",active:void 0}),[j,J]=i.useState({current:1,pageSize:10,total:0});Se();const[$]=r.useForm(),[b]=r.useForm(),[R]=r.useForm();i.useEffect(()=>{oe()},[]),i.useEffect(()=>{x&&v()},[x,j.current,j.pageSize,f]);const oe=async()=>{try{const t=await fetch("/api/exhibitions",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const s=await t.json(),a=Array.isArray(s)?s:s.data||[];H(a),a.length===0&&console.warn("No exhibitions found. User may not have access to any exhibitions.")}else console.error("Failed to fetch exhibitions:",t.status,t.statusText),n.error("Failed to load exhibitions. Please check your permissions.")}catch(t){console.error("Error fetching exhibitions:",t),n.error("Error loading exhibitions")}},v=async()=>{if(x){U(!0);try{const t=await Pe(x,{page:j.current,limit:j.pageSize,search:f.search||void 0,active:f.active});l(t.data),J(s=>{var a;return{...s,total:((a=t.pagination)==null?void 0:a.total)||0}})}catch(t){console.error("Error fetching stalls:",t),n.error("Failed to fetch stalls")}finally{U(!1)}}},ce=async t=>{try{await Te(x,t),n.success("Service charge stall created successfully"),N(!1),$.resetFields(),v()}catch(s){console.error("Error creating stall:",s),n.error("Failed to create stall")}},de=async t=>{if(L)try{await De(L._id,t),n.success("Service charge stall updated successfully"),A(!1),b.resetFields(),k(null),v()}catch(s){console.error("Error updating stall:",s),n.error("Failed to update stall")}},he=async t=>{try{await Re(t),n.success("Service charge stall deleted successfully"),v()}catch(s){console.error("Error deleting stall:",s),n.error("Failed to delete stall")}},me=t=>{z(t);const s=new FileReader;return s.onload=a=>{var y;try{const C=(y=a.target)==null?void 0:y.result,P=be(C,{type:"binary"}),je=P.SheetNames[0],ye=P.Sheets[je],Q=T.sheet_to_json(ye).map(p=>({stallNumber:p["Stall Number"]||p.stallNumber||"",exhibitorCompanyName:p["Exhibitor Company Name"]||p.exhibitorCompanyName||"",stallArea:parseFloat(p["Stall Area (sqm)"]||p.stallArea||"0"),dimensions:p.Width&&p.Height?{width:parseFloat(p.Width||"0"),height:parseFloat(p.Height||"0")}:void 0}));q(Q),n.success(`File uploaded successfully. Found ${Q.length} records.`)}catch(C){console.error("Error reading file:",C),n.error("Error reading file. Please make sure it's a valid Excel file.")}},s.readAsBinaryString(t),!1},xe=async()=>{var t,s;if(!u.length){n.error("Please upload a file first");return}Y(!0);try{const a=await Me(x,{stalls:u});n.success(`Successfully imported ${a.imported} service charge stalls`),F(!1),z(null),q([]),R.resetFields(),v()}catch(a){if(console.error("Error importing stalls:",a),a.message.includes("Validation failed"))try{const y=JSON.parse(a.message.split("Validation failed")[1]);n.error(e.jsxs("div",{children:[e.jsx("p",{children:"Import failed with validation errors:"}),e.jsxs("ul",{style:{margin:0,paddingLeft:16},children:[(t=y.errors)==null?void 0:t.slice(0,5).map((C,P)=>e.jsx("li",{children:C},P)),((s=y.errors)==null?void 0:s.length)>5&&e.jsxs("li",{children:["... and ",y.errors.length-5," more"]})]})]}))}catch{n.error("Import failed with validation errors")}else n.error("Error importing stalls")}finally{Y(!1)}},pe=()=>{const t=[{"Stall Number":"A001","Exhibitor Company Name":"ABC Company Ltd","Stall Area (sqm)":30,Width:5,Height:6},{"Stall Number":"B002","Exhibitor Company Name":"XYZ Exhibition Services","Stall Area (sqm)":60,Width:10,Height:6}],s=T.book_new(),a=T.json_to_sheet(t);T.book_append_sheet(s,a,"Service Charge Stalls"),fe(s,"service-charge-stalls-template.xlsx")},ue=t=>{k(t),b.setFieldsValue({stallNumber:t.stallNumber,exhibitorCompanyName:t.exhibitorCompanyName,stallArea:t.stallArea,dimensions:t.dimensions,isActive:t.isActive}),A(!0)},ge=[{title:"Stall Number",dataIndex:"stallNumber",key:"stallNumber",width:120,render:(t,s)=>e.jsxs("div",{children:[e.jsx(o,{strong:!0,style:{fontSize:"14px"},children:t}),!s.isActive&&e.jsx("div",{children:e.jsx(te,{color:"red",children:"Inactive"})})]})},{title:"Exhibitor Company",dataIndex:"exhibitorCompanyName",key:"exhibitorCompanyName",width:200,render:t=>e.jsx(o,{style:{fontSize:"13px"},children:t})},{title:"Stall Area",dataIndex:"stallArea",key:"stallArea",width:100,align:"center",render:t=>e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsx(o,{strong:!0,style:{fontSize:"14px"},children:t}),e.jsx("div",{style:{fontSize:"11px",color:"#666"},children:"sqm"})]})},{title:"Dimensions",key:"dimensions",width:120,align:"center",render:t=>e.jsx("div",{children:t.dimensions?e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(o,{style:{fontSize:"13px"},children:[t.dimensions.width," Ã— ",t.dimensions.height]}),e.jsx("div",{style:{fontSize:"11px",color:"#666"},children:"meters"})]}):e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:"-"})})},{title:"Status",dataIndex:"isActive",key:"isActive",width:100,align:"center",render:t=>e.jsx(te,{color:t?"green":"red",children:t?"Active":"Inactive"})},{title:"Created",dataIndex:"createdAt",key:"createdAt",width:120,render:t=>e.jsx(o,{style:{fontSize:"12px"},children:ke(t).format("DD/MM/YYYY")})},{title:"Actions",key:"actions",width:120,align:"center",render:t=>e.jsxs(g,{children:[e.jsx(d,{type:"text",icon:e.jsx(ze,{}),onClick:()=>ue(t),size:"small"}),e.jsx(qe,{title:"Are you sure you want to delete this stall?",onConfirm:()=>he(t._id),okText:"Yes",cancelText:"No",children:e.jsx(d,{type:"text",icon:e.jsx($e,{}),danger:!0,size:"small"})})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx(D,{level:2,children:"Service Charge Stalls Management"}),e.jsx(o,{type:"secondary",children:"Manage stall data for service charge auto-fill functionality"})]}),e.jsx(M,{style:{marginBottom:"24px"},children:e.jsxs(w,{gutter:16,align:"middle",children:[e.jsx(c,{span:8,children:e.jsx(B,{placeholder:"Select an exhibition",value:x,onChange:se,style:{width:"100%"},showSearch:!0,optionFilterProp:"children",children:m.map(t=>e.jsxs(V,{value:t._id,children:[t.name," - ",t.venue]},t._id))})}),e.jsx(c,{span:6,children:e.jsx(E,{placeholder:"Search stalls...",prefix:e.jsx(Ce,{}),value:f.search,onChange:t=>O(s=>({...s,search:t.target.value})),allowClear:!0})}),e.jsx(c,{span:4,children:e.jsxs(B,{placeholder:"Status",value:f.active,onChange:t=>O(s=>({...s,active:t})),allowClear:!0,children:[e.jsx(V,{value:!0,children:"Active"}),e.jsx(V,{value:!1,children:"Inactive"})]})}),e.jsx(c,{span:6,children:e.jsxs(g,{children:[e.jsx(d,{type:"primary",icon:e.jsx(we,{}),onClick:()=>N(!0),disabled:!x,children:"Add Stall"}),e.jsx(d,{icon:e.jsx(G,{}),onClick:()=>F(!0),disabled:!x,children:"Import Excel"})]})})]})}),x?e.jsx(M,{children:e.jsx(Ee,{columns:ge,dataSource:h,rowKey:"_id",loading:le,pagination:{current:j.current,pageSize:j.pageSize,total:j.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,s)=>`${s[0]}-${s[1]} of ${t} stalls`,onChange:(t,s)=>{J(a=>({...a,current:t,pageSize:s||10}))}},size:"middle",scroll:{x:800}})}):e.jsx(M,{children:e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx(ee,{style:{fontSize:"48px",color:"#d9d9d9",marginBottom:"16px"}}),e.jsx(D,{level:4,type:"secondary",children:"Select an Exhibition"}),e.jsx(o,{type:"secondary",children:"Please select an exhibition to view and manage its service charge stalls."})]})}),e.jsx(_,{title:"Add New Service Charge Stall",open:re,onCancel:()=>{N(!1),$.resetFields()},footer:null,width:600,children:e.jsxs(r,{form:$,layout:"vertical",onFinish:ce,children:[e.jsxs(w,{gutter:16,children:[e.jsx(c,{span:12,children:e.jsx(r.Item,{name:"stallNumber",label:"Stall Number",rules:[{required:!0,message:"Please enter stall number"}],children:e.jsx(E,{placeholder:"Enter stall number"})})}),e.jsx(c,{span:12,children:e.jsx(r.Item,{name:"stallArea",label:"Stall Area (sqm)",rules:[{required:!0,message:"Please enter stall area"},{type:"number",min:1,message:"Area must be at least 1 sqm"}],children:e.jsx(S,{placeholder:"Enter area in sqm",style:{width:"100%"},min:1})})})]}),e.jsx(r.Item,{name:"exhibitorCompanyName",label:"Exhibitor Company Name",rules:[{required:!0,message:"Please enter exhibitor company name"}],children:e.jsx(E,{placeholder:"Enter exhibitor company name"})}),e.jsx(D,{level:5,children:"Dimensions (Optional)"}),e.jsxs(w,{gutter:16,children:[e.jsx(c,{span:12,children:e.jsx(r.Item,{name:["dimensions","width"],label:"Width (meters)",children:e.jsx(S,{placeholder:"Enter width",style:{width:"100%"},min:.1,step:.1})})}),e.jsx(c,{span:12,children:e.jsx(r.Item,{name:["dimensions","height"],label:"Height (meters)",children:e.jsx(S,{placeholder:"Enter height",style:{width:"100%"},min:.1,step:.1})})})]}),e.jsx(r.Item,{children:e.jsxs(g,{children:[e.jsx(d,{type:"primary",htmlType:"submit",children:"Create Stall"}),e.jsx(d,{onClick:()=>{N(!1),$.resetFields()},children:"Cancel"})]})})]})}),e.jsx(_,{title:"Edit Service Charge Stall",open:ae,onCancel:()=>{A(!1),b.resetFields(),k(null)},footer:null,width:600,children:e.jsxs(r,{form:b,layout:"vertical",onFinish:de,children:[e.jsxs(w,{gutter:16,children:[e.jsx(c,{span:12,children:e.jsx(r.Item,{name:"stallNumber",label:"Stall Number",rules:[{required:!0,message:"Please enter stall number"}],children:e.jsx(E,{placeholder:"Enter stall number"})})}),e.jsx(c,{span:12,children:e.jsx(r.Item,{name:"stallArea",label:"Stall Area (sqm)",rules:[{required:!0,message:"Please enter stall area"},{type:"number",min:1,message:"Area must be at least 1 sqm"}],children:e.jsx(S,{placeholder:"Enter area in sqm",style:{width:"100%"},min:1})})})]}),e.jsx(r.Item,{name:"exhibitorCompanyName",label:"Exhibitor Company Name",rules:[{required:!0,message:"Please enter exhibitor company name"}],children:e.jsx(E,{placeholder:"Enter exhibitor company name"})}),e.jsx(D,{level:5,children:"Dimensions (Optional)"}),e.jsxs(w,{gutter:16,children:[e.jsx(c,{span:12,children:e.jsx(r.Item,{name:["dimensions","width"],label:"Width (meters)",children:e.jsx(S,{placeholder:"Enter width",style:{width:"100%"},min:.1,step:.1})})}),e.jsx(c,{span:12,children:e.jsx(r.Item,{name:["dimensions","height"],label:"Height (meters)",children:e.jsx(S,{placeholder:"Enter height",style:{width:"100%"},min:.1,step:.1})})})]}),e.jsx(r.Item,{name:"isActive",label:"Status",valuePropName:"checked",children:e.jsx(Ie,{checkedChildren:"Active",unCheckedChildren:"Inactive"})}),e.jsx(r.Item,{children:e.jsxs(g,{children:[e.jsx(d,{type:"primary",htmlType:"submit",children:"Update Stall"}),e.jsx(d,{onClick:()=>{A(!1),b.resetFields(),k(null)},children:"Cancel"})]})})]})}),e.jsxs(_,{title:"Import Service Charge Stalls",open:ie,onCancel:()=>{F(!1),z(null),q([]),R.resetFields()},footer:null,width:700,children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs(g,{children:[e.jsx(d,{type:"link",icon:e.jsx(Ne,{}),onClick:pe,style:{padding:0},children:"Download Template"}),e.jsx(o,{type:"secondary",children:"|"}),e.jsx(o,{type:"secondary",children:"Required columns: Stall Number, Exhibitor Company Name, Stall Area (sqm)"})]})}),e.jsx(Ae,{accept:".xlsx,.xls",beforeUpload:me,showUploadList:!1,children:e.jsx(d,{icon:e.jsx(G,{}),children:"Select Excel File"})}),W&&e.jsx("div",{style:{margin:"16px 0",padding:"12px",background:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"6px"},children:e.jsxs(g,{children:[e.jsx(Fe,{style:{color:"#0369a1"}}),e.jsx(o,{strong:!0,children:W.name}),e.jsxs(o,{type:"secondary",children:["(",u.length," records found)"]})]})}),u.length>0&&e.jsxs("div",{style:{margin:"16px 0",padding:"12px",background:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"6px"},children:[e.jsxs(g,{children:[e.jsx(ee,{style:{color:"#52c41a"}}),e.jsx(o,{strong:!0,children:"Preview:"}),e.jsxs(o,{children:[u.length," stalls ready to import"]})]}),e.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"#666"},children:["Sample: ",(K=u[0])==null?void 0:K.stallNumber," - ",(X=u[0])==null?void 0:X.exhibitorCompanyName," (",(Z=u[0])==null?void 0:Z.stallArea," sqm)"]})]}),e.jsx("div",{style:{marginTop:"24px"},children:e.jsxs(g,{children:[e.jsx(d,{type:"primary",onClick:xe,loading:ne,disabled:!u.length,children:"Import Stalls"}),e.jsx(d,{onClick:()=>{F(!1),z(null),q([]),R.resetFields()},children:"Cancel"})]})})]})]})};export{Ke as default};
