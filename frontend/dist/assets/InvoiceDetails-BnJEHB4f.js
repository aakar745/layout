import{u as ee,b as oe,c as ne,d as ie,j as e}from"./index-0Suq5uxL.js";import{l as ae,r as p}from"./vendor-react-BNeW3y6d.js";import{I as se}from"./InvoiceTemplate-CCCa1MaP.js";import{H as a,o as te,T as re,a5 as le,a6 as ce,a7 as de,S as U,c as m,aQ as me,ao as he,aR as pe,P as ue,D as be,W as L,I as u,U as t}from"./vendor-antd--VDS8NUg.js";import"./vendor-utils-CtctGR1F.js";import"./vendor-styling-CU6mz1ss.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:Ie,Text:ge}=re,Ae=()=>{var v,j,w,f,A,N,S,E,F,P,T,C,D,W,M,R,V,$,G;const{id:r}=ae(),{data:o,isLoading:B,error:q}=ee(r||""),[z]=oe(),[O]=ne(),[Q]=ie(),[H,b]=p.useState(!1),[_,I]=p.useState(!1),[x]=a.useForm(),[y]=a.useForm(),[g,h]=p.useState(0),[l,k]=p.useState(!1),J=async()=>{if(r)try{k(!0),h(0),t.loading({content:"Preparing invoice...",key:"download"});const s=(()=>{let i=0;const c=setInterval(()=>{i+=5,i<=90?(h(i),i%25===0&&t.loading({content:`Downloading: ${i}% complete`,key:"download"})):clearInterval(c)},200);return c})();try{const i=await z(r).unwrap();clearInterval(s),h(100),t.loading({content:"Finalizing download...",key:"download"});const c=URL.createObjectURL(i),d=document.createElement("a");d.href=c,d.download=`Invoice-${(o==null?void 0:o.invoiceNumber)||r||"download"}.pdf`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c),t.success({content:"Invoice downloaded successfully",key:"download"})}catch(i){throw clearInterval(s),i}}catch(n){console.error("Error downloading PDF:",n),t.error({content:"Failed to download invoice",key:"download"})}finally{k(!1),setTimeout(()=>h(0),500)}},K=()=>{b(!0)},X=()=>{I(!0)},Y=async n=>{try{await O({bookingId:r||"",email:n.email,message:n.message}).unwrap(),t.success(`Invoice sent to ${n.email}`),b(!1),x.resetFields()}catch(s){console.error("Error sending email:",s),t.error("Failed to send email")}},Z=async n=>{try{await Q({bookingId:r||"",phoneNumber:n.phoneNumber}).unwrap();const s=n.phoneNumber.replace(/\D/g,""),i=encodeURIComponent(n.message);window.open(`https://wa.me/${s}?text=${i}`,"_blank"),I(!1),y.resetFields()}catch(s){console.error("Error opening WhatsApp:",s),t.error("Failed to open WhatsApp")}};return B?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(te,{size:"large"})}):q||!o?e.jsxs("div",{style:{textAlign:"center",marginTop:"50px"},children:[e.jsx(Ie,{level:3,children:"Invoice Not Found"}),e.jsx(ge,{children:"The requested invoice could not be loaded. Please try again later."})]}):e.jsxs(e.Fragment,{children:[e.jsxs(le,{title:"Invoice Details",style:{margin:"20px"},children:[e.jsx(ce,{gutter:[16,24],children:e.jsx(de,{span:24,children:e.jsxs(U,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(U,{children:[e.jsx(m,{icon:e.jsx(me,{}),onClick:J,loading:l&&g<100,disabled:l&&g>=100,children:"Download PDF"}),e.jsx(m,{icon:e.jsx(he,{}),onClick:K,disabled:l,children:"Share via Email"}),e.jsx(m,{icon:e.jsx(pe,{}),onClick:X,disabled:l,children:"Share via WhatsApp"})]}),l&&e.jsx(ue,{percent:g,size:"small",status:"active",style:{marginBottom:0,marginTop:4}})]})})}),e.jsx(be,{}),e.jsx(se,{booking:{...o.bookingId,customerGSTIN:(v=o.bookingId)!=null&&v.customerGSTIN||((j=o.bookingId)==null?void 0:j.customerGSTIN)===""?o.bookingId.customerGSTIN:"N/A",customerAddress:(w=o.bookingId)!=null&&w.customerAddress||((f=o.bookingId)==null?void 0:f.customerAddress)===""?o.bookingId.customerAddress:"N/A",invoiceNumber:o.invoiceNumber,exhibitionId:{...o.bookingId.exhibitionId,companyName:((A=o.bookingId.exhibitionId)==null?void 0:A.companyName)||"",bankName:((N=o.bookingId.exhibitionId)==null?void 0:N.bankName)||"",bankAccount:((S=o.bookingId.exhibitionId)==null?void 0:S.bankAccount)||"",bankAccountName:((E=o.bookingId.exhibitionId)==null?void 0:E.bankAccountName)||"",bankBranch:((F=o.bookingId.exhibitionId)==null?void 0:F.bankBranch)||"",bankIFSC:((P=o.bookingId.exhibitionId)==null?void 0:P.bankIFSC)||"",companyCIN:((T=o.bookingId.exhibitionId)==null?void 0:T.companyCIN)||"",companyPAN:((C=o.bookingId.exhibitionId)==null?void 0:C.companyPAN)||"",companySAC:((D=o.bookingId.exhibitionId)==null?void 0:D.companySAC)||"",companyGST:((W=o.bookingId.exhibitionId)==null?void 0:W.companyGST)||"",companyEmail:((M=o.bookingId.exhibitionId)==null?void 0:M.companyEmail)||"",companyWebsite:((R=o.bookingId.exhibitionId)==null?void 0:R.companyWebsite)||"",companyAddress:((V=o.bookingId.exhibitionId)==null?void 0:V.companyAddress)||""},calculations:{...o.bookingId.calculations,stalls:((G=($=o.bookingId.calculations)==null?void 0:$.stalls)==null?void 0:G.map(n=>({...n,discount:n.discount?{...n.discount,type:n.discount.type||"percentage",value:n.discount.value}:void 0})))||[]}}})]}),e.jsx(L,{title:"Share Invoice via Email",visible:H,onCancel:()=>b(!1),footer:null,children:e.jsxs(a,{form:x,layout:"vertical",onFinish:Y,children:[e.jsx(a.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter an email address"},{type:"email",message:"Please enter a valid email address"}],children:e.jsx(u,{placeholder:"example@example.com"})}),e.jsx(a.Item,{name:"message",label:"Message",initialValue:`Please find attached the invoice for your booking with invoice number ${o.invoiceNumber}.`,children:e.jsx(u.TextArea,{rows:4})}),e.jsx(a.Item,{children:e.jsx(m,{type:"primary",htmlType:"submit",children:"Send"})})]})}),e.jsx(L,{title:"Share Invoice via WhatsApp",visible:_,onCancel:()=>I(!1),footer:null,children:e.jsxs(a,{form:y,layout:"vertical",onFinish:Z,children:[e.jsx(a.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter a phone number"}],children:e.jsx(u,{placeholder:"+1234567890"})}),e.jsx(a.Item,{name:"message",label:"Message",initialValue:`Please find the invoice for your booking with invoice number ${o.invoiceNumber}.`,children:e.jsx(u.TextArea,{rows:4})}),e.jsx(a.Item,{children:e.jsx(m,{type:"primary",htmlType:"submit",children:"Open WhatsApp"})})]})})]})};export{Ae as default};
