const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/stall-BMZvk0fo.js","assets/index-DoSueJxk.js","assets/vendor-react-dkbxt9Jf.js","assets/vendor-utils-ngrFHoWO.js","assets/vendor-antd-mFVHvrVJ.js","assets/vendor-styling-CQa69cNz.js","assets/index-Bppz5v0Z.css"])))=>i.map(i=>d[i]);
import{j as e,v as Oe,Q as Qe,a as ze,_ as Fe}from"./index-DoSueJxk.js";import{r as p,l as Ye,k as Se}from"./vendor-react-dkbxt9Jf.js";import{u as pe,a as Ue}from"./vendor-export-PCv_shhx.js";import{F as Ve}from"./FileSaver.min-jwPvKRD0.js";import{a1 as V,T as ie,$ as be,a0 as D,ab as ee,J as Ge,ar as Ke,aw as Je,S as W,c as se,j as We,au as Ze,D as He,b as E,v as Xe,aC as Te,a5 as et,H as tt,E as ae,ai as xe,P as st,aQ as at,B as me,p as it,aZ as lt,at as nt,aj as rt,l as ot,Y as ct,d as dt,n as we,a_ as ut,aW as fe,a$ as pt}from"./vendor-antd-mFVHvrVJ.js";import{c as U,f as te}from"./stallUtils-DlikgrX5.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const{Title:xt,Text:J}=ie,{Option:q}=ee,{RangePicker:mt}=Je,ft=({exhibitionId:j,exhibitions:y,exhibitionsLoading:g,onExhibitionChange:A,typeFilter:P,setTypeFilter:C,bookingStatusFilter:x,setBookingStatusFilter:k,searchQuery:B,setSearchQuery:Q,dateRange:_,setDateRange:z,resetFilters:G})=>{const M=f=>{Q(f.target.value)},I=f=>{z(f)};return e.jsxs(V,{className:"amenities-filters",children:[e.jsx(xt,{level:5,className:"filter-heading",children:"Filters"}),e.jsxs(be,{gutter:[16,16],children:[e.jsx(D,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Exhibition"}),e.jsx(ee,{placeholder:"Select an exhibition",style:{width:"100%"},loading:g,onChange:A,value:j,children:y.map(f=>e.jsx(q,{value:f._id,children:f.name},f._id))})]})}),e.jsx(D,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Amenity Type"}),e.jsxs(ee,{mode:"multiple",placeholder:"Select types",style:{width:"100%"},value:P,onChange:C,maxTagCount:2,children:[e.jsx(q,{value:"facility",children:"Facility"}),e.jsx(q,{value:"service",children:"Service"}),e.jsx(q,{value:"equipment",children:"Equipment"}),e.jsx(q,{value:"other",children:"Other"})]})]})}),e.jsx(D,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Booking Status"}),e.jsxs(ee,{mode:"multiple",placeholder:"Select statuses",style:{width:"100%"},value:x,onChange:k,maxTagCount:2,children:[e.jsx(q,{value:"confirmed",children:"Confirmed"}),e.jsx(q,{value:"approved",children:"Approved"}),e.jsx(q,{value:"pending",children:"Pending"}),e.jsx(q,{value:"rejected",children:"Rejected"}),e.jsx(q,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(D,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Search"}),e.jsx(Ge,{placeholder:"Search amenities",prefix:e.jsx(Ke,{}),value:B,onChange:M,allowClear:!0})]})}),e.jsx(D,{xs:24,md:16,lg:12,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{className:"filter-label",children:"Booking Date Range"}),e.jsx(mt,{style:{width:"100%"},onChange:I,value:_})]})}),e.jsx(D,{xs:24,md:8,lg:12,children:e.jsx("div",{className:"filter-group",style:{display:"flex",justifyContent:"flex-end",alignItems:"flex-end",height:"100%"},children:e.jsxs(W,{children:[e.jsx(se,{icon:e.jsx(We,{}),onClick:G,children:"Reset"}),e.jsx(se,{type:"primary",icon:e.jsx(Ze,{}),children:"Apply Filters"})]})})})]}),(P.length>0||x.length>0||B||_)&&e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"filter-divider"}),e.jsxs("div",{children:[e.jsx(J,{className:"filter-label",children:"Active Filters:"}),e.jsxs("div",{style:{marginTop:8},children:[P.map(f=>e.jsxs(E,{closable:!0,onClose:()=>C(P.filter(K=>K!==f)),className:`amenity-tag amenity-tag-${f}`,children:["Type: ",f]},`type-${f}`)),x.map(f=>e.jsxs(E,{closable:!0,onClose:()=>k(x.filter(K=>K!==f)),color:"blue",children:["Status: ",f]},`status-${f}`)),B&&e.jsxs(E,{closable:!0,onClose:()=>Q(""),color:"purple",children:["Search: ",B]}),_&&e.jsxs(E,{closable:!0,onClose:()=>z(null),color:"green",children:["Date Range: ",_[0]?.format("MMM DD, YYYY")," - ",_[1]?.format("MMM DD, YYYY")]})]})]})]})]})},{Text:wt}=ie,ht=({basicAmenities:j,extraAmenities:y,bookedStalls:g,calculatedAmenities:A})=>e.jsxs(be,{gutter:[24,24],children:[e.jsx(D,{xs:24,sm:12,md:6,children:e.jsxs(V,{className:"stats-card stats-primary",bordered:!1,children:[e.jsx(Xe,{style:{fontSize:24,color:"#1890ff"}}),e.jsx("div",{className:"stats-value",children:j.length}),e.jsx("div",{className:"stats-label",children:"Basic Amenities"})]})}),e.jsx(D,{xs:24,sm:12,md:6,children:e.jsxs(V,{className:"stats-card stats-secondary",bordered:!1,children:[e.jsx(Te,{style:{fontSize:24,color:"#52c41a"}}),e.jsx("div",{className:"stats-value",children:y.length}),e.jsx("div",{className:"stats-label",children:"Extra Amenities"})]})}),e.jsx(D,{xs:24,sm:12,md:6,children:e.jsxs(V,{className:"stats-card stats-tertiary",bordered:!1,children:[e.jsx(et,{style:{fontSize:24,color:"#fa8c16"}}),e.jsx("div",{className:"stats-value",children:g}),e.jsx("div",{className:"stats-label",children:"Booked Stalls"})]})}),e.jsx(D,{xs:24,sm:12,md:6,children:e.jsxs(V,{className:"stats-card stats-quaternary",bordered:!1,children:[e.jsx(tt,{style:{fontSize:24,color:"#722ed1"}}),e.jsx("div",{className:"stats-value",children:A}),e.jsx("div",{className:"stats-label",children:"Calculated Amenities"})]})})]}),{Text:R,Title:Ie}=ie,Ne=j=>{switch(j){case"facility":return{color:"#e6f7ff",borderColor:"#91d5ff",textColor:"#1890ff"};case"service":return{color:"#f6ffed",borderColor:"#b7eb8f",textColor:"#52c41a"};case"equipment":return{color:"#fff7e6",borderColor:"#ffd591",textColor:"#fa8c16"};default:return{color:"#f9f0ff",borderColor:"#d3adf7",textColor:"#722ed1"}}},he=({title:j,amenities:y,loading:g,onExport:A,isDynamicColumns:P=!1,isCalculated:C=!1,exhibitionId:x,amenityViewType:k="basic"})=>{const[B,Q]=p.useState([]),[_,z]=p.useState([]),[G,M]=p.useState(!1),I=p.useMemo(()=>C?k==="basic"?y.filter(r=>r.hasOwnProperty("calculatedQuantity")||r.hasOwnProperty("perSqm")):k==="extra"?y.filter(r=>r.hasOwnProperty("rate")&&!r.hasOwnProperty("perSqm")):y:y,[y,C,k]);p.useEffect(()=>{if(!x){z([]),M(!1);return}M(!0),setTimeout(()=>{M(!1)},500)},[x]);const f=()=>{const r=new Map,u=new Map;I.forEach(s=>{if(s.isExtraAmenity&&s.isBookingLevel){u.has(s.bookingId)||u.set(s.bookingId,{key:`booking-${s.bookingId}`,companyName:s.exhibitorName||"Unknown",stallNumber:s.stallNumber,dimension:s.dimensions,stallType:s.stallType,area:s.area||0,bookingDate:s.bookingDate?new Date(s.bookingDate).toISOString().slice(0,10):"-",status:s.bookingStatus||"-",amenities:{},isBookingLevel:!0,stallCount:s.stallCount||1});const d=u.get(s.bookingId);s.booked&&s.quantity>0&&(d.amenities[s.name]=s.quantity)}else if(s.stallId&&s.stallNumber&&!s.isBookingLevel){r.has(s.stallId)||r.set(s.stallId,{key:s.stallId,companyName:s.exhibitorName||"Unknown",stallNumber:s.stallNumber,dimension:te(s.dimensions),stallType:s.stallType||"-",area:U(s.dimensions),bookingDate:s.bookingDate?new Date(s.bookingDate).toISOString().slice(0,10):"-",status:s.bookingStatus||"-",amenities:{},isBookingLevel:!1});const d=r.get(s.stallId);if(s.hasOwnProperty("calculatedQuantity"))d.amenities[s.name]=s.calculatedQuantity;else if(s.hasOwnProperty("perSqm")){const m=typeof d.area=="number"?d.area:0,L=Math.floor(m/s.perSqm)*s.quantity;d.amenities[s.name]=L>0?L:s.quantity}}});let h=[];return k==="basic"&&(h=[...h,...Array.from(r.values()).filter(s=>Object.keys(s.amenities).length>0)]),k==="extra"&&(h=[...h,...Array.from(u.values()).filter(s=>Object.keys(s.amenities).length>0)]),h},K=()=>{const r=new Set;return I.forEach(u=>{const h=s=>C?!0:j.toLowerCase().includes("basic")?s.hasOwnProperty("perSqm"):j.toLowerCase().includes("additional")||j.toLowerCase().includes("extra")?s.hasOwnProperty("rate"):!0;u.name&&h(u)&&r.add(u.name)}),Array.from(r)},Z=()=>{const r=[{title:"Company Name",dataIndex:"companyName",key:"companyName",fixed:"left",width:180,render:d=>e.jsx(R,{strong:!0,children:d}),sorter:(d,m)=>d.companyName.localeCompare(m.companyName)},{title:"Stall No.",dataIndex:"stallNumber",key:"stallNumber",width:150,render:(d,m)=>m.isBookingLevel?e.jsx(me,{status:"processing",text:d}):e.jsx(me,{status:"success",text:d}),sorter:(d,m)=>d.stallNumber.localeCompare(m.stallNumber)},{title:"Dimension",dataIndex:"dimension",key:"dimension",width:120},{title:"Stall Type",dataIndex:"stallType",key:"stallType",width:120},{title:"Area (SQM)",dataIndex:"area",key:"area",width:100,render:d=>typeof d=="number"?d.toFixed(2):d,sorter:(d,m)=>{const L=typeof d.area=="number"?d.area:0,N=typeof m.area=="number"?m.area:0;return L-N}}],h=K().map(d=>({title:d,dataIndex:["amenities",d],key:d,width:100,render:m=>m==null?"-":m===0?e.jsx(R,{type:"secondary",children:"0"}):m==="âœ“"?e.jsx(me,{status:"success"}):e.jsx(R,{strong:!0,children:m}),sorter:(m,L)=>{const N=m.amenities[d]||0,X=L.amenities[d]||0;return N-X}})),s={title:"Actions",key:"actions",width:80,fixed:"right",render:(d,m)=>e.jsx(it,{menu:{items:[{key:"view",icon:e.jsx(nt,{}),label:"View Details"},{key:"edit",icon:e.jsx(rt,{}),label:"Edit"},{key:"settings",icon:e.jsx(ot,{}),label:"Settings"}]},trigger:["click"],children:e.jsx(se,{type:"text",icon:e.jsx(lt,{})})})};return[...r,...h,s]},O=r=>{Q(r)},H=f(),je=r=>e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Ie,{level:5,children:"Stall Details"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:[Object.entries(r).map(([u,h])=>["key","amenities"].includes(u)?null:e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs(R,{type:"secondary",style:{fontSize:"12px"},children:[u.charAt(0).toUpperCase()+u.slice(1).replace(/([A-Z])/g," $1"),":"]}),e.jsx("div",{children:e.jsx(R,{strong:!0,children:h==null?"-":typeof h=="object"?JSON.stringify(h):String(h)})})]},u)),e.jsxs("div",{style:{marginBottom:"8px",gridColumn:"1 / -1"},children:[e.jsx(R,{type:"secondary",style:{fontSize:"12px"},children:"Amenities:"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"4px"},children:Object.entries(r.amenities||{}).map(([u,h])=>e.jsxs(E,{color:"blue",children:[u,": ",h==="âœ“"?"Available":h]},u))})]})]})]});return e.jsx(V,{className:"amenities-card",title:e.jsxs(W,{children:[e.jsx(Ie,{level:5,style:{margin:0},children:j}),C&&e.jsxs(e.Fragment,{children:[e.jsx(E,{color:"green",children:"Calculated"}),k==="basic"&&e.jsx(E,{color:"blue",children:"Basic Amenities"}),k==="extra"&&e.jsx(E,{color:"purple",children:"Extra Amenities"})]})]}),extra:e.jsx(W,{children:e.jsx(se,{type:"primary",icon:e.jsx(at,{}),onClick:A,disabled:I.length===0,children:"Export"})}),children:I.length===0?e.jsx(ae,{image:ae.PRESENTED_IMAGE_SIMPLE,description:"No amenities data available"}):j.toLowerCase().includes("basic")&&!C?e.jsx(xe,{dataSource:I.map((r,u)=>({key:r._id||r.id||`basic-${u}`,...r})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(r,u)=>e.jsxs(W,{children:[e.jsx(R,{strong:!0,children:r}),e.jsx(E,{color:Ne(u.type).textColor,children:u.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Per SQM",dataIndex:"perSqm",key:"perSqm",render:r=>r?`1 per ${r} sqm`:"-"},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:r=>e.jsx(E,{color:"blue",children:r})}],loading:g,pagination:{pageSize:10},className:"amenities-table"}):(j.toLowerCase().includes("additional")||j.toLowerCase().includes("extra"))&&!C?e.jsx(xe,{dataSource:I.map((r,u)=>({key:r._id||r.id||`extra-${u}`,...r})),columns:[{title:"Name",dataIndex:"name",key:"name",render:(r,u)=>e.jsxs(W,{children:[e.jsx(R,{strong:!0,children:r}),e.jsx(E,{color:Ne(u.type).textColor,children:u.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Rate",dataIndex:"rate",key:"rate",render:r=>e.jsxs(R,{style:{color:"#1890ff"},children:["â‚¹",r.toLocaleString()]})}],loading:g,pagination:{pageSize:10},className:"amenities-table"}):H.length===0?e.jsx(st,{message:"No stall data available",description:"Amenities exist but could not be linked to stalls. Make sure stalls are booked and have amenities assigned.",type:"info",showIcon:!0}):e.jsx(xe,{dataSource:H,columns:Z(),loading:g||G,pagination:{pageSize:10},className:"amenities-table",scroll:{x:"max-content"},expandable:{expandedRowKeys:B,onExpandedRowsChange:O,expandedRowRender:je}})})},{Title:gt,Text:Ae}=ie,{TabPane:vt}=we,ge=(j,y)=>{const g=pe.json_to_sheet(j),A=pe.book_new();pe.book_append_sheet(A,g,"Amenities");const P=Ue(A,{bookType:"xlsx",type:"array"}),C=new Blob([P],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ve.saveAs(C,`${y}.xlsx`)},Ct=()=>{const j=Ye(),{message:y}=ct.useApp(),{exhibitions:g,loading:A}=Se(a=>a.exhibition),{bookings:P,loading:C}=Se(a=>a.booking),[x,k]=p.useState(null),[B,Q]=p.useState([]),[_,z]=p.useState([]),[G,M]=p.useState([]),[I,f]=p.useState([]),[K,Z]=p.useState(!1),[O,H]=p.useState({}),[je,r]=p.useState(!1),[u,h]=p.useState({current:1,pageSize:10,total:0}),[s,d]=p.useState([]),[m,L]=p.useState([]),[N,X]=p.useState(""),[F,ye]=p.useState(null),[ve,le]=p.useState(0),[Ce,ne]=p.useState(0),[ke,Ee]=p.useState("basic"),[Y,De]=p.useState("basic");p.useEffect(()=>{j(Oe()),j(Qe({page:1,limit:100}))},[j]);const Be=async(a,o=1,c=10)=>{try{Z(!0);const n=await ze.get("/bookings",{params:{exhibitionId:a,includeDetails:!0,populate:"stallIds.stallTypeId",page:o,limit:c}});if(n&&n.data){const l=n.data.data.map(i=>{const t={...i};return t.stallIds&&(t.stallIds=t.stallIds.map(b=>(b.stallTypeId&&typeof b.stallTypeId=="object"&&(b.type=b.stallTypeId.name),b))),t}).filter(i=>i.exhibitionId._id===a&&["confirmed","approved"].includes(i.status));f(l),h({current:n.data.pagination.page,pageSize:n.data.pagination.limit,total:n.data.pagination.total})}else f([]),h({current:1,pageSize:10,total:0})}catch(n){console.error("Error fetching complete booking data:",n),f([]),h({current:1,pageSize:10,total:0})}finally{Z(!1)}};p.useEffect(()=>{if(x&&g.length>0){const a=g.find(o=>o._id===x);a&&(Q(a.basicAmenities||[]),z(a.amenities||[]),Be(x,u.current,u.pageSize))}else Q([]),z([]),M([]),le(0),ne(0),f([])},[x,g]),p.useEffect(()=>{if(x&&g.length>0&&I.length>0){const a=g.find(o=>o._id===x);if(a){const o=I.flatMap(l=>l.stallIds.map(i=>{const t=i.type||(i.stallTypeId&&typeof i.stallTypeId=="object"?i.stallTypeId.name:O[i.stallTypeId])||"-";return{stallId:i._id,stallNumber:i.number,bookingId:l._id,exhibitorName:l.companyName,bookingDate:l.createdAt,dimensions:i.dimensions,area:U(i.dimensions),status:l.status,stallType:t}})),c=I.flatMap(l=>!l.basicAmenities||l.basicAmenities.length===0?l.stallIds.flatMap(i=>{const t=U(i.dimensions),b=i.type||(i.stallTypeId&&typeof i.stallTypeId=="object"?i.stallTypeId.name:O[i.stallTypeId])||"-";return(a.basicAmenities||[]).map(S=>{const T=Math.floor(t/S.perSqm)*S.quantity;return{...S,calculatedQuantity:T>0?T:S.quantity,stallId:i._id,stallNumber:i.number,bookingId:l._id,exhibitorId:l.exhibitorId||"",exhibitorName:l.companyName,bookingDate:l.createdAt,dimensions:i.dimensions,area:t,bookingStatus:l.status,stallType:b}})}):l.basicAmenities.flatMap(i=>l.stallIds.map(t=>{const b=t.type||(t.stallTypeId&&typeof t.stallTypeId=="object"?t.stallTypeId.name:O[t.stallTypeId])||"-";return{...i,stallId:t._id,stallNumber:t.number,bookingId:l._id,exhibitorId:l.exhibitorId||"",exhibitorName:l.companyName,bookingDate:l.createdAt,dimensions:t.dimensions,area:U(t.dimensions),bookingStatus:l.status,stallType:b}}))),n=I.flatMap(l=>!l.extraAmenities||l.extraAmenities.length===0?[]:l.extraAmenities.map(i=>{const t=l.stallIds.map(w=>te(w.dimensions)).join(", "),b=l.stallIds.map(w=>w.type||(w.stallTypeId&&typeof w.stallTypeId=="object"?w.stallTypeId.name:O[w.stallTypeId])||"-"),S=[...new Set(b)],T=S.length===1?S[0]:S.join(", ");return{...i,booked:!0,stallId:l.stallIds[0]?._id||"",stallNumber:l.stallIds.map(w=>w.number).join(", "),bookingId:l._id,exhibitorId:l.exhibitorId||"",exhibitorName:l.companyName,bookingDate:l.createdAt,dimensions:t,area:l.stallIds.reduce((w,de)=>w+U(de.dimensions),0),bookingStatus:l.status,stallType:T,allStalls:l.stallIds,isExtraAmenity:!0,isBookingLevel:!0,stallCount:l.stallIds.length,quantity:i.quantity||1}}));let $=n;if(n.length===0&&a.amenities&&a.amenities.length>0){const l=new Set;$=I.flatMap(i=>l.has(i._id)?[]:(l.add(i._id),(a.amenities||[]).map((t,b)=>{const S=i.extraAmenities?.find(v=>v.name===t.name),T=!!S,w=i.stallIds.map(v=>te(v.dimensions)).join(", "),de=i.stallIds.map(v=>v.type||(v.stallTypeId&&typeof v.stallTypeId=="object"?v.stallTypeId.name:O[v.stallTypeId])||"-"),ue=[...new Set(de)],Re=ue.length===1?ue[0]:ue.join(", ");return{...t,id:`sim-booking-${i._id}-${b}`,booked:T,stallId:i.stallIds[0]?._id||"",stallNumber:i.stallIds.map(v=>v.number).join(", "),bookingId:i._id,exhibitorId:i.exhibitorId||"",exhibitorName:i.companyName||"Unknown",bookingDate:i.createdAt||new Date().toISOString(),dimensions:w,area:i.stallIds.reduce((v,Pe)=>v+U(Pe.dimensions),0),bookingStatus:i.status||"approved",stallType:Re,allStalls:i.stallIds,isExtraAmenity:!0,isBookingLevel:!0,stallCount:i.stallIds.length,quantity:T?S?.quantity||1:0}})))}M([...c,...$]),le(o.length),ne(c.length+$.length)}}else x&&g.length>0&&(M([]),le(0),ne(0))},[x,g,I,O]);const re=p.useMemo(()=>{let a=B;if(s.length>0&&(a=a.filter(o=>s.includes(o.type))),N){const o=N.toLowerCase();a=a.filter(c=>c.name.toLowerCase().includes(o)||c.type.toLowerCase().includes(o)||c.description&&c.description.toLowerCase().includes(o))}return a},[B,s,N]),oe=p.useMemo(()=>{let a=_;if(s.length>0&&(a=a.filter(o=>s.includes(o.type))),N){const o=N.toLowerCase();a=a.filter(c=>c.name.toLowerCase().includes(o)||c.type.toLowerCase().includes(o)||c.description&&c.description.toLowerCase().includes(o))}return a},[_,s,N]),ce=p.useMemo(()=>{let a=G;if(s.length>0&&(a=a.filter(o=>s.includes(o.type))),m.length>0&&(a=a.filter(o=>m.includes(o.bookingStatus))),N){const o=N.toLowerCase();a=a.filter(c=>c.name.toLowerCase().includes(o)||c.type.toLowerCase().includes(o)||c.description&&c.description.toLowerCase().includes(o)||c.stallNumber&&c.stallNumber.toLowerCase().includes(o)||c.exhibitorName&&c.exhibitorName.toLowerCase().includes(o))}if(F&&F[0]&&F[1]){const o=F[0].startOf("day"),c=F[1].endOf("day");a=a.filter(n=>{if(!n.bookingDate)return!1;const $=dt(n.bookingDate);return $.isAfter(o)&&$.isBefore(c)})}return a},[G,s,m,N,F]),_e=()=>{d([]),L([]),X(""),ye(null)},qe=()=>{if(re.length===0){y.warning("No basic amenities to export");return}const a=re.map(n=>({Name:n.name,Type:n.type,Description:n.description||"","Per Sq. Meter":n.perSqm,"Quantity Per Unit":n.quantity,ID:n._id||n.id})),c=`${g.find(n=>n._id===x)?.name||"Exhibition"}_Basic_Amenities`;ge(a,c),y.success("Basic amenities exported successfully")},Me=()=>{if(oe.length===0){y.warning("No extra amenities to export");return}const a=oe.map(n=>({Name:n.name,Type:n.type,Description:n.description||"",Rate:n.rate,ID:n._id||n.id})),c=`${g.find(n=>n._id===x)?.name||"Exhibition"}_Extra_Amenities`;ge(a,c),y.success("Extra amenities exported successfully")},Le=()=>{if(ce.length===0){y.warning("No calculated amenities to export");return}const a=new Map,o=new Map;ce.filter(t=>Y==="basic"?t.hasOwnProperty("calculatedQuantity")||t.hasOwnProperty("perSqm"):Y==="extra"?t.hasOwnProperty("rate")&&!t.hasOwnProperty("perSqm"):!0).forEach(t=>{if(t.isExtraAmenity&&t.isBookingLevel){o.has(t.bookingId)||o.set(t.bookingId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,"Total Area (SQM)":t.area||0,"Stall Count":t.stallCount||1,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-","Booking Type":"Extra Amenities"});const b=o.get(t.bookingId);t.booked&&t.quantity>0&&(b[t.name]=t.quantity)}else if(t.stallId&&t.stallNumber){if(!a.has(t.stallId)){const S=t.dimensions||{width:0,height:0},T=U(S);a.set(t.stallId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,Dimension:te(S),"Stall Type":t.stallType||"-","Area (SQM)":typeof T=="number"?T:0,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-","Booking Type":"Basic Amenities"})}const b=a.get(t.stallId);if(t.hasOwnProperty("calculatedQuantity"))b[t.name]=t.calculatedQuantity;else if(t.hasOwnProperty("perSqm")){const S=typeof b["Area (SQM)"]=="number"?b["Area (SQM)"]:0,T=Math.floor(S/t.perSqm)*t.quantity;b[t.name]=T>0?T:t.quantity}}});let n=[];Y==="basic"&&(n=[...n,...Array.from(a.values())]),Y==="extra"&&(n=[...n,...Array.from(o.values())]);const $=g.find(t=>t._id===x),l=Y==="basic"?"Basic":"Extra",i=`${$?.name||"Exhibition"}_${l}_Calculated_Amenities`;ge(n,i),y.success(`${l} calculated amenities exported successfully`)},$e=async()=>{try{r(!0);const{default:a}=await Fe(async()=>{const{default:c}=await import("./stall-BMZvk0fo.js");return{default:c}},__vite__mapDeps([0,1,2,3,4,5,6])),o=await a.getStallTypes();if(o&&o.data){const c={};o.data.forEach(n=>{n._id&&(c[n._id]=n.name)}),H(c)}}catch(a){console.error("Error fetching stall types:",a)}finally{r(!1)}};return p.useEffect(()=>{x&&$e()},[x]),e.jsxs("div",{className:"amenities-container",children:[e.jsxs("div",{className:"amenities-header",children:[e.jsx(gt,{level:4,className:"amenities-title",children:"Amenities Management"}),e.jsx(Ae,{type:"secondary",children:"View, filter, and export amenities data. See calculated amenities for booked stalls."})]}),e.jsx(ft,{exhibitionId:x,exhibitions:g,exhibitionsLoading:A,onExhibitionChange:k,typeFilter:s,setTypeFilter:d,bookingStatusFilter:m,setBookingStatusFilter:L,searchQuery:N,setSearchQuery:X,dateRange:F,setDateRange:ye,resetFilters:_e}),x&&e.jsx("div",{style:{marginBottom:24},children:e.jsx(ht,{basicAmenities:B,extraAmenities:_,bookedStalls:ve,calculatedAmenities:Ce})}),x?e.jsx(we,{activeKey:ke,onChange:Ee,className:"amenities-tabs",items:[{key:"basic",label:e.jsxs("span",{children:[e.jsx(ut,{}),"Basic Amenities"]}),children:e.jsx(he,{title:"Basic Amenities",amenities:re,loading:A,onExport:qe,exhibitionId:x})},{key:"extra",label:e.jsxs("span",{children:[e.jsx(Te,{}),"Extra Amenities"]}),children:e.jsx(he,{title:"Additional Amenities",amenities:oe,loading:A,onExport:Me,exhibitionId:x})},{key:"calculated",label:e.jsxs("span",{children:[e.jsx(pt,{}),"Calculated Amenities"]}),children:e.jsxs(e.Fragment,{children:[e.jsx(be,{gutter:[0,16],children:e.jsx(D,{span:24,children:e.jsx(V,{className:"filter-card",children:e.jsxs(W,{children:[e.jsx(Ae,{strong:!0,children:"View: "}),e.jsxs(fe.Group,{value:Y,onChange:a=>De(a.target.value),optionType:"button",buttonStyle:"solid",children:[e.jsx(fe.Button,{value:"basic",children:"Basic Amenities"}),e.jsx(fe.Button,{value:"extra",children:"Extra Amenities"})]})]})})})}),e.jsx(he,{title:"Calculated Amenities",amenities:ce,loading:A,onExport:Le,isDynamicColumns:!0,isCalculated:!0,exhibitionId:x,amenityViewType:Y})]})}]}):e.jsx("div",{style:{marginTop:24,textAlign:"center",padding:48,background:"#fff",borderRadius:8},children:e.jsx(ae,{description:"Please select an exhibition to view amenities",image:ae.PRESENTED_IMAGE_SIMPLE})})]})};export{Ct as default};
