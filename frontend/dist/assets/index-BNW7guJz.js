import{j as e,A as P,w as S,B as I,G as q,H as O,y as H}from"./index-aoH9EzMk.js";import{Z as j,R as V,ag as B,Y as W,aB as N,S as v,i as y,j as _,aX as G,G as U,u as D,F as X,p as L,r as f,a5 as Y,ab as Q,bW as Z,by as J,aQ as K,bz as ee}from"./vendor-Be5M1UDi.js";import"./canvas-C-A9eff5.js";import"./apis-CU9I9MMq.js";const se=({visible:u,hall:s,exhibitionWidth:r,exhibitionHeight:i,onCancel:n,onSubmit:t,onDelete:x})=>{const[l]=j.useForm();V.useEffect(()=>{u&&(s?l.setFieldsValue({name:s.name,width:s.dimensions.width,height:s.dimensions.height}):l.setFieldsValue({name:"",width:Math.min(10,r),height:Math.min(10,i)}))},[u,s,r,i,l]);const o=async()=>{var b,g;const m=await l.validateFields(),c=s?{...s,_id:s._id,id:s.id||s._id,name:m.name,dimensions:{x:((b=s.dimensions)==null?void 0:b.x)||0,y:((g=s.dimensions)==null?void 0:g.y)||0,width:m.width,height:m.height},exhibitionId:s.exhibitionId}:{name:m.name,dimensions:{x:0,y:0,width:m.width,height:m.height}};t(c),l.resetFields()},C=()=>{s&&x&&B.confirm({title:"Delete Hall",content:`Are you sure you want to delete hall "${s.name}"? This action cannot be undone.`,okText:"Yes, Delete",cancelText:"No, Cancel",okButtonProps:{className:"confirm-delete-button"},centered:!0,onOk:()=>x(s)})};return e.jsx(B,{title:s?"Edit Hall":"Add New Hall",open:u,onCancel:()=>{l.resetFields(),n()},footer:null,width:400,destroyOnClose:!0,className:"hall-form-modal",children:e.jsxs(j,{form:l,layout:"vertical",style:{marginTop:"16px"},children:[e.jsx(j.Item,{name:"name",label:e.jsxs("span",{style:{color:"#000"},children:["Hall Name ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter hall name"}],children:e.jsx(W,{placeholder:"Enter hall name"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(j.Item,{name:"width",label:e.jsxs("span",{style:{color:"#000"},children:["Width (meters) ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter width"},{type:"number",min:5,message:"Width must be at least 5 meters"},{type:"number",max:r,message:`Width cannot exceed ${r} meters`}],children:e.jsx(N,{min:5,max:r,style:{width:"100%"},placeholder:"Enter width"})}),e.jsx(j.Item,{name:"height",label:e.jsxs("span",{style:{color:"#000"},children:["Height (meters) ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter height"},{type:"number",min:5,message:"Height must be at least 5 meters"},{type:"number",max:i,message:`Height cannot exceed ${i} meters`}],children:e.jsx(N,{min:5,max:i,style:{width:"100%"},placeholder:"Enter height"})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"32px",gap:"8px"},children:[e.jsx(v,{children:s&&x&&e.jsx(y,{className:"delete-button",icon:e.jsx(_,{}),onClick:C,children:"Delete Hall"})}),e.jsxs(v,{children:[e.jsx(y,{onClick:()=>{l.resetFields(),n()},children:"Cancel"}),e.jsx(y,{type:"primary",onClick:o,className:"update-button",children:s?"Update Hall":"Create Hall"})]})]})]})})},te=({exhibitionId:u,destination:s="layout",label:r="Back to Layout"})=>{const i=D(),{currentExhibition:n}=L(t=>t.exhibition);return e.jsxs("div",{style:{marginBottom:"24px",position:"sticky",top:"16px",zIndex:10},children:[e.jsx(y,{icon:e.jsx(ee,{}),onClick:()=>i(S(n,s),{state:{exhibitionId:u}}),type:"default",size:"large",style:{borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",background:"white",borderColor:"transparent",fontWeight:500,padding:"0 16px",height:"42px",display:"flex",alignItems:"center",transition:"all 0.3s ease"},className:"back-button-hover",children:e.jsx("span",{style:{marginLeft:8},children:r})}),e.jsx("style",{children:`
        .back-button-hover:hover {
          transform: translateX(-5px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: #f0f5ff;
          border-color: #d6e4ff;
        }
      `})]})},oe=()=>{var E,R,z;const{id:u}=G(),s=U(),r=D(),i=X(),n=((E=s.state)==null?void 0:E.exhibitionId)||u,{currentExhibition:t,halls:x}=L(a=>a.exhibition),l=f.useRef(null),[o,C]=Y.useMessage(),[m,c]=f.useState(!1),[b,g]=f.useState(null),[w,M]=f.useState({width:0,height:0});f.useEffect(()=>{const a=()=>{if(l.current){const{clientWidth:h,clientHeight:p}=l.current;M({width:Math.max(h||400,400),height:Math.max(p||400,400)})}};a();const d=new ResizeObserver(a);return l.current&&d.observe(l.current),window.addEventListener("resize",a),()=>{d.disconnect(),window.removeEventListener("resize",a)}},[]),f.useEffect(()=>{if(!n){o.error("Exhibition ID not found"),r("/exhibition");return}i(P(n))},[n,i,r,o]),f.useEffect(()=>{var a,d;if(t){if(!((a=t.dimensions)!=null&&a.width)||!((d=t.dimensions)!=null&&d.height)){o.info("Please set up exhibition space first"),r(S(t,"space"),{state:{exhibitionId:n}});return}i(I(n))}},[t,n,i,r,o]);const k=()=>{g(null),c(!0)},T=a=>{g(a),c(!!a)},F=async a=>{var d;try{a.id?(await H.updateHall(n,a.id,a),o.success("Hall updated successfully"),c(!1)):(await H.createHall(n,a),o.success("Hall created successfully"),c(!1)),i(I(n))}catch(h){console.error("Hall operation failed:",h),((d=h.response)==null?void 0:d.status)===409?o.warning({content:h.response.data.message,duration:6,style:{marginTop:"20vh"}}):(o.error(h.message||"Failed to save hall"),c(!1))}},A=async a=>{var d,h;try{const p=a._id||a.id;if(!p)throw new Error("Hall ID is required");await H.deleteHall(n,p),o.success("Hall deleted successfully"),c(!1),g(null),i(I(n))}catch(p){console.error("Failed to delete hall:",p),o.error(((h=(d=p.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to delete hall")}},$=async()=>{try{await H.saveLayout(n,x),o.success("Layout saved successfully")}catch{o.error("Failed to save layout")}};return e.jsxs("div",{style:{padding:"24px",height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(te,{exhibitionId:n}),C,e.jsx(Q,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(v,{children:[e.jsx("span",{children:"Hall Management"}),e.jsx(y,{icon:e.jsx(Z,{}),onClick:()=>r(S(t,"space"),{state:{exhibitionId:n}}),children:"Back to Space Setup"})]}),e.jsxs(v,{children:[e.jsx(y,{type:"primary",icon:e.jsx(J,{}),onClick:k,children:"Add Hall"}),e.jsx(y,{type:"primary",icon:e.jsx(K,{}),onClick:$,disabled:!x.length,children:"Save Layout"})]})]}),styles:{body:{flex:1,padding:0,overflow:"hidden",minHeight:"400px",position:"relative",background:"#fafafa"}},style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:"500px"},children:e.jsx("div",{ref:l,style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden"},children:e.jsx(q,{children:w.width>0&&w.height>0&&(t==null?void 0:t.dimensions)&&e.jsx(O,{width:w.width,height:w.height,exhibitionWidth:t.dimensions.width,exhibitionHeight:t.dimensions.height,halls:x,selectedHall:b,onSelectHall:T,onHallChange:F,onAddHall:k})})})}),e.jsx(se,{visible:m,hall:b,onCancel:()=>c(!1),onSubmit:F,onDelete:A,exhibitionWidth:((R=t==null?void 0:t.dimensions)==null?void 0:R.width)||100,exhibitionHeight:((z=t==null?void 0:t.dimensions)==null?void 0:z.height)||100})]})};export{oe as default};
