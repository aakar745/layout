import{p as _,j as e}from"./index-nu_xN7Rs.js";import{r as c,u as H,k as Q}from"./vendor-react-BNeW3y6d.js";import{T as Z,P as ee,c as f,a6 as te,a4 as ne,a5 as z,J as se,j as ae,n as L,aN as x,al as p,E as l,S as h,b as o,d as y,aw as ie,a as oe,V as re,aO as ce,aW as le,aX as P,h as $,m as B,x as M,W as v,Y as de,ap as ue,a3 as xe}from"./vendor-antd-CPyaZRZ0.js";import"./vendor-utils-DNTYNPA0.js";import"./vendor-styling-DBLAJE0-.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:pe,Text:r}=Z,{Option:ve}=xe,{TabPane:g}=L,{confirm:he}=de,{Search:ge}=se,Se=()=>{const[i,Y]=c.useState([]),[d,S]=c.useState(!0),[w,C]=c.useState(null),[j,I]=c.useState(""),[k,T]=c.useState("all"),R=H(),E=Q();c.useEffect(()=>{b()},[]),c.useEffect(()=>{const n=new URLSearchParams(E.search).get("status");n&&T(n)},[E]);const b=async()=>{try{S(!0),C(null);const t=await _.getExhibitorBookings();Y(t.data||[])}catch(t){console.error("Error fetching bookings:",t),C("Failed to load bookings. Please try again.")}finally{S(!1)}},D=t=>{he({title:"Are you sure you want to cancel this booking?",icon:e.jsx(ue,{}),content:"This action cannot be undone. Once cancelled, the stalls will be available for others to book.",okText:"Yes, Cancel Booking",okType:"danger",cancelText:"No, Keep Booking",onOk:async()=>{try{await _.cancelExhibitorBooking(t),v.success("Booking cancelled successfully"),b()}catch(n){console.error("Error cancelling booking:",n),v.error("Failed to cancel booking")}}})},A=t=>{switch(t){case"approved":return e.jsxs(o,{color:"success",children:[e.jsx(M,{})," Approved"]});case"pending":return e.jsxs(o,{color:"warning",children:[e.jsx($,{})," Pending"]});case"rejected":return e.jsxs(o,{color:"error",children:[e.jsx(B,{})," Rejected"]});case"confirmed":return e.jsxs(o,{color:"blue",children:[e.jsx(M,{})," Confirmed"]});case"cancelled":return e.jsxs(o,{color:"default",children:[e.jsx(B,{})," Cancelled"]});default:return e.jsx(o,{children:"Unknown"})}},K=t=>{switch(t){case"paid":return e.jsxs(o,{color:"success",children:[e.jsx(P,{})," Paid"]});case"pending":return e.jsxs(o,{color:"warning",children:[e.jsx($,{})," Pending"]});case"refunded":return e.jsxs(o,{color:"default",children:[e.jsx(P,{})," Refunded"]});default:return e.jsx(o,{children:"Unknown"})}},F=async t=>{try{R(`/exhibitor/invoice/${t}`)}catch(n){console.error("Error navigating to invoice:",n),v.error("Failed to access invoice. Please try again.")}},u=[{title:"Exhibition",dataIndex:["exhibitionId","name"],key:"exhibitionName",render:(t,n)=>{var a,s;return e.jsxs(h,{direction:"vertical",size:0,children:[e.jsx(r,{strong:!0,children:((a=n.exhibitionId)==null?void 0:a.name)||"N/A"}),e.jsx(r,{type:"secondary",style:{fontSize:"12px"},children:((s=n.exhibitionId)==null?void 0:s.venue)||"N/A"})]})},sorter:(t,n)=>{var a,s;return(((a=t.exhibitionId)==null?void 0:a.name)||"").localeCompare(((s=n.exhibitionId)==null?void 0:s.name)||"")}},{title:"Stall(s)",dataIndex:"stallIds",key:"stallNumbers",render:t=>e.jsx(h,{direction:"vertical",size:4,children:(t==null?void 0:t.map(n=>e.jsx(o,{children:n.number},n._id)))||"N/A"})},{title:"Type",key:"stallType",render:(t,n)=>{var a;return e.jsx(h,{direction:"vertical",size:4,children:((a=n.stallIds)==null?void 0:a.map(s=>{var m;return(m=s.stallTypeId)!=null&&m.name?e.jsx(o,{color:"blue",children:s.stallTypeId.name},s._id):e.jsx(r,{type:"secondary",children:"N/A"},s._id)}))||"N/A"})}},{title:"Dimensions",key:"dimensions",render:(t,n)=>{var a;return e.jsx(h,{direction:"vertical",size:4,children:((a=n.stallIds)==null?void 0:a.map(s=>e.jsxs(r,{children:[s.dimensions.width,"m x ",s.dimensions.height,"m"]},s._id)))||"N/A"})}},{title:"Dates",key:"dates",render:(t,n)=>{var a,s;return e.jsxs(h,{direction:"vertical",size:0,children:[e.jsxs(r,{children:[e.jsx(ie,{style:{marginRight:4}}),y((a=n.exhibitionId)==null?void 0:a.startDate).format("MMM D")," - ",y((s=n.exhibitionId)==null?void 0:s.endDate).format("MMM D, YYYY")]}),e.jsxs(r,{type:"secondary",style:{fontSize:"12px"},children:["Booked: ",y(n.createdAt).format("MMM D, YYYY")]})]})},sorter:(t,n)=>y(t.createdAt).unix()-y(n.createdAt).unix()},{title:"Amount",dataIndex:"amount",key:"amount",render:t=>e.jsxs(r,{strong:!0,children:["â‚¹",t.toLocaleString()]}),sorter:(t,n)=>t.amount-n.amount},{title:"Status",key:"status",dataIndex:"status",render:(t,n)=>t==="rejected"&&n.rejectionReason?e.jsxs(oe,{title:n.rejectionReason,children:[A(t),e.jsx(re,{style:{marginLeft:4,color:"#ff4d4f"}})]}):A(t),filters:[{text:"Approved",value:"approved"},{text:"Pending",value:"pending"},{text:"Rejected",value:"rejected"},{text:"Confirmed",value:"confirmed"},{text:"Cancelled",value:"cancelled"}],onFilter:(t,n)=>n.status===t},{title:"Payment",key:"paymentStatus",dataIndex:"paymentStatus",render:t=>K(t),filters:[{text:"Paid",value:"paid"},{text:"Pending",value:"pending"},{text:"Refunded",value:"refunded"}],onFilter:(t,n)=>n.paymentStatus===t},{title:"Actions",key:"actions",render:(t,n)=>e.jsxs(h,{children:[e.jsx(f,{type:"link",icon:e.jsx(ce,{}),onClick:()=>R(`/exhibitor/bookings/${n._id}`),children:"Details"}),(n.status==="approved"||n.status==="confirmed")&&e.jsx(f,{type:"link",icon:e.jsx(le,{}),onClick:()=>F(n._id),children:"Invoice"}),n.status==="pending"&&e.jsx(f,{type:"link",danger:!0,onClick:()=>D(n._id),children:"Cancel"})]})}],O=t=>{I(t)},N=i.filter(t=>{var s,m;const n=(((s=t.exhibitionId)==null?void 0:s.name)||"").toLowerCase().includes(j.toLowerCase())||t.stallIds.some(q=>q.number.toLowerCase().includes(j.toLowerCase()))||(((m=t.exhibitionId)==null?void 0:m.venue)||"").toLowerCase().includes(j.toLowerCase())||(t.customerName||"").toLowerCase().includes(j.toLowerCase()),a=k==="all"||t.status===k;return n&&a}),U=()=>i.length,W=()=>i.filter(t=>t.status==="pending").length,V=()=>i.filter(t=>t.status==="approved").length,G=()=>i.filter(t=>t.status==="confirmed").length,J=()=>i.filter(t=>t.status==="rejected").length,X=()=>i.filter(t=>t.status==="cancelled").length;return e.jsxs("div",{children:[e.jsx(pe,{level:2,children:"My Bookings"}),e.jsx(r,{type:"secondary",children:"Manage all your exhibition stall bookings in one place"}),w&&e.jsx(ee,{message:"Error",description:w,type:"error",showIcon:!0,style:{marginTop:24,marginBottom:24},action:e.jsx(f,{type:"primary",onClick:b,children:"Retry"})}),e.jsxs(te,{style:{marginTop:24},children:[e.jsxs(ne,{gutter:[16,16],style:{marginBottom:16},children:[e.jsx(z,{flex:"auto",children:e.jsx(ge,{placeholder:"Search bookings by exhibition name, stall number, or venue",onSearch:O,onChange:t=>I(t.target.value),style:{width:"100%",maxWidth:400},allowClear:!0})}),e.jsx(z,{children:e.jsx(f,{icon:e.jsx(ae,{}),onClick:b,children:"Refresh"})})]}),e.jsxs(L,{defaultActiveKey:k,onChange:t=>T(t),children:[e.jsx(g,{tab:`All Bookings (${U()})`,children:d?e.jsx(x,{active:!0,paragraph:{rows:5}}):N.length>0?e.jsx(p,{columns:u,dataSource:N,rowKey:"_id",pagination:{pageSize:10},scroll:{x:!0},size:"middle"}):e.jsx(l,{description:j?"No bookings match your search criteria":"No bookings found",image:l.PRESENTED_IMAGE_SIMPLE})},"all"),e.jsx(g,{tab:`Pending (${W()})`,children:d?e.jsx(x,{active:!0,paragraph:{rows:5}}):e.jsx(p,{columns:u,dataSource:i.filter(t=>t.status==="pending"),rowKey:"_id",pagination:{pageSize:10},locale:{emptyText:e.jsx(l,{description:"No pending bookings"})},scroll:{x:!0},size:"middle"})},"pending"),e.jsx(g,{tab:`Approved (${V()})`,children:d?e.jsx(x,{active:!0,paragraph:{rows:5}}):e.jsx(p,{columns:u,dataSource:i.filter(t=>t.status==="approved"),rowKey:"_id",pagination:{pageSize:10},locale:{emptyText:e.jsx(l,{description:"No approved bookings"})},scroll:{x:!0},size:"middle"})},"approved"),e.jsx(g,{tab:`Confirmed (${G()})`,children:d?e.jsx(x,{active:!0,paragraph:{rows:5}}):e.jsx(p,{columns:u,dataSource:i.filter(t=>t.status==="confirmed"),rowKey:"_id",pagination:{pageSize:10},locale:{emptyText:e.jsx(l,{description:"No confirmed bookings"})},scroll:{x:!0},size:"middle"})},"confirmed"),e.jsx(g,{tab:`Rejected (${J()})`,children:d?e.jsx(x,{active:!0,paragraph:{rows:5}}):e.jsx(p,{columns:u,dataSource:i.filter(t=>t.status==="rejected"),rowKey:"_id",pagination:{pageSize:10},locale:{emptyText:e.jsx(l,{description:"No rejected bookings"})},scroll:{x:!0},size:"middle"})},"rejected"),e.jsx(g,{tab:`Cancelled (${X()})`,children:d?e.jsx(x,{active:!0,paragraph:{rows:5}}):e.jsx(p,{columns:u,dataSource:i.filter(t=>t.status==="cancelled"),rowKey:"_id",pagination:{pageSize:10},locale:{emptyText:e.jsx(l,{description:"No cancelled bookings"})},scroll:{x:!0},size:"middle"})},"cancelled")]})]})]})};export{Se as default};
