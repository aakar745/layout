import{D as b,K as R,j as s}from"./index-ZeXq6Cnq.js";import{u as we,j as ye,i as ve,r as d,R as T}from"./vendor-react-BNeW3y6d.js";import{u as B,w as be}from"./vendor-export-CrAKd1if.js";/* empty css                  */import{a6 as $,a7 as c,S as z,T as Ce,c as ee,aQ as te,a1 as I,I as Ae,aZ as ke,a5 as Te,aI as F,b8 as D,Y as Ee,aj as Pe,b as _e,U as se}from"./vendor-antd-DmzwxccF.js";import"./vendor-utils-D9BQhWAM.js";import"./vendor-styling-C4kvkEn0.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:$e,Text:Fe}=Ce,{Option:v}=I,De=()=>{var Z;const L=we(),y=ye(),{stalls:ae,loading:ie,stallsPagination:N}=ve(e=>e.exhibition),[W,le]=d.useState([]),[f,K]=d.useState([]),[l,ne]=d.useState(null),[i,M]=d.useState(null),[oe,E]=d.useState(!1),[Q,C]=d.useState({totalStalls:0,totalArea:0}),[m,re]=d.useState(""),[x,de]=d.useState(null),[g,ce]=d.useState("number"),[p,he]=d.useState("ascend"),[U,A]=d.useState(1),[j,ue]=d.useState(10),Y=T.useRef({statusFilter:x,sortField:g,sortOrder:p,pageSize:j});T.useEffect(()=>{Y.current={statusFilter:x,sortField:g,sortOrder:p,pageSize:j}},[x,g,p,j]);const k=T.useCallback(async()=>{if(!l||!i){C({totalStalls:0,totalArea:0});return}try{const e={page:1,limit:1e4,search:m||void 0,status:x||void 0,sortBy:g,sortOrder:p==="ascend"?"asc":"desc"},a=(i==="all"?await b.getStalls(l,void 0,e):await b.getStalls(l,i,e)).data,h=a&&typeof a=="object"&&"stalls"in a?a.stalls:a,S=h.reduce((u,r)=>{var P,_;return(P=r==null?void 0:r.dimensions)!=null&&P.width&&((_=r==null?void 0:r.dimensions)!=null&&_.height)?u+r.dimensions.width*r.dimensions.height:u},0);C({totalStalls:h.length,totalArea:S})}catch(e){console.error("Failed to fetch total stats:",e),C({totalStalls:0,totalArea:0})}},[l,i,m,x,g,p]),H=T.useCallback(e=>{l&&i&&(y(R({exhibitionId:l,hallId:i==="all"?void 0:i,page:e.page||U,limit:e.size||j,search:e.search||void 0,status:e.status||void 0,sortBy:e.sortBy||g,sortOrder:e.sortOrder||(p==="ascend"?"asc":"desc")})),k())},[y,l,i,U,j,g,p,k]);T.useEffect(()=>{if(!l||!i)return;const e=setTimeout(()=>{if(l&&i){const t=Y.current;y(R({exhibitionId:l,hallId:i==="all"?void 0:i,page:1,limit:t.pageSize,search:m||void 0,status:t.statusFilter||void 0,sortBy:t.sortField,sortOrder:t.sortOrder==="ascend"?"asc":"desc"})),A(1),k()}},500);return()=>clearTimeout(e)},[m,l,i,y,k]);const me=e=>{de(e),A(1),H({page:1,search:m||void 0,status:e})},xe=(e,t)=>{ce(e),he(t),A(1),H({page:1,search:m||void 0,status:x,sortBy:e,sortOrder:t==="ascend"?"asc":"desc"})},J=(e,t)=>{A(e),t&&t!==j&&ue(t),H({page:e,size:t||j,search:m||void 0,status:x})},V=async(e=!0)=>{var t,a;try{let o=q;if(e&&l&&i){const n={page:1,limit:1e4,search:m||void 0,status:x||void 0,sortBy:g,sortOrder:p==="ascend"?"asc":"desc"},w=(i==="all"?await b.getStalls(l,void 0,n):await b.getStalls(l,i,n)).data;o=w&&typeof w=="object"&&"stalls"in w?w.stalls:w}const h=o.map(n=>{var O,w;return{"Stall Number":n.number,Hall:((O=f.find(G=>G._id===n.hallId))==null?void 0:O.name)||"N/A","Stall Type":((w=n.stallType)==null?void 0:w.name)||"N/A","Dimensions (W×H)":`${n.dimensions.width}×${n.dimensions.height}`,"Area (sq.m)":n.dimensions.width*n.dimensions.height,"Rate per Sq.m":`₹${n.ratePerSqm.toLocaleString()}`,"Total Price":`₹${(n.ratePerSqm*n.dimensions.width*n.dimensions.height).toLocaleString()}`,Status:n.status.charAt(0).toUpperCase()+n.status.slice(1),"Position (X,Y)":`${n.dimensions.x},${n.dimensions.y}`,"Created Date":new Date(n.createdAt||Date.now()).toLocaleDateString()}}),S=B.book_new(),u=B.json_to_sheet(h),r=[{wch:15},{wch:20},{wch:15},{wch:15},{wch:12},{wch:15},{wch:18},{wch:12},{wch:15},{wch:15}];u["!cols"]=r,B.book_append_sheet(S,u,"Stalls");const P=((t=W.find(n=>n._id===l))==null?void 0:t.name)||"Exhibition",_=i==="all"?"All-Halls":((a=f.find(n=>n._id===i))==null?void 0:a.name)||"Hall",fe=new Date().toISOString().split("T")[0],je=`${P}-${_}-Stalls-${fe}.xlsx`;be(S,je),se.success(`Exported ${o.length} stalls to Excel successfully!`)}catch(o){console.error("Export failed:",o),se.error("Failed to export stalls. Please try again.")}},Se=e=>{ne(e),M(null),y({type:"exhibition/clearStalls"}),C({totalStalls:0,totalArea:0})},ge=e=>{M(e),A(1),l&&e?(y(R({exhibitionId:l,hallId:e==="all"?void 0:e,page:1,limit:j,search:m||void 0,status:x||void 0,sortBy:g,sortOrder:p==="ascend"?"asc":"desc"})),k()):(y({type:"exhibition/clearStalls"}),C({totalStalls:0,totalArea:0}))};d.useEffect(()=>{(async()=>{try{E(!0),console.log("Fetching exhibitions...");const t=await b.getActiveExhibitions();console.log("Exhibitions response:",t.data),le(t.data)}catch(t){console.error("Failed to fetch exhibitions:",t)}finally{E(!1)}})()},[]),d.useEffect(()=>{l?(async()=>{try{E(!0),console.log("Fetching halls for exhibition:",l);const t=await b.getHalls(l);console.log("Halls response:",t.data),K(t.data)}catch(t){console.error("Failed to fetch halls:",t)}finally{E(!1)}})():K([])},[l]);const q=ae,pe=e=>{switch(e){case"available":return"success";case"booked":return"warning";case"reserved":return"processing";case"sold":return"error";default:return"default"}},X={totalStalls:Q.totalStalls,totalSize:Q.totalArea};return s.jsx("div",{className:"dashboard-container",children:s.jsx("div",{style:{marginBottom:"24px"},children:s.jsxs($,{gutter:[24,24],children:[s.jsx(c,{span:24,children:s.jsxs($,{justify:"space-between",align:"middle",children:[s.jsx(c,{children:s.jsxs(z,{direction:"vertical",size:4,children:[s.jsx($e,{level:4,style:{margin:0},children:"Stalls"}),s.jsx(Fe,{type:"secondary",children:"Manage your exhibition stalls"})]})}),s.jsx(c,{children:s.jsxs(z,{children:[s.jsx(ee,{icon:s.jsx(te,{}),onClick:()=>V(!1),disabled:!i||q.length===0,children:"Export Current Page"}),s.jsx(ee,{type:"primary",icon:s.jsx(te,{}),onClick:()=>V(!0),disabled:!i,children:"Export All Stalls"})]})})]})}),s.jsx(c,{span:24,children:s.jsxs($,{gutter:[16,16],align:"middle",children:[s.jsx(c,{xs:24,sm:12,md:6,children:s.jsx(I,{style:{width:"100%"},placeholder:"Select Exhibition",value:l,onChange:Se,allowClear:!0,children:W.map(e=>s.jsx(v,{value:e._id||e.id,children:e.name},e._id||e.id))})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsxs(I,{style:{width:"100%"},placeholder:"Select Hall",value:i,onChange:ge,disabled:!l||f.length===0,allowClear:!0,children:[s.jsxs(v,{value:"all",children:["All Halls (",f.length," halls)"]},"all-halls"),f.map(e=>s.jsx(v,{value:e._id||e.id,children:e.name},e._id||e.id))]})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsx(Ae,{placeholder:"Search by stall number",prefix:s.jsx(ke,{}),value:m,onChange:e=>re(e.target.value),allowClear:!0})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsxs(I,{style:{width:"100%"},placeholder:"Filter by status",value:x,onChange:me,allowClear:!0,children:[s.jsx(v,{value:"available",children:"Available"}),s.jsx(v,{value:"booked",children:"Booked"}),s.jsx(v,{value:"reserved",children:"Reserved"}),s.jsx(v,{value:"sold",children:"Sold"})]})})]})}),s.jsx(c,{span:24,children:s.jsx(Te,{size:"small",children:s.jsxs($,{gutter:16,children:[s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(F,{title:"Total Stalls",value:X.totalStalls,prefix:s.jsx(D,{})})}),s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(F,{title:"Total Area",value:X.totalSize,suffix:"sqm",prefix:s.jsx(Ee,{}),precision:2})}),i==="all"&&s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(F,{title:"Halls",value:f.length,prefix:s.jsx(D,{})})}),i!=="all"&&i&&s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(F,{title:"Current Hall",value:((Z=f.find(e=>(e._id||e.id)===i))==null?void 0:Z.name)||"N/A",prefix:s.jsx(D,{})})})]})})}),s.jsx(c,{span:24,children:s.jsx(Pe,{columns:[{title:"Stall Number",dataIndex:"number",key:"number",sorter:(e,t)=>e.number.localeCompare(t.number),defaultSortOrder:"ascend"},...i==="all"?[{title:"Hall",key:"hall",render:(e,t)=>{const a=f.find(o=>(o._id||o.id)===t.hallId);return(a==null?void 0:a.name)||"N/A"}}]:[],{title:"Type",dataIndex:["stallType","name"],key:"type",render:(e,t)=>{var a;return((a=t.stallType)==null?void 0:a.name)||"N/A"}},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"ratePerSqm",render:e=>e?`₹${e.toLocaleString()}`:"N/A",sorter:(e,t)=>(e.ratePerSqm||0)-(t.ratePerSqm||0)},{title:"Area (sqm)",key:"area",render:(e,t)=>{var a,o;return(a=t==null?void 0:t.dimensions)!=null&&a.width&&((o=t==null?void 0:t.dimensions)!=null&&o.height)?`${t.dimensions.width*t.dimensions.height} sqm`:"N/A"},sorter:(e,t)=>{var h,S,u,r;const a=(((h=e.dimensions)==null?void 0:h.width)||0)*(((S=e.dimensions)==null?void 0:S.height)||0),o=(((u=t.dimensions)==null?void 0:u.width)||0)*(((r=t.dimensions)==null?void 0:r.height)||0);return a-o}},{title:"Dimensions",key:"dimensions",render:(e,t)=>{var a,o;return(a=t==null?void 0:t.dimensions)!=null&&a.width&&((o=t==null?void 0:t.dimensions)!=null&&o.height)?`${t.dimensions.width}m × ${t.dimensions.height}m`:"N/A"}},{title:"Total Price",key:"totalPrice",render:(e,t)=>{var a,o;return(a=t==null?void 0:t.dimensions)!=null&&a.width&&((o=t==null?void 0:t.dimensions)!=null&&o.height)&&t.ratePerSqm?`₹${(t.ratePerSqm*t.dimensions.width*t.dimensions.height).toLocaleString()}`:"N/A"},sorter:(e,t)=>{var h,S,u,r;const a=(e.ratePerSqm||0)*(((h=e.dimensions)==null?void 0:h.width)||0)*(((S=e.dimensions)==null?void 0:S.height)||0),o=(t.ratePerSqm||0)*(((u=t.dimensions)==null?void 0:u.width)||0)*(((r=t.dimensions)==null?void 0:r.height)||0);return a-o}},{title:"Status",dataIndex:"status",key:"status",render:e=>s.jsx(_e,{color:pe(e),style:{textTransform:"capitalize"},children:e||"N/A"}),filters:[{text:"Available",value:"available"},{text:"Booked",value:"booked"},{text:"Reserved",value:"reserved"},{text:"Sold",value:"sold"}],onFilter:(e,t)=>t.status===e},{title:"Actions",key:"actions",render:(e,t)=>s.jsxs(z,{children:[s.jsx("a",{onClick:()=>L(`/stall/edit/${t._id||t.id}`),children:"Edit"}),s.jsx("a",{onClick:()=>L(`/stall/view/${t._id||t.id}`),children:"View"})]})}],dataSource:q,rowKey:e=>e._id||e.id,loading:oe||ie,pagination:{current:N.currentPage,pageSize:N.pageSize,total:N.totalCount,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} stalls`,onChange:J,onShowSizeChange:J,pageSizeOptions:["10","25","50","100"]},onChange:(e,t,a)=>{a.field&&a.order&&xe(a.field,a.order)}})})]})})})};export{De as default};
