import{j as s,y as $,C as X}from"./index-aoH9EzMk.js";import{u as Z,F as ee,p as te,r,R as P,a9 as w,aa as n,S as A,T as se,aF as v,Y as ie,bs as ae,ab as M,ac as N,bY as ne,ay as le,i as S,aI as re,aB as _,aS as oe,h as de}from"./vendor-Be5M1UDi.js";import"./apis-CU9I9MMq.js";import"./canvas-C-A9eff5.js";const{Title:ce,Text:he}=se,{Option:x}=v,Se=()=>{const F=Z(),C=ee(),{stalls:g,loading:B}=te(e=>e.exhibition),[H,D]=r.useState([]),[q,E]=r.useState([]),[c,O]=r.useState(null),[j,L]=r.useState(null),[Y,f]=r.useState(!1),k=P.useMemo(()=>Math.max(...g.map(e=>e.ratePerSqm*e.dimensions.width*e.dimensions.height),1e6),[g]),m=P.useMemo(()=>{const e=Math.pow(10,Math.floor(Math.log10(k)));return Math.ceil(k/e)*e},[k]),[b,K]=r.useState(""),[y,U]=r.useState(null),[d,h]=r.useState([0,m]),[R,V]=r.useState("number"),[z,G]=r.useState("ascend"),J=e=>{O(e),L(null),C({type:"exhibition/clearStalls"})},Q=e=>{L(e),C(c&&e?X({exhibitionId:c,hallId:e}):{type:"exhibition/clearStalls"})};r.useEffect(()=>{(async()=>{try{f(!0),console.log("Fetching exhibitions...");const t=await $.getActiveExhibitions();console.log("Exhibitions response:",t.data),D(t.data)}catch(t){console.error("Failed to fetch exhibitions:",t)}finally{f(!1)}})()},[]),r.useEffect(()=>{c?(async()=>{try{f(!0),console.log("Fetching halls for exhibition:",c);const t=await $.getHalls(c);console.log("Halls response:",t.data),E(t.data)}catch(t){console.error("Failed to fetch halls:",t)}finally{f(!1)}})():E([])},[c]);const T=P.useMemo(()=>{console.log("Filtering stalls from Redux:",g);const e=g.filter(t=>{const i=!b||t.number.toLowerCase().includes(b.toLowerCase()),a=!y||t.status===y,l=!j||t.hallId===j,o=t.ratePerSqm*t.dimensions.width*t.dimensions.height,u=o>=d[0]&&o<=d[1];return i&&a&&l&&u}).sort((t,i)=>R==="number"?z==="ascend"?t.number.localeCompare(i.number):i.number.localeCompare(t.number):0);return console.log("Filtered stalls:",e),e},[g,b,y,j,d,R,z]),W=e=>{switch(e){case"available":return"success";case"booked":return"warning";case"reserved":return"processing";case"sold":return"error";default:return"default"}},I=(e=>{const t=e.reduce((i,a)=>{var l,o;return(l=a==null?void 0:a.dimensions)!=null&&l.width&&((o=a==null?void 0:a.dimensions)!=null&&o.height)?i+a.dimensions.width*a.dimensions.height:i},0);return{totalStalls:e.length,totalSize:t}})(T);return s.jsx("div",{className:"dashboard-container",children:s.jsx("div",{style:{marginBottom:"24px"},children:s.jsxs(w,{gutter:[24,24],children:[s.jsx(n,{span:24,children:s.jsxs(A,{direction:"vertical",size:4,style:{width:"100%"},children:[s.jsx(ce,{level:4,style:{margin:0},children:"Stalls"}),s.jsx(he,{type:"secondary",children:"Manage your exhibition stalls"})]})}),s.jsx(n,{span:24,children:s.jsxs(w,{gutter:[16,16],align:"middle",children:[s.jsx(n,{xs:24,sm:12,md:6,children:s.jsx(v,{style:{width:"100%"},placeholder:"Select Exhibition",value:c,onChange:J,allowClear:!0,children:H.map(e=>s.jsx(x,{value:e._id||e.id,children:e.name},e._id||e.id))})}),s.jsx(n,{xs:24,sm:12,md:6,children:s.jsx(v,{style:{width:"100%"},placeholder:"Select Hall",value:j,onChange:Q,disabled:!c||q.length===0,allowClear:!0,children:q.map(e=>s.jsx(x,{value:e._id||e.id,children:e.name},e._id||e.id))})}),s.jsx(n,{xs:24,sm:12,md:6,children:s.jsx(ie,{placeholder:"Search by stall number",prefix:s.jsx(ae,{}),value:b,onChange:e=>K(e.target.value),allowClear:!0})}),s.jsx(n,{xs:24,sm:12,md:6,children:s.jsxs(v,{style:{width:"100%"},placeholder:"Filter by status",value:y,onChange:U,allowClear:!0,children:[s.jsx(x,{value:"available",children:"Available"}),s.jsx(x,{value:"booked",children:"Booked"}),s.jsx(x,{value:"reserved",children:"Reserved"}),s.jsx(x,{value:"sold",children:"Sold"})]})})]})}),s.jsx(n,{span:24,children:s.jsx(M,{size:"small",children:s.jsxs(w,{gutter:16,children:[s.jsx(n,{xs:12,sm:12,md:6,children:s.jsx(N,{title:"Total Stalls",value:I.totalStalls,prefix:s.jsx(ne,{})})}),s.jsx(n,{xs:12,sm:12,md:6,children:s.jsx(N,{title:"Total Area",value:I.totalSize,suffix:"sqm",prefix:s.jsx(le,{}),precision:2})})]})})}),s.jsx(n,{span:24,children:s.jsx(M,{size:"small",title:"Price Range Filter",children:s.jsxs(w,{gutter:16,children:[s.jsx(n,{span:24,style:{marginBottom:16},children:s.jsxs(A,{children:[s.jsx(S,{size:"small",onClick:()=>h([0,5e5]),children:"Under ₹5L"}),s.jsx(S,{size:"small",onClick:()=>h([5e5,1e6]),children:"₹5L - ₹10L"}),s.jsx(S,{size:"small",onClick:()=>h([1e6,2e6]),children:"₹10L - ₹20L"}),s.jsx(S,{size:"small",onClick:()=>h([2e6,m]),children:"Above ₹20L"}),s.jsx(S,{size:"small",onClick:()=>h([0,m]),children:"All"})]})}),s.jsx(n,{span:16,children:s.jsx(re,{range:!0,min:0,max:m,value:d,onChange:e=>h(e),step:Math.max(1e3,Math.floor(m/1e3)),tooltip:{formatter:e=>`₹${(e||0).toLocaleString()}`}})}),s.jsx(n,{span:4,children:s.jsx(_,{style:{width:"100%"},min:0,max:d[1],value:d[0],onChange:e=>h([e||0,d[1]]),formatter:e=>`₹ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?Number(e.replace(/[^\d.-]/g,"")):0,step:1e3})}),s.jsx(n,{span:4,children:s.jsx(_,{style:{width:"100%"},min:d[0],max:m,value:d[1],onChange:e=>h([d[0],e||m]),formatter:e=>`₹ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?Number(e.replace(/[^\d.-]/g,"")):0,step:1e3})})]})})}),s.jsx(n,{span:24,children:s.jsx(oe,{columns:[{title:"Stall Number",dataIndex:"number",key:"number",sorter:(e,t)=>e.number.localeCompare(t.number),defaultSortOrder:"ascend"},{title:"Type",dataIndex:["stallType","name"],key:"type",render:(e,t)=>{var i;return((i=t.stallType)==null?void 0:i.name)||"N/A"}},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"ratePerSqm",render:e=>e?`₹${e.toLocaleString()}`:"N/A",sorter:(e,t)=>(e.ratePerSqm||0)-(t.ratePerSqm||0)},{title:"Area (sqm)",key:"area",render:(e,t)=>{var i,a;return(i=t==null?void 0:t.dimensions)!=null&&i.width&&((a=t==null?void 0:t.dimensions)!=null&&a.height)?`${t.dimensions.width*t.dimensions.height} sqm`:"N/A"},sorter:(e,t)=>{var l,o,u,p;const i=(((l=e.dimensions)==null?void 0:l.width)||0)*(((o=e.dimensions)==null?void 0:o.height)||0),a=(((u=t.dimensions)==null?void 0:u.width)||0)*(((p=t.dimensions)==null?void 0:p.height)||0);return i-a}},{title:"Dimensions",key:"dimensions",render:(e,t)=>{var i,a;return(i=t==null?void 0:t.dimensions)!=null&&i.width&&((a=t==null?void 0:t.dimensions)!=null&&a.height)?`${t.dimensions.width}m × ${t.dimensions.height}m`:"N/A"}},{title:"Total Price",key:"totalPrice",render:(e,t)=>{var i,a;return(i=t==null?void 0:t.dimensions)!=null&&i.width&&((a=t==null?void 0:t.dimensions)!=null&&a.height)&&t.ratePerSqm?`₹${(t.ratePerSqm*t.dimensions.width*t.dimensions.height).toLocaleString()}`:"N/A"},sorter:(e,t)=>{var l,o,u,p;const i=(e.ratePerSqm||0)*(((l=e.dimensions)==null?void 0:l.width)||0)*(((o=e.dimensions)==null?void 0:o.height)||0),a=(t.ratePerSqm||0)*(((u=t.dimensions)==null?void 0:u.width)||0)*(((p=t.dimensions)==null?void 0:p.height)||0);return i-a}},{title:"Status",dataIndex:"status",key:"status",render:e=>s.jsx(de,{color:W(e),style:{textTransform:"capitalize"},children:e||"N/A"}),filters:[{text:"Available",value:"available"},{text:"Booked",value:"booked"},{text:"Reserved",value:"reserved"},{text:"Sold",value:"sold"}],onFilter:(e,t)=>t.status===e},{title:"Actions",key:"actions",render:(e,t)=>s.jsxs(A,{children:[s.jsx("a",{onClick:()=>F(`/stall/edit/${t._id||t.id}`),children:"Edit"}),s.jsx("a",{onClick:()=>F(`/stall/view/${t._id||t.id}`),children:"View"})]})}],dataSource:T,rowKey:e=>e._id||e.id,loading:Y||B,pagination:{total:T.length,pageSize:10,showSizeChanger:!0,showTotal:e=>`Total ${e} stalls`},onChange:(e,t,i)=>{i.field&&(V(i.field),G(i.order))}})})]})})})};export{Se as default};
