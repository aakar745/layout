import{r as o,R as H,j as e}from"./vendor-react-core-GL8v-krj.js";import{u as ne,b as re}from"./vendor-redux-9XI87JsB.js";import{b as oe}from"./app-exhibition-Vu8xGXtg.js";import{m as J,o as N}from"./app-core-BUxrPMxd.js";import"./app-dashboard-DAvQsPhE.js";import{u as Y}from"./vendor-react-router-BoDVXa_L.js";import{R as P,C as c,S as w,T as Z,b as I,I as M,a as D,j as Q,B as f,z as ce,v as W,e as ee,h as V,A as de,F as v,M as he}from"./vendor-antd-core-1s5t57SE.js";import{j as ue,ai as me,_ as pe,c as xe}from"./vendor-antd-icons-C-4QrCZ0.js";const{Title:ge,Text:ye}=Z,{Option:F}=I,Se=()=>{const x=Y(),g=ne(),{stalls:m,loading:y}=re(t=>t.exhibition),[R,$]=o.useState([]),[q,z]=o.useState([]),[p,L]=o.useState(null),[n,T]=o.useState(null),[_,C]=o.useState(!1),A=H.useMemo(()=>Math.max(...m.map(t=>t.ratePerSqm*t.dimensions.width*t.dimensions.height),1e6),[m]),S=H.useMemo(()=>{const t=Math.pow(10,Math.floor(Math.log10(A)));return Math.ceil(A/t)*t},[A]),[k,O]=o.useState(""),[a,r]=o.useState(null),[d,j]=o.useState([0,S]),[U,te]=o.useState("number"),[K,se]=o.useState("ascend"),ae=t=>{L(t),T(null),g({type:"exhibition/clearStalls"})},le=t=>{T(t),g(p&&t?oe({exhibitionId:p,hallId:t}):{type:"exhibition/clearStalls"})};o.useEffect(()=>{(async()=>{try{C(!0),console.log("Fetching exhibitions...");const s=await J.getActiveExhibitions();console.log("Exhibitions response:",s.data),$(s.data)}catch(s){console.error("Failed to fetch exhibitions:",s)}finally{C(!1)}})()},[]),o.useEffect(()=>{p?(async()=>{try{C(!0),console.log("Fetching halls for exhibition:",p);const s=await J.getHalls(p);console.log("Halls response:",s.data),z(s.data)}catch(s){console.error("Failed to fetch halls:",s)}finally{C(!1)}})():z([])},[p]);const B=H.useMemo(()=>{console.log("Filtering stalls from Redux:",m);const t=m.filter(s=>{const l=!k||s.number.toLowerCase().includes(k.toLowerCase()),i=!a||s.status===a,h=!n||s.hallId===n,u=s.ratePerSqm*s.dimensions.width*s.dimensions.height,b=u>=d[0]&&u<=d[1];return l&&i&&h&&b}).sort((s,l)=>U==="number"?K==="ascend"?s.number.localeCompare(l.number):l.number.localeCompare(s.number):0);return console.log("Filtered stalls:",t),t},[m,k,a,n,d,U,K]),ie=t=>{switch(t){case"available":return"success";case"booked":return"warning";case"reserved":return"processing";case"sold":return"error";default:return"default"}},G=(t=>{const s=t.reduce((l,i)=>{var h,u;return(h=i==null?void 0:i.dimensions)!=null&&h.width&&((u=i==null?void 0:i.dimensions)!=null&&u.height)?l+i.dimensions.width*i.dimensions.height:l},0);return{totalStalls:t.length,totalSize:s}})(B);return e.jsx("div",{className:"dashboard-container",children:e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(P,{gutter:[24,24],children:[e.jsx(c,{span:24,children:e.jsxs(w,{direction:"vertical",size:4,style:{width:"100%"},children:[e.jsx(ge,{level:4,style:{margin:0},children:"Stalls"}),e.jsx(ye,{type:"secondary",children:"Manage your exhibition stalls"})]})}),e.jsx(c,{span:24,children:e.jsxs(P,{gutter:[16,16],align:"middle",children:[e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(I,{style:{width:"100%"},placeholder:"Select Exhibition",value:p,onChange:ae,allowClear:!0,children:R.map(t=>e.jsx(F,{value:t._id||t.id,children:t.name},t._id||t.id))})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(I,{style:{width:"100%"},placeholder:"Select Hall",value:n,onChange:le,disabled:!p||q.length===0,allowClear:!0,children:q.map(t=>e.jsx(F,{value:t._id||t.id,children:t.name},t._id||t.id))})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(M,{placeholder:"Search by stall number",prefix:e.jsx(ue,{}),value:k,onChange:t=>O(t.target.value),allowClear:!0})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(I,{style:{width:"100%"},placeholder:"Filter by status",value:a,onChange:r,allowClear:!0,children:[e.jsx(F,{value:"available",children:"Available"}),e.jsx(F,{value:"booked",children:"Booked"}),e.jsx(F,{value:"reserved",children:"Reserved"}),e.jsx(F,{value:"sold",children:"Sold"})]})})]})}),e.jsx(c,{span:24,children:e.jsx(D,{size:"small",children:e.jsxs(P,{gutter:16,children:[e.jsx(c,{xs:12,sm:12,md:6,children:e.jsx(Q,{title:"Total Stalls",value:G.totalStalls,prefix:e.jsx(me,{})})}),e.jsx(c,{xs:12,sm:12,md:6,children:e.jsx(Q,{title:"Total Area",value:G.totalSize,suffix:"sqm",prefix:e.jsx(pe,{}),precision:2})})]})})}),e.jsx(c,{span:24,children:e.jsx(D,{size:"small",title:"Price Range Filter",children:e.jsxs(P,{gutter:16,children:[e.jsx(c,{span:24,style:{marginBottom:16},children:e.jsxs(w,{children:[e.jsx(f,{size:"small",onClick:()=>j([0,5e5]),children:"Under ₹5L"}),e.jsx(f,{size:"small",onClick:()=>j([5e5,1e6]),children:"₹5L - ₹10L"}),e.jsx(f,{size:"small",onClick:()=>j([1e6,2e6]),children:"₹10L - ₹20L"}),e.jsx(f,{size:"small",onClick:()=>j([2e6,S]),children:"Above ₹20L"}),e.jsx(f,{size:"small",onClick:()=>j([0,S]),children:"All"})]})}),e.jsx(c,{span:16,children:e.jsx(ce,{range:!0,min:0,max:S,value:d,onChange:t=>j(t),step:Math.max(1e3,Math.floor(S/1e3)),tooltip:{formatter:t=>`₹${(t||0).toLocaleString()}`}})}),e.jsx(c,{span:4,children:e.jsx(W,{style:{width:"100%"},min:0,max:d[1],value:d[0],onChange:t=>j([t||0,d[1]]),formatter:t=>`₹ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t?Number(t.replace(/[^\d.-]/g,"")):0,step:1e3})}),e.jsx(c,{span:4,children:e.jsx(W,{style:{width:"100%"},min:d[0],max:S,value:d[1],onChange:t=>j([d[0],t||S]),formatter:t=>`₹ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t?Number(t.replace(/[^\d.-]/g,"")):0,step:1e3})})]})})}),e.jsx(c,{span:24,children:e.jsx(ee,{columns:[{title:"Stall Number",dataIndex:"number",key:"number",sorter:(t,s)=>t.number.localeCompare(s.number),defaultSortOrder:"ascend"},{title:"Type",dataIndex:["stallType","name"],key:"type",render:(t,s)=>{var l;return((l=s.stallType)==null?void 0:l.name)||"N/A"}},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"ratePerSqm",render:t=>t?`₹${t.toLocaleString()}`:"N/A",sorter:(t,s)=>(t.ratePerSqm||0)-(s.ratePerSqm||0)},{title:"Area (sqm)",key:"area",render:(t,s)=>{var l,i;return(l=s==null?void 0:s.dimensions)!=null&&l.width&&((i=s==null?void 0:s.dimensions)!=null&&i.height)?`${s.dimensions.width*s.dimensions.height} sqm`:"N/A"},sorter:(t,s)=>{var h,u,b,E;const l=(((h=t.dimensions)==null?void 0:h.width)||0)*(((u=t.dimensions)==null?void 0:u.height)||0),i=(((b=s.dimensions)==null?void 0:b.width)||0)*(((E=s.dimensions)==null?void 0:E.height)||0);return l-i}},{title:"Dimensions",key:"dimensions",render:(t,s)=>{var l,i;return(l=s==null?void 0:s.dimensions)!=null&&l.width&&((i=s==null?void 0:s.dimensions)!=null&&i.height)?`${s.dimensions.width}m × ${s.dimensions.height}m`:"N/A"}},{title:"Total Price",key:"totalPrice",render:(t,s)=>{var l,i;return(l=s==null?void 0:s.dimensions)!=null&&l.width&&((i=s==null?void 0:s.dimensions)!=null&&i.height)&&s.ratePerSqm?`₹${(s.ratePerSqm*s.dimensions.width*s.dimensions.height).toLocaleString()}`:"N/A"},sorter:(t,s)=>{var h,u,b,E;const l=(t.ratePerSqm||0)*(((h=t.dimensions)==null?void 0:h.width)||0)*(((u=t.dimensions)==null?void 0:u.height)||0),i=(s.ratePerSqm||0)*(((b=s.dimensions)==null?void 0:b.width)||0)*(((E=s.dimensions)==null?void 0:E.height)||0);return l-i}},{title:"Status",dataIndex:"status",key:"status",render:t=>e.jsx(V,{color:ie(t),style:{textTransform:"capitalize"},children:t||"N/A"}),filters:[{text:"Available",value:"available"},{text:"Booked",value:"booked"},{text:"Reserved",value:"reserved"},{text:"Sold",value:"sold"}],onFilter:(t,s)=>s.status===t},{title:"Actions",key:"actions",render:(t,s)=>e.jsxs(w,{children:[e.jsx("a",{onClick:()=>x(`/stall/edit/${s._id||s.id}`),children:"Edit"}),e.jsx("a",{onClick:()=>x(`/stall/view/${s._id||s.id}`),children:"View"})]})}],dataSource:B,rowKey:t=>t._id||t.id,loading:_||y,pagination:{total:B.length,pageSize:10,showSizeChanger:!0,showTotal:t=>`Total ${t} stalls`},onChange:(t,s,l)=>{l.field&&(te(l.field),se(l.order))}})})]})})})},Me=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"})),{Title:fe,Text:je}=Z,{TextArea:be}=M,{Search:ve}=M,{Option:X}=I,we=()=>{Y();const{message:x}=de.useApp(),[g,m]=o.useState(!1),[y]=v.useForm(),[R,$]=o.useState(!1),[q,z]=o.useState([]),[p,L]=o.useState(!1),[n,T]=o.useState(null);o.useEffect(()=>{_()},[]),o.useEffect(()=>{var a;if(console.log("Modal visibility changed:",g),console.log("Editing stall type:",n),g&&n){const r=((a=n.features)==null?void 0:a.map(d=>d.feature).join(", "))||"";console.log("Setting form values:",{name:n.name,description:n.description,features:r,status:n.status}),setTimeout(()=>{y.setFieldsValue({name:n.name,description:n.description,features:r,status:n.status})},0)}else g&&(y.resetFields(),y.setFieldsValue({status:"active"}))},[n,y,g]);const _=async()=>{try{L(!0);const a=await N.getStallTypes();z(a.data)}catch(a){x.error("Failed to fetch stall types: "+a.message)}finally{L(!1)}},C=async a=>{try{$(!0),console.log("Form values:",a);const r={name:a.name,description:a.description,status:a.status,features:a.features?a.features.split(",").map(d=>({feature:d.trim()})):[]};console.log("Submitting data:",r),n?(await N.updateStallType(n._id,r),x.success("Stall type updated successfully")):(await N.createStallType(r),x.success("Stall type created successfully")),m(!1),T(null),y.resetFields(),_()}catch(r){x.error(`Failed to ${n?"update":"create"} stall type: `+r.message)}finally{$(!1)}},A=a=>{console.log("Editing stall type:",a),T(a),m(!0)},S=async a=>{try{await N.deleteStallType(a._id),x.success("Stall type deleted successfully"),_()}catch(r){x.error("Failed to delete stall type: "+r.message)}},k=[{title:"Type Name",dataIndex:"name",key:"name",sorter:(a,r)=>a.name.localeCompare(r.name)},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0},{title:"Features",dataIndex:"features",key:"features",render:a=>e.jsx(w,{wrap:!0,children:a==null?void 0:a.map(({feature:r})=>e.jsx(V,{children:r},r))})},{title:"Status",dataIndex:"status",key:"status",render:a=>e.jsx(V,{color:a==="active"?"success":"default",children:a.toUpperCase()})},{title:"Actions",key:"actions",render:(a,r)=>e.jsxs(w,{children:[e.jsx(f,{type:"link",onClick:()=>A(r),children:"Edit"}),e.jsx(f,{type:"link",danger:!0,onClick:()=>S(r),children:"Delete"})]})}],O=()=>{m(!1),T(null),y.resetFields()};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(P,{justify:"space-between",align:"middle",children:[e.jsx(c,{children:e.jsxs(w,{direction:"vertical",size:4,children:[e.jsx(fe,{level:4,style:{margin:0},children:"Stall Types"}),e.jsx(je,{type:"secondary",children:"Manage your stall types and configurations"})]})}),e.jsx(c,{children:e.jsxs(w,{children:[e.jsx(ve,{placeholder:"Search stall types",style:{width:200},onSearch:a=>console.log(a)}),e.jsx(f,{type:"primary",icon:e.jsx(xe,{}),onClick:()=>m(!0),children:"Add Stall Type"})]})})]})}),e.jsx(D,{className:"info-card",children:e.jsx(ee,{columns:k,dataSource:q,rowKey:a=>a._id,loading:p})}),e.jsx(he,{title:n?"Edit Stall Type":"Add Stall Type",open:g,onCancel:O,footer:null,destroyOnClose:!1,children:e.jsxs(v,{form:y,layout:"vertical",onFinish:C,initialValues:{status:"active"},preserve:!0,children:[e.jsx(v.Item,{name:"name",label:"Type Name",rules:[{required:!0,message:"Please enter stall type name"}],children:e.jsx(M,{placeholder:"e.g., 1 Side Open"})}),e.jsx(v.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter description"}],children:e.jsx(be,{rows:4,placeholder:"Enter description"})}),e.jsx(v.Item,{name:"features",label:"Features",children:e.jsx(M,{placeholder:"Enter features (comma-separated)",allowClear:!0})}),e.jsx(v.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select status"}],children:e.jsxs(I,{children:[e.jsx(X,{value:"active",children:"Active"}),e.jsx(X,{value:"inactive",children:"Inactive"})]})}),e.jsx(v.Item,{children:e.jsxs(f,{type:"primary",htmlType:"submit",loading:R,block:!0,children:[n?"Update":"Create"," Stall Type"]})})]})})]})},$e=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{$e as a,Me as i};
