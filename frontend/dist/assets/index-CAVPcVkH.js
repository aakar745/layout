import{j as t,E as L,z as W,F as j,A as P,B as _,G as N,H as O,I as V}from"./index-DoSueJxk.js";import{X,m as q,u as E,l as G,k as I,r as n}from"./vendor-react-dkbxt9Jf.js";import{C as U,F as Y}from"./FixtureForm-CZKRuS-V.js";import"./vendor-canvas-CSSoKFlf.js";import{g as Z}from"./url-DUULaBjX.js";import{Y as $,a1 as J,S,ab as K,c as C,ah as Q,aE as ee}from"./vendor-antd-mFVHvrVJ.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";import"./stallUtils-DlikgrX5.js";import"./stall-BMZvk0fo.js";const te=({exhibitionId:a,destination:p="layout",label:b="Back to Layout"})=>{const u=E(),{currentExhibition:r}=I(s=>s.exhibition);return t.jsxs("div",{style:{marginBottom:"24px",position:"sticky",top:"16px",zIndex:10},children:[t.jsx(C,{icon:t.jsx(ee,{}),onClick:()=>u(Z(r,p),{state:{exhibitionId:a}}),type:"default",size:"large",style:{borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",background:"white",borderColor:"transparent",fontWeight:500,padding:"0 16px",height:"42px",display:"flex",alignItems:"center",transition:"all 0.3s ease"},className:"back-button-hover",children:t.jsx("span",{style:{marginLeft:8},children:b})}),t.jsx("style",{children:`
        .back-button-hover:hover {
          transform: translateX(-5px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: #f0f5ff;
          border-color: #d6e4ff;
        }
      `})]})},ie=[{value:"all",label:"All Types"},{value:"sofa",label:"Sofas"},{value:"chair",label:"Chairs"},{value:"table",label:"Tables"},{value:"desk",label:"Desks"},{value:"plant",label:"Plants"},{value:"entrance",label:"Entrances"},{value:"exit",label:"Exits"},{value:"info",label:"Information"},{value:"restroom",label:"Restrooms"},{value:"food",label:"Food Areas"},{value:"custom",label:"Custom"}],fe=()=>{const{message:a}=$.useApp(),{id:p}=X(),b=q(),u=E(),r=G(),s=b.state?.exhibitionId||p,{currentExhibition:l,fixtures:x,halls:k,stalls:z,loading:se}=I(e=>e.exhibition),d=n.useRef(null),[D,c]=n.useState(!1),[v,m]=n.useState(null),[h,A]=n.useState({width:0,height:0}),[f,B]=n.useState("all"),[H,F]=n.useState([]);n.useEffect(()=>{if(!s){a.error("Exhibition ID not found"),u("/exhibitions");return}},[s,u,a]),n.useEffect(()=>{(async()=>{try{await r(W(s)).unwrap(),await r(j({exhibitionId:s})).unwrap(),await r(P(s)).unwrap(),await r(_({exhibitionId:s})).unwrap()}catch{a.error("Failed to load data")}})()},[s,r,a]),n.useEffect(()=>{F(f==="all"?x:x.filter(e=>e.type===f))},[x,f]),n.useEffect(()=>{const e=()=>{if(d.current){const{clientWidth:o,clientHeight:g}=d.current;A({width:Math.max(o||400,400),height:Math.max(g||400,400)})}};e();const i=new ResizeObserver(e);return d.current&&i.observe(d.current),window.addEventListener("resize",e),()=>{i.disconnect(),window.removeEventListener("resize",e)}},[]);const w=()=>{m(null),c(!0)},R=e=>{m(e),c(!!e)},y=async e=>{try{const i=x.reduce((o,g)=>Math.max(o,g.zIndex||1),1);if(e.id||e._id){const o={...e,zIndex:i+1};await r(N({exhibitionId:s,id:e.id||e._id||"",data:o})).unwrap(),a.success("Fixture updated successfully")}else{const o={...e,zIndex:i+1};await r(O({exhibitionId:s,data:o})).unwrap(),a.success("Fixture created successfully")}await r(j({exhibitionId:s})).unwrap(),c(!1)}catch(i){console.error("Failed to save fixture:",i),a.error(i.message||"Failed to save fixture")}},M=async e=>{try{const i=e.id||e._id;if(!i)throw new Error("Fixture ID is required");await r(V({exhibitionId:s,id:i})).unwrap(),a.success("Fixture deleted successfully"),c(!1),m(null)}catch(i){console.error("Failed to delete fixture:",i),a.error(i.message||"Failed to delete fixture")}},T=e=>{B(e)};return t.jsxs("div",{style:{padding:"24px",height:"100vh",display:"flex",flexDirection:"column"},children:[t.jsx(te,{exhibitionId:s}),t.jsxs(J,{title:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(S,{children:t.jsx("span",{children:"Fixture Management"})}),t.jsxs(S,{children:[t.jsx(K,{style:{width:180},value:f,onChange:T,options:ie}),t.jsx(C,{type:"primary",icon:t.jsx(Q,{}),onClick:w,children:"Add Fixture"})]})]}),styles:{body:{flex:1,padding:0,overflow:"hidden",minHeight:"400px",position:"relative",background:"#fafafa"}},style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:"500px"},children:[t.jsx("div",{style:{padding:"8px 16px",background:"#f0f7ff",borderBottom:"1px solid #d6e8ff",color:"#0050b3",fontSize:"14px"},children:"Halls and stalls are shown for reference. Place fixtures relative to these elements to enhance visitor navigation."}),t.jsx("div",{ref:d,style:{position:"absolute",top:33,left:0,right:0,bottom:0,overflow:"hidden"},children:t.jsx(L,{children:h.width>0&&h.height>0&&l?.dimensions&&t.jsx(U,{width:h.width,height:h.height,exhibitionWidth:l.dimensions.width,exhibitionHeight:l.dimensions.height,halls:k,stalls:z,fixtures:H,selectedFixture:v,onSelectFixture:R,onFixtureChange:y,onAddFixture:w,isFixtureMode:!0})})})]}),t.jsx(Y,{visible:D,fixture:v,onCancel:()=>c(!1),onSubmit:y,onDelete:M,exhibitionWidth:l?.dimensions?.width||100,exhibitionHeight:l?.dimensions?.height||100})]})};export{fe as default};
