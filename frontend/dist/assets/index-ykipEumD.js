import{j as t,G as P,H as _,J as G,A as N,K as S,B as V,C as X,w as q,L as J,M as K,O as U}from"./index-aoH9EzMk.js";import{aO as $,aX as Q,G as Y,u as k,F as Z,p as I,r as o,ab as ee,S as C,aF as te,i as z,by as se,bz as ae}from"./vendor-Be5M1UDi.js";import"./canvas-C-A9eff5.js";import"./apis-CU9I9MMq.js";const ie=({exhibitionId:i,destination:x="layout",label:f="Back to Layout"})=>{const c=k(),{currentExhibition:n}=I(s=>s.exhibition);return t.jsxs("div",{style:{marginBottom:"24px",position:"sticky",top:"16px",zIndex:10},children:[t.jsx(z,{icon:t.jsx(ae,{}),onClick:()=>c(q(n,x),{state:{exhibitionId:i}}),type:"default",size:"large",style:{borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",background:"white",borderColor:"transparent",fontWeight:500,padding:"0 16px",height:"42px",display:"flex",alignItems:"center",transition:"all 0.3s ease"},className:"back-button-hover",children:t.jsx("span",{style:{marginLeft:8},children:f})}),t.jsx("style",{children:`
        .back-button-hover:hover {
          transform: translateX(-5px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: #f0f5ff;
          border-color: #d6e4ff;
        }
      `})]})},ne=[{value:"all",label:"All Types"},{value:"sofa",label:"Sofas"},{value:"chair",label:"Chairs"},{value:"table",label:"Tables"},{value:"desk",label:"Desks"},{value:"plant",label:"Plants"},{value:"entrance",label:"Entrances"},{value:"exit",label:"Exits"},{value:"info",label:"Information"},{value:"restroom",label:"Restrooms"},{value:"food",label:"Food Areas"},{value:"custom",label:"Custom"}],ue=()=>{var w,F,j;const{message:i}=$.useApp(),{id:x}=Q(),f=Y(),c=k(),n=Z(),s=((w=f.state)==null?void 0:w.exhibitionId)||x,{currentExhibition:r,fixtures:p,halls:E,stalls:D,loading:re}=I(e=>e.exhibition),l=o.useRef(null),[A,d]=o.useState(!1),[g,b]=o.useState(null),[u,B]=o.useState({width:0,height:0}),[h,H]=o.useState("all"),[R,m]=o.useState([]);o.useEffect(()=>{if(!s){i.error("Exhibition ID not found"),c("/exhibitions");return}},[s,c,i]),o.useEffect(()=>{(async()=>{try{await n(N(s)).unwrap(),await n(S({exhibitionId:s})).unwrap(),await n(V(s)).unwrap(),await n(X({exhibitionId:s})).unwrap()}catch{i.error("Failed to load data")}})()},[s,n,i]),o.useEffect(()=>{m(h==="all"?p:p.filter(e=>e.type===h))},[p,h]),o.useEffect(()=>{const e=()=>{if(l.current){const{clientWidth:O,clientHeight:W}=l.current;B({width:Math.max(O||400,400),height:Math.max(W||400,400)})}};e();const a=new ResizeObserver(e);return l.current&&a.observe(l.current),window.addEventListener("resize",e),()=>{a.disconnect(),window.removeEventListener("resize",e)}},[]);const v=()=>{b(null),d(!0)},L=e=>{b(e),d(!!e)},y=async e=>{try{e.id||e._id?(await n(J({exhibitionId:s,id:e.id||e._id||"",data:e})).unwrap(),i.success("Fixture updated successfully")):(await n(K({exhibitionId:s,data:e})).unwrap(),i.success("Fixture created successfully")),await n(S({exhibitionId:s})).unwrap(),d(!1)}catch(a){console.error("Failed to save fixture:",a),i.error(a.message||"Failed to save fixture")}},M=async e=>{try{const a=e.id||e._id;if(!a)throw new Error("Fixture ID is required");await n(U({exhibitionId:s,id:a})).unwrap(),i.success("Fixture deleted successfully"),d(!1),b(null)}catch(a){console.error("Failed to delete fixture:",a),i.error(a.message||"Failed to delete fixture")}},T=e=>{H(e)};return t.jsxs("div",{style:{padding:"24px",height:"100vh",display:"flex",flexDirection:"column"},children:[t.jsx(ie,{exhibitionId:s}),t.jsxs(ee,{title:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(C,{children:t.jsx("span",{children:"Fixture Management"})}),t.jsxs(C,{children:[t.jsx(te,{style:{width:180},value:h,onChange:T,options:ne}),t.jsx(z,{type:"primary",icon:t.jsx(se,{}),onClick:v,children:"Add Fixture"})]})]}),styles:{body:{flex:1,padding:0,overflow:"hidden",minHeight:"400px",position:"relative",background:"#fafafa"}},style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:"500px"},children:[t.jsx("div",{style:{padding:"8px 16px",background:"#f0f7ff",borderBottom:"1px solid #d6e8ff",color:"#0050b3",fontSize:"14px"},children:"Halls and stalls are shown for reference. Place fixtures relative to these elements to enhance visitor navigation."}),t.jsx("div",{ref:l,style:{position:"absolute",top:33,left:0,right:0,bottom:0,overflow:"hidden"},children:t.jsx(P,{children:u.width>0&&u.height>0&&(r==null?void 0:r.dimensions)&&t.jsx(_,{width:u.width,height:u.height,exhibitionWidth:r.dimensions.width,exhibitionHeight:r.dimensions.height,halls:E,stalls:D,fixtures:R,selectedFixture:g,onSelectFixture:L,onFixtureChange:y,onAddFixture:v,isFixtureMode:!0})})})]}),t.jsx(G,{visible:A,fixture:g,onCancel:()=>d(!1),onSubmit:y,onDelete:M,exhibitionWidth:((F=r==null?void 0:r.dimensions)==null?void 0:F.width)||100,exhibitionHeight:((j=r==null?void 0:r.dimensions)==null?void 0:j.height)||100})]})};export{ue as default};
