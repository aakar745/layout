import{j as c,z as D,C as I}from"./index-DoSueJxk.js";import{X as L,m as T,u as P,l as q,k as R,r as d,N as j}from"./vendor-react-dkbxt9Jf.js";import{E as F}from"./ExhibitionForm-DTCyQlYI.js";import{Y as B,a1 as b,d as u}from"./vendor-antd-mFVHvrVJ.js";import{g as y}from"./url-DUULaBjX.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";import"./stall-BMZvk0fo.js";const J=()=>{const{message:a}=B.useApp(),{id:z}=L(),o=T().state?.exhibitionId,s=P(),m=q(),{currentExhibition:t,loading:A,error:p}=R(e=>e.exhibition),[x,g]=d.useState(!1);d.useEffect(()=>{(async()=>{if(!o){a.error("Exhibition ID not found"),s("/exhibition");return}try{await m(D(o)).unwrap()}catch(r){a.error(r.message||"Failed to fetch exhibition"),s("/exhibition")}finally{g(!0)}})()},[o,m,a,s]),d.useEffect(()=>{p&&a.error(p)},[p,a]);const l=async e=>{if(!(!o||!t))try{const[r,f]=e.dateRange||[null,null],h=(i,E)=>!i||!Array.isArray(i)?[]:i.filter(n=>n&&n.type&&n.name&&n.description&&(E==="extra"?typeof n.rate=="number"&&n.rate>=0:typeof n.perSqm=="number"&&n.perSqm>0&&typeof n.quantity=="number"&&n.quantity>0)),S=h(e.amenities,"extra"),N=h(e.basicAmenities,"basic"),k={name:e.name,description:e.description,venue:e.venue,startDate:r?r.toISOString():t.startDate,endDate:f?f.toISOString():t.endDate,status:e.status,isActive:e.isActive,invoicePrefix:e.invoicePrefix,dimensions:t.dimensions,stallRates:e.stallRates?.map(i=>({stallTypeId:i.stallTypeId,rate:i.rate}))||[],taxConfig:e.taxConfig?.map(i=>({name:i.name,rate:i.rate,isActive:i.isActive}))||[],discountConfig:e.discountConfig?.map(i=>({name:i.name,type:i.type,value:i.value,isActive:i.isActive}))||[],publicDiscountConfig:e.publicDiscountConfig?.map(i=>({name:i.name,type:i.type,value:i.value,isActive:i.isActive}))||[],companyName:e.companyName,companyContactNo:e.companyContactNo,companyEmail:e.companyEmail,companyAddress:e.companyAddress,companyWebsite:e.companyWebsite,companyPAN:e.companyPAN,companyGST:e.companyGST,companySAC:e.companySAC,companyCIN:e.companyCIN,termsAndConditions:e.termsAndConditions,piInstructions:e.piInstructions,bankName:e.bankName,bankBranch:e.bankBranch,bankIFSC:e.bankIFSC,bankAccountName:e.bankAccountName,bankAccount:e.bankAccount,headerTitle:e.headerTitle,headerSubtitle:e.headerSubtitle,headerDescription:e.headerDescription,headerLogo:e.headerLogo,sponsorLogos:e.sponsorLogos,footerText:e.footerText,footerLogo:e.footerLogo,contactEmail:e.contactEmail,contactPhone:e.contactPhone,footerLinks:e.footerLinks||[],amenities:S.map(i=>({type:i.type,name:i.name.trim(),description:i.description.trim(),rate:Number(i.rate)})),basicAmenities:N.map(i=>({type:i.type,name:i.name.trim(),description:i.description.trim(),perSqm:Number(i.perSqm),quantity:Number(i.quantity)})),specialRequirements:e.specialRequirements,letterSettings:e.letterSettings};await m(I({id:o,data:k})).unwrap(),a.success("Exhibition updated successfully"),s(y(t),{state:{exhibitionId:o}})}catch(r){console.error("Exhibition update error:",r),a.error(r.message||"Failed to update exhibition")}};if(!x)return c.jsx(b,{loading:!0});if(!o)return c.jsx(j,{to:"/exhibition",replace:!0});if(A||!t)return c.jsx(b,{loading:!0});const C={name:t.name,description:t.description,venue:t.venue,dateRange:[u(t.startDate),u(t.endDate)],status:t.status,isActive:t.isActive,invoicePrefix:t.invoicePrefix,stallRates:t.stallRates||[],taxConfig:t.taxConfig||[],discountConfig:t.discountConfig||[],publicDiscountConfig:t.publicDiscountConfig||[],companyName:t.companyName,companyContactNo:t.companyContactNo,companyEmail:t.companyEmail,companyAddress:t.companyAddress,companyWebsite:t.companyWebsite,companyPAN:t.companyPAN,companyGST:t.companyGST,companySAC:t.companySAC,companyCIN:t.companyCIN,termsAndConditions:t.termsAndConditions,piInstructions:t.piInstructions,bankName:t.bankName,bankBranch:t.bankBranch,bankIFSC:t.bankIFSC,bankAccountName:t.bankAccountName,bankAccount:t.bankAccount,headerTitle:t.headerTitle,headerSubtitle:t.headerSubtitle,headerDescription:t.headerDescription,headerLogo:t.headerLogo,sponsorLogos:t.sponsorLogos||[],footerText:t.footerText,footerLogo:t.footerLogo,contactEmail:t.contactEmail,contactPhone:t.contactPhone,footerLinks:t.footerLinks||[],amenities:t.amenities||[],basicAmenities:t.basicAmenities||[],specialRequirements:t.specialRequirements,letterSettings:t.letterSettings};return c.jsx(b,{title:"Edit Exhibition",extra:c.jsx("a",{onClick:()=>s(y(t),{state:{exhibitionId:o}}),children:"Back to Details"}),children:c.jsx(F,{initialValues:C,onSubmit:l,submitText:"Update Exhibition"})})};export{J as default};
