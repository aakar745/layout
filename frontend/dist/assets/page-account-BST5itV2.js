import{r as e,j as s,d as r,a,b as o,x as n}from"./vendor-others-aeGeD6f-.js";import{u as t,a as l}from"./vendor-react-i7tvbPTl.js";import{d as i}from"./store-D4NI4RZ9.js";import{b as d}from"./services-DHEt1Qtz.js";import{i as c,R as m,C as u,T as j,c as p,j as h,u as x,I as w,A as f,s as g}from"./vendor-antd-core-CLD06I8y.js";import{F as y}from"./vendor-antd-form-DJHhvp8w.js";import{B as v}from"./vendor-antd-buttons-wjEWA2x8.js";import"./vendor-ui-BOD89xu8.js";import"./vendor-canvas-BOVIu3pe.js";import"./vendor-utils-CTzFqUk0.js";import"./component-exhibition-CuwlJtEU.js";import"./vendor-editor-HOXaQDhO.js";import"./vendor-antd-modal-1GBGM2fb.js";import"./component-layout-BTsCaDZB.js";import"./component-auth-ClRi3ofU.js";import"./vendor-antd-table-CA0XBoxE.js";const{Title:P,Text:b}=j,{TabPane:I}=h,A=()=>{var j;const{notification:A}=c.useApp(),[C]=y.useForm(),[F]=y.useForm(),[U,S]=e.useState(!1),[T,q]=e.useState(!1),[B,E]=e.useState(!1),[N,k]=e.useState(null),M=t(),V=l((e=>e.auth.user));e.useEffect((()=>{(async()=>{try{E(!0);const e=await d.getProfile();e.data&&M(i({user:e.data,token:localStorage.getItem("token")||""}))}catch(e){g.error("Failed to fetch profile")}finally{E(!1)}})()}),[M]);return s.jsxs("div",{className:"dashboard-container",children:[s.jsx("div",{style:{marginBottom:"24px"},children:s.jsx(m,{gutter:[24,24],align:"middle",children:s.jsxs(u,{flex:"auto",children:[s.jsx(P,{level:4,children:"My Account"}),s.jsx(b,{type:"secondary",children:"Manage your account settings and change your password"})]})})}),s.jsx(p,{loading:B,children:s.jsxs(h,{defaultActiveKey:"account",children:[s.jsx(I,{tab:"Account Information",children:s.jsxs(m,{gutter:32,children:[s.jsx(u,{span:6,children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:[s.jsx(x,{size:100,icon:s.jsx(r,{}),style:{backgroundColor:"#1890ff",marginBottom:16},children:(null==(j=null==V?void 0:V.username)?void 0:j.charAt(0).toUpperCase())||"U"}),s.jsx(P,{level:4,children:null==V?void 0:V.username}),s.jsx(b,{type:"secondary",children:(null==V?void 0:V.role)?"string"==typeof V.role?V.role:"object"==typeof V.role&&"name"in V.role?V.role.name:"User":"User"})]})}),s.jsx(u,{span:18,children:s.jsx(y,{layout:"vertical",initialValues:{username:null==V?void 0:V.username,email:null==V?void 0:V.email},disabled:!0,children:s.jsxs(m,{gutter:16,children:[s.jsx(u,{span:12,children:s.jsx(y.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter your username"}],children:s.jsx(w,{prefix:s.jsx(r,{}),placeholder:"Username"})})}),s.jsx(u,{span:12,children:s.jsx(y.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter your email"},{type:"email",message:"Please enter a valid email"}],children:s.jsx(w,{prefix:s.jsx(a,{}),placeholder:"Email Address"})})})]})})})]})},"account"),s.jsxs(I,{tab:"Change Password",children:[N&&s.jsx(f,{message:"Error",description:N,type:"error",showIcon:!0,style:{marginBottom:24}}),s.jsxs(y,{form:F,layout:"vertical",onFinish:async e=>{var s,r;try{k(null),q(!0),await d.changePassword({currentPassword:e.currentPassword,newPassword:e.newPassword}),A.success({message:"Success",description:"Password has been changed successfully"}),F.resetFields()}catch(a){k((null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.message)||"Failed to change password. Please try again.")}finally{q(!1)}},children:[s.jsx(y.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:s.jsx(w.Password,{prefix:s.jsx(o,{}),placeholder:"Current Password"})}),s.jsx(y.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter your new password"},{min:8,message:"Password must be at least 8 characters"}],children:s.jsx(w.Password,{prefix:s.jsx(o,{}),placeholder:"New Password"})}),s.jsx(y.Item,{name:"confirmPassword",label:"Confirm New Password",dependencies:["newPassword"],rules:[{required:!0,message:"Please confirm your new password"},({getFieldValue:e})=>({validator:(s,r)=>r&&e("newPassword")!==r?Promise.reject(new Error("The two passwords do not match")):Promise.resolve()})],children:s.jsx(w.Password,{prefix:s.jsx(o,{}),placeholder:"Confirm New Password"})}),s.jsx(y.Item,{children:s.jsx(v,{type:"primary",htmlType:"submit",loading:T,icon:s.jsx(n,{}),children:"Update Password"})})]})]},"password")]})})]})};export{A as default};
