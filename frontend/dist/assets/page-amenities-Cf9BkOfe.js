const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/services-DHEt1Qtz.js","assets/vendor-utils-CTzFqUk0.js","assets/vendor-canvas-BOVIu3pe.js","assets/vendor-others-aeGeD6f-.js","assets/vendor-ui-BOD89xu8.js","assets/vendor-react-i7tvbPTl.js","assets/component-exhibition-CuwlJtEU.js","assets/vendor-editor-HOXaQDhO.js","assets/vendor-antd-core-CLD06I8y.js","assets/vendor-antd-buttons-wjEWA2x8.js","assets/vendor-antd-modal-1GBGM2fb.js","assets/vendor-antd-form-DJHhvp8w.js","assets/component-layout-BTsCaDZB.js","assets/store-D4NI4RZ9.js","assets/component-auth-ClRi3ofU.js","assets/vendor-antd-table-CA0XBoxE.js"])))=>i.map(i=>d[i]);
import{j as e,T as t,U as a,V as s,n as i,l as n,E as l,W as r,r as o,X as d,Y as c,Z as m,_ as u,$ as p,a0 as h,a1 as x,a2 as y,a3 as f,a4 as g}from"./vendor-others-aeGeD6f-.js";import{u as b,a as j}from"./vendor-react-i7tvbPTl.js";import{f as v,g as S}from"./store-D4NI4RZ9.js";import{d as w}from"./vendor-utils-CTzFqUk0.js";import{a as I}from"./services-DHEt1Qtz.js";import{c as N,T as k,R as A,C,f as T,I as E,d as _,e as D,D as q,o as M,E as P,A as O,B as L,v as B,M as $,i as R,j as F,x as Q}from"./vendor-antd-core-CLD06I8y.js";import{B as z}from"./vendor-antd-buttons-wjEWA2x8.js";import{F as Y}from"./vendor-antd-table-CA0XBoxE.js";const U={},V=function(e,t,a){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),a=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in U)return;U[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,a&&i.setAttribute("nonce",a),document.head.appendChild(i),t?new Promise(((t,a)=>{i.addEventListener("load",t),i.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then((t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)}))},{Title:G,Text:W}=k,{Option:K}=T,{RangePicker:Z}=_,J=({exhibitionId:i,exhibitions:n,exhibitionsLoading:l,onExhibitionChange:r,typeFilter:o,setTypeFilter:d,bookingStatusFilter:c,setBookingStatusFilter:m,searchQuery:u,setSearchQuery:p,dateRange:h,setDateRange:x,resetFilters:y})=>{var f,g;return e.jsxs(N,{className:"amenities-filters",children:[e.jsx(G,{level:5,className:"filter-heading",children:"Filters"}),e.jsxs(A,{gutter:[16,16],children:[e.jsx(C,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(W,{className:"filter-label",children:"Exhibition"}),e.jsx(T,{placeholder:"Select an exhibition",style:{width:"100%"},loading:l,onChange:r,value:i,children:n.map((t=>e.jsx(K,{value:t._id,children:t.name},t._id)))})]})}),e.jsx(C,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(W,{className:"filter-label",children:"Amenity Type"}),e.jsxs(T,{mode:"multiple",placeholder:"Select types",style:{width:"100%"},value:o,onChange:d,maxTagCount:2,children:[e.jsx(K,{value:"facility",children:"Facility"}),e.jsx(K,{value:"service",children:"Service"}),e.jsx(K,{value:"equipment",children:"Equipment"}),e.jsx(K,{value:"other",children:"Other"})]})]})}),e.jsx(C,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(W,{className:"filter-label",children:"Booking Status"}),e.jsxs(T,{mode:"multiple",placeholder:"Select statuses",style:{width:"100%"},value:c,onChange:m,maxTagCount:2,children:[e.jsx(K,{value:"confirmed",children:"Confirmed"}),e.jsx(K,{value:"approved",children:"Approved"}),e.jsx(K,{value:"pending",children:"Pending"}),e.jsx(K,{value:"rejected",children:"Rejected"}),e.jsx(K,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(C,{xs:24,md:8,lg:6,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(W,{className:"filter-label",children:"Search"}),e.jsx(E,{placeholder:"Search amenities",prefix:e.jsx(t,{}),value:u,onChange:e=>{p(e.target.value)},allowClear:!0})]})}),e.jsx(C,{xs:24,md:16,lg:12,children:e.jsxs("div",{className:"filter-group",children:[e.jsx(W,{className:"filter-label",children:"Booking Date Range"}),e.jsx(Z,{style:{width:"100%"},onChange:e=>{x(e)},value:h})]})}),e.jsx(C,{xs:24,md:8,lg:12,children:e.jsx("div",{className:"filter-group",style:{display:"flex",justifyContent:"flex-end",alignItems:"flex-end",height:"100%"},children:e.jsxs(D,{children:[e.jsx(z,{icon:e.jsx(a,{}),onClick:y,children:"Reset"}),e.jsx(z,{type:"primary",icon:e.jsx(s,{}),children:"Apply Filters"})]})})})]}),(o.length>0||c.length>0||u||h)&&e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"filter-divider"}),e.jsxs("div",{children:[e.jsx(W,{className:"filter-label",children:"Active Filters:"}),e.jsxs("div",{style:{marginTop:8},children:[o.map((t=>e.jsxs(M,{closable:!0,onClose:()=>d(o.filter((e=>e!==t))),className:`amenity-tag amenity-tag-${t}`,children:["Type: ",t]},`type-${t}`))),c.map((t=>e.jsxs(M,{closable:!0,onClose:()=>m(c.filter((e=>e!==t))),color:"blue",children:["Status: ",t]},`status-${t}`))),u&&e.jsxs(M,{closable:!0,onClose:()=>p(""),color:"purple",children:["Search: ",u]}),h&&e.jsxs(M,{closable:!0,onClose:()=>x(null),color:"green",children:["Date Range: ",null==(f=h[0])?void 0:f.format("MMM DD, YYYY")," - ",null==(g=h[1])?void 0:g.format("MMM DD, YYYY")]})]})]})]})]})},{Text:X}=k,H=({basicAmenities:t,extraAmenities:a,bookedStalls:s,calculatedAmenities:o})=>e.jsxs(A,{gutter:[24,24],children:[e.jsx(C,{xs:24,sm:12,md:6,children:e.jsxs(N,{className:"stats-card stats-primary",bordered:!1,children:[e.jsx(i,{style:{fontSize:24,color:"#1890ff"}}),e.jsx("div",{className:"stats-value",children:t.length}),e.jsx("div",{className:"stats-label",children:"Basic Amenities"})]})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsxs(N,{className:"stats-card stats-secondary",bordered:!1,children:[e.jsx(n,{style:{fontSize:24,color:"#52c41a"}}),e.jsx("div",{className:"stats-value",children:a.length}),e.jsx("div",{className:"stats-label",children:"Extra Amenities"})]})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsxs(N,{className:"stats-card stats-tertiary",bordered:!1,children:[e.jsx(l,{style:{fontSize:24,color:"#fa8c16"}}),e.jsx("div",{className:"stats-value",children:s}),e.jsx("div",{className:"stats-label",children:"Booked Stalls"})]})}),e.jsx(C,{xs:24,sm:12,md:6,children:e.jsxs(N,{className:"stats-card stats-quaternary",bordered:!1,children:[e.jsx(r,{style:{fontSize:24,color:"#722ed1"}}),e.jsx("div",{className:"stats-value",children:o}),e.jsx("div",{className:"stats-label",children:"Calculated Amenities"})]})})]}),{Text:ee,Title:te}=k,ae=e=>{switch(e){case"facility":return{color:"#e6f7ff",borderColor:"#91d5ff",textColor:"#1890ff"};case"service":return{color:"#f6ffed",borderColor:"#b7eb8f",textColor:"#52c41a"};case"equipment":return{color:"#fff7e6",borderColor:"#ffd591",textColor:"#fa8c16"};default:return{color:"#f9f0ff",borderColor:"#d3adf7",textColor:"#722ed1"}}},se=({title:t,amenities:a,loading:s,onExport:i,isDynamicColumns:n=!1,isCalculated:l=!1,exhibitionId:r,amenityViewType:h="all"})=>{const[x,y]=o.useState([]),[f,g]=o.useState([]),[b,j]=o.useState(!1),v=o.useMemo((()=>l&&"all"!==h?"basic"===h?a.filter((e=>e.hasOwnProperty("calculatedQuantity")||e.hasOwnProperty("perSqm"))):"extra"===h?a.filter((e=>e.hasOwnProperty("rate")&&!e.hasOwnProperty("perSqm"))):a:a),[a,l,h]);o.useEffect((()=>{if(!r)return g([]),void j(!1);j(!0),setTimeout((()=>{j(!1)}),500)}),[r]);const S=(()=>{const e=new Map;v.forEach((t=>{var a,s;if(t.stallId&&t.stallNumber){e.has(t.stallId)||e.set(t.stallId,{key:t.stallId,companyName:t.exhibitorName||"Unknown",stallNumber:t.stallNumber,dimension:t.dimensions?`${t.dimensions.width}x${t.dimensions.height}m`:"-",stallType:t.stallType||"-",area:t.area||((null==(a=t.dimensions)?void 0:a.width)&&(null==(s=t.dimensions)?void 0:s.height)?t.dimensions.width*t.dimensions.height:"-"),bookingDate:t.bookingDate?new Date(t.bookingDate).toISOString().slice(0,10):"-",status:t.bookingStatus||"-",amenities:{}});const i=e.get(t.stallId);if(t.hasOwnProperty("calculatedQuantity"))i.amenities[t.name]=t.calculatedQuantity;else if(t.hasOwnProperty("perSqm")){const e="number"==typeof i.area?i.area:0,a=Math.floor(e/t.perSqm)*t.quantity;i.amenities[t.name]=a>0?a:t.quantity}else if(t.hasOwnProperty("booked")&&t.booked){let e=1;"number"==typeof t.quantity?e=t.quantity:"string"==typeof t.quantity&&(e=parseInt(t.quantity,10),isNaN(e)&&(e=1)),i.amenities[t.name]=e}else t.hasOwnProperty("rate")&&(i.amenities[t.name]=0)}}));return Array.from(e.values()).filter((e=>Object.keys(e.amenities).length>0))})();return e.jsx(N,{className:"amenities-card",title:e.jsxs(D,{children:[e.jsx(te,{level:5,style:{margin:0},children:t}),l&&e.jsxs(e.Fragment,{children:[e.jsx(M,{color:"green",children:"Calculated"}),"basic"===h&&e.jsx(M,{color:"blue",children:"Basic Amenities"}),"extra"===h&&e.jsx(M,{color:"purple",children:"Extra Amenities"}),"all"===h&&e.jsx(M,{color:"orange",children:"All Amenities"})]})]}),extra:e.jsx(D,{children:e.jsx(z,{type:"primary",icon:e.jsx(d,{}),onClick:i,disabled:0===v.length,children:"Export"})}),children:0===v.length?e.jsx(P,{image:P.PRESENTED_IMAGE_SIMPLE,description:"No amenities data available"}):t.toLowerCase().includes("basic")&&!l?e.jsx(Y,{dataSource:v.map(((e,t)=>({key:e._id||e.id||`basic-${t}`,...e}))),columns:[{title:"Name",dataIndex:"name",key:"name",render:(t,a)=>e.jsxs(D,{children:[e.jsx(ee,{strong:!0,children:t}),e.jsx(M,{color:ae(a.type).textColor,children:a.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Per SQM",dataIndex:"perSqm",key:"perSqm",render:e=>e?`1 per ${e} sqm`:"-"},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:t=>e.jsx(M,{color:"blue",children:t})}],loading:s,pagination:{pageSize:10},className:"amenities-table"}):!t.toLowerCase().includes("additional")&&!t.toLowerCase().includes("extra")||l?0===S.length?e.jsx(O,{message:"No stall data available",description:"Amenities exist but could not be linked to stalls. Make sure stalls are booked and have amenities assigned.",type:"info",showIcon:!0}):e.jsx(Y,{dataSource:S,columns:[{title:"Company Name",dataIndex:"companyName",key:"companyName",fixed:"left",width:180,render:t=>e.jsx(ee,{strong:!0,children:t}),sorter:(e,t)=>e.companyName.localeCompare(t.companyName)},{title:"Stall No.",dataIndex:"stallNumber",key:"stallNumber",width:100,render:t=>e.jsx(L,{status:"success",text:t}),sorter:(e,t)=>e.stallNumber.localeCompare(t.stallNumber)},{title:"Dimension",dataIndex:"dimension",key:"dimension",width:120},{title:"Stall Type",dataIndex:"stallType",key:"stallType",width:120},{title:"Area (SQM)",dataIndex:"area",key:"area",width:100,render:e=>"number"==typeof e?e.toFixed(2):e,sorter:(e,t)=>("number"==typeof e.area?e.area:0)-("number"==typeof t.area?t.area:0)},...(()=>{const e=new Set;return v.forEach((a=>{var s;a.name&&(s=a,l||(t.toLowerCase().includes("basic")?s.hasOwnProperty("perSqm"):!t.toLowerCase().includes("additional")&&!t.toLowerCase().includes("extra")||s.hasOwnProperty("rate")))&&e.add(a.name)})),Array.from(e)})().map((t=>({title:t,dataIndex:["amenities",t],key:t,width:100,render:t=>null==t?"-":0===t?e.jsx(ee,{type:"secondary",children:"0"}):"✓"===t?e.jsx(L,{status:"success"}):e.jsx(ee,{strong:!0,children:t}),sorter:(e,a)=>(e.amenities[t]||0)-(a.amenities[t]||0)}))),{title:"Actions",key:"actions",width:80,fixed:"right",render:(t,a)=>e.jsx(B,{overlay:e.jsxs($,{children:[e.jsx($.Item,{icon:e.jsx(m,{}),children:"View Details"},"view"),e.jsx($.Item,{icon:e.jsx(u,{}),children:"Edit"},"edit"),e.jsx($.Item,{icon:e.jsx(p,{}),children:"Settings"},"settings")]}),trigger:["click"],children:e.jsx(z,{type:"text",icon:e.jsx(c,{})})})}],loading:s||b,pagination:{pageSize:10},className:"amenities-table",scroll:{x:"max-content"},expandable:{expandedRowKeys:x,onExpandedRowsChange:e=>{y(e)},expandedRowRender:t=>e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(te,{level:5,children:"Stall Details"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:[Object.entries(t).map((([t,a])=>["key","amenities"].includes(t)?null:e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs(ee,{type:"secondary",style:{fontSize:"12px"},children:[t.charAt(0).toUpperCase()+t.slice(1).replace(/([A-Z])/g," $1"),":"]}),e.jsx("div",{children:e.jsx(ee,{strong:!0,children:null==a?"-":"object"==typeof a?JSON.stringify(a):String(a)})})]},t))),e.jsxs("div",{style:{marginBottom:"8px",gridColumn:"1 / -1"},children:[e.jsx(ee,{type:"secondary",style:{fontSize:"12px"},children:"Amenities:"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"4px"},children:Object.entries(t.amenities||{}).map((([t,a])=>e.jsxs(M,{color:"blue",children:[t,": ","✓"===a?"Available":a]},t)))})]})]})]})}}):e.jsx(Y,{dataSource:v.map(((e,t)=>({key:e._id||e.id||`extra-${t}`,...e}))),columns:[{title:"Name",dataIndex:"name",key:"name",render:(t,a)=>e.jsxs(D,{children:[e.jsx(ee,{strong:!0,children:t}),e.jsx(M,{color:ae(a.type).textColor,children:a.type})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Rate",dataIndex:"rate",key:"rate",render:t=>e.jsxs(ee,{style:{color:"#1890ff"},children:["₹",t.toLocaleString()]})}],loading:s,pagination:{pageSize:10},className:"amenities-table"})})},{Title:ie,Text:ne}=k,{TabPane:le}=F,re=(e,t)=>{const a=y.json_to_sheet(e),s=y.book_new();y.book_append_sheet(s,a,"Amenities");const i=f(s,{bookType:"xlsx",type:"array"}),n=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});g.saveAs(n,`${t}.xlsx`)},oe=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=b(),{message:a}=R.useApp(),{exhibitions:s,loading:i}=j((e=>e.exhibition)),{bookings:l,loading:r}=j((e=>e.booking)),[d,c]=o.useState(null),[m,u]=o.useState([]),[p,y]=o.useState([]),[f,g]=o.useState([]),[k,T]=o.useState([]),[E,_]=o.useState(!1),[q,M]=o.useState({}),[O,L]=o.useState(!1),[B,$]=o.useState({current:1,pageSize:10,total:0}),[z,Y]=o.useState([]),[U,G]=o.useState([]),[W,K]=o.useState(""),[Z,X]=o.useState(null),[ee,te]=o.useState(0),[ae,le]=o.useState(0),[oe,de]=o.useState("basic"),[ce,me]=o.useState("basic");o.useEffect((()=>{t(v()),t(S({page:1,limit:100}))}),[t]);o.useEffect((()=>{if(d&&s.length>0){const e=s.find((e=>e._id===d));e&&(u(e.basicAmenities||[]),y(e.amenities||[]),(async(e,t=1,a=10)=>{try{_(!0);const s=await I.get("/bookings",{params:{exhibitionId:e,includeDetails:!0,populate:"stallIds.stallTypeId",page:t,limit:a}});if(s&&s.data){const t=s.data.data.map((e=>{const t={...e};return t.stallIds&&(t.stallIds=t.stallIds.map((e=>(e.stallTypeId&&"object"==typeof e.stallTypeId&&(e.type=e.stallTypeId.name),e)))),t})).filter((t=>t.exhibitionId._id===e&&["confirmed","approved"].includes(t.status)));T(t),$({current:s.data.pagination.page,pageSize:s.data.pagination.limit,total:s.data.pagination.total})}else T([]),$({current:1,pageSize:10,total:0})}catch(s){T([]),$({current:1,pageSize:10,total:0})}finally{_(!1)}})(d,B.current,B.pageSize))}else u([]),y([]),g([]),te(0),le(0),T([])}),[d,s]),o.useEffect((()=>{if(d&&s.length>0&&k.length>0){const e=s.find((e=>e._id===d));if(e){const t=k.flatMap((e=>e.stallIds.map((t=>{const a=t.type||(t.stallTypeId&&"object"==typeof t.stallTypeId?t.stallTypeId.name:q[t.stallTypeId])||"-";return{stallId:t._id,stallNumber:t.number,bookingId:e._id,exhibitorName:e.companyName,bookingDate:e.createdAt,dimensions:t.dimensions,area:t.dimensions.width*t.dimensions.height,status:e.status,stallType:a}})))),a=k.flatMap((t=>t.basicAmenities&&0!==t.basicAmenities.length?t.basicAmenities.flatMap((e=>t.stallIds.map((a=>{const s=a.type||(a.stallTypeId&&"object"==typeof a.stallTypeId?a.stallTypeId.name:q[a.stallTypeId])||"-";return{...e,stallId:a._id,stallNumber:a.number,bookingId:t._id,exhibitorId:t.exhibitorId||"",exhibitorName:t.companyName,bookingDate:t.createdAt,dimensions:a.dimensions,area:a.dimensions.width*a.dimensions.height,bookingStatus:t.status,stallType:s}})))):t.stallIds.flatMap((a=>{const s=a.dimensions.width*a.dimensions.height,i=a.type||(a.stallTypeId&&"object"==typeof a.stallTypeId?a.stallTypeId.name:q[a.stallTypeId])||"-";return(e.basicAmenities||[]).map((e=>{const n=Math.floor(s/e.perSqm)*e.quantity;return{...e,calculatedQuantity:n>0?n:e.quantity,stallId:a._id,stallNumber:a.number,bookingId:t._id,exhibitorId:t.exhibitorId||"",exhibitorName:t.companyName,bookingDate:t.createdAt,dimensions:a.dimensions,area:s,bookingStatus:t.status,stallType:i}}))})))),s=k.flatMap((e=>e.extraAmenities&&0!==e.extraAmenities.length?e.extraAmenities.flatMap((t=>e.stallIds.map((a=>{const s=a.type||(a.stallTypeId&&"object"==typeof a.stallTypeId?a.stallTypeId.name:q[a.stallTypeId])||"-";return{...t,booked:!0,stallId:a._id,stallNumber:a.number,bookingId:e._id,exhibitorId:e.exhibitorId||"",exhibitorName:e.companyName,bookingDate:e.createdAt,dimensions:a.dimensions,area:a.dimensions.width*a.dimensions.height,bookingStatus:e.status,stallType:s,isExtraAmenity:!0,quantity:t.quantity||1}})))):[]));let i=s;if(0===s.length&&e.amenities&&e.amenities.length>0){i=k.flatMap((e=>e.stallIds)).flatMap(((t,a)=>(e.amenities||[]).map(((e,s)=>{var i;const n=k.find((e=>e.stallIds.some((e=>e._id===t._id)))),l=null==(i=null==n?void 0:n.extraAmenities)?void 0:i.find((t=>t.name===e.name)),r=!!l,o=`sim-${a}-${s}-${Date.now()}`,d=t.type||(t.stallTypeId&&"object"==typeof t.stallTypeId?t.stallTypeId.name:q[t.stallTypeId])||"-";return{...e,id:o,booked:r,stallId:t._id,stallNumber:t.number,bookingId:(null==n?void 0:n._id)||"",exhibitorId:(null==n?void 0:n.exhibitorId)||"",exhibitorName:(null==n?void 0:n.companyName)||"Unknown",bookingDate:(null==n?void 0:n.createdAt)||(new Date).toISOString(),dimensions:t.dimensions,area:t.dimensions.width*t.dimensions.height,bookingStatus:(null==n?void 0:n.status)||"approved",stallType:d,isExtraAmenity:!0,quantity:r?(null==l?void 0:l.quantity)||1:0}}))))}g([...a,...i]),te(t.length),le(a.length+i.length)}}else d&&s.length>0&&(g([]),te(0),le(0))}),[d,s,k,q]);const ue=o.useMemo((()=>{let e=m;if(z.length>0&&(e=e.filter((e=>z.includes(e.type)))),W){const t=W.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.type.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)))}return e}),[m,z,W]),pe=o.useMemo((()=>{let e=p;if(z.length>0&&(e=e.filter((e=>z.includes(e.type)))),W){const t=W.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.type.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)))}return e}),[p,z,W]),he=o.useMemo((()=>{let e=f;if(z.length>0&&(e=e.filter((e=>z.includes(e.type)))),U.length>0&&(e=e.filter((e=>U.includes(e.bookingStatus)))),W){const t=W.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.type.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.stallNumber&&e.stallNumber.toLowerCase().includes(t)||e.exhibitorName&&e.exhibitorName.toLowerCase().includes(t)))}if(Z&&Z[0]&&Z[1]){const t=Z[0].startOf("day"),a=Z[1].endOf("day");e=e.filter((e=>{if(!e.bookingDate)return!1;const s=w(e.bookingDate);return s.isAfter(t)&&s.isBefore(a)}))}return e}),[f,z,U,W,Z]);return o.useEffect((()=>{d&&(async()=>{try{L(!0);const{default:e}=await V((async()=>{const{default:e}=await import("./services-DHEt1Qtz.js").then((e=>e.w));return{default:e}}),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),t=await e.getStallTypes();if(t&&t.data){const e={};t.data.forEach((t=>{t._id&&(e[t._id]=t.name)})),M(e)}}catch(e){}finally{L(!1)}})()}),[d]),e.jsxs("div",{className:"amenities-container",children:[e.jsxs("div",{className:"amenities-header",children:[e.jsx(ie,{level:4,className:"amenities-title",children:"Amenities Management"}),e.jsx(ne,{type:"secondary",children:"View, filter, and export amenities data. See calculated amenities for booked stalls."})]}),e.jsx(J,{exhibitionId:d,exhibitions:s,exhibitionsLoading:i,onExhibitionChange:c,typeFilter:z,setTypeFilter:Y,bookingStatusFilter:U,setBookingStatusFilter:G,searchQuery:W,setSearchQuery:K,dateRange:Z,setDateRange:X,resetFilters:()=>{Y([]),G([]),K(""),X(null)}}),d&&e.jsx("div",{style:{marginBottom:24},children:e.jsx(H,{basicAmenities:m,extraAmenities:p,bookedStalls:ee,calculatedAmenities:ae})}),d?e.jsx(F,{activeKey:oe,onChange:de,className:"amenities-tabs",items:[{key:"basic",label:e.jsxs("span",{children:[e.jsx(h,{}),"Basic Amenities"]}),children:e.jsx(se,{title:"Basic Amenities",amenities:ue,loading:i,onExport:()=>{if(0===ue.length)return void a.warning("No basic amenities to export");const e=ue.map((e=>({Name:e.name,Type:e.type,Description:e.description||"","Per Sq. Meter":e.perSqm,"Quantity Per Unit":e.quantity,ID:e._id||e.id}))),t=s.find((e=>e._id===d)),i=`${(null==t?void 0:t.name)||"Exhibition"}_Basic_Amenities`;re(e,i),a.success("Basic amenities exported successfully")},exhibitionId:d})},{key:"extra",label:e.jsxs("span",{children:[e.jsx(n,{}),"Extra Amenities"]}),children:e.jsx(se,{title:"Additional Amenities",amenities:pe,loading:i,onExport:()=>{if(0===pe.length)return void a.warning("No extra amenities to export");const e=pe.map((e=>({Name:e.name,Type:e.type,Description:e.description||"",Rate:e.rate,ID:e._id||e.id}))),t=s.find((e=>e._id===d)),i=`${(null==t?void 0:t.name)||"Exhibition"}_Extra_Amenities`;re(e,i),a.success("Extra amenities exported successfully")},exhibitionId:d})},{key:"calculated",label:e.jsxs("span",{children:[e.jsx(x,{}),"Calculated Amenities"]}),children:e.jsxs(e.Fragment,{children:[e.jsx(A,{gutter:[0,16],children:e.jsx(C,{span:24,children:e.jsx(N,{className:"filter-card",children:e.jsxs(D,{children:[e.jsx(ne,{strong:!0,children:"View: "}),e.jsxs(Q.Group,{value:ce,onChange:e=>me(e.target.value),optionType:"button",buttonStyle:"solid",children:[e.jsx(Q.Button,{value:"basic",children:"Basic Amenities"}),e.jsx(Q.Button,{value:"extra",children:"Extra Amenities"}),e.jsx(Q.Button,{value:"all",children:"All Amenities"})]})]})})})}),e.jsx(se,{title:"Calculated Amenities",amenities:he,loading:i,onExport:()=>{if(0===he.length)return void a.warning("No calculated amenities to export");const e=new Map;he.filter((e=>"all"===ce||("basic"===ce?e.hasOwnProperty("calculatedQuantity")||e.hasOwnProperty("perSqm"):"extra"!==ce||e.hasOwnProperty("rate")&&!e.hasOwnProperty("perSqm")))).forEach((t=>{if(t.stallId&&t.stallNumber){if(!e.has(t.stallId)){const a=t.dimensions||{width:0,height:0},s=t.area||(a.width&&a.height?a.width*a.height:0);e.set(t.stallId,{"Company Name":t.exhibitorName||"Unknown","Stall No.":t.stallNumber,Dimension:a?`${a.width}x${a.height}m`:"-","Stall Type":t.stallType||"-","Area (SQM)":"number"==typeof s?s:0,"Booking Date":t.bookingDate?new Date(t.bookingDate).toLocaleDateString():"-","Booking Status":t.bookingStatus||"-"})}const a=e.get(t.stallId);if(t.hasOwnProperty("calculatedQuantity"))a[t.name]=t.calculatedQuantity;else if(t.hasOwnProperty("perSqm")){const e="number"==typeof a["Area (SQM)"]?a["Area (SQM)"]:0,s=Math.floor(e/t.perSqm)*t.quantity;a[t.name]=s>0?s:t.quantity}else if(t.hasOwnProperty("booked")&&t.booked){let e=1;"number"==typeof t.quantity?e=t.quantity:"string"==typeof t.quantity&&(e=parseInt(t.quantity,10),isNaN(e)&&(e=1)),a[t.name]=e}else t.hasOwnProperty("rate")&&(a[t.name]=0)}}));const t=Array.from(e.values()),i=s.find((e=>e._id===d)),n="basic"===ce?"Basic":"extra"===ce?"Extra":"All",l=`${(null==i?void 0:i.name)||"Exhibition"}_${n}_Calculated_Amenities`;re(t,l),a.success(`${n} calculated amenities exported successfully`)},isDynamicColumns:!0,isCalculated:!0,exhibitionId:d,amenityViewType:ce})]})}]}):e.jsx("div",{style:{marginTop:24,textAlign:"center",padding:48,background:"#fff",borderRadius:8},children:e.jsx(P,{description:"Please select an exhibition to view amenities",image:P.PRESENTED_IMAGE_SIMPLE})})]})}},Symbol.toStringTag,{value:"Module"}));export{V as _,oe as i};
