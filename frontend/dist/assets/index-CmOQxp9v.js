import{v as ue,K as he,L as xe,j as t,Y as me}from"./index-DoSueJxk.js";import{u as ge,l as pe,r as a,k as je,R as ye}from"./vendor-react-dkbxt9Jf.js";import{W as ve,d as E,Y as fe,a1 as K,S as x,T as Ie,a as I,c as m,j as be,J as R,ar as we,ab as N,aw as ke,aY as Se,au as Ce,ai as De,ag as Ee,b as Re,at as Ne,aQ as Me,z as Le,U as Ae}from"./vendor-antd-mFVHvrVJ.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const{Title:Fe,Text:c}=Ie,{Option:b}=N,{RangePicker:Te}=ke,ze=()=>{const w=ge(),M=pe(),[L,Q]=a.useState(1),[A,G]=a.useState(10),[g,F]=a.useState(""),[p,T]=a.useState(null),[j,O]=a.useState(null),[i,_]=a.useState(null),[H,k]=a.useState(!1),[$,Y]=a.useState(null),[S,P]=a.useState(""),[z,U]=a.useState(""),[o,J]=a.useState("createdAt"),[l,q]=a.useState("descend"),[r,X]=ve.useMessage(),[u,W]=a.useState(null),[B,C]=a.useState(0),{exhibitions:Z,loading:ee}=je(e=>e.exhibition);a.useEffect(()=>{M(ue())},[M]);const{data:y,isLoading:V,refetch:te}=he({page:L,limit:A}),[ne,{isLoading:ae}]=xe(),se=ye.useMemo(()=>y?.data?y.data.filter(e=>{const n=g.toLowerCase(),s=g===""||e.invoiceNumber&&e.invoiceNumber.toLowerCase().includes(n)||e._id.toLowerCase().includes(n)||e.bookingId.customerName&&e.bookingId.customerName.toLowerCase().includes(n)||e.bookingId.companyName&&e.bookingId.companyName.toLowerCase().includes(n),d=!p||e.status===p,v=!j||e.bookingId.exhibitionId&&e.bookingId.exhibitionId._id===j;let h=!0;if(i&&i[0]&&i[1]){const f=E(e.createdAt);h=f.isAfter(i[0])&&f.isBefore(i[1])}return s&&d&&v&&h}):[],[y,g,p,j,i]),ie=async e=>{try{W(e),C(0),r.loading({content:"Preparing invoice...",key:e});const n=await me(`/invoices/${e}/download?force=false`,!1,v=>{const h=v.total,f=v.loaded;if(h){const D=Math.round(f*100/h);C(D),D%25===0&&r.loading({content:`Downloading: ${D}% complete`,key:e})}}),s=window.URL.createObjectURL(new Blob([n.data])),d=document.createElement("a");d.href=s,d.setAttribute("download",`invoice-${e}.pdf`),document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(s),r.success({content:"Invoice downloaded successfully",key:e})}catch(n){console.error("Download error:",n),r.error({content:"Failed to download invoice",key:e})}finally{W(null),C(0)}},oe=async()=>{if(!(!$||!S))try{r.loading({content:"Sending email...",key:"email"}),await ne({id:$,email:S,message:z||void 0}).unwrap(),r.success({content:"Invoice sent via email successfully",key:"email"}),k(!1),P(""),U(""),Y(null)}catch(e){console.error("Email error:",e),r.error({content:"Failed to send invoice via email",key:"email"})}},le=e=>{Y(e),k(!0)},re=()=>{F(""),T(null),O(null),_(null)},de=[{title:"Invoice #",dataIndex:["invoiceNumber"],key:"invoiceNumber",sorter:!0,sortOrder:o==="invoiceNumber"?l:null,render:(e,n)=>t.jsx("a",{onClick:()=>w(`/invoice/${n._id}`),children:e||"N/A"})},{title:"Company",dataIndex:["bookingId","companyName"],key:"companyName",sorter:!0,sortOrder:o==="companyName"?l:null,render:e=>e||"N/A"},{title:"Exhibition",dataIndex:["bookingId","exhibitionId","name"],key:"exhibitionName",sorter:!0,sortOrder:o==="exhibitionName"?l:null,render:(e,n)=>t.jsx("a",{onClick:()=>w(`/exhibition/${n.bookingId.exhibitionId._id}`),children:e})},{title:"Amount",dataIndex:"amount",key:"amount",sorter:!0,sortOrder:o==="amount"?l:null,render:e=>`â‚¹${e.toLocaleString("en-IN")}`},{title:"Status",dataIndex:"status",key:"status",sorter:!0,sortOrder:o==="status"?l:null,render:e=>t.jsx(Re,{color:e==="paid"?"green":e==="pending"?"gold":e==="cancelled"?"red":"blue",children:e.toUpperCase()})},{title:"Due Date",dataIndex:"dueDate",key:"dueDate",sorter:!0,sortOrder:o==="dueDate"?l:null,render:e=>e?E(e).format("DD MMM YYYY"):"N/A"},{title:"Created",dataIndex:"createdAt",key:"createdAt",sorter:!0,sortOrder:o==="createdAt"?l:null,render:e=>E(e).format("DD MMM YYYY")},{title:"Actions",key:"actions",render:(e,n)=>t.jsxs(x,{direction:"vertical",size:"small",style:{width:"100%"},children:[t.jsxs(x,{children:[t.jsx(I,{title:"View Invoice",children:t.jsx(m,{type:"text",icon:t.jsx(Ne,{}),onClick:()=>w(`/invoice/${n._id}`)})}),t.jsx(I,{title:"Download",children:t.jsx(m,{type:"text",icon:t.jsx(Me,{}),onClick:()=>ie(n._id),loading:u===n._id&&B<100,disabled:u!==null&&u!==n._id})}),t.jsx(I,{title:"Email",children:t.jsx(m,{type:"text",icon:t.jsx(Le,{}),onClick:()=>le(n._id),disabled:u!==null})})]}),u===n._id&&t.jsx(Ae,{percent:B,size:"small",status:"active",style:{marginBottom:0,marginTop:4}})]})}],ce=(e,n,s)=>{s&&s.field&&(J(s.field),q(s.order||"descend"))};return t.jsxs(fe,{children:[X,t.jsxs("div",{className:"invoice-list-container",children:[t.jsx(K,{children:t.jsxs(x,{direction:"vertical",style:{width:"100%"},size:"large",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(Fe,{level:2,style:{margin:0},children:"Invoices"}),t.jsx(x,{children:t.jsx(I,{title:"Refresh",children:t.jsx(m,{icon:t.jsx(be,{}),onClick:()=>te(),loading:V})})})]}),t.jsx(K,{size:"small",title:t.jsxs(x,{children:[t.jsx(Ce,{})," Filters"]}),children:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:[t.jsxs("div",{style:{minWidth:"200px",flex:1},children:[t.jsx(c,{strong:!0,children:"Search"}),t.jsx(R,{placeholder:"Search by invoice #, company...",value:g,onChange:e=>F(e.target.value),prefix:t.jsx(we,{}),allowClear:!0})]}),t.jsxs("div",{style:{minWidth:"150px"},children:[t.jsx(c,{strong:!0,children:"Status"}),t.jsxs(N,{style:{width:"100%"},placeholder:"Filter by status",value:p,onChange:T,allowClear:!0,children:[t.jsx(b,{value:"pending",children:"Pending"}),t.jsx(b,{value:"paid",children:"Paid"}),t.jsx(b,{value:"cancelled",children:"Cancelled"})]})]}),t.jsxs("div",{style:{minWidth:"200px"},children:[t.jsx(c,{strong:!0,children:"Exhibition"}),t.jsx(N,{style:{width:"100%"},placeholder:"Filter by exhibition",value:j,onChange:O,loading:ee,allowClear:!0,children:Z.map(e=>t.jsx(b,{value:e._id||e.id,children:e.name},e._id||e.id))})]}),t.jsxs("div",{style:{minWidth:"300px"},children:[t.jsx(c,{strong:!0,children:"Date Range"}),t.jsx(Te,{style:{width:"100%"},value:i,onChange:_})]}),t.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:t.jsx(m,{icon:t.jsx(Se,{}),onClick:re,children:"Clear Filters"})})]})}),t.jsx(De,{columns:de,dataSource:se,rowKey:"_id",loading:V,pagination:{current:L,pageSize:A,total:y?.pagination?.total||0,onChange:(e,n)=>{Q(e),n&&G(n)},showSizeChanger:!0,showTotal:e=>`Total ${e} invoices`},onChange:ce})]})}),t.jsxs(Ee,{title:"Send Invoice via Email",open:H,onCancel:()=>k(!1),onOk:oe,okText:"Send",confirmLoading:ae,children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(c,{strong:!0,children:"Email Address"}),t.jsx(R,{placeholder:"Enter recipient email",value:S,onChange:e=>P(e.target.value),style:{width:"100%"}})]}),t.jsxs("div",{children:[t.jsx(c,{strong:!0,children:"Message (Optional)"}),t.jsx(R.TextArea,{placeholder:"Enter optional message",value:z,onChange:e=>U(e.target.value),rows:4})]})]})]})]})};export{ze as default};
