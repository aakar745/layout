import{j as e,e as Te,a7 as oe,C as Ie,Y as se,a8 as ke,a1 as ne,D as re}from"./index-BRKtYmDF.js";import{j as ce,r as v,u as Fe,i as M}from"./vendor-react-BNeW3y6d.js";import{Z as Ne,N as x,K as S,a5 as q,a6 as T,aa as $e,c as R,X as I,a7 as _,am as D,T as g,S as k,b as L,W as Be,D as de,a4 as W,$ as Pe,b5 as qe}from"./vendor-antd-Dz3j4xaK.js";import"./vendor-utils-CsjRLf7T.js";import"./vendor-styling-BEMjND7I.js";import"./vendor-canvas-BRbMLhVA.js";const De=({visible:t,onCancel:o,onExhibitorAdded:u,form:c})=>{const s=ce(),d=async n=>{var A,y;try{const b={companyName:n.companyName,contactPerson:n.contactPerson,email:n.email,phone:n.phone,address:n.address,city:n.city,state:n.state,pinCode:n.pinCode,website:n.website,description:n.description,panNumber:n.panNumber,gstNumber:n.gstNumber,isActive:n.isActive!==!1},h=await Te.createExhibitor(b);I.success({content:"Exhibitor created successfully! Login credentials have been sent via email.",duration:5}),s(oe({})),u(h.data.exhibitor._id),o(),c.resetFields()}catch(b){const h=((y=(A=b.response)==null?void 0:A.data)==null?void 0:y.message)||(b==null?void 0:b.message)||"Failed to add exhibitor";I.error(h),h.includes("email already exists")&&c.setFields([{name:"email",errors:["This email is already registered"]}])}};return e.jsx(Ne,{title:e.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:"#101828"},children:"Add Exhibitor"}),open:t,onCancel:o,width:800,footer:e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end",padding:"20px 24px",borderTop:"1px solid #E5E7EB"},children:[e.jsx(R,{onClick:o,size:"large",style:{height:"44px",padding:"12px 20px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",backgroundColor:"white",minWidth:"100px"},children:"Cancel"}),e.jsx(R,{type:"primary",onClick:c.submit,size:"large",style:{height:"44px",padding:"12px 20px",borderRadius:"8px",border:"none",backgroundColor:"#6941C6",color:"white",fontWeight:500,fontSize:"14px",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)",minWidth:"140px"},children:"Create Exhibitor"})]}),styles:{body:{padding:"24px",maxHeight:"calc(100vh - 200px)",overflowY:"auto"},header:{borderBottom:"1px solid #E5E7EB",padding:"24px"},footer:{borderTop:"1px solid #E5E7EB",padding:0}},style:{top:20},children:e.jsxs(x,{form:c,layout:"vertical",onFinish:d,requiredMark:!1,scrollToFirstError:!0,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"32px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"24px",paddingBottom:"12px",borderBottom:"2px solid #F3F4F6"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"8px",backgroundColor:"#EEF2FF",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"12px"},children:e.jsx("span",{style:{fontSize:"16px"},children:"ðŸ¢"})}),e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#101828",margin:0},children:"Company Information"})]}),e.jsx(x.Item,{name:"companyName",label:"Company Name",rules:[{required:!0,message:"Please enter company name"},{min:2,message:"Company name must be at least 2 characters"},{max:100,message:"Company name cannot exceed 100 characters"}],children:e.jsx(S,{placeholder:"Enter company name",size:"large"})}),e.jsx(x.Item,{name:"address",label:"Address",rules:[{required:!0,message:"Please enter address"}],children:e.jsx(S.TextArea,{rows:3,placeholder:"Enter complete address",showCount:!0,maxLength:200})}),e.jsxs(q,{gutter:16,children:[e.jsx(T,{span:12,children:e.jsx(x.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(S,{placeholder:"Enter city"})})}),e.jsx(T,{span:12,children:e.jsx(x.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(S,{placeholder:"Enter state"})})})]}),e.jsx(x.Item,{name:"pinCode",label:"PIN Code",rules:[{required:!0,message:"Please enter PIN code"},{pattern:/^\d{6}$/,message:"Please enter a valid 6-digit PIN code"}],children:e.jsx(S,{placeholder:"123456",maxLength:6})}),e.jsx(x.Item,{name:"website",label:"Website",rules:[{type:"url",message:"Please enter a valid website URL"}],children:e.jsx(S,{placeholder:"https://www.company.com"})}),e.jsx(x.Item,{name:"description",label:"Company Description",children:e.jsx(S.TextArea,{rows:3,placeholder:"Brief description about the company",showCount:!0,maxLength:500})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"24px",paddingBottom:"12px",borderBottom:"2px solid #F3F4F6"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"8px",backgroundColor:"#FEF3F2",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"12px"},children:e.jsx("span",{style:{fontSize:"16px"},children:"ðŸ‘¤"})}),e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#101828",margin:0},children:"Contact & Legal Information"})]}),e.jsx(x.Item,{name:"contactPerson",label:"Contact Person",rules:[{required:!0,message:"Please enter contact person"},{min:2,message:"Name must be at least 2 characters"},{max:100,message:"Name cannot exceed 100 characters"}],children:e.jsx(S,{placeholder:"Enter contact person name",size:"large"})}),e.jsx(x.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter email"},{type:"email",message:"Please enter a valid email"}],extra:"Login credentials will be sent to this email",children:e.jsx(S,{placeholder:"contact@company.com",size:"large",prefix:e.jsx("span",{style:{color:"#9CA3AF"},children:"ðŸ“§"})})}),e.jsx(x.Item,{name:"phone",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^[0-9-+()]*$/,message:"Please enter a valid phone number"}],children:e.jsx(S,{placeholder:"9876543210",size:"large",prefix:e.jsx("span",{style:{color:"#9CA3AF"},children:"ðŸ“±"})})}),e.jsx(x.Item,{name:"panNumber",label:"PAN Number",rules:[{pattern:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,message:"Please enter a valid PAN number (e.g., ABCDE1234F)"}],children:e.jsx(S,{placeholder:"ABCDE1234F",style:{textTransform:"uppercase"},maxLength:10})}),e.jsx(x.Item,{name:"gstNumber",label:"GST Number",rules:[{pattern:/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,message:"Please enter a valid GST number"}],children:e.jsx(S,{placeholder:"27AAPFU0939F1ZV",style:{textTransform:"uppercase"},maxLength:15})}),e.jsx(x.Item,{name:"isActive",label:"Account Status",initialValue:!0,valuePropName:"checked",children:e.jsx($e,{checkedChildren:"Active",unCheckedChildren:"Inactive",size:"default"})})]})]}),e.jsxs("div",{style:{marginTop:"24px",padding:"16px",backgroundColor:"#F0F9FF",border:"1px solid #BAE6FD",borderRadius:"8px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx("span",{style:{fontSize:"16px",marginTop:"2px"},children:"â„¹ï¸"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"#0369A1",marginBottom:"4px"},children:"Account Creation Notice"}),e.jsxs("div",{style:{color:"#0369A1",fontSize:"14px",lineHeight:"1.5"},children:["â€¢ A temporary password will be automatically generated and sent to the provided email",e.jsx("br",{}),"â€¢ The exhibitor will be pre-approved and can log in immediately",e.jsx("br",{}),"â€¢ They should change their password after first login for security"]})]})]})]})})},{Text:ie}=g,ze=t=>{if(!t)return 0;const o=t.shapeType||"rectangle";if(o==="rectangle")return t.width*t.height;if(o==="l-shape"&&t.lShape){const{rect1Width:u,rect1Height:c,rect2Width:s,rect2Height:d}=t.lShape;return u*c+s*d}return t.width*t.height},Le=({selectedStalls:t,calculateBaseAmount:o})=>{if(t.length===0)return null;const u=[{title:"Stall Number",dataIndex:"number",key:"number",width:120},{title:"Stall Type",key:"type",width:150,render:(s,d)=>{var n,A;return((n=d.stallType)==null?void 0:n.name)||(typeof d.stallTypeId=="object"?(A=d.stallTypeId)==null?void 0:A.name:"Not specified")}},{title:"Dimensions",key:"dimensions",width:120,render:(s,d)=>d.dimensions.shapeType==="l-shape"?"L-Shape":`${d.dimensions.width}m Ã— ${d.dimensions.height}m`},{title:"Area (sqm)",key:"area",width:100,render:(s,d)=>ze(d.dimensions).toFixed(2)},{title:"Rate/sq.m",dataIndex:"ratePerSqm",key:"rate",width:120,render:s=>`â‚¹${s.toLocaleString()}`},{title:"Base Amount",key:"baseAmount",width:120,render:(s,d)=>`â‚¹${o(d).toLocaleString()}`}],c=t.reduce((s,d)=>s+o(d),0);return e.jsx(_,{title:"Selected Stalls Summary",size:"small",style:{marginBottom:16},children:e.jsx(D,{dataSource:t.map(s=>({...s,key:s._id||s.id})),columns:u,pagination:!1,size:"small",summary:()=>e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:5,children:e.jsx(ie,{strong:!0,children:"Total Base Amount"})}),e.jsx(D.Summary.Cell,{index:1,children:e.jsxs(ie,{strong:!0,children:["â‚¹",c.toLocaleString()]})})]})})})},{Text:Ye}=g,Re=({selectedExhibition:t,basicAmenitiesWithQuantities:o,totalStallArea:u,selectedExtraAmenities:c,extraAmenityQuantities:s,onExtraAmenitiesChange:d,onExtraAmenityQuantityChange:n,getSelectedExtraAmenities:A})=>{var y,b,h;return e.jsxs(_,{title:"Stall Amenities",size:"small",style:{marginBottom:16},children:[(t==null?void 0:t.basicAmenities)&&t.basicAmenities.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(g.Title,{level:5,style:{margin:0},children:e.jsxs(k,{children:[e.jsx("span",{children:"Included Basic Amenities"}),e.jsx(L,{color:"green",children:"Based on stall area"})]})}),e.jsxs(g.Text,{type:"secondary",children:["The following amenities are included based on your total stall area of ",u.toFixed(2)," sqm."]})]}),e.jsx(D,{dataSource:o.filter(m=>m.calculatedQuantity>0),columns:[{title:"Name",dataIndex:"name",key:"name",render:(m,r)=>e.jsxs(k,{children:[e.jsx(g.Text,{strong:!0,children:m}),e.jsx(L,{color:"blue",children:r.type})]})},{title:"Quantity",dataIndex:"calculatedQuantity",key:"calculatedQuantity",width:120,render:m=>e.jsxs(L,{color:"green",children:[m," ",m===1?"unit":"units"]})},{title:"Allocation",dataIndex:"perSqm",key:"perSqm",width:180,render:(m,r)=>e.jsx("div",{title:r.description,children:e.jsxs(g.Text,{type:"secondary",children:[e.jsx(Be,{style:{marginRight:5}}),"1 ",r.quantity>1?`set of ${r.quantity}`:"unit"," per ",m," sqm"]})})},{title:"Status",key:"status",width:100,align:"right",render:()=>e.jsx(g.Text,{type:"success",children:"Included"})}],pagination:!1,size:"small",locale:{emptyText:e.jsx(g.Text,{children:"No basic amenities qualify based on the selected stall area."})}}),e.jsx(de,{style:{margin:"16px 0"}})]}),(t==null?void 0:t.amenities)&&t.amenities.length>0&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(g.Title,{level:5,style:{margin:0},children:e.jsxs(k,{children:[e.jsx("span",{children:"Additional Amenities"}),e.jsx(L,{color:"blue",children:"Optional"})]})}),e.jsx(g.Text,{type:"secondary",children:"Select any additional amenities for the booking."})]}),e.jsx(W,{mode:"multiple",placeholder:"Select amenities",style:{width:"100%",marginBottom:16},onChange:d,value:c,options:(y=t==null?void 0:t.amenities)==null?void 0:y.map(m=>({label:`${m.name} (${m.rate?`â‚¹${m.rate.toLocaleString()}`:"N/A"})`,value:m._id||m.id,key:m._id||m.id}))}),c.length>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(g.Text,{strong:!0,children:"Selected Amenities:"}),e.jsx(D,{dataSource:A(),columns:[{title:"Name",dataIndex:"name",key:"name",render:(m,r)=>e.jsxs(k,{align:"center",children:[e.jsx(g.Text,{strong:!0,children:m}),e.jsx(L,{color:"blue",children:r.type}),e.jsx(g.Text,{type:"secondary",style:{fontSize:"13px"},children:r.description||""})]})},{title:"Rate",dataIndex:"rate",key:"rate",width:120,align:"right",render:m=>e.jsxs(g.Text,{strong:!0,style:{color:"#1890ff"},children:["â‚¹",m.toLocaleString("en-IN")]})},{title:"Quantity",dataIndex:"quantity",key:"quantity",width:120,render:(m,r)=>e.jsx(Pe,{min:1,value:s[r.id]||1,onChange:w=>n(r.id,w||1),style:{width:"100%"}})},{title:"Total",key:"total",width:120,align:"right",render:(m,r)=>{const w=s[r.id]||1,$=r.rate*w;return e.jsxs(g.Text,{strong:!0,style:{color:"#1890ff"},children:["â‚¹",$.toLocaleString("en-IN")]})}}],pagination:!1,size:"small"})]})]}),!((b=t==null?void 0:t.basicAmenities)!=null&&b.length)&&!((h=t==null?void 0:t.amenities)!=null&&h.length)&&e.jsx(g.Text,{type:"secondary",children:"No amenities have been configured for this exhibition."})]})},{Text:C}=g,We=({selectedExhibition:t,selectedDiscountId:o,onDiscountChange:u,calculateAmounts:c})=>{var d;const s=c();return e.jsxs(_,{title:"Price Calculations",size:"small",style:{marginBottom:16},children:[e.jsxs(q,{gutter:[16,16],children:[e.jsx(T,{span:12,children:e.jsx(W,{placeholder:"Select discount",allowClear:!0,style:{width:"100%"},value:o,onChange:u,options:(d=t==null?void 0:t.discountConfig)==null?void 0:d.map(n=>({label:`${n.name} (${n.type==="percentage"?n.value+"%":"â‚¹"+n.value})${n.isActive?"":" - Inactive"}`,value:`${n.name}-${n.value}-${n.type}`,disabled:!n.isActive}))})}),e.jsx(T,{span:12,children:e.jsx("div",{style:{textAlign:"right"},children:e.jsx(C,{type:"secondary",children:"Discount Available"})})})]}),e.jsx("div",{style:{background:"#fafafa",padding:"16px",borderRadius:"8px",marginTop:"16px"},children:e.jsxs(k,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(C,{children:"Total Base Amount:"}),e.jsxs(C,{strong:!0,children:["â‚¹",s.baseAmount.toLocaleString()]})]}),s.selectedDiscount&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(C,{children:["Discount (",s.selectedDiscount.type==="percentage"?`${s.selectedDiscount.value}%`:`â‚¹${s.selectedDiscount.value.toLocaleString()}`,"):"]}),e.jsxs(C,{type:"danger",children:["-â‚¹",s.discountAmount.toLocaleString()]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(C,{children:"Amount after Discount:"}),e.jsxs(C,{children:["â‚¹",s.amountAfterDiscount.toLocaleString()]})]}),e.jsx(de,{style:{margin:"8px 0"}}),s.taxes.map(n=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(C,{children:[n.name," (",n.rate,"%):"]}),e.jsxs(C,{children:["â‚¹",n.amount.toLocaleString()]})]},`tax-${n.name}`)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[e.jsx(C,{strong:!0,children:"Total Amount (incl. Taxes):"}),e.jsxs(C,{strong:!0,style:{color:"#1890ff",fontSize:"16px"},children:["â‚¹",s.totalAmount.toLocaleString()]})]})]})})]})},Me=t=>{if(!t)return 0;const o=t.shapeType||"rectangle";if(o==="rectangle")return t.width*t.height;if(o==="l-shape"&&t.lShape){const{rect1Width:u,rect1Height:c,rect2Width:s,rect2Height:d}=t.lShape;return u*c+s*d}return t.width*t.height},H=t=>{const o=Me(t.dimensions);return Math.round(t.ratePerSqm*o*100)/100},_e=(t,o,u)=>{if(!(u!=null&&u.isActive))return 0;let c=0;if(u.type==="percentage")c=t*(Math.max(0,Math.min(100,u.value))/100);else{const s=t/o*u.value;c=Math.min(s,t)}return Math.round(c*100)/100},le=(t,o,u)=>{var h,m;const c=t.reduce((r,w)=>r+H(w),0),s=(h=o==null?void 0:o.discountConfig)==null?void 0:h.find(r=>`${r.name}-${r.value}-${r.type}`===u&&r.isActive),d=s?s.type==="percentage"?Math.round(c*s.value/100*100)/100:Math.min(s.value,c):0,n=Math.round((c-d)*100)/100,A=((m=o==null?void 0:o.taxConfig)==null?void 0:m.filter(r=>r.isActive).map(r=>({name:r.name,rate:r.rate,amount:Math.round(n*r.rate/100*100)/100})))||[],y=A.reduce((r,w)=>r+w.amount,0),b=Math.round((n+y)*100)/100;return{baseAmount:c,selectedDiscount:s,discountAmount:d,amountAfterDiscount:n,taxes:A,totalTaxAmount:y,totalAmount:b}},Qe=(t,o)=>t.map(u=>{const c=Math.floor(o/u.perSqm)*u.quantity;return{...u,calculatedQuantity:c>0?c:0,key:u._id||u.id}}),{Title:Ve,Text:Ze}=g,Xe=()=>{const[t]=x.useForm(),[o]=x.useForm(),[u,c]=v.useState(!1),[s,d]=v.useState([]),[n,A]=v.useState(!1),[y,b]=v.useState([]),[h,m]=v.useState(null),[r,w]=v.useState(),[$,O]=v.useState([]),[Q,G]=v.useState({}),[V,K]=v.useState([]),[ue,U]=v.useState(0),z=Fe(),B=ce(),{loading:me}=M(a=>a.booking),{exhibitions:he=[],loading:pe}=M(a=>a.exhibition),{exhibitors:Y=[],loading:xe}=M(a=>a.exhibitor),{isAuthenticated:X}=M(a=>a.auth);v.useEffect(()=>{if(!X){I.error("Please login to create a booking"),z("/login");return}B(Ie()),B(oe({}))},[B,X,z]);const ge=async a=>{try{A(!0),t.setFieldValue("stallIds",[]),t.setFieldValue("discountId",void 0),t.setFieldValue("extraAmenities",[]),b([]),O([]),K([]),U(0),w(void 0);const[l,i]=await Promise.all([re.getExhibition(a),re.getStalls(a)]);m(l.data);const j=i.data.stalls.filter(f=>f.status==="available");d(j)}catch(l){console.error("Failed to fetch exhibition data:",l),I.error("Failed to fetch exhibition data")}finally{A(!1)}},ye=a=>{var j;const l=s.filter(f=>{const F=f._id||f.id;return F&&a.includes(F)});b(l);const i=l.reduce((f,F)=>f+se(F.dimensions),0);if(U(i),(j=h==null?void 0:h.basicAmenities)!=null&&j.length){const f=Qe(h.basicAmenities,i);K(f)}},je=async a=>{var l;try{const i=Y.find(p=>p._id===a.exhibitorId);if(!i)throw new Error("Selected exhibitor not found");const j=(l=h==null?void 0:h.discountConfig)==null?void 0:l.find(p=>`${p.name}-${p.value}-${p.type}`===r),f=le(y,h,r),F=y.map(p=>{const N=p._id||p.id;if(!N)throw new Error(`Invalid stall ID for stall number ${p.number}`);return{stall:p,stallId:N,baseAmount:H(p)}}),ee=F.reduce((p,{baseAmount:N})=>p+N,0),te=F.map(({stall:p,stallId:N,baseAmount:E})=>{const ae=j?_e(E,ee,j):0;return{stallId:N,number:p.number,baseAmount:E,discount:j?{name:j.name,type:j.type,value:j.value,amount:ae}:null,amountAfterDiscount:Math.round((E-ae)*100)/100}}),Z={exhibitionId:a.exhibitionId,exhibitorId:a.exhibitorId,stallIds:te.map(p=>p.stallId),customerName:i.contactPerson,customerEmail:i.email,customerPhone:i.phone,customerAddress:i.address||"N/A",customerGSTIN:i.gstNumber||"N/A",customerPAN:i.panNumber||"N/A",companyName:i.companyName,discount:j?{name:j.name,type:j.type,value:j.value}:null,amount:f.totalAmount,calculations:{stalls:te,totalBaseAmount:ee,totalDiscountAmount:f.discountAmount,totalAmountAfterDiscount:f.amountAfterDiscount,taxes:f.taxes,totalTaxAmount:f.totalTaxAmount,totalAmount:f.totalAmount}};V.length&&(Z.basicAmenities=V.filter(p=>p.calculatedQuantity>0).map(p=>({name:p.name,type:p.type,perSqm:p.perSqm,quantity:p.quantity,calculatedQuantity:p.calculatedQuantity,description:p.description}))),$.length&&(Z.extraAmenities=J());const P=await B(ke(Z)).unwrap();B(ne.util.invalidateTags(["Invoice"])),P&&P.invoiceId?(I.success("Booking created successfully! Redirecting to invoice..."),setTimeout(()=>{z(`/invoice/${P.invoiceId}`)},2e3)):(I.success("Booking created successfully"),B(ne.util.invalidateTags(["Invoice"])),z("/bookings")),P&&P.warning&&I.warning(P.warning)}catch(i){console.error("Error creating booking:",i),I.error("Failed to create booking")}},fe=a=>{w(a),t.setFieldValue("discountId",a)},be=a=>{const l={...Q};a.forEach(i=>{$.includes(i)||(l[i]=1)}),Object.keys(l).forEach(i=>{a.includes(i)||delete l[i]}),G(l),O(a)},Ae=(a,l)=>{G(i=>({...i,[a]:l}))},Se=a=>{t.setFieldValue("exhibitorId",a)},J=()=>{var a;return(a=h==null?void 0:h.amenities)!=null&&a.length?h.amenities.filter(l=>{const i=l._id||l.id;return i&&$.includes(i.toString())}).map(l=>{const i=(l._id||l.id).toString();return{id:i,name:l.name,type:l.type,rate:l.rate,description:l.description,quantity:Q[i]||1}}):[]},ve=()=>le(y,h,r),Ce=he.filter(a=>a.status==="published"&&a.isActive).map(a=>({label:a.name,value:a._id||a.id})),we=Y.map(a=>({label:`${a.companyName} (${a.contactPerson})`,value:a._id}));return e.jsxs("div",{style:{padding:"24px",maxWidth:"1000px",margin:"0 auto"},children:[e.jsxs(q,{gutter:[24,24],children:[e.jsx(T,{span:24,children:e.jsxs(k,{direction:"vertical",size:4,children:[e.jsx(Ve,{level:2,style:{margin:0,color:"#1890ff"},children:"Create Booking"}),e.jsx(Ze,{type:"secondary",children:"Create a new stall booking with enhanced interface"})]})}),e.jsx(T,{span:24,children:e.jsx(_,{style:{borderRadius:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:e.jsxs(x,{form:t,layout:"vertical",onFinish:je,size:"large",children:[e.jsxs(q,{gutter:16,style:{marginBottom:24},children:[e.jsx(T,{span:12,children:e.jsx(x.Item,{name:"exhibitionId",label:"Exhibition",rules:[{required:!0,message:"Please select an exhibition"}],children:e.jsx(W,{placeholder:"Select exhibition",loading:pe,options:Ce,onChange:ge,style:{borderRadius:"8px"}})})}),e.jsx(T,{span:12,children:e.jsx(x.Item,{name:"exhibitorId",label:e.jsxs(k,{children:[e.jsx("span",{children:"Exhibitor"}),e.jsx(R,{type:"link",icon:e.jsx(qe,{}),onClick:()=>c(!0),style:{padding:0,fontSize:"12px"},children:"Add New"})]}),rules:[{required:!0,message:"Please select an exhibitor"}],children:e.jsx(W,{showSearch:!0,placeholder:"Select exhibitor",loading:xe,options:we,style:{borderRadius:"8px"},filterOption:(a,l)=>{var i;return(((i=l==null?void 0:l.label)==null?void 0:i.toString())??"").toLowerCase().includes(a.toLowerCase())}})})})]}),e.jsx(q,{gutter:16,style:{marginBottom:24},children:e.jsx(T,{span:24,children:e.jsx(x.Item,{name:"stallIds",label:"Select Stalls",rules:[{required:!0,message:"Please select at least one stall"}],children:e.jsx(W,{mode:"multiple",placeholder:n?"Loading stalls...":"Select stalls",loading:n,onChange:ye,style:{borderRadius:"8px"},options:s.map(a=>{const l=se(a.dimensions),i=a.dimensions.shapeType==="l-shape"?`L-Shape = ${l.toFixed(2)} sqm`:`${a.dimensions.width}m x ${a.dimensions.height}m = ${l.toFixed(2)} sqm`;return{label:`${a.number} (${i}) - â‚¹${a.ratePerSqm.toLocaleString()}/sq.m`,value:a._id||a.id}})})})})}),e.jsx(Le,{selectedStalls:y,calculateBaseAmount:H}),y.length>0&&e.jsx(Re,{selectedExhibition:h,basicAmenitiesWithQuantities:V,totalStallArea:ue,selectedExtraAmenities:$,extraAmenityQuantities:Q,onExtraAmenitiesChange:be,onExtraAmenityQuantityChange:Ae,getSelectedExtraAmenities:J}),y.length>0&&e.jsx(We,{selectedExhibition:h,selectedDiscountId:r,onDiscountChange:fe,calculateAmounts:ve}),e.jsx(x.Item,{name:"discountId",style:{display:"none"},children:e.jsx("input",{type:"hidden"})}),e.jsx(q,{justify:"center",style:{marginTop:32},children:e.jsx(T,{children:e.jsxs(k,{size:"middle",children:[e.jsx(R,{onClick:()=>z("/bookings"),size:"large",style:{borderRadius:"8px",minWidth:"120px"},children:"Cancel"}),e.jsx(R,{type:"primary",htmlType:"submit",loading:me,size:"large",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"8px",minWidth:"140px",boxShadow:"0 4px 15px 0 rgba(116, 79, 168, 0.75)"},children:"Create Booking"})]})})})]})})})]}),e.jsx(De,{visible:u,onCancel:()=>{c(!1),o.resetFields()},onExhibitorAdded:Se,form:o})]})};export{Xe as default};
