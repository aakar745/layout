import{j as e,ac as b,ad as z}from"./index-BfjvBafq.js";import{l as le,u as de,k as pe,r as y}from"./vendor-react-BNeW3y6d.js";/* empty css                       */import{N as c,X as o,q as N,o as me,Q as w,c as g,f as G,F as V,x as O,a7 as d,T as ye,S as he,W as q,D as B,al as Y,a5 as R,a6 as i,K as h,z as ue,as as ge,a4 as Q,aM as U,b as K}from"./vendor-antd-sZZBSykP.js";import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:T,Text:H,Paragraph:je}=ye,{Option:xe}=Q,{TextArea:J}=h,{Step:_e}=Y,{Content:D}=N,Ce=()=>{const{exhibitionId:v}=le(),j=de(),E=pe(),[P]=c.useForm(),[p,x]=y.useState(0),[W,S]=y.useState(!0),[X,f]=y.useState(!1),[a,k]=y.useState(null),[t,I]=y.useState({vendorName:"",companyName:"",exhibitorCompanyName:"",vendorEmail:"",vendorPhone:"",stallNumber:"",vendorAddress:"",serviceType:""}),[m,_]=y.useState(null),C=E.pathname==="/service-charge/payment-success";y.useEffect(()=>{C?$():v&&(Z(),ee())},[v,C]);const $=async()=>{try{const n=new URLSearchParams(E.search).get("serviceChargeId");if(!n){o.error("Payment verification failed: Missing service charge ID"),j("/");return}S(!0);const r=await fetch(`/api/public/service-charge/status/${n}`),l=await r.json();if(!r.ok)throw new Error(l.message||"Failed to verify payment status");if(l.data.status==="paid"){if(_(l.data),x(2),l.data.exhibitionId){const u=await fetch(`/api/public/service-charge/config/${l.data.exhibitionId}`);if(u.ok){const M=await u.json();k(M.data)}}o.success("Payment verified successfully!")}else o.warning("Payment verification in progress. Please wait..."),setTimeout(()=>{$()},3e3)}catch(s){console.error("Payment verification error:",s),o.error(s.message||"Payment verification failed"),j("/")}finally{S(!1)}},Z=async()=>{try{const s=await fetch(`/api/public/service-charge/config/${v}`),n=await s.json();if(!s.ok)throw new Error(n.message||"Failed to fetch exhibition config");k(n.data)}catch(s){o.error(s.message||"Failed to load exhibition details"),setTimeout(()=>j("/"),3e3)}finally{S(!1)}},ee=()=>new Promise(s=>{const n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>s(!0),n.onerror=()=>s(!1),document.body.appendChild(n)}),ae=()=>{P.validateFields().then(()=>{const s=P.getFieldsValue();I({...t,...s}),x(p+1)})},se=()=>{const s=P.getFieldsValue();I({...t,...s}),x(p-1)},ne=async()=>{try{f(!0);const s=await fetch("/api/public/service-charge/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({exhibitionId:v,...t,amount:F()})}),n=await s.json();if(!s.ok)throw new Error(n.message||"Failed to create order");if(n.data.paymentGateway==="phonepe")if((a==null?void 0:a.config.phonePeConfig.clientId)==="phonepe_test_development_mode")o.info("Development Mode: Simulating PhonePe payment..."),setTimeout(async()=>{await te(n.data.orderId)},2e3);else if(n.data.redirectUrl)window.location.href=n.data.redirectUrl;else throw new Error("PhonePe payment URL not received");else if((a==null?void 0:a.config.razorpayKeyId)==="rzp_test_development_mode")o.info("Development Mode: Simulating Razorpay payment..."),setTimeout(async()=>{const u={razorpay_order_id:n.data.orderId,razorpay_payment_id:`pay_dev_${Date.now()}`,razorpay_signature:`sig_dev_${Date.now()}`};await A(u,n.data.serviceChargeId)},2e3);else{const u={key:a==null?void 0:a.config.razorpayKeyId,amount:n.data.amount*100,currency:"INR",name:a==null?void 0:a.name,description:`Service Charge - ${t.serviceType}`,order_id:n.data.orderId,prefill:{name:t.vendorName,email:t.vendorEmail,contact:t.vendorPhone},handler:async ce=>{await A(ce,n.data.serviceChargeId)},modal:{ondismiss:()=>{f(!1),o.warning("Payment cancelled")}}};new window.Razorpay(u).open()}}catch(s){f(!1),o.error(s.message||"Payment initialization failed")}},A=async(s,n)=>{try{const r=await fetch("/api/public/service-charge/verify-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serviceChargeId:n,razorpay_payment_id:s.razorpay_payment_id,razorpay_order_id:s.razorpay_order_id,razorpay_signature:s.razorpay_signature})}),l=await r.json();if(!r.ok)throw new Error(l.message||"Payment verification failed");_(l.data),x(2),o.success("Payment successful!")}catch(r){o.error(r.message||"Payment verification failed")}finally{f(!1)}},te=async s=>{try{const n=await fetch("/api/public/service-charge/verify-phonepe-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({merchantTransactionId:s})}),r=await n.json();if(!n.ok)throw new Error(r.message||"Payment verification failed");_(r.data),x(2),o.success("Payment successful!")}catch(n){o.error(n.message||"Payment verification failed")}finally{f(!1)}},F=()=>{const s=a==null?void 0:a.config.serviceTypes.find(n=>n.type===t.serviceType);return(s==null?void 0:s.amount)||0},re=()=>e.jsx(d,{title:"Vendor Information",className:"step-card",children:e.jsxs(R,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(c.Item,{name:"vendorName",label:"Vendor Name",rules:[{required:!0,message:"Please enter vendor name"}],children:e.jsx(h,{prefix:e.jsx(G,{}),placeholder:"Enter vendor name"})})}),e.jsx(i,{span:12,children:e.jsx(c.Item,{name:"companyName",label:"Vendor Company Name",rules:[{required:!0,message:"Please enter vendor company name"}],children:e.jsx(h,{placeholder:"Enter vendor company name"})})}),e.jsx(i,{span:12,children:e.jsx(c.Item,{name:"exhibitorCompanyName",label:"Exhibitor Company Name (Optional)",children:e.jsx(h,{placeholder:"Enter exhibitor company name"})})}),e.jsx(i,{span:12,children:e.jsx(c.Item,{name:"vendorEmail",label:"Email (Optional)",rules:[{type:"email",message:"Please enter valid email"}],children:e.jsx(h,{prefix:e.jsx(ue,{}),placeholder:"Enter email address"})})}),e.jsx(i,{span:12,children:e.jsx(c.Item,{name:"vendorPhone",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"}],children:e.jsx(h,{prefix:e.jsx(ge,{}),placeholder:"Enter phone number"})})}),e.jsx(i,{span:12,children:e.jsx(c.Item,{name:"stallNumber",label:"Exhibitor Stall Number",rules:[{required:!0,message:"Please enter the exhibitor stall number"}],children:e.jsx(h,{placeholder:"Enter exhibitor stall number"})})}),e.jsx(i,{span:12,children:e.jsx(c.Item,{name:"serviceType",label:"Service Type",rules:[{required:!0,message:"Please select service type"}],children:e.jsx(Q,{placeholder:"Select service type",children:a==null?void 0:a.config.serviceTypes.map(s=>e.jsxs(xe,{value:s.type,children:[s.type," - ₹",s.amount.toLocaleString("en-IN")]},s.type))})})}),e.jsx(i,{span:24,children:e.jsx(c.Item,{name:"vendorAddress",label:"Address",rules:[{required:!0,message:"Please enter address"}],children:e.jsx(J,{rows:3,placeholder:"Enter complete address"})})}),e.jsx(i,{span:24,children:e.jsx(c.Item,{name:"description",label:"Additional Notes (Optional)",children:e.jsx(J,{rows:2,placeholder:"Any additional notes or requirements"})})})]})}),oe=()=>{const s=a==null?void 0:a.config.serviceTypes.find(n=>n.type===t.serviceType);return e.jsx(d,{title:"Payment Details",className:"step-card",children:e.jsxs("div",{className:"payment-summary",children:[e.jsxs(R,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsxs(d,{size:"small",title:"Service Details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Service Type:"})," ",t.serviceType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ₹",s==null?void 0:s.amount.toLocaleString("en-IN")]}),(s==null?void 0:s.description)&&e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.description]})]})}),e.jsx(i,{span:12,children:e.jsxs(d,{size:"small",title:"Vendor Details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",t.vendorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vendor Company:"})," ",t.companyName]}),t.exhibitorCompanyName&&e.jsxs("p",{children:[e.jsx("strong",{children:"Exhibitor Company:"})," ",t.exhibitorCompanyName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Stall Number:"})," ",t.stallNumber]}),t.vendorEmail&&e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",t.vendorEmail]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",t.vendorPhone]})]})})]}),e.jsx(B,{}),e.jsx("div",{className:"payment-total",children:e.jsxs(T,{level:3,children:["Total Amount: ₹",s==null?void 0:s.amount.toLocaleString("en-IN")]})}),(()=>{const n=(a==null?void 0:a.config.paymentGateway)==="phonepe"?(a==null?void 0:a.config.phonePeConfig.clientId)==="phonepe_test_development_mode":(a==null?void 0:a.config.razorpayKeyId)==="rzp_test_development_mode",r=(a==null?void 0:a.config.paymentGateway)||"phonepe";return n?e.jsx(w,{message:"Development Mode",description:`This is running in development mode. ${r==="phonepe"?"PhonePe":"Razorpay"} payment will be simulated - no actual payment will be processed.`,type:"warning",icon:e.jsx(q,{}),style:{marginBottom:16},showIcon:!0}):e.jsx(w,{message:"Secure Payment",description:`Your payment is processed securely through ${r==="phonepe"?"PhonePe":"Razorpay"}. You will receive a receipt via email after successful payment.`,type:"info",icon:e.jsx(U,{}),style:{marginBottom:16}})})()]})})},ie=()=>e.jsx(d,{className:"step-card success-card",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(O,{style:{fontSize:64,color:"#52c41a",marginBottom:16}}),e.jsx(T,{level:2,children:"Payment Successful!"}),m&&e.jsxs("div",{className:"success-details",children:[e.jsxs(K,{color:"green",style:{marginBottom:16},children:["Receipt Number: ",m.receiptNumber]}),e.jsx(d,{size:"small",style:{marginBottom:16},children:e.jsxs(R,{gutter:16,children:[e.jsxs(i,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amount Paid:"})," ₹",m.amount.toLocaleString("en-IN")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment ID:"})," ",m.paymentId]})]}),e.jsxs(i,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(m.paidAt).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(K,{color:"green",children:"Paid"})]})]})]})}),e.jsx(w,{message:"Receipt Sent",description:"A detailed receipt has been sent to your email address. You can also download it using the link below.",type:"success",style:{marginBottom:16}}),m.receiptDownloadUrl&&e.jsx(g,{type:"primary",icon:e.jsx(U,{}),href:m.receiptDownloadUrl,target:"_blank",style:{marginRight:8},children:"Download Receipt"}),e.jsx(g,{onClick:()=>j("/"),children:"Back to Home"})]})]})});if(W)return e.jsxs(N,{children:[e.jsx(b,{}),e.jsx(D,{style:{paddingTop:"64px"},children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(me,{size:"large",tip:"Loading exhibition details..."})})}),e.jsx(z,{})]});if(!a&&!C)return e.jsxs(N,{children:[e.jsx(b,{}),e.jsx(D,{style:{paddingTop:"64px"},children:e.jsxs("div",{style:{padding:"50px",textAlign:"center"},children:[e.jsx(w,{message:"Exhibition Not Found",description:"The requested exhibition could not be found or service charges are not enabled.",type:"error",showIcon:!0}),e.jsx(g,{type:"primary",onClick:()=>j("/"),style:{marginTop:16},children:"Back to Home"})]})}),e.jsx(z,{})]});const L=[{title:"Vendor Details",icon:e.jsx(G,{}),content:re()},{title:"Payment",icon:e.jsx(V,{}),content:oe()},{title:"Confirmation",icon:e.jsx(O,{}),content:ie()}];return e.jsxs(N,{children:[e.jsx(b,{}),e.jsx(D,{style:{paddingTop:"64px",background:"#f5f5f5"},children:e.jsx("div",{className:"public-service-charge-form",children:e.jsxs("div",{className:"form-container",children:[e.jsx(d,{className:"header-card",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(T,{level:2,children:(a==null?void 0:a.config.title)||"Service Charge Payment"}),e.jsx(je,{children:(a==null?void 0:a.config.description)||"Complete your service charge payment"}),a&&e.jsxs(he,{children:[e.jsx(q,{}),e.jsx(H,{strong:!0,children:a.name}),e.jsx(B,{type:"vertical"}),e.jsx(H,{children:a.venue})]})]})}),e.jsx(d,{className:"steps-card",children:e.jsx(Y,{current:p,items:L})}),e.jsx(c,{form:P,layout:"vertical",initialValues:t,onValuesChange:(s,n)=>I({...t,...n}),children:L[p].content}),e.jsx(d,{className:"actions-card",children:e.jsxs("div",{style:{textAlign:"center"},children:[p>0&&p<2&&e.jsx(g,{onClick:se,style:{marginRight:8},children:"Previous"}),p===0&&e.jsx(g,{type:"primary",onClick:ae,children:"Next"}),p===1&&e.jsx(g,{type:"primary",onClick:ne,loading:X,icon:e.jsx(V,{}),children:(()=>{const s=(a==null?void 0:a.config.paymentGateway)==="phonepe"?(a==null?void 0:a.config.phonePeConfig.clientId)==="phonepe_test_development_mode":(a==null?void 0:a.config.razorpayKeyId)==="rzp_test_development_mode",n=(a==null?void 0:a.config.paymentGateway)||"phonepe",r=F().toLocaleString("en-IN");return s?`Simulate ${n==="phonepe"?"PhonePe":"Razorpay"} Payment Rs. ${r}`:`Pay via ${n==="phonepe"?"PhonePe":"Razorpay"} Rs. ${r}`})()})]})})]})})}),e.jsx(z,{})]})};export{Ce as default};
