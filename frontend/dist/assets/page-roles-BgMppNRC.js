import{r as e,j as s,g as i,_ as r,q as t,a5 as o,am as l,C as n}from"./vendor-others-aeGeD6f-.js";import{u as a,a as d}from"./vendor-react-i7tvbPTl.js";import{F as c,G as h,H as p,I as m}from"./store-D4NI4RZ9.js";import{F as u}from"./vendor-antd-form-DJHhvp8w.js";import{M as x}from"./vendor-antd-modal-1GBGM2fb.js";import{I as g,D as b,c as j,R as y,C as k,y as f,T as v,e as w,i as _,u as C,k as E}from"./vendor-antd-core-CLD06I8y.js";import{B as R}from"./vendor-antd-buttons-wjEWA2x8.js";import{u as S}from"./page-booking-B9D71fvQ.js";import{F as D}from"./vendor-antd-table-CA0XBoxE.js";import"./vendor-ui-BOD89xu8.js";import"./vendor-canvas-BOVIu3pe.js";import"./services-DHEt1Qtz.js";import"./vendor-utils-CTzFqUk0.js";import"./component-exhibition-CuwlJtEU.js";import"./vendor-editor-HOXaQDhO.js";import"./component-layout-BTsCaDZB.js";import"./component-auth-ClRi3ofU.js";import"./page-amenities-Cf9BkOfe.js";import"./page-dashboard-984XnN9x.js";const{Text:A}=v,T=[{key:"dashboard_view",label:"View Dashboard",group:"Dashboard"},{key:"dashboard_manage",label:"Manage Dashboard",group:"Dashboard"},{key:"users_view",label:"View Users",group:"Users"},{key:"users_create",label:"Create Users",group:"Users"},{key:"users_edit",label:"Edit Users",group:"Users"},{key:"users_delete",label:"Delete Users",group:"Users"},{key:"roles_view",label:"View Roles",group:"Roles"},{key:"roles_create",label:"Create Roles",group:"Roles"},{key:"roles_edit",label:"Edit Roles",group:"Roles"},{key:"roles_delete",label:"Delete Roles",group:"Roles"},{key:"exhibitions_view",label:"View Exhibitions",group:"Exhibitions"},{key:"exhibitions_create",label:"Create Exhibitions",group:"Exhibitions"},{key:"exhibitions_edit",label:"Edit Exhibitions",group:"Exhibitions"},{key:"exhibitions_delete",label:"Delete Exhibitions",group:"Exhibitions"},{key:"bookings_view",label:"View Bookings",group:"Bookings"},{key:"bookings_create",label:"Create Bookings",group:"Bookings"},{key:"bookings_edit",label:"Edit Bookings",group:"Bookings"},{key:"bookings_delete",label:"Delete Bookings",group:"Bookings"},{key:"exhibitors_view",label:"View Exhibitors",group:"Exhibitors"},{key:"exhibitors_create",label:"Create Exhibitors",group:"Exhibitors"},{key:"exhibitors_edit",label:"Edit Exhibitors",group:"Exhibitors"},{key:"exhibitors_delete",label:"Delete Exhibitors",group:"Exhibitors"},{key:"settings_view",label:"View Settings",group:"Settings"},{key:"settings_edit",label:"Edit Settings",group:"Settings"}].reduce(((e,s)=>(e[s.group]||(e[s.group]=[]),e[s.group].push({key:s.key,label:s.label}),e)),{}),B=({visible:i,onCancel:r,onSave:t,role:o,loading:l})=>{const[n]=u.useForm(),a=!!o,[d,c]=e.useState([]);e.useEffect((()=>{if(i)if(o){const e=o.permissions||[];n.setFieldsValue({name:o.name,description:o.description,permissions:e}),c(e)}else n.resetFields(),c([])}),[i,o,n]);const h=e=>{const s=T[e].map((e=>e.key));return s.length>0&&s.every((e=>d.includes(e)))};return s.jsx(x,{title:a?"Edit Role":"Add New Role",open:i,onCancel:r,width:700,footer:[s.jsx(R,{onClick:r,children:"Cancel"},"cancel"),s.jsx(R,{type:"primary",loading:l,onClick:()=>{n.setFieldsValue({permissions:d}),n.validateFields().then((e=>{t(e)}))},children:a?"Update":"Create"},"submit")],children:s.jsxs(u,{form:n,layout:"vertical",initialValues:{name:"",description:"",permissions:[]},children:[s.jsx(u.Item,{name:"name",label:"Role Name",rules:[{required:!0,message:"Please enter a role name"}],children:s.jsx(g,{placeholder:"e.g., Administrator, Editor, Viewer"})}),s.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please provide a description"}],children:s.jsx(g.TextArea,{placeholder:"Describe the purpose of this role",rows:3})}),s.jsx(b,{plain:!0,children:"Permissions"}),s.jsx(u.Item,{name:"permissions",hidden:!0,children:s.jsx(g,{})}),s.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 8px"},children:Object.entries(T).map((([e,i])=>s.jsx(j,{size:"small",title:s.jsxs(w,{children:[s.jsx(A,{strong:!0,children:e}),s.jsx(f,{checked:h(e),onChange:s=>((e,s)=>{const i=T[e].map((e=>e.key));let r;if(s){const e=i.filter((e=>!d.includes(e)));r=[...d,...e]}else r=d.filter((e=>!i.includes(e)));c(r)})(e,s.target.checked),children:"Select All"})]}),style:{marginBottom:16},children:s.jsx(y,{gutter:[16,12],children:i.map((e=>{return s.jsx(k,{span:12,children:s.jsx(f,{checked:(i=e.key,d.includes(i)),onChange:s=>((e,s)=>{let i;i=s?[...d,e]:d.filter((s=>s!==e)),c(i)})(e.key,s.target.checked),children:s.jsx(A,{children:e.label})})},e.key);var i}))})},e)))})]})})},{Title:F,Paragraph:V,Text:U}=v,{confirm:z}=x;function I({allowed:e}){return e?s.jsx(o,{className:"text-success",style:{color:"#52c41a",fontSize:16}}):s.jsx(l,{className:"text-danger",style:{color:"#f5222d",fontSize:16}})}function W(){const{message:o,notification:l}=_.useApp(),u=a(),{roles:x,loading:b,error:f}=d((e=>e.role)),[v,A]=e.useState(""),[T,W]=e.useState(!1),[$,P]=e.useState(null),{hasPermission:L}=S();e.useEffect((()=>{u(c())}),[u]),e.useEffect((()=>{f&&l.error({message:"Error",description:f})}),[f,l]);const M=[{title:"Role",dataIndex:"name",key:"name",render:(e,i)=>s.jsxs(w,{children:[s.jsx(C,{style:{backgroundColor:O(i.name)},children:e.charAt(0).toUpperCase()}),s.jsx(U,{strong:!0,children:e})]})},{title:"Description",dataIndex:"description",key:"description",render:e=>s.jsx(U,{type:"secondary",children:e})},{title:"Read",key:"read",align:"center",render:(e,i)=>s.jsx(I,{allowed:N(i)})},{title:"Write",key:"write",align:"center",render:(e,i)=>s.jsx(I,{allowed:q(i)})},{title:"Delete",key:"delete",align:"center",render:(e,i)=>s.jsx(I,{allowed:H(i)})},{title:"Actions",key:"actions",align:"right",render:(e,i)=>s.jsxs(w,{children:[L("roles_edit")&&s.jsx(E,{title:"Administrator"===i.name?"Administrator role cannot be edited":"Edit role",children:s.jsx(R,{type:"primary",shape:"circle",icon:s.jsx(r,{}),size:"small",onClick:()=>(P(i),void W(!0)),disabled:"Administrator"===i.name})}),L("roles_delete")&&s.jsx(E,{title:"Delete role",children:s.jsx(R,{danger:!0,shape:"circle",icon:s.jsx(t,{}),size:"small",onClick:()=>{return e=i,void z({title:"Are you sure you want to delete this role?",icon:s.jsx(n,{}),content:`This will permanently delete the ${e.name} role. This action cannot be undone.`,okText:"Yes, delete it",okType:"danger",cancelText:"Cancel",onOk(){u(m(e._id)).unwrap().then((()=>{o.success(`${e.name} role deleted successfully`)})).catch((e=>{o.error(`Failed to delete role: ${e.message}`)}))}});var e},disabled:"Administrator"===i.name})})]})}],N=e=>e.permissions.some((e=>e.endsWith("_view"))),q=e=>e.permissions.some((e=>e.endsWith("_create")||e.endsWith("_edit"))),H=e=>e.permissions.some((e=>e.endsWith("_delete"))),O=e=>{const s=["#1677ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#eb2f96"];let i=0;for(let r=0;r<e.length;r++)i=e.charCodeAt(r)+((i<<5)-i);return s[Math.abs(i)%s.length]},Y=x.filter((e=>e.name.toLowerCase().includes(v.toLowerCase())||e.description.toLowerCase().includes(v.toLowerCase())));return s.jsxs("div",{style:{padding:"12px 0"},children:[s.jsxs("div",{style:{marginBottom:24},children:[s.jsx(F,{level:2,children:"Roles & Permissions"}),s.jsx(V,{children:"Manage role-based access control and permissions for your users."})]}),s.jsxs(j,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},loading:b&&0===x.length,children:[s.jsxs(y,{gutter:16,style:{marginBottom:16},children:[s.jsx(k,{span:16,children:s.jsx(g,{placeholder:"Search roles...",allowClear:!0,value:v,onChange:e=>A(e.target.value),prefix:s.jsx(U,{type:"secondary",style:{fontSize:16},children:"ðŸ”"})})}),s.jsx(k,{span:8,style:{textAlign:"right"},children:L("roles_create")&&s.jsx(R,{type:"primary",icon:s.jsx(i,{}),style:{borderRadius:6},onClick:()=>{P(null),W(!0)},children:"Add Role"})})]}),s.jsx(D,{columns:M,dataSource:Y,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(e,s)=>`Showing ${s[0]}-${s[1]} of ${e} roles`},style:{marginTop:8},loading:b&&x.length>0})]}),s.jsx(j,{title:s.jsx(F,{level:4,style:{margin:0},children:"Role Management Tips"}),style:{marginTop:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:s.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[s.jsxs(w,{direction:"vertical",style:{flex:1,minWidth:250},children:[s.jsx(F,{level:5,children:"Best Practices"}),s.jsxs("ul",{style:{paddingLeft:20},children:[s.jsx("li",{children:s.jsx(U,{children:"Follow the principle of least privilege"})}),s.jsx("li",{children:s.jsx(U,{children:"Regularly audit user roles"})}),s.jsx("li",{children:s.jsx(U,{children:"Document role responsibilities"})})]})]}),s.jsxs(w,{direction:"vertical",style:{flex:1,minWidth:250},children:[s.jsx(F,{level:5,children:"Role Inheritance"}),s.jsx(V,{children:"Higher-level roles automatically include permissions from lower-level roles to ensure consistency."})]})]})}),s.jsx(B,{visible:T,onCancel:()=>W(!1),onSave:e=>{$?u(h({id:$._id,roleData:e})).unwrap().then((()=>{W(!1),o.success("Role updated successfully")})).catch((e=>{o.error(`Failed to update role: ${e.message}`)})):u(p(e)).unwrap().then((()=>{W(!1),o.success("Role created successfully")})).catch((e=>{o.error(`Failed to create role: ${e.message}`)}))},role:$,loading:b})]})}export{W as default};
