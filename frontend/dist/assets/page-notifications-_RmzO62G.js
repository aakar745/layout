import{j as e,q as t,ak as i,d as s,al as a,F as n,M as o,r,U as c,B as l,$ as d,a6 as u,R as h,x as f,a as E,V as m}from"./vendor-others-aeGeD6f-.js";import{c as x,a as y,b as p}from"./vendor-react-i7tvbPTl.js";import{n as j}from"./services-DHEt1Qtz.js";import{T as g,J as N,k as I,e as A,o as R,B as S,u as T,j as b,b as _,E as v,D as w,v as O,c as C,A as L,R as k,C as D,h as M,N as G,I as B}from"./vendor-antd-core-CLD06I8y.js";import{B as P}from"./vendor-antd-buttons-wjEWA2x8.js";import{d as H,r as U}from"./vendor-utils-CTzFqUk0.js";import{F}from"./vendor-antd-form-DJHhvp8w.js";var K=(e=>(e.NEW_LEAD="New Lead",e.FOLLOWUP_DUE="Follow-up Due",e.STATUS_CHANGE="Status Changed",e.ASSIGNMENT="Lead Assigned",e.NEW_BOOKING="NEW_BOOKING",e.BOOKING_CONFIRMED="BOOKING_CONFIRMED",e.BOOKING_CANCELLED="BOOKING_CANCELLED",e.PAYMENT_RECEIVED="PAYMENT_RECEIVED",e.INVOICE_GENERATED="INVOICE_GENERATED",e.EXHIBITION_UPDATE="EXHIBITION_UPDATE",e.SYSTEM_MESSAGE="SYSTEM_MESSAGE",e.EXHIBITOR_MESSAGE="EXHIBITOR_MESSAGE",e.EXHIBITOR_REGISTERED="EXHIBITOR_REGISTERED",e))(K||{}),V=(e=>(e.HIGH="HIGH",e.MEDIUM="MEDIUM",e.LOW="LOW",e))(V||{}),W=(e=>(e.READ="Read",e.UNREAD="Unread",e))(W||{});H.extend(U);const $=e=>{switch(e){case V.HIGH:return"#f5222d";case V.MEDIUM:return"#faad14";case V.LOW:return"#52c41a";default:return"#1677ff"}},X=e=>H(e).fromNow(),Y=e=>e.filter((e=>!1===e.isRead)).length,{Text:z,Paragraph:q}=g,J=({notification:r,onView:c,onMarkAsRead:l,onDelete:d})=>{return e.jsx(N.Item,{onClick:()=>{r.isRead||l(r),c(r)},className:r.isRead?"":"notification-unread",style:{cursor:"pointer",backgroundColor:r.isRead?"transparent":"#f0f5ff",padding:"16px",borderRadius:"4px",transition:"background-color 0.3s"},actions:[e.jsx(I,{title:"Delete notification",children:e.jsx(P,{type:"text",danger:!0,icon:e.jsx(t,{}),onClick:e=>{e.stopPropagation(),d(r)},"aria-label":"Delete notification"})})],children:e.jsx(N.Item.Meta,{avatar:e.jsx(S,{dot:!r.isRead,color:$(r.priority),children:e.jsx(T,{icon:(()=>{switch(r.type){case K.NEW_LEAD:return e.jsx(o,{style:{color:"#1677ff"}});case K.FOLLOWUP_DUE:return e.jsx(n,{style:{color:"#faad14"}});case K.STATUS_CHANGE:return e.jsx(a,{style:{color:"#722ed1"}});case K.ASSIGNMENT:return e.jsx(s,{style:{color:"#52c41a"}});default:return e.jsx(i,{style:{color:"#1677ff"}})}})(),size:"large",style:{backgroundColor:"white",border:`1px solid ${$(r.priority)}`}})}),title:e.jsxs(A,{children:[e.jsx(z,{strong:!0,children:r.title}),!r.isRead&&e.jsx(R,{color:"blue",children:"New"})]}),description:e.jsxs("div",{children:[e.jsx(q,{ellipsis:{rows:2},style:{marginBottom:4},children:r.message}),e.jsx(I,{title:(u=r.createdAt,H(u).format("YYYY-MM-DD HH:mm")),children:e.jsx(z,{type:"secondary",style:{fontSize:12},children:X(r.createdAt)})})]})})});var u},{Title:Q,Text:Z}=g,ee=e=>{switch(e){case"NEW_BOOKING":case"EXHIBITOR_REGISTERED":return K.NEW_LEAD;case"BOOKING_CONFIRMED":case"INVOICE_GENERATED":case"PAYMENT_RECEIVED":default:return K.STATUS_CHANGE;case"EXHIBITOR_MESSAGE":return K.FOLLOWUP_DUE}},te=e=>{switch(e){case"HIGH":return V.HIGH;case"MEDIUM":default:return V.MEDIUM;case"LOW":return V.LOW}},ie=({isExhibitor:s=!1})=>{const a=x(),[n,o]=r.useState([]),[h,f]=r.useState(!1),[E,m]=r.useState(!1),[p,g]=r.useState(0),[I,R]=r.useState(!1),[T,C]=r.useState("all"),L=r.useRef(null),{isAuthenticated:k,user:D}=y((e=>e.auth)),{isAuthenticated:M}=y((e=>e.exhibitorAuth||{isAuthenticated:!1})),G=s?M:k,[B,H]=r.useState(!1);r.useEffect((()=>{if(G){const e=s?"exhibitor_token":"token",t=localStorage.getItem(e);if(t){j.init(t,s),j.subscribeToNotifications();const e=e=>{g(e),e>0&&!E&&(R(!0),setTimeout((()=>{R(!1)}),2e3))},i=e=>{o((t=>[e,...t]))},a=()=>{H(!0),U()},n=()=>{H(!1)};return j.addEventListener("unreadCount",e),j.addEventListener("notification",i),j.addEventListener("connected",a),j.addEventListener("disconnected",n),U(),()=>{j.removeEventListener("unreadCount",e),j.removeEventListener("notification",i),j.removeEventListener("connected",a),j.removeEventListener("disconnected",n),j.unsubscribeFromNotifications()}}}}),[G,s]);const U=async()=>{if(G){f(!0);try{const e=await j.getNotifications(1,10);e.success&&(o(e.data.notifications),g(e.data.unreadCount))}catch(e){}finally{f(!1)}}},F=async e=>{try{await j.markAsRead(e._id),o(n.map((t=>t._id===e._id?{...t,isRead:!0}:t)))}catch(t){}},K=async e=>{try{await j.deleteNotification(e._id),o(n.filter((t=>t._id!==e._id))),e.isRead||g((e=>Math.max(0,e-1)))}catch(t){}},V=()=>"unread"===T?n.filter((e=>!e.isRead)):n.slice(0,10),$=e.jsxs("div",{className:"notification-dropdown",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx(Q,{level:5,style:{margin:0},children:"Notifications"}),e.jsxs(A,{children:[e.jsx(P,{type:"text",size:"small",icon:e.jsx(c,{}),onClick:U,loading:h,className:"header-btn",title:"Refresh notifications"}),e.jsx(P,{type:"text",size:"small",icon:e.jsx(l,{}),onClick:async()=>{try{await j.markAllAsRead(),o(n.map((e=>({...e,isRead:!0})))),g(0)}catch(e){}},disabled:0===p,className:"header-btn",title:"Mark all as read"}),e.jsx(P,{type:"text",size:"small",danger:!0,icon:e.jsx(t,{}),onClick:async()=>{try{await j.deleteAllNotifications(),o([]),g(0)}catch(e){}},disabled:0===n.length,className:"header-btn",title:"Clear all notifications"}),e.jsx(P,{type:"text",size:"small",icon:e.jsx(d,{}),onClick:()=>a("/notifications"),className:"header-btn",title:"Notification Settings"}),e.jsx(P,{type:"text",size:"small",icon:e.jsx(u,{}),onClick:()=>m(!1),className:"header-btn",title:"Close"})]})]}),e.jsx(b,{activeKey:T,onChange:e=>{C(e)},size:"small",className:"notification-tabs",items:[{key:"all",label:e.jsx("span",{children:"All"})},{key:"unread",label:e.jsxs("span",{className:"tab-label",children:["Unread",e.jsx(S,{count:p,size:"small",offset:[5,-3],style:{backgroundColor:"#1677ff"}})]})}]}),e.jsx("div",{className:"notification-list",children:e.jsx(_,{spinning:h,children:0===V().length?e.jsx(v,{image:v.PRESENTED_IMAGE_SIMPLE,description:"unread"===T?"No unread notifications":"No notifications",style:{padding:"20px 0"}}):e.jsx(N,{dataSource:V(),renderItem:t=>{return e.jsx(J,{notification:(i=t,{_id:i._id,recipient:i.recipient,recipientType:i.recipientType||"admin",title:i.title,message:i.message,type:ee(i.type),priority:te(i.priority),isRead:i.isRead,readAt:i.readAt,entityId:i.entityId,entityType:i.entityType,data:i.data,createdAt:i.createdAt,updatedAt:i.updatedAt||i.createdAt,id:i._id,userId:i.recipient,source:null==(n=i.data)?void 0:n.source,status:i.isRead?W.READ:W.UNREAD}),onView:()=>(async e=>{if(e.isRead||await F(e),m(!1),e.entityId&&e.entityType){let t="";switch(e.entityType){case"Booking":t=s?`/exhibitor/bookings/${e.entityId}`:"/bookings";break;case"Invoice":t=s?`/exhibitor/invoice/${e.entityId}`:`/invoice/${e.entityId}`;break;case"Exhibition":t=`/exhibition/${e.entityId}`;break;case"Exhibitor":t=`/exhibitors?id=${e.entityId}`;break;default:t=""}a(t||"/notifications")}else a("/notifications")})(t),onMarkAsRead:()=>F(t),onDelete:K});var i,n}})})}),e.jsx(w,{style:{margin:"0"}}),e.jsx("div",{className:"notification-footer",children:e.jsx(P,{type:"link",onClick:()=>{m(!1),a("/notifications")},children:"View All Notifications"})})]});return e.jsx("div",{ref:L,className:"bell-container "+(I?"bell-animate":""),children:e.jsx(O,{overlay:$,trigger:["click"],open:E,onOpenChange:e=>{m(e),e&&(L.current&&L.current.classList.remove("bell-animate"),U())},placement:"bottomRight",getPopupContainer:e=>e.parentNode,overlayClassName:"notification-dropdown-overlay",children:e.jsx("div",{className:"bell-trigger",children:e.jsx(S,{count:p,className:"notification-badge",size:"default",overflowCount:99,children:e.jsx(i,{className:"notification-bell-icon"})})})})})},{Title:se,Text:ae,Paragraph:ne}=g,oe=({settings:t,onSave:i,loading:s})=>{const[a]=F.useForm();h.useEffect((()=>{a.setFieldsValue(t)}),[t,a]);return e.jsxs(C,{title:e.jsxs(A,{children:[e.jsx(E,{}),e.jsx("span",{children:"Email Notifications"})]}),style:{marginBottom:24},children:[e.jsx(ne,{children:"Configure which notifications you want to receive via email. Email notifications will be sent to your registered email address."}),e.jsx(L,{message:"Email Notifications",description:"Email notifications help you stay updated even when you're not logged into the system.",type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsxs(F,{form:a,layout:"vertical",initialValues:t,onFinish:e=>{i(e)},children:[e.jsxs(k,{gutter:[24,16],children:[e.jsxs(D,{span:24,children:[e.jsx(F.Item,{name:"newLeads",valuePropName:"checked",label:e.jsx(ae,{strong:!0,children:"New Lead Notifications"}),children:e.jsx(M,{})}),e.jsx(ne,{type:"secondary",style:{marginTop:-16,marginBottom:16},children:"Receive email when new leads are created or assigned to you"})]}),e.jsxs(D,{span:24,children:[e.jsx(F.Item,{name:"followUpReminders",valuePropName:"checked",label:e.jsx(ae,{strong:!0,children:"Follow-up Reminders"}),children:e.jsx(M,{})}),e.jsx(ne,{type:"secondary",style:{marginTop:-16,marginBottom:16},children:"Receive reminders for upcoming follow-ups"})]}),e.jsxs(D,{span:24,children:[e.jsx(F.Item,{name:"statusChanges",valuePropName:"checked",label:e.jsx(ae,{strong:!0,children:"Status Change Notifications"}),children:e.jsx(M,{})}),e.jsx(ne,{type:"secondary",style:{marginTop:-16,marginBottom:16},children:"Receive notifications when lead statuses are updated"})]}),e.jsxs(D,{span:24,children:[e.jsx(F.Item,{name:"leadAssignments",valuePropName:"checked",label:e.jsx(ae,{strong:!0,children:"Lead Assignment Notifications"}),children:e.jsx(M,{})}),e.jsx(ne,{type:"secondary",style:{marginTop:-16,marginBottom:16},children:"Receive notifications when leads are assigned to you"})]})]}),e.jsx(w,{}),e.jsx(F.Item,{children:e.jsx(P,{type:"primary",htmlType:"submit",icon:e.jsx(f,{}),loading:s,children:"Save Email Preferences"})})]})]})},re=e=>{switch(e){case"NEW_BOOKING":return K.NEW_BOOKING;case"BOOKING_CONFIRMED":return K.BOOKING_CONFIRMED;case"BOOKING_CANCELLED":return K.BOOKING_CANCELLED;case"PAYMENT_RECEIVED":return K.PAYMENT_RECEIVED;case"INVOICE_GENERATED":return K.INVOICE_GENERATED;case"EXHIBITION_UPDATE":return K.EXHIBITION_UPDATE;case"SYSTEM_MESSAGE":default:return K.SYSTEM_MESSAGE;case"EXHIBITOR_MESSAGE":return K.EXHIBITOR_MESSAGE;case"EXHIBITOR_REGISTERED":return K.EXHIBITOR_REGISTERED}},{Title:ce,Text:le,Paragraph:de}=g,{Search:ue}=B,{TabPane:he}=b,fe=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const s=x();p();const[a,n]=r.useState([]),[o,u]=r.useState([]),[h,f]=r.useState(!1),[E,y]=r.useState(""),[g,R]=r.useState("ALL"),[T,_]=r.useState("ALL"),[w,O]=r.useState({newLeads:!0,followUpReminders:!0,statusChanges:!1,leadAssignments:!0}),[L,M]=r.useState(!1),[B,H]=r.useState("all");r.useEffect((()=>{const e=localStorage.getItem("token");e&&j.init(e,!1),U(),j.subscribeToNotifications();const t=e=>{const t={...e,type:re(e.type)};n((i=>i.some((t=>t._id===e._id))?i:[t,...i]))},i=e=>{if(e.newNotifications&&e.newNotifications.length>0){const t=e.newNotifications.map((e=>({...e,type:re(e.type)})));n((e=>[...t.filter((t=>!e.some((e=>e._id===t._id)))),...e]))}};return j.addEventListener("notification",t),j.addEventListener("notification_update",i),()=>{j.removeEventListener("notification",t),j.removeEventListener("notification_update",i)}}),[]),r.useEffect((()=>{F()}),[a,E,g,T,B]),r.useEffect((()=>{U();const e=()=>{0===a.length&&U()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),[a.length]);const U=async()=>{f(!0);try{const e=await j.getNotifications(1,50);if(e.success){const t=e.data.notifications.map((e=>({...e,type:re(e.type)})));n(t)}}catch(e){G.error({message:"Failed to fetch notifications",description:"There was an error loading your notifications. Please try again later."})}finally{f(!1)}},F=()=>{let e=a;if("unread"===B&&(e=e.filter((e=>!1===e.isRead))),E){const t=E.toLowerCase();e=e.filter((e=>e.title.toLowerCase().includes(t)||e.message.toLowerCase().includes(t)))}"ALL"!==g&&(e=e.filter((e=>e.type===g))),"ALL"!==T&&(e=e.filter((e=>e.source===T))),u(e)},K=e=>{const t=(e=>{if(!e.entityId||!e.entityType)return"/notifications";switch(e.entityType){case"lead":return`/leads/${e.entityId}`;case"followup":return`/followups/${e.entityId}`;case"Booking":return"/bookings";case"Invoice":return`/invoice/${e.entityId}`;case"Exhibition":return`/exhibition/${e.entityId}`;case"Exhibitor":return`/exhibitors?id=${e.entityId}`;default:return"/notifications"}})(e);s(t)},V=async e=>{try{await j.markAsRead(e._id);const t=a.map((t=>t._id===e._id?{...t,isRead:!0,readAt:(new Date).toISOString()}:t));n(t)}catch(t){G.error({message:"Failed to mark notification as read",description:"There was an error updating the notification status. Please try again later."})}},W=async e=>{try{await j.deleteNotification(e._id);const t=a.filter((t=>t._id!==e._id));n(t),G.success({message:"Notification deleted",description:"The notification has been deleted successfully."})}catch(t){G.error({message:"Failed to delete notification",description:"There was an error deleting the notification. Please try again later."})}};return e.jsx("div",{className:"notifications-page",children:e.jsxs(k,{gutter:[24,24],children:[e.jsx(D,{xs:24,children:e.jsx(C,{children:e.jsxs(k,{justify:"space-between",align:"middle",children:[e.jsxs(D,{children:[e.jsx(ce,{level:4,children:e.jsxs(A,{children:[e.jsx(i,{}),"Notifications ",a.length>0?`(${a.length})`:""]})}),e.jsx(de,{children:"Stay updated with all your lead activities and follow-ups"})]}),e.jsx(D,{children:e.jsxs(A,{children:[e.jsx(I,{title:"Refresh notifications",children:e.jsx(P,{icon:e.jsx(c,{}),onClick:U,loading:h,children:"Refresh"})}),e.jsx(P,{type:"primary",icon:e.jsx(l,{}),onClick:async()=>{try{await j.markAllAsRead();const e=a.map((e=>({...e,isRead:!0,readAt:(new Date).toISOString()})));n(e),G.success({message:"All notifications marked as read",description:"All notifications have been marked as read successfully."})}catch(e){G.error({message:"Failed to mark all notifications as read",description:"There was an error updating the notification status. Please try again later."})}},disabled:0===a.filter((e=>!e.isRead)).length,children:"Mark All as Read"}),e.jsx(P,{type:"primary",danger:!0,icon:e.jsx(t,{}),onClick:async()=>{try{await j.deleteAllNotifications(),n([]),G.success({message:"All notifications cleared",description:"All notifications have been deleted successfully."})}catch(e){G.error({message:"Failed to clear notifications",description:"There was an error deleting the notifications. Please try again later."})}},disabled:0===a.length,children:"Clear All"})]})})]})})}),e.jsx(D,{xs:24,lg:16,children:e.jsxs(C,{className:"notifications-list-card",style:{marginBottom:24},children:[e.jsxs(b,{activeKey:B,onChange:e=>{H(e)},tabBarExtraContent:e.jsx(A,{children:e.jsx(S,{count:Y(a),offset:[-5,0],children:e.jsx("span",{style:{padding:"0 8px"},children:"Unread"})})}),children:[e.jsx(he,{tab:"All Notifications"},"all"),e.jsx(he,{tab:"Unread"},"unread")]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx(ue,{placeholder:"Search notifications...",onSearch:e=>{y(e)},style:{width:300},allowClear:!0}),e.jsx(A,{children:e.jsx(P,{icon:e.jsx(m,{}),onClick:()=>{y(""),R("ALL"),_("ALL"),H("all")},disabled:""===E&&"ALL"===g&&"ALL"===T,children:"Reset Filters"})})]}),e.jsx(N,{dataSource:o,renderItem:t=>e.jsx(J,{notification:t,onView:K,onMarkAsRead:V,onDelete:W}),pagination:{pageSize:10,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} notifications`},rowKey:"_id",loading:h,locale:{emptyText:e.jsx(v,{description:e.jsx("span",{children:"No notifications found"})})}})]})}),e.jsxs(D,{xs:24,lg:8,children:[e.jsx(oe,{settings:w,onSave:e=>{M(!0),setTimeout((()=>{O(e),M(!1),G.success({message:"Settings saved",description:"Your email notification settings have been updated successfully."})}),1e3)},loading:L}),e.jsx(C,{title:e.jsxs(A,{children:[e.jsx(d,{}),e.jsx("span",{children:"Notification Tips"})]}),children:e.jsx(de,{children:e.jsxs("ul",{children:[e.jsx("li",{children:"Notifications help you stay informed about important lead activities"}),e.jsx("li",{children:"Use email notifications for critical updates when you're away"}),e.jsx("li",{children:"Click on a notification to see more details or take action"}),e.jsx("li",{children:"Mark notifications as read to keep your inbox organized"})]})})})]})]})})}},Symbol.toStringTag,{value:"Module"}));export{ie as N,fe as i};
