const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-0Suq5uxL.js","assets/vendor-react-BNeW3y6d.js","assets/vendor-utils-CtctGR1F.js","assets/vendor-antd--VDS8NUg.js","assets/vendor-styling-CU6mz1ss.js","assets/vendor-canvas-BRbMLhVA.js","assets/index-ByOcC5Wo.css"])))=>i.map(i=>d[i]);
import{j as e,X as ie,Y as Se,Z as Ce,_ as ke,B as Ae,H as Te,$ as De,a0 as _e}from"./index-0Suq5uxL.js";import{j as xe,R as Re,u as pe,i as de,r as C}from"./vendor-react-BNeW3y6d.js";import{a6 as se,a7 as $,a5 as v,o as B,aI as z,aZ as $e,a as _,Q as E,h as ue,x as H,m as X,S as k,I as he,aW as Ne,a1 as ce,a$ as Be,c as A,j as ze,W as q,ah as P,T as me,b as N,aj as ge,D as je,z as fe,b6 as F,H as Ee,N as G,U as b,an as Pe,R as ye,d as Le,aO as Me,p as Fe,b1 as We,M as Q,b7 as Ue,aQ as qe,aT as He}from"./vendor-antd--VDS8NUg.js";/* empty css                  */import{u as Oe}from"./reduxHooks-D3iepLCM.js";import{u as ne,w as Ve,F as Ye}from"./vendor-export-CFMDcAMQ.js";import"./vendor-utils-CtctGR1F.js";import"./vendor-styling-CU6mz1ss.js";import"./vendor-canvas-BRbMLhVA.js";const Ke=({bookings:t,paginationTotal:x,stats:u,statsLoading:i=!1})=>{const c=u||{total:x!==void 0?x:t.length,pending:t.filter(r=>r.status==="pending").length,approved:t.filter(r=>r.status==="approved").length,rejected:t.filter(r=>r.status==="rejected").length,confirmed:t.filter(r=>r.status==="confirmed").length,cancelled:t.filter(r=>r.status==="cancelled").length,totalRevenue:t.filter(r=>r.status==="confirmed"||r.status==="approved").reduce((r,n)=>r+n.amount,0),totalBaseAmount:t.reduce((r,n)=>{var s;return r+(((s=n.calculations)==null?void 0:s.totalBaseAmount)||0)},0)};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(B,{})}):e.jsx(z,{title:e.jsxs(_,{title:"Total count across all pages",children:["Total Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.total,prefix:e.jsx($e,{})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(B,{})}):e.jsx(z,{title:e.jsxs(_,{title:"Count of all pending bookings",children:["Pending Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.pending,prefix:e.jsx(ue,{style:{color:"#faad14"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(B,{})}):e.jsx(z,{title:e.jsxs(_,{title:"Count of all approved bookings",children:["Approved Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.approved,prefix:e.jsx(H,{style:{color:"#52c41a"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(B,{})}):e.jsx(z,{title:e.jsxs(_,{title:"Count of all confirmed bookings",children:["Confirmed Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.confirmed,prefix:e.jsx(H,{style:{color:"#52c41a"}})})})})]}),e.jsxs(se,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(B,{})}):e.jsx(z,{title:e.jsxs(_,{title:"Count of all rejected bookings",children:["Rejected Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.rejected,prefix:e.jsx(X,{style:{color:"#f5222d"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(B,{})}):e.jsx(z,{title:e.jsxs(_,{title:"Count of all cancelled bookings",children:["Cancelled Bookings ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.cancelled,prefix:e.jsx(X,{style:{color:"#f5222d"}})})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(B,{})}):e.jsx(z,{title:e.jsxs(_,{title:"Total revenue from all bookings",children:["Total Revenue ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.totalRevenue,precision:0,prefix:"₹"})})}),e.jsx($,{xs:24,sm:12,md:6,children:e.jsx(v,{children:i?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(B,{})}):e.jsx(z,{title:e.jsxs(_,{title:"Total base amount before taxes and discounts",children:["Total Base Amount ",e.jsx(E,{style:{fontSize:"14px",marginLeft:4}})]}),value:c.totalBaseAmount,precision:0,prefix:"₹",valueStyle:{color:"#1890ff"}})})})]})]})},{RangePicker:Ge}=Be,Qe=({filters:t,exhibitions:x,onFilterChange:u,onRefresh:i})=>e.jsx(v,{style:{marginBottom:"24px"},children:e.jsxs(k,{wrap:!0,children:[e.jsx(he,{placeholder:"Search by company name",prefix:e.jsx(Ne,{}),value:t.search,onChange:p=>u({...t,search:p.target.value}),style:{width:200},allowClear:!0}),e.jsx(ce,{placeholder:"Filter by exhibition",value:t.exhibition,onChange:p=>u({...t,exhibition:p}),style:{minWidth:200},allowClear:!0,options:x.map(p=>({label:p.name,value:p._id}))}),e.jsx(ce,{mode:"multiple",placeholder:"Filter by status",value:t.status,onChange:p=>u({...t,status:p}),style:{minWidth:200},options:[{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"},{label:"Confirmed",value:"confirmed"},{label:"Cancelled",value:"cancelled"}]}),e.jsx(Ge,{onChange:p=>{var c,f;return u({...t,dateRange:p?[((c=p[0])==null?void 0:c.toISOString())||"",((f=p[1])==null?void 0:f.toISOString())||""]:null})}}),e.jsx(A,{icon:e.jsx(ze,{}),onClick:i,children:"Refresh"})]})}),{Title:gt,Text:j}=me,Xe=({selectedBooking:t,isDetailsModalVisible:x,setIsDetailsModalVisible:u,setSelectedBooking:i,setIsStatusModalVisible:p,setSelectedStatus:c,setRejectionReasonText:f,formatBookingNumber:r})=>e.jsx(q,{title:"Booking Details",open:x,onCancel:()=>{u(!1),i(null)},footer:[e.jsx(A,{type:"primary",disabled:!t,onClick:()=>{t&&(c(t.status),f(t.rejectionReason||""),p(!0))},children:"Update Status"},"updateStatus"),e.jsx(A,{onClick:()=>{u(!1),i(null)},children:"Close"},"close")],width:800,children:t&&e.jsxs(k,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs(P,{bordered:!0,column:2,children:[e.jsxs(P.Item,{label:"Booking Number",span:2,children:[r(t._id,t.createdAt),e.jsxs(j,{type:"secondary",style:{marginLeft:8,fontSize:"12px"},children:["(ID: ",t._id,")"]})]}),e.jsx(P.Item,{label:"Exhibition",span:2,children:t.exhibitionId.name}),e.jsxs(P.Item,{label:"Status",span:2,children:[e.jsx(N,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()}),t.rejectionReason&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(j,{type:"secondary",children:"Rejection Reason:"}),e.jsx("br",{}),e.jsx(j,{children:t.rejectionReason})]})]}),e.jsx(P.Item,{label:"Customer Name",children:t.customerName}),e.jsx(P.Item,{label:"Customer Email",children:t.customerEmail}),e.jsx(P.Item,{label:"Customer Phone",children:t.customerPhone}),e.jsx(P.Item,{label:"Company Name",children:t.companyName})]}),e.jsx(v,{title:"Stall Details",size:"small",children:e.jsx(ge,{dataSource:t.stallIds,pagination:!1,rowKey:"_id",columns:[{title:"Stall Number",dataIndex:"number",key:"number"},{title:"Stall Type",key:"type",render:n=>n.type||"-"},{title:"Dimensions",key:"dimensions",render:n=>e.jsx(N,{color:"blue",children:n.dimensions?`${n.dimensions.width}x${n.dimensions.height}m`:"No dimensions"})},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"rate",render:n=>`₹${n.toLocaleString()}`},{title:"Base Amount",key:"baseAmount",render:n=>{const s=t.calculations.stalls.find(a=>a.stallId===n._id);return s?`₹${s.baseAmount.toLocaleString()}`:"-"}},{title:"Discount",key:"discount",render:n=>{const s=t.calculations.stalls.find(a=>a.stallId===n._id);return s!=null&&s.discount?e.jsx(_,{title:e.jsx("div",{children:s.discount.type==="percentage"&&` (${s.discount.value}%)`}),children:e.jsxs(N,{color:"red",children:["-₹",s.discount.amount.toLocaleString(),s.discount.type==="percentage"&&` (${s.discount.value}%)`]})}):"-"}}]})}),e.jsx(v,{title:"Financial Summary",size:"small",children:e.jsxs(k,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(j,{children:"Total Base Amount:"}),e.jsxs(j,{children:["₹",t.calculations.totalBaseAmount.toLocaleString()]})]}),t.calculations.totalDiscountAmount>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(j,{children:"Total Discount:"}),e.jsxs(j,{type:"danger",children:["-₹",t.calculations.totalDiscountAmount.toLocaleString()]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(j,{children:"Amount after Discount:"}),e.jsxs(j,{children:["₹",t.calculations.totalAmountAfterDiscount.toLocaleString()]})]}),e.jsx(je,{style:{margin:"8px 0"}}),t.calculations.taxes.map(n=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(j,{children:[n.name," (",n.rate,"%):"]}),e.jsxs(j,{children:["₹",n.amount.toLocaleString()]})]},`tax-${n.name}-${n.rate}`)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[e.jsx(j,{strong:!0,children:"Total Amount (incl. Taxes):"}),e.jsxs(j,{strong:!0,children:["₹",t.amount.toLocaleString()]})]})]})})]})}),Ze=({selectedBooking:t,isStatusModalVisible:x,setIsStatusModalVisible:u,selectedStatus:i,setSelectedStatus:p,rejectionReasonText:c,setRejectionReasonText:f,formatBookingNumber:r,refreshAfterAction:n})=>{const s=xe(),[a,l]=Re.useState(!1),{refetch:m}=ie({page:1,limit:100}),d=async(y,T,o)=>{try{l(!0),await s(Se({id:y,status:T,...o&&{rejectionReason:o}})).unwrap(),b.success(`Booking ${T} successfully`),n(),u(!1),w(null),T==="approved"&&setTimeout(async()=>{await m()},1e3)}catch{b.error("Failed to update booking status")}finally{l(!1)}},w=y=>{};return e.jsx(q,{title:"Update Booking Status",open:x,onCancel:()=>{u(!1),f("")},footer:null,width:600,children:t&&e.jsxs("div",{children:[e.jsx(v,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(fe,{style:{fontSize:"18px"}}),e.jsx("span",{children:"Booking Information"})]}),style:{marginBottom:16},variant:"borderless",size:"small",children:e.jsxs(k,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(N,{color:"processing",children:r(t._id,t.createdAt)}),e.jsx(N,{color:"default",children:t.exhibitionId.name}),e.jsx(N,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()})]}),e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx(j,{strong:!0,children:"Stall Details:"}),e.jsx("div",{style:{marginTop:"4px"},children:t.stallIds.map((y,T)=>e.jsxs(N,{style:{margin:"2px"},children:["#",y.number," ",y.type&&`(${y.type})`]},y._id))})]}),e.jsx(je,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(j,{strong:!0,style:{minWidth:"120px"},children:"Company:"}),e.jsx(j,{children:t.companyName})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx(j,{strong:!0,style:{minWidth:"120px"},children:"Current Status:"}),e.jsx(N,{color:t.status==="confirmed"?"success":t.status==="approved"?"blue":t.status==="pending"?"warning":t.status==="rejected"?"error":"default",children:t.status.toUpperCase()})]})]})}),e.jsxs(v,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(Pe,{style:{fontSize:"18px"}}),e.jsx("span",{children:"Update Status"})]}),variant:"borderless",size:"small",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx(j,{strong:!0,children:"Select New Status:"}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsxs(F.Group,{value:i,onChange:y=>p(y.target.value),buttonStyle:"solid",style:{display:"flex",flexWrap:"nowrap",overflowX:"auto"},children:[e.jsx(F.Button,{value:"pending",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(ue,{style:{color:"#faad14"}}),"Pending"]})}),e.jsx(F.Button,{value:"approved",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(H,{style:{color:"#52c41a"}}),"Approved"]})}),e.jsx(F.Button,{value:"rejected",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(X,{style:{color:"#f5222d"}}),"Rejected"]})}),e.jsx(F.Button,{value:"confirmed",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(H,{style:{color:"#1890ff"}}),"Confirmed"]})}),e.jsx(F.Button,{value:"cancelled",style:{flex:"0 0 auto"},children:e.jsxs(k,{children:[e.jsx(X,{style:{color:"#ff7875"}}),"Cancelled"]})})]})})]}),i==="rejected"&&e.jsx("div",{children:e.jsx(Ee.Item,{label:e.jsx(j,{strong:!0,children:"Rejection Reason:"}),required:i==="rejected",rules:[{required:!0,message:"Please provide a reason for rejection"}],help:"This will be visible to the customer",children:e.jsx(he.TextArea,{rows:4,value:c,onChange:y=>f(y.target.value),placeholder:"Provide a reason for rejection",style:{marginTop:8}})})}),i==="approved"&&e.jsx(G,{message:"Approval Confirmation",description:"By approving this booking, the stalls will be reserved but not yet confirmed. Customer will be notified.",type:"success",showIcon:!0,style:{marginTop:8}}),i==="confirmed"&&e.jsx(G,{message:"Confirmation Notice",description:"By confirming this booking, the stalls will be marked as booked. This should be done after payment is received.",type:"info",showIcon:!0,style:{marginTop:8}}),i==="cancelled"&&e.jsx(G,{message:"Cancellation Warning",description:"By cancelling this booking, all stalls will be marked as available again.",type:"warning",showIcon:!0,style:{marginTop:8}}),i==="pending"&&e.jsx(G,{message:"Return to Pending",description:"This booking will be moved back to pending status.",type:"warning",showIcon:!0,style:{marginTop:8}})]}),e.jsxs("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end",gap:"8px"},children:[e.jsx(A,{onClick:()=>{u(!1),f("")},children:"Cancel"}),e.jsx(A,{type:"primary",onClick:()=>{if(i==="rejected"&&!c.trim()){b.error("Rejection reason is required when rejecting a booking");return}d(t._id,i,i==="rejected"?c:void 0)},loading:a,disabled:i==="rejected"&&!c.trim(),children:"Update Status"})]})]})]})})},Je=(t,x,u)=>{q.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(ye,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Booking"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete booking ",e.jsx("strong",{children:u(t._id,t.createdAt)}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data including invoices."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(A,{onClick:()=>q.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(A,{danger:!0,type:"primary",onClick:()=>{x(t._id),q.destroyAll()},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},et=t=>{const x=pe(),{data:u,isLoading:i,error:p,refetch:c}=ie({page:1,limit:100}),f=n=>{if(i||p||!u)return null;const a=(u.data||[]).find(l=>l.bookingId&&typeof l.bookingId=="object"&&l.bookingId._id===n);return a==null?void 0:a._id},r=async n=>{if(i){b.loading("Loading invoice data...");return}let s=f(n._id);if(s)x(`/invoice/${s}`);else{const a="invoice-loading";if(b.loading({content:"Checking for invoice...",key:a}),await c(),s=f(n._id),s){b.success({content:"Invoice found!",key:a,duration:1}),x(`/invoice/${s}`);return}const l=new Date(n.createdAt),m=new Date(Date.now()-30*60*1e3);if(l>m||n.status==="approved"){b.info({content:"Invoice is still being generated. Checking again in a moment...",key:a});let w=0;const y=5,T=[2e3,3e3,5e3,8e3,1e4],o=async()=>{w++,await c();const W=f(n._id);if(W)b.success({content:"Invoice is ready!",key:a,duration:1}),x(`/invoice/${W}`);else if(w<y){const O=T[w]||5e3,ae=O/1e3;b.info({content:`Attempt ${w}/${y}: Invoice not ready yet. Trying again in ${ae} seconds...`,key:a}),setTimeout(o,O)}else b.warning({content:"Invoice generation is taking longer than expected. Please try refreshing the page in a few moments.",key:a})};setTimeout(o,T[0])}else b.error({content:"No invoice found for this booking. Please contact support if this persists.",key:a})}};return[{title:"Booking Number",dataIndex:"_id",key:"bookingNumber",fixed:"left",width:170,render:(n,s)=>e.jsx(A,{type:"link",onClick:()=>{t.setSelectedBooking(s),t.setIsDetailsModalVisible(!0)},children:t.formatBookingNumber(n,s.createdAt)})},{title:"Exhibition",dataIndex:["exhibitionId","name"],key:"exhibition",width:250,render:(n,s)=>s.exhibitionId.name},{title:"Company Name",dataIndex:"companyName",key:"company",width:250,render:n=>n||"N/A"},{title:"Stall No.",key:"stallNumber",width:120,render:(n,s)=>e.jsx("span",{children:s.stallIds.map((a,l)=>e.jsxs("span",{children:[a.number,l<s.stallIds.length-1?", ":""]},`stall-${a._id||l}`))})},{title:"Stall Type",key:"stallType",width:120,render:(n,s)=>{const a=Array.from(new Set(s.stallIds.map(l=>l.type)));return e.jsx("span",{children:a.map((l,m)=>e.jsxs("span",{children:[l,m<a.length-1?", ":""]},`type-${l}-${m}`))})}},{title:"Dimensions",key:"dimensions",width:150,render:(n,s)=>e.jsx("span",{children:s.stallIds.map((a,l)=>e.jsxs("span",{children:[a.dimensions?`${a.dimensions.width}m × ${a.dimensions.height}m`:"No dimensions",l<s.stallIds.length-1?", ":""]},`dim-${a._id||l}`))})},{title:"Area (sqm)",key:"area",width:120,render:(n,s)=>{const a=s.stallIds.reduce((l,m)=>m.dimensions?l+m.dimensions.width*m.dimensions.height:l,0);return e.jsxs("span",{children:[Math.round(a)," sqm"]})}},{title:"Base Amount",dataIndex:["calculations","totalBaseAmount"],key:"baseAmount",width:150,render:n=>`₹${n.toLocaleString()}`},{title:"Discount",key:"discount",width:150,render:(n,s)=>{const a=s.calculations.totalDiscountAmount;if(!a||a===0)return"-";const l=s.calculations.stalls.filter(d=>d.discount).map(d=>d.discount);if(l.length===0)return"-";const m=l[0];return e.jsx(_,{title:e.jsx("div",{children:l.map((d,w)=>e.jsxs("div",{children:[d==null?void 0:d.name,": ",(d==null?void 0:d.type)==="percentage"?`${d==null?void 0:d.value}%`:`₹${d==null?void 0:d.value}`,e.jsx("br",{}),"Amount: ₹",d==null?void 0:d.amount.toLocaleString()]},`discount-${w}-${(d==null?void 0:d.name)||"unnamed"}`))}),children:e.jsxs(N,{color:"red",children:["-₹",a.toLocaleString(),(m==null?void 0:m.type)==="percentage"&&` (${m.value}%)`,l.length>1&&" +"]})})}},{title:"Total Amount",dataIndex:"amount",key:"amount",width:150,render:n=>`₹${n.toLocaleString()}`},{title:"Status",dataIndex:"status",key:"status",width:120,render:n=>e.jsx(N,{color:n==="confirmed"?"success":n==="approved"?"blue":n==="pending"?"warning":n==="rejected"?"error":"default",children:n.toUpperCase()})},{title:"Created At",dataIndex:"createdAt",key:"createdAt",width:200,render:n=>Le(n).format("MMM D, YYYY HH:mm")},{title:"Actions",key:"actions",fixed:"right",width:220,render:(n,s)=>e.jsxs(k,{children:[e.jsx(_,{title:"View Details",children:e.jsx(A,{icon:e.jsx(Me,{}),onClick:()=>{t.setSelectedBooking(s),t.setIsDetailsModalVisible(!0)}})}),e.jsx(Fe,{overlay:e.jsxs(Q,{children:[s.status!=="cancelled"&&t.hasPermission("view_bookings")&&e.jsx(Q.Item,{icon:e.jsx(fe,{}),disabled:i,onClick:()=>r(s),children:"View Invoice"},"invoice"),e.jsx(Q.Item,{icon:e.jsx(H,{}),onClick:()=>{t.setSelectedBooking(s),t.setSelectedStatus(s.status),t.setRejectionReasonText(s.rejectionReason||""),t.setIsStatusModalVisible(!0)},children:"Update Status"},"updateStatus"),t.hasPermission("bookings_delete")&&e.jsx(Q.Item,{icon:e.jsx(ye,{}),danger:!0,onClick:()=>{Je(s,t.handleDelete,t.formatBookingNumber)},children:"Delete"},"delete")]}),trigger:["click"],children:e.jsx(A,{icon:e.jsx(We,{})})})]})}]},tt=t=>{const{bookings:x,loading:u,pagination:i,fetchBookingsWithPagination:p}=t,c=et(t),f=(r,n,s,a)=>e.jsx("div",{className:"ant-table-pagination ant-table-pagination-right",style:{padding:"16px 24px",margin:0,display:"flex",justifyContent:"flex-end"},children:e.jsx(Ue,{current:r,pageSize:n,total:s,showTotal:l=>`Total ${l} items`,showSizeChanger:!0,pageSizeOptions:["5","10","20","50","100"],onChange:l=>a(l,n),onShowSizeChange:(l,m)=>a(l,m),size:"default"})});return e.jsxs(e.Fragment,{children:[e.jsx(ge,{columns:c,dataSource:x,loading:u,rowKey:"_id",scroll:{x:1800},pagination:!1}),f(i.page,i.limit,i.total,(r,n)=>p(r,n))]})},{Title:nt,Text:st}=me,jt=()=>{const t=xe(),{bookings:x,loading:u,pagination:i,stats:p,statsLoading:c}=de(h=>h.booking),{exhibitions:f}=de(h=>h.exhibition),[r,n]=C.useState(null),[s,a]=C.useState(!1),[l,m]=C.useState(!1),[d,w]=C.useState("pending"),[y,T]=C.useState(""),[o,W]=C.useState({search:"",status:[],dateRange:null,exhibition:null}),O=pe(),{data:ae,isLoading:it,error:at,refetch:lt}=ie({page:1,limit:100}),{hasPermission:be}=Oe(),M=C.useCallback((h=1,S=10)=>{const R={page:h,limit:S};o.search&&(R.search=o.search),o.exhibition&&(R.exhibitionId=o.exhibition),o.status&&o.status.length>0&&(R.status=o.status),o.dateRange&&o.dateRange.length===2&&(R.startDate=o.dateRange[0],R.endDate=o.dateRange[1]),t(Ce(R))},[t,o]),V=C.useCallback(()=>{t(ke())},[t]),Z=C.useCallback(()=>{M(i.page,i.limit),V()},[M,V,i.page,i.limit]);C.useEffect(()=>{M(i.page,i.limit),V()},[M,V,i.page,i.limit]),C.useEffect(()=>{t(Ae())},[t]),C.useEffect(()=>{x.length>0&&[...new Set(x.map(S=>S.exhibitionId._id))].forEach(S=>{t(Te(S))})},[x,t]);const ve=async h=>{try{await t(_e(h)).unwrap(),b.success("Booking deleted successfully"),Z()}catch(S){b.error((S==null?void 0:S.message)||"Failed to delete booking")}},Ie=h=>{W(h),M(1,i.limit)},J=Array.isArray(x)?x:[],Y=(h,S)=>{const R=new Date(S).getFullYear(),L=J.find(D=>D._id===h);if(!L)return`--/${R}/--`;const K=(J.filter(D=>D.exhibitionId._id===L.exhibitionId._id).sort((D,g)=>new Date(D.createdAt).getTime()-new Date(g.createdAt).getTime()).findIndex(D=>D._id===h)+1).toString().padStart(2,"0"),U=f.find(D=>D._id===L.exhibitionId._id);return`${(U==null?void 0:U.invoicePrefix)||L.exhibitionId.invoicePrefix||"BK"}/${R}/${K}`},we=async()=>{try{b.loading({content:"Preparing export...",key:"export"});const h={};o.search&&(h.search=o.search),o.exhibition&&(h.exhibitionId=o.exhibition),o.status&&o.status.length>0&&(h.status=o.status),o.dateRange&&o.dateRange.length===2&&(h.startDate=o.dateRange[0],h.endDate=o.dateRange[1]);const L=(await(await De(async()=>{const{default:g}=await import("./index-0Suq5uxL.js").then(ee=>ee.a6);return{default:g}},__vite__mapDeps([0,1,2,3,4,5,6]))).default.get("/bookings/export",{params:h})).data;if(!Array.isArray(L))throw new Error("Invalid data format received");const le=L.map(g=>{const ee=g.stallIds.reduce((I,te)=>te.dimensions?I+te.dimensions.width*te.dimensions.height:I,0);return{"Booking Number":Y(g._id,g.createdAt),Exhibition:g.exhibitionId.name,"Company Name":g.companyName||"N/A","Customer Name":g.customerName,"Customer Email":g.customerEmail,"Customer Phone":g.customerPhone,"Stall Numbers":g.stallIds.map(I=>I.number).join(", "),"Stall Types":Array.from(new Set(g.stallIds.map(I=>I.type||(I.stallTypeId&&typeof I.stallTypeId=="object"?I.stallTypeId.name:"-")))).join(", "),Dimensions:g.stallIds.map(I=>I.dimensions?`${I.dimensions.width}m × ${I.dimensions.height}m`:"No dimensions").join(", "),"Total Area (sqm)":Math.round(ee),"Base Amount":Math.round(g.calculations.totalBaseAmount),Discount:Math.round(g.calculations.totalDiscountAmount),"Total Amount":Math.round(g.calculations.totalAmount),Status:g.status.toUpperCase(),"Created Date":new Date(g.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}}),oe=ne.json_to_sheet(le),K=ne.book_new();ne.book_append_sheet(K,oe,"Bookings");const U=Ve(K,{bookType:"xlsx",type:"array"}),re=new Blob([U],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),D=new Date().toISOString().split("T")[0];Ye.saveAs(re,`bookings_export_${D}.xlsx`),b.success({content:"Export successful!",key:"export",duration:2})}catch(h){console.error("Export error:",h),b.error({content:"Failed to export bookings",key:"export",duration:2})}};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(se,{gutter:[24,24],align:"middle",children:[e.jsx($,{flex:"auto",children:e.jsxs(k,{direction:"vertical",size:4,children:[e.jsx(nt,{level:4,style:{margin:0},children:"Stall Bookings"}),e.jsx(st,{type:"secondary",children:"Manage exhibition stall bookings"})]})}),e.jsx($,{children:e.jsxs(k,{children:[e.jsx(A,{icon:e.jsx(qe,{}),onClick:we,size:"large",children:"Export"}),e.jsx(A,{type:"primary",size:"large",icon:e.jsx(He,{}),onClick:()=>O("/bookings/create"),children:"Create Booking"})]})})]})}),e.jsx(Ke,{bookings:x,paginationTotal:i.total,stats:p,statsLoading:c}),e.jsx(Qe,{filters:o,exhibitions:f,onFilterChange:Ie,onRefresh:Z}),e.jsx(v,{className:"info-card",styles:{body:{padding:0,overflow:"auto"},header:{paddingBottom:12}},title:"Booking List",children:e.jsx(tt,{bookings:J,loading:u,fetchBookingsWithPagination:M,pagination:i,setSelectedBooking:n,setIsDetailsModalVisible:a,setIsStatusModalVisible:m,setSelectedStatus:w,setRejectionReasonText:T,formatBookingNumber:Y,handleDelete:ve,hasPermission:be})}),e.jsx(Xe,{selectedBooking:r,isDetailsModalVisible:s,setIsDetailsModalVisible:a,setSelectedBooking:n,setIsStatusModalVisible:m,setSelectedStatus:w,setRejectionReasonText:T,formatBookingNumber:Y}),e.jsx(Ze,{selectedBooking:r,isStatusModalVisible:l,setIsStatusModalVisible:m,selectedStatus:d,setSelectedStatus:w,rejectionReasonText:y,setRejectionReasonText:T,formatBookingNumber:Y,refreshAfterAction:Z})]})};export{jt as default};
