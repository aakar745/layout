import{j as t}from"./vendor-pdf-Cn0rG44s.js";import{r as s,w as he,a as me,d as R,a4 as xe,G as K,S as x,T as ge,e as I,h as g,t as N,ai as pe,Z as D,al as je,a7 as ye,K as fe,f as ve,ac as Ie,ad as we,P as be}from"./vendor-antd-B8jUXf3i.js";import{q as Se,O as ke,_ as Ce,Z as Ee}from"./index-bCNJQtew.js";import{b as Re,u as Ne}from"./vendor-redux-rS0pI56E.js";import{u as De}from"./vendor-react-DW9h-haf.js";import{c as Me,a0 as Ae,V as Le,u as Fe}from"./vendor-antd-icons-BoTJB7uA.js";import"./vendor-http-t--hEgTQ.js";import"./vendor-ui-BmMA_ojr.js";import"./vendor-canvas-DrFPvyt4.js";const{Title:Oe,Text:u}=ge,{Option:w}=D,{RangePicker:Te}=je,Ge=()=>{var G;const b=De(),M=Re(),[A,Z]=s.useState(1),[L,q]=s.useState(10),[p,F]=s.useState(""),[j,O]=s.useState(null),[y,T]=s.useState(null),[o,_]=s.useState(null),[H,S]=s.useState(!1),[$,P]=s.useState(null),[k,Y]=s.useState(""),[z,V]=s.useState(""),[l,Q]=s.useState("createdAt"),[r,J]=s.useState("descend"),[d,X]=he.useMessage(),[h,B]=s.useState(null),[U,C]=s.useState(0),{exhibitions:ee,loading:te}=Ne(e=>e.exhibition);s.useEffect(()=>{M(Se())},[M]);const{data:i,isLoading:W,refetch:ne}=ke({page:A,limit:L}),[se,{isLoading:ae}]=Ce(),ie=me.useMemo(()=>i!=null&&i.data?i.data.filter(e=>{const n=p.toLowerCase(),a=p===""||e.invoiceNumber&&e.invoiceNumber.toLowerCase().includes(n)||e._id.toLowerCase().includes(n)||e.bookingId.customerName&&e.bookingId.customerName.toLowerCase().includes(n)||e.bookingId.companyName&&e.bookingId.companyName.toLowerCase().includes(n),c=!j||e.status===j,f=!y||e.bookingId.exhibitionId&&e.bookingId.exhibitionId._id===y;let m=!0;if(o&&o[0]&&o[1]){const v=R(e.createdAt);m=v.isAfter(o[0])&&v.isBefore(o[1])}return a&&c&&f&&m}):[],[i,p,j,y,o]),oe=async e=>{try{B(e),C(0),d.loading({content:"Preparing invoice...",key:e});const n=await Ee(`/invoices/${e}/download?force=false`,!1,f=>{const m=f.total,v=f.loaded;if(m){const E=Math.round(v*100/m);C(E),E%25===0&&d.loading({content:`Downloading: ${E}% complete`,key:e})}}),a=window.URL.createObjectURL(new Blob([n.data])),c=document.createElement("a");c.href=a,c.setAttribute("download",`invoice-${e}.pdf`),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(a),d.success({content:"Invoice downloaded successfully",key:e})}catch(n){console.error("Download error:",n),d.error({content:"Failed to download invoice",key:e})}finally{B(null),C(0)}},le=async()=>{if(!(!$||!k))try{d.loading({content:"Sending email...",key:"email"}),await se({id:$,email:k,message:z||void 0}).unwrap(),d.success({content:"Invoice sent via email successfully",key:"email"}),S(!1),Y(""),V(""),P(null)}catch(e){console.error("Email error:",e),d.error({content:"Failed to send invoice via email",key:"email"})}},re=e=>{P(e),S(!0)},de=()=>{F(""),O(null),T(null),_(null)},ce=[{title:"Invoice #",dataIndex:["invoiceNumber"],key:"invoiceNumber",sorter:!0,sortOrder:l==="invoiceNumber"?r:null,render:(e,n)=>t.jsx("a",{onClick:()=>b(`/invoice/${n._id}`),children:e||"N/A"})},{title:"Company",dataIndex:["bookingId","companyName"],key:"companyName",sorter:!0,sortOrder:l==="companyName"?r:null,render:e=>e||"N/A"},{title:"Exhibition",dataIndex:["bookingId","exhibitionId","name"],key:"exhibitionName",sorter:!0,sortOrder:l==="exhibitionName"?r:null,render:(e,n)=>t.jsx("a",{onClick:()=>b(`/exhibition/${n.bookingId.exhibitionId._id}`),children:e})},{title:"Amount",dataIndex:"amount",key:"amount",sorter:!0,sortOrder:l==="amount"?r:null,render:e=>`â‚¹${e.toLocaleString("en-IN")}`},{title:"Status",dataIndex:"status",key:"status",sorter:!0,sortOrder:l==="status"?r:null,render:e=>t.jsx(ve,{color:e==="paid"?"green":e==="pending"?"gold":e==="cancelled"?"red":"blue",children:e.toUpperCase()})},{title:"Due Date",dataIndex:"dueDate",key:"dueDate",sorter:!0,sortOrder:l==="dueDate"?r:null,render:e=>e?R(e).format("DD MMM YYYY"):"N/A"},{title:"Created",dataIndex:"createdAt",key:"createdAt",sorter:!0,sortOrder:l==="createdAt"?r:null,render:e=>R(e).format("DD MMM YYYY")},{title:"Actions",key:"actions",render:(e,n)=>t.jsxs(x,{direction:"vertical",size:"small",style:{width:"100%"},children:[t.jsxs(x,{children:[t.jsx(I,{title:"View Invoice",children:t.jsx(g,{type:"text",icon:t.jsx(Ie,{}),onClick:()=>b(`/invoice/${n._id}`)})}),t.jsx(I,{title:"Download",children:t.jsx(g,{type:"text",icon:t.jsx(we,{}),onClick:()=>oe(n._id),loading:h===n._id&&U<100,disabled:h!==null&&h!==n._id})}),t.jsx(I,{title:"Email",children:t.jsx(g,{type:"text",icon:t.jsx(Fe,{}),onClick:()=>re(n._id),disabled:h!==null})})]}),h===n._id&&t.jsx(be,{percent:U,size:"small",status:"active",style:{marginBottom:0,marginTop:4}})]})}],ue=(e,n,a)=>{a&&a.field&&(Q(a.field),J(a.order||"descend"))};return t.jsxs(xe,{children:[X,t.jsxs("div",{className:"invoice-list-container",children:[t.jsx(K,{children:t.jsxs(x,{direction:"vertical",style:{width:"100%"},size:"large",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(Oe,{level:2,style:{margin:0},children:"Invoices"}),t.jsx(x,{children:t.jsx(I,{title:"Refresh",children:t.jsx(g,{icon:t.jsx(Me,{}),onClick:()=>ne(),loading:W})})})]}),t.jsx(K,{size:"small",title:t.jsxs(x,{children:[t.jsx(Le,{})," Filters"]}),children:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:[t.jsxs("div",{style:{minWidth:"200px",flex:1},children:[t.jsx(u,{strong:!0,children:"Search"}),t.jsx(N,{placeholder:"Search by invoice #, company...",value:p,onChange:e=>F(e.target.value),prefix:t.jsx(pe,{}),allowClear:!0})]}),t.jsxs("div",{style:{minWidth:"150px"},children:[t.jsx(u,{strong:!0,children:"Status"}),t.jsxs(D,{style:{width:"100%"},placeholder:"Filter by status",value:j,onChange:O,allowClear:!0,children:[t.jsx(w,{value:"pending",children:"Pending"}),t.jsx(w,{value:"paid",children:"Paid"}),t.jsx(w,{value:"cancelled",children:"Cancelled"})]})]}),t.jsxs("div",{style:{minWidth:"200px"},children:[t.jsx(u,{strong:!0,children:"Exhibition"}),t.jsx(D,{style:{width:"100%"},placeholder:"Filter by exhibition",value:y,onChange:T,loading:te,allowClear:!0,children:ee.map(e=>t.jsx(w,{value:e._id||e.id,children:e.name},e._id||e.id))})]}),t.jsxs("div",{style:{minWidth:"300px"},children:[t.jsx(u,{strong:!0,children:"Date Range"}),t.jsx(Te,{style:{width:"100%"},value:o,onChange:_})]}),t.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:t.jsx(g,{icon:t.jsx(Ae,{}),onClick:de,children:"Clear Filters"})})]})}),t.jsx(ye,{columns:ce,dataSource:ie,rowKey:"_id",loading:W,pagination:{current:A,pageSize:L,total:((G=i==null?void 0:i.pagination)==null?void 0:G.total)||0,onChange:(e,n)=>{Z(e),n&&q(n)},showSizeChanger:!0,showTotal:e=>`Total ${e} invoices`},onChange:ue})]})}),t.jsxs(fe,{title:"Send Invoice via Email",open:H,onCancel:()=>S(!1),onOk:le,okText:"Send",confirmLoading:ae,children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(u,{strong:!0,children:"Email Address"}),t.jsx(N,{placeholder:"Enter recipient email",value:k,onChange:e=>Y(e.target.value),style:{width:"100%"}})]}),t.jsxs("div",{children:[t.jsx(u,{strong:!0,children:"Message (Optional)"}),t.jsx(N.TextArea,{placeholder:"Enter optional message",value:z,onChange:e=>V(e.target.value),rows:4})]})]})]})]})};export{Ge as default};
