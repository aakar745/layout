import{C as k,D as V,j as e,E as ae,F as ne,G as Se}from"./index-BfjvBafq.js";import{u as Ce,j as we,i as ke,r as d}from"./vendor-react-BNeW3y6d.js";import{ah as De,a5 as _,a6 as h,S as x,T as Ee,c,b5 as Re,a7 as m,aL as D,C as oe,x as B,h as U,be as re,K as Ae,bb as Pe,a4 as M,bf as Te,bg as Ie,am as K,R as F,Z as L,d as G,a as $,V as ze,j as _e,aR as Z,b6 as de,p as Be,bh as Me,b as f,a0 as Fe,bd as Le}from"./vendor-antd-sZZBSykP.js";/* empty css                  */import{u as $e}from"./reduxHooks-D3iepLCM.js";import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:Ye,Text:j}=Ee,{RangePicker:Ne}=Te,qe=()=>{const{message:g,modal:q}=De.useApp(),Y=Ce(),u=we(),{exhibitions:o,loading:ce}=ke(t=>t.exhibition),[p,J]=d.useState([]),[Q,E]=d.useState(!1),[b,R]=d.useState(!1),[N,X]=d.useState({current:1,pageSize:10,total:0}),[r,A]=d.useState({status:[],dateRange:null,search:"",activeStatus:null}),[P,xe]=d.useState("all"),[H,pe]=d.useState({}),[ee,te]=d.useState(!1),{hasPermission:W}=$e();d.useEffect(()=>{u(k())},[u]),d.useEffect(()=>{o.length>0&&se()},[o]);const se=async()=>{if(o.length!==0)try{te(!0);const t=o.map(async a=>{try{const l=a._id||a.id,n=await V.getExhibitionProgress(l);return{id:l,data:n}}catch(l){return console.warn(`Failed to load progress for exhibition ${a.name}:`,l),{id:a._id||a.id,data:null}}}),i=(await Promise.all(t)).reduce((a,{id:l,data:n})=>(a[l]=n,a),{});pe(i)}catch(t){console.error("Failed to load progress data:",t)}finally{te(!1)}},he=()=>{se()};d.useEffect(()=>{X(t=>({...t,total:le.length}))},[o,r,P]);const v=d.useMemo(()=>{const t=o.length,s=o.filter(n=>n.status==="published").length,i=o.filter(n=>new Date(n.startDate)>new Date).length,a=o.filter(n=>n.status==="completed").length,l=o.filter(n=>n.isActive).length;return{total:t,active:s,upcoming:i,completed:a,activeCount:l}},[o]),ge=async t=>{const s=t._id||t.id;try{E(!0),await u(ae(s)).unwrap(),g.success("Exhibition deleted successfully")}catch(i){g.error(i.message||"Failed to delete exhibition")}finally{E(!1)}},ie=async()=>{q.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(F,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Selected Exhibitions"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete ",e.jsxs("strong",{children:[p.length," selected exhibitions"]}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data for these exhibitions."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(c,{onClick:()=>L.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(c,{danger:!0,type:"primary",onClick:async()=>{try{E(!0),await Promise.all(p.map(t=>u(ae(t._id||t.id)).unwrap())),g.success(`Successfully deleted ${p.length} exhibitions`),J([])}catch(t){g.error(t.message||"Failed to delete some exhibitions")}finally{E(!1),L.destroyAll()}},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete All"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},O=async(t,s)=>{try{R(!0);const i=t._id||t.id;await V.updateExhibition(i,{status:s});const a=o.map(l=>(l._id||l.id)===i?{...l,status:s}:l);u(k.fulfilled(a,"",void 0)),g.success("Status updated successfully")}catch{g.error("Failed to update status"),u(k())}finally{R(!1)}},ue=async(t,s)=>{try{R(!0);const i=t._id||t.id;await V.updateExhibition(i,{isActive:s});const a=o.map(l=>(l._id||l.id)===i?{...l,isActive:s}:l);u(k.fulfilled(a,"",void 0)),g.success(`Exhibition ${s?"activated":"deactivated"} successfully`)}catch{g.error("Failed to update active status"),u(k())}finally{R(!1)}},y=(t,s)=>{const i=t._id||t.id;s==="/layout"?Y(ne(t,"layout"),{state:{exhibitionId:i}}):Y(ne(t)+s,{state:{exhibitionId:i}})},me=t=>{switch(t.toLowerCase()){case"published":return"#52c41a";case"draft":return"#faad14";case"completed":return"#1890ff";default:return"#d9d9d9"}},fe=(t,s)=>{const i=me(t);return e.jsxs(x,{size:4,style:{display:"inline-flex",alignItems:"center"},children:[e.jsx(f,{color:i,style:{textTransform:"capitalize",minWidth:"80px",textAlign:"center",margin:0},children:t}),!s&&e.jsx(f,{color:"red",style:{margin:0},children:"Inactive"})]})},je=t=>{var I,C,w,z;const s=t._id||t.id,i=H[s];if(((I=i==null?void 0:i.progress)==null?void 0:I.combinedProgress)!==void 0)return i.progress.combinedProgress;if(((C=i==null?void 0:i.progress)==null?void 0:C.stallBookingProgress)!==void 0)return i.progress.stallBookingProgress;if(((w=t.progress)==null?void 0:w.combinedProgress)!==void 0)return t.progress.combinedProgress;if(((z=t.progress)==null?void 0:z.stallBookingProgress)!==void 0)return t.progress.stallBookingProgress;const a=new Date,l=new Date(t.startDate),n=new Date(t.endDate);if(a<l)return 0;if(a>n)return 100;const T=n.getTime()-l.getTime(),S=a.getTime()-l.getTime();return Math.round(S/T*100)},ye=t=>{q.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(F,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Exhibition"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete ",e.jsx("strong",{children:t.name}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(c,{onClick:()=>L.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(c,{danger:!0,type:"primary",onClick:()=>{ge(t),L.destroyAll()},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},be=t=>[{key:"view",label:"View Details",icon:e.jsx(Z,{}),onClick:()=>y(t,"")},{key:"edit",label:"Edit Exhibition",icon:e.jsx(de,{}),onClick:()=>y(t,"/edit")},{key:"layout",label:"Manage Layout",icon:e.jsx(Fe,{}),onClick:()=>y(t,"/layout")},{type:"divider"},...t.status==="published"?[{key:"public-view",label:"Public View",icon:e.jsx(Z,{}),onClick:()=>window.open(Se(t),"_blank")},{type:"divider"}]:[],{key:"status",label:"Change Status",icon:e.jsx(Le,{}),children:[{key:"draft",label:e.jsxs(x,{children:[e.jsx(f,{color:"#faad14",style:{margin:0},children:"Draft"}),e.jsx("span",{children:"Set as Draft"})]}),icon:e.jsx(oe,{}),onClick:()=>O(t,"draft"),disabled:t.status==="draft"||b},{key:"published",label:e.jsxs(x,{children:[e.jsx(f,{color:"#52c41a",style:{margin:0},children:"Published"}),e.jsx("span",{children:"Publish"})]}),icon:e.jsx(B,{}),onClick:()=>O(t,"published"),disabled:t.status==="published"||b},{key:"completed",label:e.jsxs(x,{children:[e.jsx(f,{color:"#1890ff",style:{margin:0},children:"Completed"}),e.jsx("span",{children:"Mark as Completed"})]}),icon:e.jsx(U,{}),onClick:()=>O(t,"completed"),disabled:t.status==="completed"||b}]},{key:"active-status",label:e.jsxs(x,{children:[t.isActive?e.jsx(f,{color:"red",style:{margin:0},children:"Deactivate"}):e.jsx(f,{color:"#52c41a",style:{margin:0},children:"Activate"}),e.jsx("span",{children:t.isActive?"Deactivate":"Activate"})]}),icon:e.jsx(re,{}),onClick:()=>ue(t,!t.isActive),disabled:b},{type:"divider"},{key:"delete",label:"Delete",icon:e.jsx(F,{}),danger:!0,onClick:()=>ye(t)}],le=d.useMemo(()=>o.filter(t=>{if(r.search&&!t.name.toLowerCase().includes(r.search.toLowerCase())||r.status.length>0&&!r.status.includes(t.status)||r.activeStatus!==null&&t.isActive!==r.activeStatus)return!1;if(r.dateRange){const[s,i]=r.dateRange,a=new Date(t.startDate),l=new Date(t.endDate);if(a<new Date(s)||l>new Date(i))return!1}switch(P){case"active":return t.status==="published";case"upcoming":return new Date(t.startDate)>new Date;case"completed":return t.status==="completed";default:return!0}}),[o,r,P]),ve=[{title:"Exhibition Details",key:"details",render:(t,s)=>e.jsx(j,{strong:!0,style:{fontSize:"16px",cursor:"pointer"},onClick:()=>y(s,""),children:s.name})},{title:"Status",key:"status",width:180,align:"center",render:(t,s)=>fe(s.status,s.isActive),filters:[{text:"Draft",value:"draft"},{text:"Published",value:"published"},{text:"Completed",value:"completed"}],onFilter:(t,s)=>s.status===t},{title:"Start Date",key:"startDate",width:130,render:(t,s)=>e.jsx(j,{children:G(s.startDate).format("MMM D, YYYY")})},{title:"End Date",key:"endDate",width:130,render:(t,s)=>e.jsx(j,{children:G(s.endDate).format("MMM D, YYYY")})},{title:"Create Date",key:"createdAt",width:130,render:(t,s)=>e.jsx(j,{children:G(s.createdAt).format("MMM D, YYYY")})},{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{children:"Progress"}),e.jsx($,{title:"Refresh all progress data",children:e.jsx(c,{type:"text",size:"small",icon:e.jsx(_e,{}),loading:ee,onClick:he,style:{padding:"2px"}})})]}),key:"progress",width:250,render:(t,s)=>{var C,w;const i=je(s),a=s._id||s.id,l=(C=H[a])==null?void 0:C.stats,n=(w=H[a])==null?void 0:w.progress;let T="active",S="#1890ff";s.status==="completed"?(T="success",S="#52c41a"):i===100&&(S="#faad14");const I=l?e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("strong",{children:"Real-time Stall Booking:"})}),e.jsxs("div",{children:["• Total Stalls: ",l.totalStalls]}),e.jsxs("div",{children:["• Booked Stalls: ",l.bookedStalls]}),e.jsxs("div",{children:["• Available Stalls: ",l.availableStalls]}),e.jsxs("div",{children:["• Booking Rate: ",l.bookingRate,"%"]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:"8px"},children:e.jsx("strong",{children:"Progress Breakdown:"})}),e.jsxs("div",{children:["• Stall Booking: ",n.stallBookingProgress,"%"]}),e.jsxs("div",{children:["• Timeline: ",n.timeProgress,"%"]}),e.jsxs("div",{children:["• Combined: ",n.combinedProgress,"%"]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{children:["Progress: ",i,"%"]}),e.jsx("div",{children:"Based on timeline calculation"}),e.jsx("div",{style:{color:"#faad14",marginTop:"4px"},children:"⚠️ Real-time data not available"})]});return e.jsxs("div",{children:[e.jsx($,{title:I,placement:"topLeft",children:e.jsx(ze,{percent:i,size:"small",status:T,strokeColor:S,format:z=>`${z}%`})}),l?e.jsxs("div",{style:{fontSize:"12px",color:"#52c41a",marginTop:"4px"},children:[e.jsx(B,{style:{marginRight:"4px"}}),l.bookedStalls,"/",l.totalStalls," stalls booked"]}):e.jsxs("div",{style:{fontSize:"12px",color:"#faad14",marginTop:"4px"},children:[e.jsx(U,{style:{marginRight:"4px"}}),"Timeline-based progress"]})]})}},{title:"Actions",key:"actions",width:150,fixed:"right",render:(t,s)=>e.jsxs(x,{size:"middle",children:[W("exhibitions_view")&&e.jsx($,{title:"View Details",children:e.jsx(c,{type:"text",icon:e.jsx(Z,{}),onClick:()=>y(s,"")})}),W("exhibitions_edit")&&e.jsx($,{title:"Edit Exhibition",children:e.jsx(c,{type:"text",icon:e.jsx(de,{}),onClick:()=>y(s,"/edit")})}),W("exhibitions_delete")&&e.jsx(Be,{menu:{items:be(s)},trigger:["click"],placement:"bottomRight",children:e.jsx(c,{type:"text",icon:e.jsx(Me,{})})})]})}];return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(_,{gutter:[24,24],align:"middle",children:[e.jsx(h,{flex:"auto",children:e.jsxs(x,{direction:"vertical",size:4,children:[e.jsx(Ye,{level:4,style:{margin:0},children:"Exhibitions"}),e.jsx(j,{type:"secondary",children:"Manage your exhibition spaces and layouts"})]})}),e.jsx(h,{children:e.jsx(c,{type:"primary",icon:e.jsx(Re,{}),onClick:()=>Y("/exhibition/create"),size:"large",children:"Create Exhibition"})})]})}),e.jsxs(_,{gutter:[24,24],style:{marginBottom:"24px"},children:[e.jsx(h,{xs:24,sm:12,md:6,lg:4,children:e.jsx(m,{children:e.jsx(D,{title:"Total Exhibitions",value:v.total,prefix:e.jsx(oe,{})})})}),e.jsx(h,{xs:24,sm:12,md:6,lg:5,children:e.jsx(m,{children:e.jsx(D,{title:"Published Exhibitions",value:v.active,prefix:e.jsx(B,{style:{color:"#52c41a"}})})})}),e.jsx(h,{xs:24,sm:12,md:6,lg:5,children:e.jsx(m,{children:e.jsx(D,{title:"Upcoming Exhibitions",value:v.upcoming,prefix:e.jsx(U,{style:{color:"#1890ff"}})})})}),e.jsx(h,{xs:24,sm:12,md:6,lg:5,children:e.jsx(m,{children:e.jsx(D,{title:"Completed Exhibitions",value:v.completed,prefix:e.jsx(B,{style:{color:"#8c8c8c"}})})})}),e.jsx(h,{xs:24,sm:12,md:6,lg:5,children:e.jsx(m,{children:e.jsx(D,{title:"Active Status",value:v.activeCount,prefix:e.jsx(re,{style:{color:"#52c41a"}})})})})]}),e.jsx(m,{className:"info-card",style:{marginBottom:"16px"},styles:{body:{padding:"20px"}},children:e.jsxs(x,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(_,{gutter:[16,16],align:"middle",children:[e.jsx(h,{flex:"auto",children:e.jsxs(x,{size:"middle",wrap:!0,children:[e.jsx(Ae,{placeholder:"Search exhibitions",prefix:e.jsx(Pe,{style:{color:"#8c8c8c"}}),style:{width:"250px"},value:r.search,onChange:t=>A(s=>({...s,search:t.target.value})),allowClear:!0}),e.jsx(M,{mode:"multiple",placeholder:"Filter by status",style:{minWidth:"200px"},value:r.status,onChange:t=>A(s=>({...s,status:t})),options:[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Completed",value:"completed"}]}),e.jsxs(M,{placeholder:"Active Status",style:{width:"150px"},value:r.activeStatus,onChange:t=>A(s=>({...s,activeStatus:t})),allowClear:!0,children:[e.jsx(M.Option,{value:!0,children:"Active"}),e.jsx(M.Option,{value:!1,children:"Inactive"})]}),e.jsx(Ne,{onChange:t=>A(s=>{var i,a;return{...s,dateRange:t?[((i=t[0])==null?void 0:i.toISOString())||"",((a=t[1])==null?void 0:a.toISOString())||""]:null}})})]})}),e.jsx(h,{children:e.jsx(Ie,{options:[{label:"All",value:"all"},{label:"Active",value:"active"},{label:"Upcoming",value:"upcoming"},{label:"Completed",value:"completed"}],value:P,onChange:t=>xe(t)})})]}),p.length>0&&e.jsx(_,{children:e.jsxs(x,{children:[e.jsxs(j,{children:["Selected ",p.length," items"]}),e.jsx(c,{danger:!0,onClick:ie,children:"Delete Selected"})]})})]})}),e.jsx(m,{className:"info-card",styles:{body:{padding:0}},children:e.jsx(K,{columns:ve,dataSource:le.map(t=>({...t,key:t._id||t.id})),rowKey:t=>t._id||t.id,loading:ce||Q||b||ee,rowSelection:{selectedRowKeys:p.map(t=>t._id||t.id),onChange:(t,s)=>J(s),selections:[K.SELECTION_ALL,K.SELECTION_NONE]},footer:()=>p.length>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[e.jsxs(j,{children:["Selected ",e.jsx("strong",{children:p.length})," ",p.length===1?"exhibition":"exhibitions"]}),e.jsx(c,{danger:!0,onClick:ie,icon:e.jsx(F,{}),loading:Q,children:"Delete Selected"})]}),scroll:{x:1500},pagination:{current:N.current,pageSize:N.pageSize,total:N.total,showSizeChanger:!0,showTotal:t=>`Total ${t} items`,style:{marginTop:"16px"},onChange:(t,s)=>{X(i=>({...i,current:t,pageSize:s}))}}})})]})};export{qe as default};
