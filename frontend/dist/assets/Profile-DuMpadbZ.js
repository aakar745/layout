import{r as n,u as S,a as T,j as e}from"./vendor-react-core-B0uGejYc.js";import{f as U}from"./app-auth-Phoe3BrL.js";import{k as j}from"./app-core-L3PgNZOI.js";import{A as q,F as r,R as d,C as i,T as B,a as N,k as I,f as k,I as l,m as L,B as M,s as $}from"./vendor-antd-core-PMpIrrMR.js";import{i as g,q as D,o as c,R as z}from"./vendor-antd-icons-DK8C9GTH.js";import"./vendor-deps-DEOa4Mno.js";import"./vendor-ui-utils-CGs7t4cg.js";import"./vendor-canvas-CkLjwLEv.js";import"./vendor-redux-GR4hUpLs.js";import"./vendor-http-t--hEgTQ.js";import"./vendor-date-utils-3BRsAYU6.js";import"./app-admin-CoTkNL6t.js";import"./app-dashboard-OSBEAOF5.js";const{Title:P,Text:y}=B,{TabPane:b}=I,oe=()=>{var w;const{notification:C}=q.useApp(),[K]=r.useForm(),[m]=r.useForm(),[V,_]=n.useState(!1),[v,u]=n.useState(!1),[A,p]=n.useState(!1),[h,f]=n.useState(null),x=S(),s=T(a=>a.auth.user);n.useEffect(()=>{(async()=>{try{p(!0);const o=await j.getProfile();o.data&&x(U({user:o.data,token:localStorage.getItem("token")||""}))}catch{$.error("Failed to fetch profile")}finally{p(!1)}})()},[x]);const E=async a=>{var o,t;try{f(null),u(!0),await j.changePassword({currentPassword:a.currentPassword,newPassword:a.newPassword}),C.success({message:"Success",description:"Password has been changed successfully"}),m.resetFields()}catch(R){f(((t=(o=R.response)==null?void 0:o.data)==null?void 0:t.message)||"Failed to change password. Please try again.")}finally{u(!1)}},F=()=>s!=null&&s.role?typeof s.role=="string"?s.role:typeof s.role=="object"&&"name"in s.role?s.role.name:"User":"User";return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx(d,{gutter:[24,24],align:"middle",children:e.jsxs(i,{flex:"auto",children:[e.jsx(P,{level:4,children:"My Account"}),e.jsx(y,{type:"secondary",children:"Manage your account settings and change your password"})]})})}),e.jsx(N,{loading:A,children:e.jsxs(I,{defaultActiveKey:"account",children:[e.jsx(b,{tab:"Account Information",children:e.jsxs(d,{gutter:32,children:[e.jsx(i,{span:6,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:[e.jsx(k,{size:100,icon:e.jsx(g,{}),style:{backgroundColor:"#1890ff",marginBottom:16},children:((w=s==null?void 0:s.username)==null?void 0:w.charAt(0).toUpperCase())||"U"}),e.jsx(P,{level:4,children:s==null?void 0:s.username}),e.jsx(y,{type:"secondary",children:F()})]})}),e.jsx(i,{span:18,children:e.jsx(r,{layout:"vertical",initialValues:{username:s==null?void 0:s.username,email:s==null?void 0:s.email},disabled:!0,children:e.jsxs(d,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(r.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter your username"}],children:e.jsx(l,{prefix:e.jsx(g,{}),placeholder:"Username"})})}),e.jsx(i,{span:12,children:e.jsx(r.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter your email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(l,{prefix:e.jsx(D,{}),placeholder:"Email Address"})})})]})})})]})},"account"),e.jsxs(b,{tab:"Change Password",children:[h&&e.jsx(L,{message:"Error",description:h,type:"error",showIcon:!0,style:{marginBottom:24}}),e.jsxs(r,{form:m,layout:"vertical",onFinish:E,children:[e.jsx(r.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(l.Password,{prefix:e.jsx(c,{}),placeholder:"Current Password"})}),e.jsx(r.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter your new password"},{min:8,message:"Password must be at least 8 characters"}],children:e.jsx(l.Password,{prefix:e.jsx(c,{}),placeholder:"New Password"})}),e.jsx(r.Item,{name:"confirmPassword",label:"Confirm New Password",dependencies:["newPassword"],rules:[{required:!0,message:"Please confirm your new password"},({getFieldValue:a})=>({validator(o,t){return!t||a("newPassword")===t?Promise.resolve():Promise.reject(new Error("The two passwords do not match"))}})],children:e.jsx(l.Password,{prefix:e.jsx(c,{}),placeholder:"Confirm New Password"})}),e.jsx(r.Item,{children:e.jsx(M,{type:"primary",htmlType:"submit",loading:v,icon:e.jsx(z,{}),children:"Update Password"})})]})]},"password")]})})]})};export{oe as default};
