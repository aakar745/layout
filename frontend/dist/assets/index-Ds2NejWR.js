import{j as e}from"./index-BfjvBafq.js";import{r as o,u as le}from"./vendor-react-BNeW3y6d.js";import{N as c,X as h,T as de,S as N,c as p,bd as he,b0 as O,l as pe,a5 as A,a6 as j,a7 as b,aL as k,C as M,a_ as xe,x as ue,h as je,am as me,aw as ge,a4 as f,K as V,bf as fe,Z as B,n as q,d as v,b as g,p as Se,aR as ye,b6 as be}from"./vendor-antd-sZZBSykP.js";/* empty css                       */import"./vendor-utils-BlPUcn-b.js";import"./vendor-styling-ULYxIwmc.js";import"./vendor-canvas-BRbMLhVA.js";const{RangePicker:ve}=fe,{Option:i}=f,{Title:we,Text:m}=de,{TabPane:_}=q,Pe=()=>{const[G,H]=o.useState([]),[S,J]=o.useState(null),[K,E]=o.useState(!1),[x,w]=o.useState({current:1,pageSize:10,total:0}),[l,P]=o.useState({}),[Q,X]=o.useState([]),[r,D]=o.useState(null),[Z,R]=o.useState(!1),[W,C]=o.useState(!1),[ee,I]=o.useState(!1),te=le(),[$]=c.useForm();o.useEffect(()=>{se()},[]),o.useEffect(()=>{T(),L()},[x.current,x.pageSize,l]);const se=async()=>{try{const t=await fetch("/api/exhibitions",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const s=await t.json();X(s.data||[])}}catch(t){console.error("Error fetching exhibitions:",t)}},T=async()=>{E(!0);try{const t={page:x.current.toString(),limit:x.pageSize.toString()};Object.entries(l).forEach(([n,a])=>{a!==void 0&&n!=="dateRange"&&(t[n]=String(a))}),l.dateRange&&(t.startDate=l.dateRange[0].toISOString(),t.endDate=l.dateRange[1].toISOString());const s=new URLSearchParams(t),d=await fetch(`/api/service-charges?${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(d.ok){const n=await d.json();H(n.data||[]),w(a=>{var u;return{...a,total:((u=n.pagination)==null?void 0:u.total)||0}})}else h.error("Failed to fetch service charges")}catch(t){console.error("Error fetching service charges:",t),h.error("Error fetching service charges")}finally{E(!1)}},L=async()=>{var t;try{const s={period:"all"};Object.entries(l).forEach(([a,u])=>{u!==void 0&&a!=="dateRange"&&(s[a]=String(u))});const d=new URLSearchParams(s),n=await fetch(`/api/service-charges/stats?${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(n.ok){const a=await n.json();J(((t=a.data)==null?void 0:t.overview)||null)}}catch(s){console.error("Error fetching stats:",s)}},re=async t=>{if(r)try{(await fetch(`/api/service-charges/${r._id}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)})).ok?(h.success("Status updated successfully"),C(!1),T(),L()):h.error("Failed to update status")}catch(s){console.error("Error updating status:",s),h.error("Error updating status")}},ae=async()=>{try{const t={};Object.entries(l).forEach(([n,a])=>{a!==void 0&&n!=="dateRange"&&(t[n]=String(a))}),l.dateRange&&(t.startDate=l.dateRange[0].toISOString(),t.endDate=l.dateRange[1].toISOString());const s=new URLSearchParams(t),d=await fetch(`/api/service-charges/export?${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(d.ok){const n=await d.json(),a=[Object.keys(n.data[0]||{}).join(","),...n.data.map(oe=>Object.values(oe).join(","))].join(`
`),u=new Blob([a],{type:"text/csv"}),F=window.URL.createObjectURL(u),y=document.createElement("a");y.style.display="none",y.href=F,y.download=`service-charges-${v().format("YYYY-MM-DD")}.csv`,document.body.appendChild(y),y.click(),window.URL.revokeObjectURL(F),h.success("Export completed successfully")}else h.error("Failed to export data")}catch(t){console.error("Error exporting data:",t),h.error("Error exporting data")}},U=async t=>{try{const s=await fetch(`/api/service-charges/${t}/receipt`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const d=await s.blob(),n=window.URL.createObjectURL(d),a=document.createElement("a");a.style.display="none",a.href=n,a.download=`receipt-${t}.pdf`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n)}else h.error("Failed to download receipt")}catch(s){console.error("Error downloading receipt:",s),h.error("Error downloading receipt")}},Y=t=>{switch(t){case"paid":case"completed":return"green";case"pending":case"submitted":return"orange";case"cancelled":case"failed":return"red";default:return"default"}},z=t=>{switch(t){case"paid":return"green";case"pending":return"orange";case"failed":return"red";case"refunded":return"purple";default:return"default"}},ne=[{key:"view",label:"View Details",icon:e.jsx(ye,{})},{key:"status",label:"Update Status",icon:e.jsx(be,{})},{key:"receipt",label:"Download Receipt",icon:e.jsx(M,{})}],ie=(t,s)=>{switch(t){case"view":D(s),R(!0);break;case"status":D(s),C(!0),$.setFieldsValue({status:s.status,adminNotes:s.adminNotes});break;case"receipt":U(s._id);break}},ce=[{title:"Receipt #",dataIndex:"receiptNumber",key:"receiptNumber",width:120,render:t=>e.jsx(m,{strong:!0,copyable:!0,children:t})},{title:"Vendor",key:"vendor",width:200,render:t=>e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(m,{strong:!0,children:t.vendorName})}),e.jsx("div",{children:e.jsx(m,{type:"secondary",children:t.companyName})}),e.jsx("div",{children:e.jsx(m,{type:"secondary",style:{fontSize:"12px"},children:t.vendorEmail})})]})},{title:"Exhibition",dataIndex:["exhibitionId","name"],key:"exhibition",width:150,render:(t,s)=>e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(m,{strong:!0,children:t})}),e.jsx("div",{children:e.jsx(m,{type:"secondary",style:{fontSize:"12px"},children:s.exhibitionId.venue})})]})},{title:"Service Type",dataIndex:"serviceType",key:"serviceType",width:120,render:t=>e.jsx(g,{children:t.charAt(0).toUpperCase()+t.slice(1)})},{title:"Amount",dataIndex:"amount",key:"amount",width:100,render:t=>e.jsxs(m,{strong:!0,children:["₹",t.toLocaleString("en-IN")]})},{title:"Payment Status",dataIndex:"paymentStatus",key:"paymentStatus",width:120,render:t=>e.jsx(g,{color:z(t),children:t.toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(g,{color:Y(t),children:t.toUpperCase()})},{title:"Date",dataIndex:"createdAt",key:"createdAt",width:120,render:(t,s)=>e.jsxs("div",{children:[e.jsx("div",{children:v(t).format("DD/MM/YYYY")}),s.paidAt&&e.jsxs("div",{style:{fontSize:"12px",color:"#52c41a"},children:["Paid: ",v(s.paidAt).format("DD/MM/YYYY")]})]})},{title:"Actions",key:"actions",width:100,render:t=>e.jsx(Se,{menu:{items:ne,onClick:({key:s})=>ie(s,t)},trigger:["click"],children:e.jsx(p,{size:"small",children:"Actions"})})}];return e.jsxs("div",{className:"service-charges-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(we,{level:2,children:"Service Charges"}),e.jsxs(N,{children:[e.jsx(p,{icon:e.jsx(he,{}),onClick:()=>I(!0),children:"Filters"}),e.jsx(p,{icon:e.jsx(O,{}),onClick:ae,type:"primary",children:"Export"}),e.jsx(p,{icon:e.jsx(pe,{}),onClick:()=>te("/service-charges/settings"),children:"Settings"})]})]}),S&&e.jsxs(A,{gutter:16,className:"stats-row",children:[e.jsx(j,{span:6,children:e.jsx(b,{children:e.jsx(k,{title:"Total Charges",value:S.totalCharges,prefix:e.jsx(M,{})})})}),e.jsx(j,{span:6,children:e.jsx(b,{children:e.jsx(k,{title:"Total Amount",value:S.totalAmount,prefix:e.jsx(xe,{}),formatter:t=>`₹${t==null?void 0:t.toLocaleString("en-IN")}`})})}),e.jsx(j,{span:6,children:e.jsx(b,{children:e.jsx(k,{title:"Paid Amount",value:S.paidAmount,prefix:e.jsx(ue,{}),formatter:t=>`₹${t==null?void 0:t.toLocaleString("en-IN")}`,valueStyle:{color:"#3f8600"}})})}),e.jsx(j,{span:6,children:e.jsx(b,{children:e.jsx(k,{title:"Pending Amount",value:S.pendingAmount,prefix:e.jsx(je,{}),formatter:t=>`₹${t==null?void 0:t.toLocaleString("en-IN")}`,valueStyle:{color:"#cf1322"}})})})]}),e.jsx(b,{children:e.jsx(me,{columns:ce,dataSource:G,rowKey:"_id",loading:K,pagination:{current:x.current,pageSize:x.pageSize,total:x.total,showSizeChanger:!0,showQuickJumper:!0,onChange:(t,s)=>{w(d=>({...d,current:t,pageSize:s||10}))}},scroll:{x:1200}})}),e.jsx(ge,{title:"Filters",placement:"right",open:ee,onClose:()=>I(!1),width:400,children:e.jsxs(c,{layout:"vertical",onFinish:t=>{P(t),I(!1),w(s=>({...s,current:1}))},initialValues:l,children:[e.jsx(c.Item,{name:"exhibitionId",label:"Exhibition",children:e.jsx(f,{placeholder:"Select exhibition",allowClear:!0,children:Q.map(t=>e.jsx(i,{value:t._id,children:t.name},t._id))})}),e.jsx(c.Item,{name:"paymentStatus",label:"Payment Status",children:e.jsxs(f,{placeholder:"Select payment status",allowClear:!0,children:[e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"paid",children:"Paid"}),e.jsx(i,{value:"failed",children:"Failed"}),e.jsx(i,{value:"refunded",children:"Refunded"})]})}),e.jsx(c.Item,{name:"status",label:"Status",children:e.jsxs(f,{placeholder:"Select status",allowClear:!0,children:[e.jsx(i,{value:"submitted",children:"Submitted"}),e.jsx(i,{value:"paid",children:"Paid"}),e.jsx(i,{value:"completed",children:"Completed"}),e.jsx(i,{value:"cancelled",children:"Cancelled"})]})}),e.jsx(c.Item,{name:"serviceType",label:"Service Type",children:e.jsxs(f,{placeholder:"Select service type",allowClear:!0,children:[e.jsx(i,{value:"positioning",children:"Positioning"}),e.jsx(i,{value:"setup",children:"Setup"}),e.jsx(i,{value:"maintenance",children:"Maintenance"}),e.jsx(i,{value:"other",children:"Other"})]})}),e.jsx(c.Item,{name:"vendorName",label:"Vendor Name",children:e.jsx(V,{placeholder:"Search by vendor name"})}),e.jsx(c.Item,{name:"dateRange",label:"Date Range",children:e.jsx(ve,{style:{width:"100%"}})}),e.jsx(c.Item,{children:e.jsxs(N,{children:[e.jsx(p,{type:"primary",htmlType:"submit",children:"Apply Filters"}),e.jsx(p,{onClick:()=>{P({}),I(!1),w(t=>({...t,current:1}))},children:"Clear"})]})})]})}),e.jsx(B,{title:"Update Status",open:W,onCancel:()=>C(!1),footer:null,children:e.jsxs(c,{form:$,layout:"vertical",onFinish:re,children:[e.jsx(c.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select a status"}],children:e.jsxs(f,{children:[e.jsx(i,{value:"submitted",children:"Submitted"}),e.jsx(i,{value:"paid",children:"Paid"}),e.jsx(i,{value:"completed",children:"Completed"}),e.jsx(i,{value:"cancelled",children:"Cancelled"})]})}),e.jsx(c.Item,{name:"adminNotes",label:"Admin Notes",children:e.jsx(V.TextArea,{rows:4,placeholder:"Add notes..."})}),e.jsx(c.Item,{children:e.jsxs(N,{children:[e.jsx(p,{type:"primary",htmlType:"submit",children:"Update Status"}),e.jsx(p,{onClick:()=>C(!1),children:"Cancel"})]})})]})}),e.jsx(B,{title:"Service Charge Details",open:Z,onCancel:()=>R(!1),footer:[e.jsx(p,{onClick:()=>R(!1),children:"Close"},"close"),(r==null?void 0:r.receiptGenerated)&&e.jsx(p,{type:"primary",icon:e.jsx(O,{}),onClick:()=>r&&U(r._id),children:"Download Receipt"},"download")],width:800,children:r&&e.jsx("div",{className:"service-charge-details",children:e.jsxs(q,{children:[e.jsx(_,{tab:"Basic Info",children:e.jsxs(A,{gutter:16,children:[e.jsxs(j,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Receipt Number:"})," ",r.receiptNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vendor Name:"})," ",r.vendorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," ",r.companyName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",r.vendorEmail]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",r.vendorPhone]}),r.stallNumber&&e.jsxs("p",{children:[e.jsx("strong",{children:"Stall Number:"})," ",r.stallNumber]})]}),e.jsxs(j,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Exhibition:"})," ",r.exhibitionId.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Venue:"})," ",r.exhibitionId.venue]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Service Type:"})," ",r.serviceType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ₹",r.amount.toLocaleString("en-IN")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",v(r.createdAt).format("DD/MM/YYYY HH:mm")]}),r.paidAt&&e.jsxs("p",{children:[e.jsx("strong",{children:"Paid At:"})," ",v(r.paidAt).format("DD/MM/YYYY HH:mm")]})]})]})},"basic"),e.jsxs(_,{tab:"Status",children:[e.jsx(A,{gutter:16,children:e.jsxs(j,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Status:"}),e.jsx(g,{color:z(r.paymentStatus),style:{marginLeft:8},children:r.paymentStatus.toUpperCase()})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"}),e.jsx(g,{color:Y(r.status),style:{marginLeft:8},children:r.status.toUpperCase()})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Receipt Generated:"}),e.jsx(g,{color:r.receiptGenerated?"green":"orange",style:{marginLeft:8},children:r.receiptGenerated?"Yes":"No"})]})]})}),r.adminNotes&&e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Admin Notes:"})}),e.jsx("p",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"4px"},children:r.adminNotes})]})]},"status")]})})})]})};export{Pe as default};
