import{c as de,t as w,j as e,v as O,w as W,x as re,y as U}from"./index-aoH9EzMk.js";import{aO as ce,u as xe,F as pe,p as he,r as g,a9 as E,aa as p,S as d,T as ue,i as r,by as ge,ab as y,ac as S,U as V,P as F,n as K,bS as q,Y as ye,bs as fe,aF as A,br as me,bT as be,aS as P,j as R,ag as I,e as L,a3 as je,f as G,bu as $,bC as J,y as ve,bv as we,h as f,ay as Se,bq as Ce}from"./vendor-Be5M1UDi.js";import"./apis-CU9I9MMq.js";import"./canvas-C-A9eff5.js";const{Title:De,Text:m}=ue,{RangePicker:ke}=me,Te=()=>{const{message:h,modal:Y}=ce.useApp(),T=xe(),u=pe(),{exhibitions:o,loading:Q}=he(t=>t.exhibition),[c,B]=g.useState([]),[N,C]=g.useState(!1),[j,D]=g.useState(!1),[n,k]=g.useState({status:[],dateRange:null,search:"",activeStatus:null}),[_,X]=g.useState("all"),{hasPermission:z}=de();g.useEffect(()=>{u(w())},[u]);const v=g.useMemo(()=>{const t=o.length,s=o.filter(x=>x.status==="published").length,i=o.filter(x=>new Date(x.startDate)>new Date).length,a=o.filter(x=>x.status==="completed").length,l=o.filter(x=>x.isActive).length;return{total:t,active:s,upcoming:i,completed:a,activeCount:l}},[o]),Z=async t=>{const s=t._id||t.id;try{C(!0),await u(O(s)).unwrap(),h.success("Exhibition deleted successfully")}catch(i){h.error(i.message||"Failed to delete exhibition")}finally{C(!1)}},H=async()=>{Y.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(R,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Selected Exhibitions"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete ",e.jsxs("strong",{children:[c.length," selected exhibitions"]}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data for these exhibitions."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(r,{onClick:()=>I.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(r,{danger:!0,type:"primary",onClick:async()=>{try{C(!0),await Promise.all(c.map(t=>u(O(t._id||t.id)).unwrap())),h.success(`Successfully deleted ${c.length} exhibitions`),B([])}catch(t){h.error(t.message||"Failed to delete some exhibitions")}finally{C(!1),I.destroyAll()}},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete All"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},M=async(t,s)=>{try{D(!0);const i=t._id||t.id;await U.updateExhibition(i,{status:s});const a=o.map(l=>(l._id||l.id)===i?{...l,status:s}:l);u(w.fulfilled(a,"",void 0)),h.success("Status updated successfully")}catch{h.error("Failed to update status"),u(w())}finally{D(!1)}},ee=async(t,s)=>{try{D(!0);const i=t._id||t.id;await U.updateExhibition(i,{isActive:s});const a=o.map(l=>(l._id||l.id)===i?{...l,isActive:s}:l);u(w.fulfilled(a,"",void 0)),h.success(`Exhibition ${s?"activated":"deactivated"} successfully`)}catch{h.error("Failed to update active status"),u(w())}finally{D(!1)}},b=(t,s)=>{const i=t._id||t.id;s==="/layout"?T(W(t,"layout"),{state:{exhibitionId:i}}):T(W(t)+s,{state:{exhibitionId:i}})},te=t=>{switch(t.toLowerCase()){case"published":return"#52c41a";case"draft":return"#faad14";case"completed":return"#1890ff";default:return"#d9d9d9"}},se=(t,s)=>{const i=te(t);return e.jsxs(d,{size:4,style:{display:"inline-flex",alignItems:"center"},children:[e.jsx(f,{color:i,style:{textTransform:"capitalize",minWidth:"80px",textAlign:"center",margin:0},children:t}),!s&&e.jsx(f,{color:"red",style:{margin:0},children:"Inactive"})]})},ie=t=>{const s=new Date,i=new Date(t.startDate),a=new Date(t.endDate);if(s<i)return 0;if(s>a)return 100;const l=a.getTime()-i.getTime(),x=s.getTime()-i.getTime();return Math.round(x/l*100)},le=t=>{Y.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(R,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Exhibition"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete ",e.jsx("strong",{children:t.name}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(r,{onClick:()=>I.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(r,{danger:!0,type:"primary",onClick:()=>{Z(t),I.destroyAll()},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},ae=t=>[{key:"view",label:"View Details",icon:e.jsx($,{}),onClick:()=>b(t,"")},{key:"edit",label:"Edit Exhibition",icon:e.jsx(J,{}),onClick:()=>b(t,"/edit")},{key:"layout",label:"Manage Layout",icon:e.jsx(Se,{}),onClick:()=>b(t,"/layout")},{type:"divider"},...t.status==="published"?[{key:"public-view",label:"Public View",icon:e.jsx($,{}),onClick:()=>window.open(re(t),"_blank")},{type:"divider"}]:[],{key:"status",label:"Change Status",icon:e.jsx(Ce,{}),children:[{key:"draft",label:e.jsxs(d,{children:[e.jsx(f,{color:"#faad14",style:{margin:0},children:"Draft"}),e.jsx("span",{children:"Set as Draft"})]}),icon:e.jsx(V,{}),onClick:()=>M(t,"draft"),disabled:t.status==="draft"||j},{key:"published",label:e.jsxs(d,{children:[e.jsx(f,{color:"#52c41a",style:{margin:0},children:"Published"}),e.jsx("span",{children:"Publish"})]}),icon:e.jsx(F,{}),onClick:()=>M(t,"published"),disabled:t.status==="published"||j},{key:"completed",label:e.jsxs(d,{children:[e.jsx(f,{color:"#1890ff",style:{margin:0},children:"Completed"}),e.jsx("span",{children:"Mark as Completed"})]}),icon:e.jsx(K,{}),onClick:()=>M(t,"completed"),disabled:t.status==="completed"||j}]},{key:"active-status",label:e.jsxs(d,{children:[t.isActive?e.jsx(f,{color:"red",style:{margin:0},children:"Deactivate"}):e.jsx(f,{color:"#52c41a",style:{margin:0},children:"Activate"}),e.jsx("span",{children:t.isActive?"Deactivate":"Activate"})]}),icon:e.jsx(q,{}),onClick:()=>ee(t,!t.isActive),disabled:j},{type:"divider"},{key:"delete",label:"Delete",icon:e.jsx(R,{}),danger:!0,onClick:()=>le(t)}],ne=g.useMemo(()=>o.filter(t=>{if(n.search&&!t.name.toLowerCase().includes(n.search.toLowerCase())||n.status.length>0&&!n.status.includes(t.status)||n.activeStatus!==null&&t.isActive!==n.activeStatus)return!1;if(n.dateRange){const[s,i]=n.dateRange,a=new Date(t.startDate),l=new Date(t.endDate);if(a<new Date(s)||l>new Date(i))return!1}switch(_){case"active":return t.status==="published";case"upcoming":return new Date(t.startDate)>new Date;case"completed":return t.status==="completed";default:return!0}}),[o,n,_]),oe=[{title:"Exhibition Details",key:"details",render:(t,s)=>e.jsx(m,{strong:!0,style:{fontSize:"16px",cursor:"pointer"},onClick:()=>b(s,""),children:s.name})},{title:"Status",key:"status",width:180,align:"center",render:(t,s)=>se(s.status,s.isActive),filters:[{text:"Draft",value:"draft"},{text:"Published",value:"published"},{text:"Completed",value:"completed"}],onFilter:(t,s)=>s.status===t},{title:"Start Date",key:"startDate",width:130,render:(t,s)=>e.jsx(m,{children:L(s.startDate).format("MMM D, YYYY")})},{title:"End Date",key:"endDate",width:130,render:(t,s)=>e.jsx(m,{children:L(s.endDate).format("MMM D, YYYY")})},{title:"Create Date",key:"createdAt",width:130,render:(t,s)=>e.jsx(m,{children:L(s.createdAt).format("MMM D, YYYY")})},{title:"Progress",key:"progress",width:200,render:(t,s)=>e.jsx(je,{percent:ie(s),size:"small",status:s.status==="completed"?"success":"active"})},{title:"Actions",key:"actions",width:150,fixed:"right",render:(t,s)=>e.jsxs(d,{size:"middle",children:[z("exhibitions_view")&&e.jsx(G,{title:"View Details",children:e.jsx(r,{type:"text",icon:e.jsx($,{}),onClick:()=>b(s,"")})}),z("exhibitions_edit")&&e.jsx(G,{title:"Edit Exhibition",children:e.jsx(r,{type:"text",icon:e.jsx(J,{}),onClick:()=>b(s,"/edit")})}),z("exhibitions_delete")&&e.jsx(ve,{menu:{items:ae(s)},trigger:["click"],placement:"bottomRight",children:e.jsx(r,{type:"text",icon:e.jsx(we,{})})})]})}];return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(E,{gutter:[24,24],align:"middle",children:[e.jsx(p,{flex:"auto",children:e.jsxs(d,{direction:"vertical",size:4,children:[e.jsx(De,{level:4,style:{margin:0},children:"Exhibitions"}),e.jsx(m,{type:"secondary",children:"Manage your exhibition spaces and layouts"})]})}),e.jsx(p,{children:e.jsx(r,{type:"primary",icon:e.jsx(ge,{}),onClick:()=>T("/exhibition/create"),size:"large",children:"Create Exhibition"})})]})}),e.jsxs(E,{gutter:[24,24],style:{marginBottom:"24px"},children:[e.jsx(p,{xs:24,sm:12,md:6,lg:4,children:e.jsx(y,{children:e.jsx(S,{title:"Total Exhibitions",value:v.total,prefix:e.jsx(V,{})})})}),e.jsx(p,{xs:24,sm:12,md:6,lg:5,children:e.jsx(y,{children:e.jsx(S,{title:"Published Exhibitions",value:v.active,prefix:e.jsx(F,{style:{color:"#52c41a"}})})})}),e.jsx(p,{xs:24,sm:12,md:6,lg:5,children:e.jsx(y,{children:e.jsx(S,{title:"Upcoming Exhibitions",value:v.upcoming,prefix:e.jsx(K,{style:{color:"#1890ff"}})})})}),e.jsx(p,{xs:24,sm:12,md:6,lg:5,children:e.jsx(y,{children:e.jsx(S,{title:"Completed Exhibitions",value:v.completed,prefix:e.jsx(F,{style:{color:"#8c8c8c"}})})})}),e.jsx(p,{xs:24,sm:12,md:6,lg:5,children:e.jsx(y,{children:e.jsx(S,{title:"Active Status",value:v.activeCount,prefix:e.jsx(q,{style:{color:"#52c41a"}})})})})]}),e.jsx(y,{className:"info-card",style:{marginBottom:"16px"},styles:{body:{padding:"20px"}},children:e.jsxs(d,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(E,{gutter:[16,16],align:"middle",children:[e.jsx(p,{flex:"auto",children:e.jsxs(d,{size:"middle",wrap:!0,children:[e.jsx(ye,{placeholder:"Search exhibitions",prefix:e.jsx(fe,{style:{color:"#8c8c8c"}}),style:{width:"250px"},value:n.search,onChange:t=>k(s=>({...s,search:t.target.value})),allowClear:!0}),e.jsx(A,{mode:"multiple",placeholder:"Filter by status",style:{minWidth:"200px"},value:n.status,onChange:t=>k(s=>({...s,status:t})),options:[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Completed",value:"completed"}]}),e.jsxs(A,{placeholder:"Active Status",style:{width:"150px"},value:n.activeStatus,onChange:t=>k(s=>({...s,activeStatus:t})),allowClear:!0,children:[e.jsx(A.Option,{value:!0,children:"Active"}),e.jsx(A.Option,{value:!1,children:"Inactive"})]}),e.jsx(ke,{onChange:t=>k(s=>{var i,a;return{...s,dateRange:t?[((i=t[0])==null?void 0:i.toISOString())||"",((a=t[1])==null?void 0:a.toISOString())||""]:null}})})]})}),e.jsx(p,{children:e.jsx(be,{options:[{label:"All",value:"all"},{label:"Active",value:"active"},{label:"Upcoming",value:"upcoming"},{label:"Completed",value:"completed"}],value:_,onChange:t=>X(t)})})]}),c.length>0&&e.jsx(E,{children:e.jsxs(d,{children:[e.jsxs(m,{children:["Selected ",c.length," items"]}),e.jsx(r,{danger:!0,onClick:H,children:"Delete Selected"})]})})]})}),e.jsx(y,{className:"info-card",styles:{body:{padding:0}},children:e.jsx(P,{columns:oe,dataSource:ne.map(t=>({...t,key:t._id||t.id})),rowKey:t=>t._id||t.id,loading:Q||N||j,rowSelection:{selectedRowKeys:c.map(t=>t._id||t.id),onChange:(t,s)=>B(s),selections:[P.SELECTION_ALL,P.SELECTION_NONE]},footer:()=>c.length>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[e.jsxs(m,{children:["Selected ",e.jsx("strong",{children:c.length})," ",c.length===1?"exhibition":"exhibitions"]}),e.jsx(r,{danger:!0,onClick:H,icon:e.jsx(R,{}),loading:N,children:"Delete Selected"})]}),scroll:{x:1500},pagination:{pageSize:10,showSizeChanger:!0,showTotal:t=>`Total ${t} items`,style:{marginTop:"16px"}}})})]})};export{Te as default};
