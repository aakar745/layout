import{a9 as $,j as e,aa as D,a as k}from"./index-BRKtYmDF.js";import{l as R,u as T,r as m}from"./vendor-react-BNeW3y6d.js";import{I as W}from"./InvoiceTemplate-CBdF4OCq.js";import{N as i,a7 as L,S as f,c as l,a$ as M,b0 as B,z as G,b1 as V,V as U,Z as j,K as x,X as n}from"./vendor-antd-Dz3j4xaK.js";import"./vendor-utils-CsjRLf7T.js";import"./vendor-styling-BEMjND7I.js";import"./vendor-canvas-BRbMLhVA.js";const H=()=>{const{id:s}=R(),w=T(),{data:o,isLoading:S}=$(s||""),[A,h]=m.useState(!1),[N,p]=m.useState(!1),[d]=i.useForm(),[b,u]=m.useState(0),[t,g]=m.useState(!1),C=async()=>{if(s)try{g(!0),u(0),n.loading({content:"Preparing invoice...",key:"download"});const a=await D(`/invoices/${s}/download?force=false`,!1,y=>{const v=y.total,P=y.loaded;if(v){const I=Math.round(P*100/v);u(I),I%25===0&&n.loading({content:`Downloading: ${I}% complete`,key:"download"})}}),r=window.URL.createObjectURL(new Blob([a.data])),c=document.createElement("a");c.href=r,c.setAttribute("download",`invoice-${s}.pdf`),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(r),n.success({content:"Invoice downloaded successfully",key:"download"})}catch(a){console.error("Download error:",a),n.error({content:"Failed to download invoice",key:"download"})}finally{g(!1),u(0)}},E=async a=>{try{await k.post(`/invoices/${s}/share/email`,a),n.success("Invoice shared via email successfully"),h(!1),d.resetFields()}catch(r){console.error("Email sharing error:",r),n.error("Failed to share invoice via email")}},F=async a=>{try{await k.post(`/invoices/${s}/share/whatsapp`,a),n.success("Invoice shared via WhatsApp successfully"),p(!1),d.resetFields()}catch(r){console.error("WhatsApp sharing error:",r),n.error("Failed to share invoice via WhatsApp")}};return S||!o?e.jsx("div",{children:"Loading..."}):(console.log("Invoice data:",o),e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(L,{title:"Invoice Details",extra:e.jsxs(f,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(f,{children:[e.jsx(l,{icon:e.jsx(M,{}),onClick:()=>w(-1),disabled:t,children:"Back"}),e.jsx(l,{type:"primary",icon:e.jsx(B,{}),onClick:C,loading:t&&b<100,disabled:t&&b>=100,children:"Download"}),e.jsx(l,{icon:e.jsx(G,{}),onClick:()=>h(!0),disabled:t,children:"Share via Email"}),e.jsx(l,{icon:e.jsx(V,{}),onClick:()=>p(!0),disabled:t,children:"Share via WhatsApp"})]}),t&&e.jsx(U,{percent:b,size:"small",status:"active",style:{marginBottom:0,marginTop:4}})]}),children:e.jsx(W,{booking:{...o.bookingId,customerGSTIN:o.bookingId.customerGSTIN||"",invoiceNumber:o.invoiceNumber,exhibitionId:{...o.bookingId.exhibitionId,companyName:o.bookingId.exhibitionId.companyName||"Company Name",bankName:o.bookingId.exhibitionId.bankName||"",bankAccount:o.bookingId.exhibitionId.bankAccount||"",bankAccountName:o.bookingId.exhibitionId.bankAccountName||"",bankBranch:o.bookingId.exhibitionId.bankBranch||"",bankIFSC:o.bookingId.exhibitionId.bankIFSC||"",companyCIN:o.bookingId.exhibitionId.companyCIN||"",companyPAN:o.bookingId.exhibitionId.companyPAN||"",companySAC:o.bookingId.exhibitionId.companySAC||"",companyGST:o.bookingId.exhibitionId.companyGST||"",companyEmail:o.bookingId.exhibitionId.companyEmail||"",companyWebsite:o.bookingId.exhibitionId.companyWebsite||"",companyAddress:o.bookingId.exhibitionId.companyAddress||"",headerLogo:o.bookingId.exhibitionId.headerLogo||void 0},calculations:{...o.bookingId.calculations,stalls:o.bookingId.calculations.stalls.map(a=>({discount:a.discount?{...a.discount,type:a.discount.type||"percentage",value:a.discount.value}:void 0}))}}})}),e.jsx(j,{title:"Share Invoice via Email",open:A,onCancel:()=>h(!1),footer:null,children:e.jsxs(i,{form:d,onFinish:E,layout:"vertical",children:[e.jsx(i.Item,{name:"email",label:"Email Address",rules:[{required:!0,message:"Please enter email address"},{type:"email",message:"Please enter a valid email address"}],children:e.jsx(x,{placeholder:"Enter email address"})}),e.jsx(i.Item,{name:"message",label:"Message (Optional)",children:e.jsx(x.TextArea,{placeholder:"Enter optional message"})}),e.jsx(i.Item,{children:e.jsx(l,{type:"primary",htmlType:"submit",children:"Send"})})]})}),e.jsx(j,{title:"Share Invoice via WhatsApp",open:N,onCancel:()=>p(!1),footer:null,children:e.jsxs(i,{form:d,onFinish:F,layout:"vertical",children:[e.jsx(i.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^\+?[1-9]\d{9,14}$/,message:"Please enter a valid phone number"}],children:e.jsx(x,{placeholder:"Enter phone number with country code"})}),e.jsx(i.Item,{children:e.jsx(l,{type:"primary",htmlType:"submit",children:"Send"})})]})})]}))};export{H as default};
