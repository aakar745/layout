import{j as e,d as s,r as a,a5 as r,T as t,ap as l,M as i,F as n,Z as o,_ as d,q as c,C as m}from"./vendor-others-aeGeD6f-.js";import{u,a as x}from"./vendor-react-i7tvbPTl.js";import{F as h,M as j,N as p,O as v,P as g,Q as f}from"./store-D4NI4RZ9.js";import{M as y}from"./vendor-antd-modal-1GBGM2fb.js";import{u as b,T as w,o as C,D as A,n as k,i as S,I,f as U,h as P,R as F,C as L,c as E,z as _,e as T,k as z,j as R,B as q}from"./vendor-antd-core-CLD06I8y.js";import{F as $}from"./vendor-antd-form-DJHhvp8w.js";import{B as M}from"./vendor-antd-buttons-wjEWA2x8.js";import{u as N}from"./page-booking-B9D71fvQ.js";import{F as B}from"./vendor-antd-table-CA0XBoxE.js";import"./vendor-ui-BOD89xu8.js";import"./vendor-canvas-BOVIu3pe.js";import"./services-DHEt1Qtz.js";import"./vendor-utils-CTzFqUk0.js";import"./component-exhibition-CuwlJtEU.js";import"./vendor-editor-HOXaQDhO.js";import"./component-layout-BTsCaDZB.js";import"./component-auth-ClRi3ofU.js";import"./page-amenities-Cf9BkOfe.js";import"./page-dashboard-984XnN9x.js";const{Text:O}=w,D=({visible:a,user:r,onClose:t})=>{if(!r)return null;const l=e=>"string"==typeof e?e:e&&"object"==typeof e&&e.name?e.name:"Unknown";return e.jsxs(y,{title:"User Details",open:a,onCancel:t,footer:null,width:600,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:20},children:[e.jsx(b,{size:64,icon:e.jsx(s,{}),style:{backgroundColor:"#1677ff"}}),e.jsxs("div",{style:{marginLeft:20},children:[e.jsx(O,{style:{fontSize:20,fontWeight:"bold"},children:r.name||r.username}),e.jsxs("div",{children:[e.jsx(C,{color:r.isActive?"success":"default",children:r.isActive?"Active":"Inactive"}),e.jsx(C,{color:"blue",children:l(r.role)})]})]})]}),e.jsx(A,{}),e.jsxs(k,{bordered:!0,column:1,children:[e.jsx(k.Item,{label:"Username",children:r.username}),e.jsx(k.Item,{label:"Email",children:r.email}),e.jsx(k.Item,{label:"Role",children:l(r.role)}),e.jsx(k.Item,{label:"Status",children:e.jsx(C,{color:r.isActive?"success":"default",children:r.isActive?"Active":"Inactive"})}),e.jsx(k.Item,{label:"Created At",children:new Date(r.createdAt).toLocaleString()}),e.jsx(k.Item,{label:"Updated At",children:new Date(r.updatedAt).toLocaleString()})]})]})},{Option:V}=U,{Text:K}=w,W=({visible:s,user:r,onClose:t,onSuccess:l})=>{const{message:i}=S.useApp(),[n]=$.useForm(),o=u(),{roles:d,loading:c}=x((e=>e.role)),{loading:m}=x((e=>e.user));a.useEffect((()=>{s&&r&&n.setFieldsValue({username:r.username,name:r.name||"",email:r.email,role:"object"==typeof r.role?r.role._id:r.role,isActive:r.isActive})}),[s,r,n]),a.useEffect((()=>{s&&o(h())}),[s,o]);return r?e.jsx(y,{title:"Edit User",open:s,onCancel:t,width:600,footer:[e.jsx(M,{onClick:t,children:"Cancel"},"cancel"),e.jsx(M,{type:"primary",loading:m,onClick:async()=>{if(r)try{const e=await n.validateFields(),s={username:e.username,name:e.name,email:e.email,role:e.role,isActive:e.isActive};e.password&&""!==e.password.trim()&&(s.password=e.password),o(j({id:r._id,userData:s})).unwrap().then((()=>{i.success("User updated successfully"),l(),t()})).catch((e=>{i.error(`Failed to update user: ${e}`)}))}catch(e){}},children:"Update User"},"submit")],children:e.jsxs($,{form:n,layout:"vertical",children:[e.jsx($.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter a username"}],children:e.jsx(I,{placeholder:"Username"})}),e.jsx($.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:e.jsx(I,{placeholder:"Full name"})}),e.jsx($.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter an email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(I,{placeholder:"Email address"})}),e.jsx(A,{children:e.jsx(K,{type:"secondary",children:"Change Password (Optional)"})}),e.jsx($.Item,{name:"password",label:"New Password",extra:"Leave blank to keep the current password",rules:[{min:6,message:"Password must be at least 6 characters"}],children:e.jsx(I.Password,{placeholder:"New password (optional)"})}),e.jsx(A,{}),e.jsx($.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:e.jsx(U,{loading:c,children:d.length>0?d.map((s=>e.jsx(V,{value:s._id,children:s.name},s._id))):e.jsxs(e.Fragment,{children:[e.jsx(V,{value:"admin",children:"Admin"}),e.jsx(V,{value:"manager",children:"Manager"}),e.jsx(V,{value:"agent",children:"Agent"})]})})}),e.jsx($.Item,{name:"isActive",label:"Status",valuePropName:"checked",children:e.jsx(P,{checkedChildren:"Active",unCheckedChildren:"Inactive"})})]})}):null},{Option:Q}=U,{Text:Y}=w,Z=({visible:s,onClose:r,onSuccess:t})=>{const{message:l}=S.useApp(),[i]=$.useForm(),n=u(),{roles:o,loading:d}=x((e=>e.role)),{loading:c}=x((e=>e.user));a.useEffect((()=>{s&&n(h())}),[s,n]),a.useEffect((()=>{s&&i.resetFields()}),[s,i]);return e.jsx(y,{title:"Create New User",open:s,onCancel:r,width:600,footer:[e.jsx(M,{onClick:r,children:"Cancel"},"cancel"),e.jsx(M,{type:"primary",loading:c,onClick:async()=>{try{const e=await i.validateFields(),s={username:e.username,name:e.name,email:e.email,password:e.password,role:e.role,isActive:e.status};n(p(s)).unwrap().then((e=>{l.success("User created successfully"),i.resetFields(),t(),r()})).catch((e=>{l.error(`Failed to create user: ${e}`)}))}catch(e){}},children:"Create User"},"submit")],children:e.jsxs($,{form:i,layout:"vertical",requiredMark:!1,children:[e.jsx($.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter a username"}],children:e.jsx(I,{placeholder:"Username"})}),e.jsx($.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter the user name"}],children:e.jsx(I,{placeholder:"Full name"})}),e.jsx($.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(I,{placeholder:"Email address"})}),e.jsx($.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please enter password"},{min:6,message:"Password must be at least 6 characters"}],children:e.jsx(I.Password,{placeholder:"Enter password"})}),e.jsx(A,{}),e.jsx($.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:e.jsx(U,{placeholder:"Select role",loading:d,children:o.length>0?o.map((s=>e.jsx(Q,{value:s._id,children:s.name},s._id))):e.jsxs(e.Fragment,{children:[e.jsx(Q,{value:"admin",children:"Admin"}),e.jsx(Q,{value:"manager",children:"Manager"}),e.jsx(Q,{value:"agent",children:"Agent"})]})})}),e.jsx($.Item,{name:"status",label:"Status",valuePropName:"checked",initialValue:!0,children:e.jsx(P,{checkedChildren:"Active",unCheckedChildren:"Inactive"})})]})})},{Title:G,Paragraph:H,Text:J}=w,{TabPane:X}=R,{confirm:ee}=y;function se(){const{message:h,notification:j}=S.useApp(),p=u(),{users:y,loading:w,error:A,selectedUser:k}=x((e=>e.user)),[U,P]=a.useState(""),[$,O]=a.useState("all"),[V,K]=a.useState(!1),[Q,Y]=a.useState(!1),[se,ae]=a.useState(!1),{hasPermission:re}=N();a.useEffect((()=>{p(v())}),[p]),a.useEffect((()=>{A&&j.error({message:"Error",description:A})}),[A,j]),a.useEffect((()=>{k||(K(!1),Y(!1))}),[k]);const te=[{title:"User",key:"user",render:(a,r)=>e.jsxs(T,{children:[e.jsx(b,{icon:e.jsx(s,{}),size:"large"}),e.jsxs(T,{direction:"vertical",size:0,children:[e.jsx(J,{strong:!0,children:r.name||r.username}),e.jsx(J,{type:"secondary",style:{fontSize:"12px"},children:r.email})]})]})},{title:"Role",dataIndex:"role",key:"role",render:s=>{const a=ne(s);let r="admin"===a.toLowerCase()||"administrator"===a.toLowerCase()?"#1677ff":"manager"===a.toLowerCase()?"#52c41a":"#faad14";return e.jsx(C,{color:r,style:{fontWeight:500,borderRadius:"4px"},children:a.toUpperCase()})},filters:[{text:"Admin",value:"admin"},{text:"Manager",value:"manager"},{text:"Agent",value:"agent"}],onFilter:(e,s)=>0===ne(s.role).toLowerCase().indexOf(e.toLowerCase())},{title:"Status",key:"status",render:(s,a)=>e.jsx(T,{children:a.isActive?e.jsx(q,{status:"success",text:e.jsx(J,{style:{color:"#52c41a"},children:"Active"})}):e.jsx(q,{status:"default",text:e.jsx(J,{type:"secondary",children:"Inactive"})})}),filters:[{text:"Active",value:!0},{text:"Inactive",value:!1}],onFilter:(e,s)=>s.isActive===e},{title:"Last Active",key:"lastLogin",render:(s,a)=>e.jsxs(T,{children:[e.jsx(n,{style:{color:"#8c8c8c"}}),e.jsx(J,{type:"secondary",children:a.lastLogin||"Never"})]})},{title:"Action",key:"action",render:(s,a)=>e.jsxs(T,{size:"small",children:[re("users_view")&&e.jsx(z,{title:"View details",children:e.jsx(M,{type:"text",icon:e.jsx(o,{}),size:"small",onClick:()=>(p(g(a)),void K(!0))})}),re("users_edit")&&e.jsx(z,{title:"Edit user",children:e.jsx(M,{type:"text",icon:e.jsx(d,{}),size:"small",onClick:()=>(p(g(a)),void Y(!0))})}),re("users_delete")&&e.jsx(z,{title:"Delete user",children:e.jsx(M,{type:"text",danger:!0,icon:e.jsx(c,{}),size:"small",onClick:()=>{return s=a._id,r=a.name||a.username,void ee({title:"Are you sure you want to delete this user?",icon:e.jsx(m,{}),content:`This will permanently delete ${r}'s account. This action cannot be undone.`,okText:"Yes, delete",okType:"danger",cancelText:"Cancel",onOk:()=>{p(f(s)).unwrap().then((()=>{h.success(`${r} has been deleted successfully.`)})).catch((e=>{h.error(`Failed to delete user: ${e}`)}))}});var s,r}})})]})}],le=e=>e.isActive?"active":"inactive",ie=y.filter((e=>("all"===$||"active"===$&&"active"===le(e)||"inactive"===$&&"inactive"===le(e))&&Object.values(e).some((e=>"string"==typeof e&&e.toLowerCase().includes(U.toLowerCase()))))),ne=e=>"string"==typeof e?e:e&&"object"==typeof e&&e.name?e.name:"Unknown",oe={admin:y.filter((e=>{const s=ne(e.role).toLowerCase();return"admin"===s||"administrator"===s})).length,manager:y.filter((e=>"manager"===ne(e.role).toLowerCase())).length,agent:y.filter((e=>"agent"===ne(e.role).toLowerCase())).length},de={active:y.filter((e=>e.isActive)).length,inactive:y.filter((e=>!e.isActive)).length};return e.jsxs("div",{style:{padding:"12px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(G,{level:2,children:"User Management"}),e.jsx(H,{children:"Manage user accounts, permissions, and access control."})]}),e.jsxs(F,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(L,{xs:24,sm:8,children:e.jsx(E,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(_,{title:"Total Users",value:y.length,prefix:e.jsx(s,{}),valueStyle:{color:"#1677ff"},loading:w})})}),e.jsx(L,{xs:24,sm:8,children:e.jsx(E,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(_,{title:"Active Users",value:de.active,prefix:e.jsx(r,{}),valueStyle:{color:"#52c41a"},loading:w})})}),e.jsx(L,{xs:24,sm:8,children:e.jsx(E,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(_,{title:"Admin Users",value:oe.admin,prefix:e.jsx(s,{}),valueStyle:{color:"#faad14"},loading:w})})})]}),e.jsx(E,{style:{marginBottom:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsxs(F,{gutter:[16,16],justify:"space-between",align:"middle",children:[e.jsx(L,{xs:24,md:12,children:e.jsx(I,{placeholder:"Search users...",prefix:e.jsx(t,{style:{color:"rgba(0,0,0,.45)"}}),onChange:e=>P(e.target.value),allowClear:!0,size:"middle"})}),e.jsx(L,{xs:24,md:12,style:{textAlign:"right"},children:e.jsxs(T,{wrap:!0,children:[e.jsx(z,{title:"Refresh data",children:e.jsx(M,{icon:w?e.jsx(l,{}):e.jsx(t,{}),onClick:()=>p(v()),disabled:w,children:"Refresh"})}),e.jsx(M,{type:"primary",icon:e.jsx(i,{}),onClick:()=>{ae(!0)},children:"Add User"})]})})]})}),e.jsxs(E,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:[e.jsxs(R,{defaultActiveKey:"all",onChange:O,tabBarStyle:{marginBottom:24},children:[e.jsx(X,{tab:`All Users (${y.length})`},"all"),e.jsx(X,{tab:`Active (${de.active})`},"active"),e.jsx(X,{tab:`Inactive (${de.inactive})`},"inactive")]}),e.jsx(B,{columns:te,dataSource:ie,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(e,s)=>`${s[0]}-${s[1]} of ${e} users`},loading:w})]}),e.jsx(D,{user:y.find((e=>e._id===(null==k?void 0:k._id)))||null,visible:V,onClose:()=>p(g(null))}),e.jsx(W,{user:y.find((e=>e._id===(null==k?void 0:k._id)))||null,visible:Q,onClose:()=>p(g(null)),onSuccess:()=>p(v())}),e.jsx(Z,{visible:se,onClose:()=>ae(!1),onSuccess:()=>p(v())})]})}export{se as default};
