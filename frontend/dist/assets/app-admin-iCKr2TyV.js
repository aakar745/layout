import{r as b,j as e}from"./vendor-react-core-GL8v-krj.js";import"./app-dashboard-DAvQsPhE.js";import{c as U,a as Ce,u as J,b as E}from"./vendor-redux-9XI87JsB.js";import{s as Se,g as Me,u as Oe,c as qe,d as We,a as Ge,b as Ke,e as Ye,f as He,h as Je,i as Qe,j as xe}from"./app-core-BUxrPMxd.js";import{A as Q,F as g,R as q,C as $,S as _,T as B,a as T,I as R,b as N,c as ke,U as Xe,P as _e,B as k,M as W,D as H,d as Ue,e as Te,f as Re,g as M,h as ae,i as F,j as fe,k as Ee,l as Ae}from"./vendor-antd-core-1s5t57SE.js";import{R as Ze,a as es,b as ss,c as rs,d as Fe,e as Le,f as Ne,g as as,h as Be,i as te,j as $e,k as ts,l as ls,m as is,n as ns}from"./vendor-antd-icons-C-4QrCZ0.js";const os={settings:null,loading:!1,error:null},le=U("settings/fetchSettings",async(t,{rejectWithValue:s})=>{var r,a;try{return await Se.getSettings()}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch settings")}}),Y=U("settings/updateSettings",async(t,{rejectWithValue:s})=>{var r,a;try{return await Se.updateSettings(t)}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to update settings")}}),ie=U("settings/uploadLogo",async(t,{dispatch:s,rejectWithValue:r})=>{var a,l;try{const i=await Se.uploadLogo(t);return i.path&&await s(Y({logo:i.path})),i}catch(i){return r(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to upload logo")}}),ds=Ce({name:"settings",initialState:os,reducers:{},extraReducers:t=>{t.addCase(le.pending,s=>{s.loading=!0,s.error=null}).addCase(le.fulfilled,(s,r)=>{s.settings=r.payload,s.loading=!1}).addCase(le.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(Y.pending,s=>{s.loading=!0,s.error=null}).addCase(Y.fulfilled,(s,r)=>{s.settings=r.payload,s.loading=!1}).addCase(Y.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(ie.pending,s=>{s.loading=!0,s.error=null}).addCase(ie.fulfilled,s=>{s.loading=!1}).addCase(ie.rejected,(s,r)=>{s.loading=!1,s.error=r.payload})}}),Es=ds.reducer,cs={roles:[],role:null,loading:!1,error:null},O=U("roles/fetchRoles",async(t,{rejectWithValue:s})=>{var r,a;try{return await Me()}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch roles")}}),je=U("roles/fetchRoleById",async(t,{rejectWithValue:s})=>{var r,a;try{return await Ge(t)}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch role")}}),ne=U("roles/addRole",async(t,{rejectWithValue:s})=>{var r,a;try{return await qe(t)}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to create role")}}),oe=U("roles/modifyRole",async({id:t,roleData:s},{rejectWithValue:r})=>{var a,l;try{return await Oe(t,s)}catch(i){return r(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to update role")}}),de=U("roles/removeRole",async(t,{rejectWithValue:s})=>{var r,a;try{return await We(t),t}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to delete role")}}),ze=Ce({name:"roles",initialState:cs,reducers:{clearRoleError:t=>{t.error=null},setSelectedRole:(t,s)=>{t.role=s.payload}},extraReducers:t=>{t.addCase(O.pending,s=>{s.loading=!0,s.error=null}).addCase(O.fulfilled,(s,r)=>{s.loading=!1,s.roles=r.payload}).addCase(O.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(je.pending,s=>{s.loading=!0,s.error=null}).addCase(je.fulfilled,(s,r)=>{s.loading=!1,s.role=r.payload}).addCase(je.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(ne.pending,s=>{s.loading=!0,s.error=null}).addCase(ne.fulfilled,(s,r)=>{s.loading=!1,s.roles.push(r.payload)}).addCase(ne.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(oe.pending,s=>{s.loading=!0,s.error=null}).addCase(oe.fulfilled,(s,r)=>{var l;s.loading=!1;const a=s.roles.findIndex(i=>i._id===r.payload._id);a!==-1&&(s.roles[a]=r.payload),((l=s.role)==null?void 0:l._id)===r.payload._id&&(s.role=r.payload)}).addCase(oe.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(de.pending,s=>{s.loading=!0,s.error=null}).addCase(de.fulfilled,(s,r)=>{var a;s.loading=!1,s.roles=s.roles.filter(l=>l._id!==r.payload),((a=s.role)==null?void 0:a._id)===r.payload&&(s.role=null)}).addCase(de.rejected,(s,r)=>{s.loading=!1,s.error=r.payload})}}),{clearRoleError:Fs,setSelectedRole:Ls}=ze.actions,Ns=ze.reducer,us={users:[],selectedUser:null,loading:!1,error:null},L=U("users/fetchUsers",async(t,{rejectWithValue:s})=>{var r,a;try{return await Ke()}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch users")}}),ye=U("users/fetchUserById",async(t,{rejectWithValue:s})=>{var r,a;try{return await Ye(t)}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch user")}}),ce=U("users/addUser",async(t,{rejectWithValue:s})=>{var r,a;try{return await He(t)}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to create user")}}),ue=U("users/modifyUser",async({id:t,userData:s},{rejectWithValue:r})=>{var a,l;try{return await Je(t,s)}catch(i){return r(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to update user")}}),he=U("users/removeUser",async(t,{rejectWithValue:s})=>{var r,a;try{return await Qe(t),t}catch(l){return s(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to delete user")}}),Ve=Ce({name:"users",initialState:us,reducers:{clearUserError:t=>{t.error=null},setSelectedUser:(t,s)=>{t.selectedUser=s.payload}},extraReducers:t=>{t.addCase(L.pending,s=>{s.loading=!0,s.error=null}).addCase(L.fulfilled,(s,r)=>{s.loading=!1,s.users=r.payload}).addCase(L.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(ye.pending,s=>{s.loading=!0,s.error=null}).addCase(ye.fulfilled,(s,r)=>{s.loading=!1,s.selectedUser=r.payload}).addCase(ye.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(ce.pending,s=>{s.loading=!0,s.error=null}).addCase(ce.fulfilled,(s,r)=>{s.loading=!1,s.users.push(r.payload)}).addCase(ce.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(ue.pending,s=>{s.loading=!0,s.error=null}).addCase(ue.fulfilled,(s,r)=>{var l;s.loading=!1;const a=s.users.findIndex(i=>i._id===r.payload._id);a!==-1&&(s.users[a]=r.payload),((l=s.selectedUser)==null?void 0:l._id)===r.payload._id&&(s.selectedUser=r.payload)}).addCase(ue.rejected,(s,r)=>{s.loading=!1,s.error=r.payload}).addCase(he.pending,s=>{s.loading=!0,s.error=null}).addCase(he.fulfilled,(s,r)=>{var a;s.loading=!1,s.users=s.users.filter(l=>l._id!==r.payload),((a=s.selectedUser)==null?void 0:a._id)===r.payload&&(s.selectedUser=null)}).addCase(he.rejected,(s,r)=>{s.loading=!1,s.error=r.payload})}}),{clearUserError:Bs,setSelectedUser:Z}=Ve.actions,zs=Ve.reducer,{Option:V}=N,{Title:hs,Text:ms}=B,gs=()=>{const t=J(),{message:s}=Q.useApp(),[r]=g.useForm(),{settings:a,loading:l}=E(f=>f.settings),[i,o]=b.useState([]),[y,v]=b.useState(0);b.useEffect(()=>{t(le())},[t]),b.useEffect(()=>{if(a&&(r.setFieldsValue({siteName:a.siteName,adminEmail:a.adminEmail,language:a.language,timezone:a.timezone,emailNotifications:a.emailNotifications,footerText:a.footerText}),a.logo)){const f=j=>{const h=localStorage.getItem("token");return{url:`${xe.defaults.baseURL}/uploads/${j}`,token:h}},{url:w,token:u}=f(a.logo);fetch(w,{headers:{authorization:`Bearer ${u}`}}).then(j=>j.blob()).then(j=>{var C;const h=URL.createObjectURL(j);o([{uid:"-1",name:((C=a.logo)==null?void 0:C.split("/").pop())||"logo",status:"done",url:h,thumbUrl:h,type:j.type,response:{path:a.logo}}])}).catch(()=>{o([])})}},[a,r]);const S=f=>{t(Y(f)).unwrap().then(()=>s.success("Settings updated successfully")).catch(w=>s.error(`Failed to update settings: ${w}`))},x={name:"file",action:`${xe.defaults.baseURL}/settings/upload/logo`,headers:{authorization:`Bearer ${localStorage.getItem("token")}`},maxCount:1,accept:"image/*",fileList:i,listType:"picture-card",showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},onChange(f){const{status:w,name:u,response:j,uid:h}=f.file;if(w==="uploading"){o([...f.fileList]);return}if(w==="done"&&j){v(0);const C=localStorage.getItem("token"),A=`${xe.defaults.baseURL}/uploads/${j.path}`;fetch(A,{headers:{authorization:`Bearer ${C}`}}).then(I=>I.blob()).then(I=>{const z=URL.createObjectURL(I);o([{uid:f.file.uid,name:u,status:"done",url:z,thumbUrl:z,type:I.type,response:j}]),s.success(`${u} uploaded successfully`),r.setFieldValue("logo",j.path)}).catch(()=>{s.error(`${u} preview failed to load`),o([])})}else w==="error"?(s.error(`${u} upload failed.`),o([]),v(0)):w==="removed"&&(o([]),r.setFieldValue("logo",null),v(0))},onRemove(){return o([]),r.setFieldValue("logo",null),v(0),!0},customRequest:async({file:f,onSuccess:w,onError:u,onProgress:j})=>{try{t(ie(f)).unwrap().then(h=>{w&&w(h)}).catch(h=>{u&&u(new Error(h))})}catch(h){u&&u(h)}}},p=e.jsx("div",{children:y>0?e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(_e,{type:"circle",percent:y,width:80}),e.jsx("div",{style:{marginTop:8},children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{}),e.jsx("div",{style:{marginTop:8},children:"Upload Logo"})]})});return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx(q,{gutter:[24,24],align:"middle",children:e.jsx($,{flex:"auto",children:e.jsxs(_,{direction:"vertical",size:4,children:[e.jsx(hs,{level:4,style:{margin:0},children:"Settings"}),e.jsx(ms,{type:"secondary",children:"Configure system settings and preferences"})]})})})}),e.jsx(T,{className:"info-card",children:e.jsxs(g,{form:r,layout:"vertical",onFinish:S,initialValues:{siteName:"Exhibition Management System",emailNotifications:!0,language:"en",timezone:"UTC"},children:[e.jsxs(q,{gutter:24,children:[e.jsxs($,{span:12,children:[e.jsx(g.Item,{label:"Site Name",name:"siteName",rules:[{required:!0,message:"Please input the site name!"}],children:e.jsx(R,{})}),e.jsx(g.Item,{label:"Admin Email",name:"adminEmail",rules:[{required:!0,message:"Please input the admin email!"},{type:"email",message:"Please enter a valid email!"}],children:e.jsx(R,{})}),e.jsx(g.Item,{label:"Language",name:"language",children:e.jsxs(N,{children:[e.jsx(V,{value:"en",children:"English"}),e.jsx(V,{value:"es",children:"Spanish"}),e.jsx(V,{value:"fr",children:"French"})]})}),e.jsx(g.Item,{label:"Timezone",name:"timezone",children:e.jsxs(N,{children:[e.jsx(V,{value:"UTC",children:"UTC"}),e.jsx(V,{value:"EST",children:"EST"}),e.jsx(V,{value:"PST",children:"PST"})]})}),e.jsx(g.Item,{label:"Email Notifications",name:"emailNotifications",valuePropName:"checked",children:e.jsx(ke,{})})]}),e.jsxs($,{span:12,children:[e.jsxs(g.Item,{label:"Site Logo",name:"logo",tooltip:"Upload your site logo (recommended size: 200x200px, max 2MB)",children:[e.jsx(Xe,{...x,children:i.length<1&&p}),i.length>0&&y>0&&e.jsx(_e,{percent:y,status:"active",style:{marginTop:8}})]}),e.jsx(g.Item,{label:"Footer Text",name:"footerText",children:e.jsx(R.TextArea,{rows:4,placeholder:"Enter footer text (optional)"})})]})]}),e.jsx(g.Item,{children:e.jsxs(_,{children:[e.jsx(k,{type:"primary",htmlType:"submit",icon:e.jsx(Ze,{}),loading:l,children:"Save Settings"}),e.jsx(k,{onClick:()=>r.resetFields(),icon:e.jsx(es,{}),children:"Reset"})]})})]})})]})},Vs=Object.freeze(Object.defineProperty({__proto__:null,default:gs},Symbol.toStringTag,{value:"Module"})),{Text:Ie}=B,ps=[{key:"dashboard_view",label:"View Dashboard",group:"Dashboard"},{key:"dashboard_manage",label:"Manage Dashboard",group:"Dashboard"},{key:"users_view",label:"View Users",group:"Users"},{key:"users_create",label:"Create Users",group:"Users"},{key:"users_edit",label:"Edit Users",group:"Users"},{key:"users_delete",label:"Delete Users",group:"Users"},{key:"roles_view",label:"View Roles",group:"Roles"},{key:"roles_create",label:"Create Roles",group:"Roles"},{key:"roles_edit",label:"Edit Roles",group:"Roles"},{key:"roles_delete",label:"Delete Roles",group:"Roles"},{key:"exhibitions_view",label:"View Exhibitions",group:"Exhibitions"},{key:"exhibitions_create",label:"Create Exhibitions",group:"Exhibitions"},{key:"exhibitions_edit",label:"Edit Exhibitions",group:"Exhibitions"},{key:"exhibitions_delete",label:"Delete Exhibitions",group:"Exhibitions"},{key:"bookings_view",label:"View Bookings",group:"Bookings"},{key:"bookings_create",label:"Create Bookings",group:"Bookings"},{key:"bookings_edit",label:"Edit Bookings",group:"Bookings"},{key:"bookings_delete",label:"Delete Bookings",group:"Bookings"},{key:"exhibitors_view",label:"View Exhibitors",group:"Exhibitors"},{key:"exhibitors_create",label:"Create Exhibitors",group:"Exhibitors"},{key:"exhibitors_edit",label:"Edit Exhibitors",group:"Exhibitors"},{key:"exhibitors_delete",label:"Delete Exhibitors",group:"Exhibitors"},{key:"settings_view",label:"View Settings",group:"Settings"},{key:"settings_edit",label:"Edit Settings",group:"Settings"}],be=ps.reduce((t,s)=>(t[s.group]||(t[s.group]=[]),t[s.group].push({key:s.key,label:s.label}),t),{}),xs=({visible:t,onCancel:s,onSave:r,role:a,loading:l})=>{const[i]=g.useForm(),o=!!a,[y,v]=b.useState([]);b.useEffect(()=>{if(t)if(a){const u=a.permissions||[];i.setFieldsValue({name:a.name,description:a.description,permissions:u}),v(u)}else i.resetFields(),v([])},[t,a,i]);const S=()=>{i.setFieldsValue({permissions:y}),i.validateFields().then(u=>{r(u)})},x=u=>{const j=be[u].map(h=>h.key);return j.length>0&&j.every(h=>y.includes(h))},p=(u,j)=>{let h;j?h=[...y,u]:h=y.filter(C=>C!==u),v(h)},f=(u,j)=>{const h=be[u].map(A=>A.key);let C;if(j){const A=h.filter(I=>!y.includes(I));C=[...y,...A]}else C=y.filter(A=>!h.includes(A));v(C)},w=u=>y.includes(u);return e.jsx(W,{title:o?"Edit Role":"Add New Role",open:t,onCancel:s,width:700,footer:[e.jsx(k,{onClick:s,children:"Cancel"},"cancel"),e.jsx(k,{type:"primary",loading:l,onClick:S,children:o?"Update":"Create"},"submit")],children:e.jsxs(g,{form:i,layout:"vertical",initialValues:{name:"",description:"",permissions:[]},children:[e.jsx(g.Item,{name:"name",label:"Role Name",rules:[{required:!0,message:"Please enter a role name"}],children:e.jsx(R,{placeholder:"e.g., Administrator, Editor, Viewer"})}),e.jsx(g.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please provide a description"}],children:e.jsx(R.TextArea,{placeholder:"Describe the purpose of this role",rows:3})}),e.jsx(H,{plain:!0,children:"Permissions"}),e.jsx(g.Item,{name:"permissions",hidden:!0,children:e.jsx(R,{})}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 8px"},children:Object.entries(be).map(([u,j])=>e.jsx(T,{size:"small",title:e.jsxs(_,{children:[e.jsx(Ie,{strong:!0,children:u}),e.jsx(Ue,{checked:x(u),onChange:h=>f(u,h.target.checked),children:"Select All"})]}),style:{marginBottom:16},children:e.jsx(q,{gutter:[16,12],children:j.map(h=>e.jsx($,{span:12,children:e.jsx(Ue,{checked:w(h.key),onChange:C=>p(h.key,C.target.checked),children:e.jsx(Ie,{children:h.label})})},h.key))})},u))})]})})},De=()=>{const{user:t}=E(r=>r.auth),s=r=>{if(!t||!t.role||!t.role.permissions)return!1;const a=t.role.permissions;if(a.includes(r)||a.includes("*")||a.includes("all")||a.includes("admin")||a.includes("superadmin")||a.includes("full_access"))return!0;const l=r.split("_");if(l.length===2){const i=l[0],o=l[1],y=[`${i}.*`,`*.${o}`,`view_${i}`,`${i}_view`,`${i}s_${o}`,`${o}_${i}`,i.endsWith("s")?`${i.slice(0,-1)}_${o}`:`${i}s_${o}`,`${i}_${o==="view"?"read":o}`,`${o==="view"?"read":o}_${i}`];for(const v of y)if(a.includes(v))return!0}return!1};return{hasPermission:s,hasAnyPermission:r=>r.some(a=>s(a)),hasAllPermissions:r=>r.every(a=>s(a))}},{Title:ee,Paragraph:Pe,Text:D}=B,{confirm:fs}=W;function ve({allowed:t}){return t?e.jsx(Ne,{className:"text-success",style:{color:"#52c41a",fontSize:16}}):e.jsx(as,{className:"text-danger",style:{color:"#f5222d",fontSize:16}})}function js(){const{message:t,notification:s}=Q.useApp(),r=J(),{roles:a,loading:l,error:i}=E(d=>d.role),[o,y]=b.useState(""),[v,S]=b.useState(!1),[x,p]=b.useState(null),{hasPermission:f}=De();b.useEffect(()=>{r(O())},[r]),b.useEffect(()=>{i&&s.error({message:"Error",description:i})},[i,s]);const w=()=>{p(null),S(!0)},u=d=>{p(d),S(!0)},j=d=>{x?r(oe({id:x._id,roleData:d})).unwrap().then(()=>{S(!1),t.success("Role updated successfully")}).catch(m=>{t.error(`Failed to update role: ${m.message}`)}):r(ne(d)).unwrap().then(()=>{S(!1),t.success("Role created successfully")}).catch(m=>{t.error(`Failed to create role: ${m.message}`)})},h=d=>{fs({title:"Are you sure you want to delete this role?",icon:e.jsx(Be,{}),content:`This will permanently delete the ${d.name} role. This action cannot be undone.`,okText:"Yes, delete it",okType:"danger",cancelText:"Cancel",onOk(){r(de(d._id)).unwrap().then(()=>{t.success(`${d.name} role deleted successfully`)}).catch(m=>{t.error(`Failed to delete role: ${m.message}`)})}})},C=[{title:"Role",dataIndex:"name",key:"name",render:(d,m)=>e.jsxs(_,{children:[e.jsx(Re,{style:{backgroundColor:me(m.name)},children:d.charAt(0).toUpperCase()}),e.jsx(D,{strong:!0,children:d})]})},{title:"Description",dataIndex:"description",key:"description",render:d=>e.jsx(D,{type:"secondary",children:d})},{title:"Read",key:"read",align:"center",render:(d,m)=>e.jsx(ve,{allowed:A(m)})},{title:"Write",key:"write",align:"center",render:(d,m)=>e.jsx(ve,{allowed:I(m)})},{title:"Delete",key:"delete",align:"center",render:(d,m)=>e.jsx(ve,{allowed:z(m)})},{title:"Actions",key:"actions",align:"right",render:(d,m)=>e.jsxs(_,{children:[f("roles_edit")&&e.jsx(M,{title:m.name==="Administrator"?"Administrator role cannot be edited":"Edit role",children:e.jsx(k,{type:"primary",shape:"circle",icon:e.jsx(Fe,{}),size:"small",onClick:()=>u(m),disabled:m.name==="Administrator"})}),f("roles_delete")&&e.jsx(M,{title:"Delete role",children:e.jsx(k,{danger:!0,shape:"circle",icon:e.jsx(Le,{}),size:"small",onClick:()=>h(m),disabled:m.name==="Administrator"})})]})}],A=d=>d.permissions.some(m=>m.endsWith("_view")),I=d=>d.permissions.some(m=>m.endsWith("_create")||m.endsWith("_edit")),z=d=>d.permissions.some(m=>m.endsWith("_delete")),me=d=>{const m=["#1677ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2","#eb2f96"];let P=0;for(let G=0;G<d.length;G++)P=d.charCodeAt(G)+((P<<5)-P);return m[Math.abs(P)%m.length]},ge=a.filter(d=>d.name.toLowerCase().includes(o.toLowerCase())||d.description.toLowerCase().includes(o.toLowerCase()));return e.jsxs("div",{style:{padding:"12px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(ee,{level:2,children:"Roles & Permissions"}),e.jsx(Pe,{children:"Manage role-based access control and permissions for your users."})]}),e.jsxs(T,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},loading:l&&a.length===0,children:[e.jsxs(q,{gutter:16,style:{marginBottom:16},children:[e.jsx($,{span:16,children:e.jsx(R,{placeholder:"Search roles...",allowClear:!0,value:o,onChange:d=>y(d.target.value),prefix:e.jsx(D,{type:"secondary",style:{fontSize:16},children:"🔍"})})}),e.jsx($,{span:8,style:{textAlign:"right"},children:f("roles_create")&&e.jsx(k,{type:"primary",icon:e.jsx(rs,{}),style:{borderRadius:6},onClick:w,children:"Add Role"})})]}),e.jsx(Te,{columns:C,dataSource:ge,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(d,m)=>`Showing ${m[0]}-${m[1]} of ${d} roles`},style:{marginTop:8},loading:l&&a.length>0})]}),e.jsx(T,{title:e.jsx(ee,{level:4,style:{margin:0},children:"Role Management Tips"}),style:{marginTop:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[e.jsxs(_,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(ee,{level:5,children:"Best Practices"}),e.jsxs("ul",{style:{paddingLeft:20},children:[e.jsx("li",{children:e.jsx(D,{children:"Follow the principle of least privilege"})}),e.jsx("li",{children:e.jsx(D,{children:"Regularly audit user roles"})}),e.jsx("li",{children:e.jsx(D,{children:"Document role responsibilities"})})]})]}),e.jsxs(_,{direction:"vertical",style:{flex:1,minWidth:250},children:[e.jsx(ee,{level:5,children:"Role Inheritance"}),e.jsx(Pe,{children:"Higher-level roles automatically include permissions from lower-level roles to ensure consistency."})]})]})}),e.jsx(xs,{visible:v,onCancel:()=>S(!1),onSave:j,role:x,loading:l})]})}const Ds=Object.freeze(Object.defineProperty({__proto__:null,default:js},Symbol.toStringTag,{value:"Module"})),{Text:ys}=B,bs=({visible:t,user:s,onClose:r})=>{if(!s)return null;const a=l=>typeof l=="string"?l:l&&typeof l=="object"&&l.name?l.name:"Unknown";return e.jsxs(W,{title:"User Details",open:t,onCancel:r,footer:null,width:600,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:20},children:[e.jsx(Re,{size:64,icon:e.jsx(te,{}),style:{backgroundColor:"#1677ff"}}),e.jsxs("div",{style:{marginLeft:20},children:[e.jsx(ys,{style:{fontSize:20,fontWeight:"bold"},children:s.name||s.username}),e.jsxs("div",{children:[e.jsx(ae,{color:s.isActive?"success":"default",children:s.isActive?"Active":"Inactive"}),e.jsx(ae,{color:"blue",children:a(s.role)})]})]})]}),e.jsx(H,{}),e.jsxs(F,{bordered:!0,column:1,children:[e.jsx(F.Item,{label:"Username",children:s.username}),e.jsx(F.Item,{label:"Email",children:s.email}),e.jsx(F.Item,{label:"Role",children:a(s.role)}),e.jsx(F.Item,{label:"Status",children:e.jsx(ae,{color:s.isActive?"success":"default",children:s.isActive?"Active":"Inactive"})}),e.jsx(F.Item,{label:"Created At",children:new Date(s.createdAt).toLocaleString()}),e.jsx(F.Item,{label:"Updated At",children:new Date(s.updatedAt).toLocaleString()})]})]})},{Option:se}=N,{Text:vs}=B,ws=({visible:t,user:s,onClose:r,onSuccess:a})=>{const{message:l}=Q.useApp(),[i]=g.useForm(),o=J(),{roles:y,loading:v}=E(p=>p.role),{loading:S}=E(p=>p.user);b.useEffect(()=>{t&&s&&i.setFieldsValue({username:s.username,name:s.name||"",email:s.email,role:typeof s.role=="object"?s.role._id:s.role,isActive:s.isActive})},[t,s,i]),b.useEffect(()=>{t&&o(O())},[t,o]);const x=async()=>{if(s)try{const p=await i.validateFields(),f={username:p.username,name:p.name,email:p.email,role:p.role,isActive:p.isActive};p.password&&p.password.trim()!==""&&(f.password=p.password),o(ue({id:s._id,userData:f})).unwrap().then(()=>{l.success("User updated successfully"),a(),r()}).catch(w=>{l.error(`Failed to update user: ${w}`)})}catch(p){console.error("Validation error:",p)}};return s?e.jsx(W,{title:"Edit User",open:t,onCancel:r,width:600,footer:[e.jsx(k,{onClick:r,children:"Cancel"},"cancel"),e.jsx(k,{type:"primary",loading:S,onClick:x,children:"Update User"},"submit")],children:e.jsxs(g,{form:i,layout:"vertical",children:[e.jsx(g.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter a username"}],children:e.jsx(R,{placeholder:"Username"})}),e.jsx(g.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:e.jsx(R,{placeholder:"Full name"})}),e.jsx(g.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter an email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(R,{placeholder:"Email address"})}),e.jsx(H,{children:e.jsx(vs,{type:"secondary",children:"Change Password (Optional)"})}),e.jsx(g.Item,{name:"password",label:"New Password",extra:"Leave blank to keep the current password",rules:[{min:6,message:"Password must be at least 6 characters"}],children:e.jsx(R.Password,{placeholder:"New password (optional)"})}),e.jsx(H,{}),e.jsx(g.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:e.jsx(N,{loading:v,children:y.length>0?y.map(p=>e.jsx(se,{value:p._id,children:p.name},p._id)):e.jsxs(e.Fragment,{children:[e.jsx(se,{value:"admin",children:"Admin"}),e.jsx(se,{value:"manager",children:"Manager"}),e.jsx(se,{value:"agent",children:"Agent"})]})})}),e.jsx(g.Item,{name:"isActive",label:"Status",valuePropName:"checked",children:e.jsx(ke,{checkedChildren:"Active",unCheckedChildren:"Inactive"})})]})}):null},{Option:re}=N,{Text:Ms}=B,Cs=({visible:t,onClose:s,onSuccess:r})=>{const{message:a}=Q.useApp(),[l]=g.useForm(),i=J(),{roles:o,loading:y}=E(x=>x.role),{loading:v}=E(x=>x.user);b.useEffect(()=>{t&&i(O())},[t,i]),b.useEffect(()=>{t&&l.resetFields()},[t,l]);const S=async()=>{try{const x=await l.validateFields(),p={username:x.username,name:x.name,email:x.email,password:x.password,role:x.role,isActive:x.status};i(ce(p)).unwrap().then(f=>{a.success("User created successfully"),l.resetFields(),r(),s()}).catch(f=>{a.error(`Failed to create user: ${f}`)})}catch(x){console.error("Validation error:",x)}};return e.jsx(W,{title:"Create New User",open:t,onCancel:s,width:600,footer:[e.jsx(k,{onClick:s,children:"Cancel"},"cancel"),e.jsx(k,{type:"primary",loading:v,onClick:S,children:"Create User"},"submit")],children:e.jsxs(g,{form:l,layout:"vertical",requiredMark:!1,children:[e.jsx(g.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please enter a username"}],children:e.jsx(R,{placeholder:"Username"})}),e.jsx(g.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter the user name"}],children:e.jsx(R,{placeholder:"Full name"})}),e.jsx(g.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(R,{placeholder:"Email address"})}),e.jsx(g.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please enter password"},{min:6,message:"Password must be at least 6 characters"}],children:e.jsx(R.Password,{placeholder:"Enter password"})}),e.jsx(H,{}),e.jsx(g.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:e.jsx(N,{placeholder:"Select role",loading:y,children:o.length>0?o.map(x=>e.jsx(re,{value:x._id,children:x.name},x._id)):e.jsxs(e.Fragment,{children:[e.jsx(re,{value:"admin",children:"Admin"}),e.jsx(re,{value:"manager",children:"Manager"}),e.jsx(re,{value:"agent",children:"Agent"})]})})}),e.jsx(g.Item,{name:"status",label:"Status",valuePropName:"checked",initialValue:!0,children:e.jsx(ke,{checkedChildren:"Active",unCheckedChildren:"Inactive"})})]})})},{Title:Ss,Paragraph:ks,Text:K}=B,{TabPane:we}=Ee,{confirm:Rs}=W;function _s(){const{message:t,notification:s}=Q.useApp(),r=J(),{users:a,loading:l,error:i,selectedUser:o}=E(n=>n.user),[y,v]=b.useState(""),[S,x]=b.useState("all"),[p,f]=b.useState(!1),[w,u]=b.useState(!1),[j,h]=b.useState(!1),{hasPermission:C}=De();b.useEffect(()=>{r(L())},[r]),b.useEffect(()=>{i&&s.error({message:"Error",description:i})},[i,s]),b.useEffect(()=>{o||(f(!1),u(!1))},[o]);const A=(n,c)=>{Rs({title:"Are you sure you want to delete this user?",icon:e.jsx(Be,{}),content:`This will permanently delete ${c}'s account. This action cannot be undone.`,okText:"Yes, delete",okType:"danger",cancelText:"Cancel",onOk:()=>{r(he(n)).unwrap().then(()=>{t.success(`${c} has been deleted successfully.`)}).catch(X=>{t.error(`Failed to delete user: ${X}`)})}})},I=n=>{r(Z(n)),f(!0)},z=n=>{r(Z(n)),u(!0)},me=()=>{h(!0)},ge=[{title:"User",key:"user",render:(n,c)=>e.jsxs(_,{children:[e.jsx(Re,{icon:e.jsx(te,{}),size:"large"}),e.jsxs(_,{direction:"vertical",size:0,children:[e.jsx(K,{strong:!0,children:c.name||c.username}),e.jsx(K,{type:"secondary",style:{fontSize:"12px"},children:c.email})]})]})},{title:"Role",dataIndex:"role",key:"role",render:n=>{const c=P(n);let X=c.toLowerCase()==="admin"||c.toLowerCase()==="administrator"?"#1677ff":c.toLowerCase()==="manager"?"#52c41a":"#faad14";return e.jsx(ae,{color:X,style:{fontWeight:500,borderRadius:"4px"},children:c.toUpperCase()})},filters:[{text:"Admin",value:"admin"},{text:"Manager",value:"manager"},{text:"Agent",value:"agent"}],onFilter:(n,c)=>P(c.role).toLowerCase().indexOf(n.toLowerCase())===0},{title:"Status",key:"status",render:(n,c)=>e.jsx(_,{children:c.isActive?e.jsx(Ae,{status:"success",text:e.jsx(K,{style:{color:"#52c41a"},children:"Active"})}):e.jsx(Ae,{status:"default",text:e.jsx(K,{type:"secondary",children:"Inactive"})})}),filters:[{text:"Active",value:!0},{text:"Inactive",value:!1}],onFilter:(n,c)=>c.isActive===n},{title:"Last Active",key:"lastLogin",render:(n,c)=>e.jsxs(_,{children:[e.jsx(is,{style:{color:"#8c8c8c"}}),e.jsx(K,{type:"secondary",children:c.lastLogin||"Never"})]})},{title:"Action",key:"action",render:(n,c)=>e.jsxs(_,{size:"small",children:[C("users_view")&&e.jsx(M,{title:"View details",children:e.jsx(k,{type:"text",icon:e.jsx(ns,{}),size:"small",onClick:()=>I(c)})}),C("users_edit")&&e.jsx(M,{title:"Edit user",children:e.jsx(k,{type:"text",icon:e.jsx(Fe,{}),size:"small",onClick:()=>z(c)})}),C("users_delete")&&e.jsx(M,{title:"Delete user",children:e.jsx(k,{type:"text",danger:!0,icon:e.jsx(Le,{}),size:"small",onClick:()=>A(c._id,c.name||c.username)})})]})}],d=n=>n.isActive?"active":"inactive",m=a.filter(n=>(S==="all"||S==="active"&&d(n)==="active"||S==="inactive"&&d(n)==="inactive")&&Object.values(n).some(c=>typeof c=="string"&&c.toLowerCase().includes(y.toLowerCase()))),P=n=>typeof n=="string"?n:n&&typeof n=="object"&&n.name?n.name:"Unknown",G={admin:a.filter(n=>{const c=P(n.role).toLowerCase();return c==="admin"||c==="administrator"}).length,manager:a.filter(n=>P(n.role).toLowerCase()==="manager").length,agent:a.filter(n=>P(n.role).toLowerCase()==="agent").length},pe={active:a.filter(n=>n.isActive).length,inactive:a.filter(n=>!n.isActive).length};return e.jsxs("div",{style:{padding:"12px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Ss,{level:2,children:"User Management"}),e.jsx(ks,{children:"Manage user accounts, permissions, and access control."})]}),e.jsxs(q,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx($,{xs:24,sm:8,children:e.jsx(T,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(fe,{title:"Total Users",value:a.length,prefix:e.jsx(te,{}),valueStyle:{color:"#1677ff"},loading:l})})}),e.jsx($,{xs:24,sm:8,children:e.jsx(T,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(fe,{title:"Active Users",value:pe.active,prefix:e.jsx(Ne,{}),valueStyle:{color:"#52c41a"},loading:l})})}),e.jsx($,{xs:24,sm:8,children:e.jsx(T,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsx(fe,{title:"Admin Users",value:G.admin,prefix:e.jsx(te,{}),valueStyle:{color:"#faad14"},loading:l})})})]}),e.jsx(T,{style:{marginBottom:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:e.jsxs(q,{gutter:[16,16],justify:"space-between",align:"middle",children:[e.jsx($,{xs:24,md:12,children:e.jsx(R,{placeholder:"Search users...",prefix:e.jsx($e,{style:{color:"rgba(0,0,0,.45)"}}),onChange:n=>v(n.target.value),allowClear:!0,size:"middle"})}),e.jsx($,{xs:24,md:12,style:{textAlign:"right"},children:e.jsxs(_,{wrap:!0,children:[e.jsx(M,{title:"Refresh data",children:e.jsx(k,{icon:l?e.jsx(ts,{}):e.jsx($e,{}),onClick:()=>r(L()),disabled:l,children:"Refresh"})}),e.jsx(k,{type:"primary",icon:e.jsx(ls,{}),onClick:me,children:"Add User"})]})})]})}),e.jsxs(T,{style:{borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.09)"},children:[e.jsxs(Ee,{defaultActiveKey:"all",onChange:x,tabBarStyle:{marginBottom:24},children:[e.jsx(we,{tab:`All Users (${a.length})`},"all"),e.jsx(we,{tab:`Active (${pe.active})`},"active"),e.jsx(we,{tab:`Inactive (${pe.inactive})`},"inactive")]}),e.jsx(Te,{columns:ge,dataSource:m,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(n,c)=>`${c[0]}-${c[1]} of ${n} users`},loading:l})]}),e.jsx(bs,{user:a.find(n=>n._id===(o==null?void 0:o._id))||null,visible:p,onClose:()=>r(Z(null))}),e.jsx(ws,{user:a.find(n=>n._id===(o==null?void 0:o._id))||null,visible:w,onClose:()=>r(Z(null)),onSuccess:()=>r(L())}),e.jsx(Cs,{visible:j,onClose:()=>h(!1),onSuccess:()=>r(L())})]})}const Os=Object.freeze(Object.defineProperty({__proto__:null,default:_s},Symbol.toStringTag,{value:"Module"}));export{Vs as S,zs as a,Os as b,le as f,Ds as i,Ns as r,Es as s,De as u};
