import{j as e,z as T,A as H,E as A,w as y}from"./index-DoSueJxk.js";import{R as $,X as P,m as q,u as F,l as O,k as R,r as x}from"./vendor-react-dkbxt9Jf.js";import{C as V}from"./FixtureForm-CZKRuS-V.js";import"./vendor-canvas-CSSoKFlf.js";import{K as f,ag as I,J as W,aF as S,S as b,c as p,R as _,W as U,a1 as X,aH as J,ah as K,aa as Y,aE as G}from"./vendor-antd-mFVHvrVJ.js";import{g as v}from"./url-DUULaBjX.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";import"./stallUtils-DlikgrX5.js";import"./stall-BMZvk0fo.js";const Q=({visible:m,hall:s,exhibitionWidth:o,exhibitionHeight:n,onCancel:t,onSubmit:a,onDelete:u})=>{const[l]=f.useForm();$.useEffect(()=>{m&&(s?l.setFieldsValue({name:s.name,width:s.dimensions.width,height:s.dimensions.height}):l.setFieldsValue({name:"",width:Math.min(10,o),height:Math.min(10,n)}))},[m,s,o,n,l]);const r=async()=>{const h=await l.validateFields(),c=s?{...s,_id:s._id,id:s.id||s._id,name:h.name,dimensions:{x:s.dimensions?.x||0,y:s.dimensions?.y||0,width:h.width,height:h.height},exhibitionId:s.exhibitionId}:{name:h.name,dimensions:{x:0,y:0,width:h.width,height:h.height}};a(c),l.resetFields()},j=()=>{s&&u&&I.confirm({title:"Delete Hall",content:`Are you sure you want to delete hall "${s.name}"? This action cannot be undone.`,okText:"Yes, Delete",cancelText:"No, Cancel",okButtonProps:{className:"confirm-delete-button"},centered:!0,onOk:()=>u(s)})};return e.jsx(I,{title:s?"Edit Hall":"Add New Hall",open:m,onCancel:()=>{l.resetFields(),t()},footer:null,width:400,destroyOnHidden:!0,className:"hall-form-modal",children:e.jsxs(f,{form:l,layout:"vertical",style:{marginTop:"16px"},children:[e.jsx(f.Item,{name:"name",label:e.jsxs("span",{style:{color:"#000"},children:["Hall Name ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter hall name"}],children:e.jsx(W,{placeholder:"Enter hall name"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(f.Item,{name:"width",label:e.jsxs("span",{style:{color:"#000"},children:["Width (meters) ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter width"},{type:"number",min:5,message:"Width must be at least 5 meters"},{type:"number",max:o,message:`Width cannot exceed ${o} meters`}],children:e.jsx(S,{min:5,max:o,style:{width:"100%"},placeholder:"Enter width"})}),e.jsx(f.Item,{name:"height",label:e.jsxs("span",{style:{color:"#000"},children:["Height (meters) ",e.jsx("span",{style:{color:"#ff4d4f"},children:"*"})]}),rules:[{required:!0,message:"Please enter height"},{type:"number",min:5,message:"Height must be at least 5 meters"},{type:"number",max:n,message:`Height cannot exceed ${n} meters`}],children:e.jsx(S,{min:5,max:n,style:{width:"100%"},placeholder:"Enter height"})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"32px",gap:"8px"},children:[e.jsx(b,{children:s&&u&&e.jsx(p,{className:"delete-button",icon:e.jsx(_,{}),onClick:j,children:"Delete Hall"})}),e.jsxs(b,{children:[e.jsx(p,{onClick:()=>{l.resetFields(),t()},children:"Cancel"}),e.jsx(p,{type:"primary",onClick:r,className:"update-button",children:s?"Update Hall":"Create Hall"})]})]})]})})},Z=({exhibitionId:m,destination:s="layout",label:o="Back to Layout"})=>{const n=F(),{currentExhibition:t}=R(a=>a.exhibition);return e.jsxs("div",{style:{marginBottom:"24px",position:"sticky",top:"16px",zIndex:10},children:[e.jsx(p,{icon:e.jsx(G,{}),onClick:()=>n(v(t,s),{state:{exhibitionId:m}}),type:"default",size:"large",style:{borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",background:"white",borderColor:"transparent",fontWeight:500,padding:"0 16px",height:"42px",display:"flex",alignItems:"center",transition:"all 0.3s ease"},className:"back-button-hover",children:e.jsx("span",{style:{marginLeft:8},children:o})}),e.jsx("style",{children:`
        .back-button-hover:hover {
          transform: translateX(-5px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: #f0f5ff;
          border-color: #d6e4ff;
        }
      `})]})},ce=()=>{const{id:m}=P(),s=q(),o=F(),n=O(),t=s.state?.exhibitionId||m,{currentExhibition:a,halls:u}=R(i=>i.exhibition),l=x.useRef(null),[r,j]=U.useMessage(),[h,c]=x.useState(!1),[C,w]=x.useState(null),[g,z]=x.useState({width:0,height:0});x.useEffect(()=>{const i=()=>{if(l.current){const{clientWidth:M,clientHeight:B}=l.current;z({width:Math.max(M||400,400),height:Math.max(B||400,400)})}};i();const d=new ResizeObserver(i);return l.current&&d.observe(l.current),window.addEventListener("resize",i),()=>{d.disconnect(),window.removeEventListener("resize",i)}},[]),x.useEffect(()=>{if(!t){r.error("Exhibition ID not found"),o("/exhibition");return}n(T(t))},[t,n,o,r]),x.useEffect(()=>{if(a){if(!a.dimensions?.width||!a.dimensions?.height){r.info("Please set up exhibition space first"),o(v(a,"space"),{state:{exhibitionId:t}});return}n(H(t))}},[a,t,n,o,r]);const k=()=>{w(null),c(!0)},N=i=>{w(i),c(!!i)},E=async i=>{try{i.id?(await y.updateHall(t,i.id,i),r.success("Hall updated successfully"),c(!1)):(await y.createHall(t,i),r.success("Hall created successfully"),c(!1)),n(H(t))}catch(d){console.error("Hall operation failed:",d),d.response?.status===409?r.warning({content:d.response.data.message,duration:6,style:{marginTop:"20vh"}}):(r.error(d.message||"Failed to save hall"),c(!1))}},D=async i=>{try{const d=i._id||i.id;if(!d)throw new Error("Hall ID is required");await y.deleteHall(t,d),r.success("Hall deleted successfully"),c(!1),w(null),n(H(t))}catch(d){console.error("Failed to delete hall:",d),r.error(d.response?.data?.message||"Failed to delete hall")}},L=async()=>{try{await y.saveLayout(t,u),r.success("Layout saved successfully")}catch{r.error("Failed to save layout")}};return e.jsxs("div",{style:{padding:"24px",height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(Z,{exhibitionId:t}),j,e.jsx(X,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(b,{children:[e.jsx("span",{children:"Hall Management"}),e.jsx(p,{icon:e.jsx(J,{}),onClick:()=>o(v(a,"space"),{state:{exhibitionId:t}}),children:"Back to Space Setup"})]}),e.jsxs(b,{children:[e.jsx(p,{type:"primary",icon:e.jsx(K,{}),onClick:k,children:"Add Hall"}),e.jsx(p,{type:"primary",icon:e.jsx(Y,{}),onClick:L,disabled:!u.length,children:"Save Layout"})]})]}),styles:{body:{flex:1,padding:0,overflow:"hidden",minHeight:"400px",position:"relative",background:"#fafafa"}},style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:"500px"},children:e.jsx("div",{ref:l,style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden"},children:e.jsx(A,{children:g.width>0&&g.height>0&&a?.dimensions&&e.jsx(V,{width:g.width,height:g.height,exhibitionWidth:a.dimensions.width,exhibitionHeight:a.dimensions.height,halls:u,selectedHall:C,onSelectHall:N,onHallChange:E,onAddHall:k})})})}),e.jsx(Q,{visible:h,hall:C,onCancel:()=>c(!1),onSubmit:E,onDelete:D,exhibitionWidth:a?.dimensions?.width||100,exhibitionHeight:a?.dimensions?.height||100})]})};export{ce as default};
