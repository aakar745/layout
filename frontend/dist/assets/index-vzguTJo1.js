import{D as v,K as R,j as s}from"./index-BP1I9PmK.js";import{u as we,j as ye,i as je,r as d,R as P}from"./vendor-react-BNeW3y6d.js";import{u as B,w as be}from"./vendor-export-CrAKd1if.js";/* empty css                  */import{a7 as $,a8 as c,S as Z,T as ve,c as G,aW as ee,a2 as N,I as Ce,b4 as Ae,a6 as Te,aH as I,bf as z,Z as Pe,ak as ke,b as Ee,V as te}from"./vendor-antd-DhcJxEc5.js";import"./vendor-utils-j652IAQy.js";import"./vendor-styling-BBrlYwaV.js";import"./vendor-canvas-BRbMLhVA.js";const{Title:Fe,Text:$e}=ve,{Option:b}=N,ze=()=>{var X;we();const j=ye(),{stalls:se,loading:ae,stallsPagination:_}=je(e=>e.exhibition),[D,ie]=d.useState([]),[f,L]=d.useState([]),[l,le]=d.useState(null),[i,W]=d.useState(null),[ne,k]=d.useState(!1),[K,C]=d.useState({totalStalls:0,totalArea:0}),[m,oe]=d.useState(""),[x,re]=d.useState(null),[g,de]=d.useState("number"),[p,ce]=d.useState("ascend"),[M,A]=d.useState(1),[w,he]=d.useState(10),J=P.useRef({statusFilter:x,sortField:g,sortOrder:p,pageSize:w});P.useEffect(()=>{J.current={statusFilter:x,sortField:g,sortOrder:p,pageSize:w}},[x,g,p,w]);const T=P.useCallback(async()=>{if(!l||!i){C({totalStalls:0,totalArea:0});return}try{const e={page:1,limit:1e4,search:m||void 0,status:x||void 0,sortBy:g,sortOrder:p==="ascend"?"asc":"desc"},a=(i==="all"?await v.getStalls(l,void 0,e):await v.getStalls(l,i,e)).data,h=a&&typeof a=="object"&&"stalls"in a?a.stalls:a,S=h.reduce((u,r)=>{var E,F;return(E=r==null?void 0:r.dimensions)!=null&&E.width&&((F=r==null?void 0:r.dimensions)!=null&&F.height)?u+r.dimensions.width*r.dimensions.height:u},0);C({totalStalls:h.length,totalArea:S})}catch(e){console.error("Failed to fetch total stats:",e),C({totalStalls:0,totalArea:0})}},[l,i,m,x,g,p]),H=P.useCallback(e=>{l&&i&&(j(R({exhibitionId:l,hallId:i==="all"?void 0:i,page:e.page||M,limit:e.size||w,search:e.search||void 0,status:e.status||void 0,sortBy:e.sortBy||g,sortOrder:e.sortOrder||(p==="ascend"?"asc":"desc")})),T())},[j,l,i,M,w,g,p,T]);P.useEffect(()=>{if(!l||!i)return;const e=setTimeout(()=>{if(l&&i){const t=J.current;j(R({exhibitionId:l,hallId:i==="all"?void 0:i,page:1,limit:t.pageSize,search:m||void 0,status:t.statusFilter||void 0,sortBy:t.sortField,sortOrder:t.sortOrder==="ascend"?"asc":"desc"})),A(1),T()}},500);return()=>clearTimeout(e)},[m,l,i,j,T]);const ue=e=>{re(e),A(1),H({page:1,search:m||void 0,status:e})},me=(e,t)=>{de(e),ce(t),A(1),H({page:1,search:m||void 0,status:x,sortBy:e,sortOrder:t==="ascend"?"asc":"desc"})},Q=(e,t)=>{A(e),t&&t!==w&&he(t),H({page:e,size:t||w,search:m||void 0,status:x})},U=async(e=!0)=>{var t,a;try{let o=q;if(e&&l&&i){const n={page:1,limit:1e4,search:m||void 0,status:x||void 0,sortBy:g,sortOrder:p==="ascend"?"asc":"desc"},y=(i==="all"?await v.getStalls(l,void 0,n):await v.getStalls(l,i,n)).data;o=y&&typeof y=="object"&&"stalls"in y?y.stalls:y}const h=o.map(n=>{var O,y;return{"Stall Number":n.number,Hall:((O=f.find(Y=>Y._id===n.hallId))==null?void 0:O.name)||"N/A","Stall Type":((y=n.stallType)==null?void 0:y.name)||"N/A","Dimensions (W×H)":`${n.dimensions.width}×${n.dimensions.height}`,"Area (sq.m)":n.dimensions.width*n.dimensions.height,"Rate per Sq.m":`₹${n.ratePerSqm.toLocaleString()}`,"Total Price":`₹${(n.ratePerSqm*n.dimensions.width*n.dimensions.height).toLocaleString()}`,Status:n.status.charAt(0).toUpperCase()+n.status.slice(1),"Position (X,Y)":`${n.dimensions.x},${n.dimensions.y}`,"Created Date":new Date(n.createdAt||Date.now()).toLocaleDateString()}}),S=B.book_new(),u=B.json_to_sheet(h),r=[{wch:15},{wch:20},{wch:15},{wch:15},{wch:12},{wch:15},{wch:18},{wch:12},{wch:15},{wch:15}];u["!cols"]=r,B.book_append_sheet(S,u,"Stalls");const E=((t=D.find(n=>n._id===l))==null?void 0:t.name)||"Exhibition",F=i==="all"?"All-Halls":((a=f.find(n=>n._id===i))==null?void 0:a.name)||"Hall",pe=new Date().toISOString().split("T")[0],fe=`${E}-${F}-Stalls-${pe}.xlsx`;be(S,fe),te.success(`Exported ${o.length} stalls to Excel successfully!`)}catch(o){console.error("Export failed:",o),te.error("Failed to export stalls. Please try again.")}},xe=e=>{le(e),W(null),j({type:"exhibition/clearStalls"}),C({totalStalls:0,totalArea:0})},Se=e=>{W(e),A(1),l&&e?(j(R({exhibitionId:l,hallId:e==="all"?void 0:e,page:1,limit:w,search:m||void 0,status:x||void 0,sortBy:g,sortOrder:p==="ascend"?"asc":"desc"})),T()):(j({type:"exhibition/clearStalls"}),C({totalStalls:0,totalArea:0}))};d.useEffect(()=>{(async()=>{try{k(!0),console.log("Fetching exhibitions...");const t=await v.getActiveExhibitions();console.log("Exhibitions response:",t.data),ie(t.data)}catch(t){console.error("Failed to fetch exhibitions:",t)}finally{k(!1)}})()},[]),d.useEffect(()=>{l?(async()=>{try{k(!0),console.log("Fetching halls for exhibition:",l);const t=await v.getHalls(l);console.log("Halls response:",t.data),L(t.data)}catch(t){console.error("Failed to fetch halls:",t)}finally{k(!1)}})():L([])},[l]);const q=se,ge=e=>{switch(e){case"available":return"success";case"booked":return"warning";case"reserved":return"processing";case"sold":return"error";default:return"default"}},V={totalStalls:K.totalStalls,totalSize:K.totalArea};return s.jsx("div",{className:"dashboard-container",children:s.jsx("div",{style:{marginBottom:"24px"},children:s.jsxs($,{gutter:[24,24],children:[s.jsx(c,{span:24,children:s.jsxs($,{justify:"space-between",align:"middle",children:[s.jsx(c,{children:s.jsxs(Z,{direction:"vertical",size:4,children:[s.jsx(Fe,{level:4,style:{margin:0},children:"Stalls"}),s.jsx($e,{type:"secondary",children:"Manage your exhibition stalls"})]})}),s.jsx(c,{children:s.jsxs(Z,{children:[s.jsx(G,{icon:s.jsx(ee,{}),onClick:()=>U(!1),disabled:!i||q.length===0,children:"Export Current Page"}),s.jsx(G,{type:"primary",icon:s.jsx(ee,{}),onClick:()=>U(!0),disabled:!i,children:"Export All Stalls"})]})})]})}),s.jsx(c,{span:24,children:s.jsxs($,{gutter:[16,16],align:"middle",children:[s.jsx(c,{xs:24,sm:12,md:6,children:s.jsx(N,{style:{width:"100%"},placeholder:"Select Exhibition",value:l,onChange:xe,allowClear:!0,children:D.map(e=>s.jsx(b,{value:e._id||e.id,children:e.name},e._id||e.id))})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsxs(N,{style:{width:"100%"},placeholder:"Select Hall",value:i,onChange:Se,disabled:!l||f.length===0,allowClear:!0,children:[s.jsxs(b,{value:"all",children:["All Halls (",f.length," halls)"]},"all-halls"),f.map(e=>s.jsx(b,{value:e._id||e.id,children:e.name},e._id||e.id))]})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsx(Ce,{placeholder:"Search by stall number",prefix:s.jsx(Ae,{}),value:m,onChange:e=>oe(e.target.value),allowClear:!0})}),s.jsx(c,{xs:24,sm:12,md:6,children:s.jsxs(N,{style:{width:"100%"},placeholder:"Filter by status",value:x,onChange:ue,allowClear:!0,children:[s.jsx(b,{value:"available",children:"Available"}),s.jsx(b,{value:"booked",children:"Booked"}),s.jsx(b,{value:"reserved",children:"Reserved"}),s.jsx(b,{value:"sold",children:"Sold"})]})})]})}),s.jsx(c,{span:24,children:s.jsx(Te,{size:"small",children:s.jsxs($,{gutter:16,children:[s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(I,{title:"Total Stalls",value:V.totalStalls,prefix:s.jsx(z,{})})}),s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(I,{title:"Total Area",value:V.totalSize,suffix:"sqm",prefix:s.jsx(Pe,{}),precision:2})}),i==="all"&&s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(I,{title:"Halls",value:f.length,prefix:s.jsx(z,{})})}),i!=="all"&&i&&s.jsx(c,{xs:12,sm:12,md:6,children:s.jsx(I,{title:"Current Hall",value:((X=f.find(e=>(e._id||e.id)===i))==null?void 0:X.name)||"N/A",prefix:s.jsx(z,{})})})]})})}),s.jsx(c,{span:24,children:s.jsx(ke,{columns:[{title:"Stall Number",dataIndex:"number",key:"number",sorter:(e,t)=>e.number.localeCompare(t.number),defaultSortOrder:"ascend"},...i==="all"?[{title:"Hall",key:"hall",render:(e,t)=>{const a=f.find(o=>(o._id||o.id)===t.hallId);return(a==null?void 0:a.name)||"N/A"}}]:[],{title:"Type",dataIndex:["stallType","name"],key:"type",render:(e,t)=>{var a;return((a=t.stallType)==null?void 0:a.name)||"N/A"}},{title:"Rate (per sqm)",dataIndex:"ratePerSqm",key:"ratePerSqm",render:e=>e?`₹${e.toLocaleString()}`:"N/A",sorter:(e,t)=>(e.ratePerSqm||0)-(t.ratePerSqm||0)},{title:"Area (sqm)",key:"area",render:(e,t)=>{var a,o;return(a=t==null?void 0:t.dimensions)!=null&&a.width&&((o=t==null?void 0:t.dimensions)!=null&&o.height)?`${t.dimensions.width*t.dimensions.height} sqm`:"N/A"},sorter:(e,t)=>{var h,S,u,r;const a=(((h=e.dimensions)==null?void 0:h.width)||0)*(((S=e.dimensions)==null?void 0:S.height)||0),o=(((u=t.dimensions)==null?void 0:u.width)||0)*(((r=t.dimensions)==null?void 0:r.height)||0);return a-o}},{title:"Dimensions",key:"dimensions",render:(e,t)=>{var a,o;return(a=t==null?void 0:t.dimensions)!=null&&a.width&&((o=t==null?void 0:t.dimensions)!=null&&o.height)?`${t.dimensions.width}m × ${t.dimensions.height}m`:"N/A"}},{title:"Total Price",key:"totalPrice",render:(e,t)=>{var a,o;return(a=t==null?void 0:t.dimensions)!=null&&a.width&&((o=t==null?void 0:t.dimensions)!=null&&o.height)&&t.ratePerSqm?`₹${(t.ratePerSqm*t.dimensions.width*t.dimensions.height).toLocaleString()}`:"N/A"},sorter:(e,t)=>{var h,S,u,r;const a=(e.ratePerSqm||0)*(((h=e.dimensions)==null?void 0:h.width)||0)*(((S=e.dimensions)==null?void 0:S.height)||0),o=(t.ratePerSqm||0)*(((u=t.dimensions)==null?void 0:u.width)||0)*(((r=t.dimensions)==null?void 0:r.height)||0);return a-o}},{title:"Status",dataIndex:"status",key:"status",render:e=>s.jsx(Ee,{color:ge(e),style:{textTransform:"capitalize"},children:e||"N/A"}),filters:[{text:"Available",value:"available"},{text:"Booked",value:"booked"},{text:"Reserved",value:"reserved"},{text:"Sold",value:"sold"}],onFilter:(e,t)=>t.status===e}],dataSource:q,rowKey:e=>e._id||e.id,loading:ne||ae,pagination:{current:_.currentPage,pageSize:_.pageSize,total:_.totalCount,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} stalls`,onChange:Q,onShowSizeChange:Q,pageSizeOptions:["10","25","50","100"]},onChange:(e,t,a)=>{a.field&&a.order&&me(a.field,a.order)}})})]})})})};export{ze as default};
