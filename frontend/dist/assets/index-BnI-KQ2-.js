import{j as e,n as o,o as ne,N as oe,p as r,q as re}from"./index-aoH9EzMk.js";import{Z as m,R as ce,ab as R,T as G,a1 as le,a9 as b,aa as f,aH as T,D as de,i as j,aQ as fe,S as p,ah as he,u as ue,aX as me,r as n,bR as d,k as pe,f as xe,q as ge,s as je,j as ye,w as $,B as Ee,Y as Ne,bq as Se,L as we,E as Te,t as Ie}from"./vendor-Be5M1UDi.js";import"./apis-CU9I9MMq.js";import"./canvas-C-A9eff5.js";const{Title:ke,Text:I,Paragraph:g}=G,Re=({settings:h,onSave:i,loading:c})=>{const[x]=m.useForm();ce.useEffect(()=>{x.setFieldsValue(h)},[h,x]);const A=y=>{i(y)};return e.jsxs(R,{title:e.jsxs(p,{children:[e.jsx(he,{}),e.jsx("span",{children:"Email Notifications"})]}),style:{marginBottom:24},children:[e.jsx(g,{children:"Configure which notifications you want to receive via email. Email notifications will be sent to your registered email address."}),e.jsx(le,{message:"Email Notifications",description:"Email notifications help you stay updated even when you're not logged into the system.",type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsxs(m,{form:x,layout:"vertical",initialValues:h,onFinish:A,children:[e.jsxs(b,{gutter:[24,16],children:[e.jsxs(f,{span:24,children:[e.jsx(m.Item,{name:"newLeads",valuePropName:"checked",label:e.jsx(I,{strong:!0,children:"New Lead Notifications"}),children:e.jsx(T,{})}),e.jsx(g,{type:"secondary",style:{marginTop:-16,marginBottom:16},children:"Receive email when new leads are created or assigned to you"})]}),e.jsxs(f,{span:24,children:[e.jsx(m.Item,{name:"followUpReminders",valuePropName:"checked",label:e.jsx(I,{strong:!0,children:"Follow-up Reminders"}),children:e.jsx(T,{})}),e.jsx(g,{type:"secondary",style:{marginTop:-16,marginBottom:16},children:"Receive reminders for upcoming follow-ups"})]}),e.jsxs(f,{span:24,children:[e.jsx(m.Item,{name:"statusChanges",valuePropName:"checked",label:e.jsx(I,{strong:!0,children:"Status Change Notifications"}),children:e.jsx(T,{})}),e.jsx(g,{type:"secondary",style:{marginTop:-16,marginBottom:16},children:"Receive notifications when lead statuses are updated"})]}),e.jsxs(f,{span:24,children:[e.jsx(m.Item,{name:"leadAssignments",valuePropName:"checked",label:e.jsx(I,{strong:!0,children:"Lead Assignment Notifications"}),children:e.jsx(T,{})}),e.jsx(g,{type:"secondary",style:{marginTop:-16,marginBottom:16},children:"Receive notifications when leads are assigned to you"})]})]}),e.jsx(de,{}),e.jsx(m.Item,{children:e.jsx(j,{type:"primary",htmlType:"submit",icon:e.jsx(fe,{}),loading:c,children:"Save Email Preferences"})})]})]})},_=h=>{switch(h){case"NEW_BOOKING":return r.NEW_BOOKING;case"BOOKING_CONFIRMED":return r.BOOKING_CONFIRMED;case"BOOKING_CANCELLED":return r.BOOKING_CANCELLED;case"PAYMENT_RECEIVED":return r.PAYMENT_RECEIVED;case"INVOICE_GENERATED":return r.INVOICE_GENERATED;case"EXHIBITION_UPDATE":return r.EXHIBITION_UPDATE;case"SYSTEM_MESSAGE":return r.SYSTEM_MESSAGE;case"EXHIBITOR_MESSAGE":return r.EXHIBITOR_MESSAGE;case"EXHIBITOR_REGISTERED":return r.EXHIBITOR_REGISTERED;default:return r.SYSTEM_MESSAGE}},{Title:Ae,Text:Be,Paragraph:D}=G,{Search:Le}=Ne,{TabPane:M}=$,Oe=()=>{const h=ue();me();const[i,c]=n.useState([]),[x,A]=n.useState([]),[y,C]=n.useState(!1),[E,k]=n.useState(""),[N,K]=n.useState("ALL"),[S,H]=n.useState("ALL"),[U,V]=n.useState({newLeads:!0,followUpReminders:!0,statusChanges:!1,leadAssignments:!0}),[X,B]=n.useState(!1),[L,O]=n.useState("all");n.useEffect(()=>{const s=localStorage.getItem("token");s&&o.init(s,!1),w(),o.subscribeToNotifications();const a=u=>{const v={...u,type:_(u.type)};c(l=>l.some(P=>P._id===u._id)?l:[v,...l])},F=u=>{if(u.newNotifications&&u.newNotifications.length>0){const v=u.newNotifications.map(l=>({...l,type:_(l.type)}));c(l=>[...v.filter(ie=>!l.some(ae=>ae._id===ie._id)),...l])}};return o.addEventListener("notification",a),o.addEventListener("notification_update",F),()=>{o.removeEventListener("notification",a),o.removeEventListener("notification_update",F)}},[]),n.useEffect(()=>{Y()},[i,E,N,S,L]),n.useEffect(()=>{w();const t=()=>{i.length===0&&w()};return window.addEventListener("focus",t),()=>{window.removeEventListener("focus",t)}},[i.length]);const w=async()=>{C(!0);try{const t=await o.getNotifications(1,50);if(t.success){const s=t.data.notifications.map(a=>({...a,type:_(a.type)}));c(s)}}catch{d.error({message:"Failed to fetch notifications",description:"There was an error loading your notifications. Please try again later."})}finally{C(!1)}},Y=()=>{let t=i;if(L==="unread"&&(t=t.filter(s=>s.isRead===!1)),E){const s=E.toLowerCase();t=t.filter(a=>a.title.toLowerCase().includes(s)||a.message.toLowerCase().includes(s))}N!=="ALL"&&(t=t.filter(s=>s.type===N)),S!=="ALL"&&(t=t.filter(s=>s.source===S)),A(t)},q=t=>{O(t)},z=t=>{k(t)},W=()=>{k(""),K("ALL"),H("ALL"),O("all")},Q=t=>{const s=re(t);h(s)},Z=async t=>{try{await o.markAsRead(t._id);const s=i.map(a=>a._id===t._id?{...a,isRead:!0,readAt:new Date().toISOString()}:a);c(s)}catch{d.error({message:"Failed to mark notification as read",description:"There was an error updating the notification status. Please try again later."})}},J=async t=>{try{await o.deleteNotification(t._id);const s=i.filter(a=>a._id!==t._id);c(s),d.success({message:"Notification deleted",description:"The notification has been deleted successfully."})}catch{d.error({message:"Failed to delete notification",description:"There was an error deleting the notification. Please try again later."})}},ee=async()=>{try{await o.markAllAsRead();const t=i.map(s=>({...s,isRead:!0,readAt:new Date().toISOString()}));c(t),d.success({message:"All notifications marked as read",description:"All notifications have been marked as read successfully."})}catch{d.error({message:"Failed to mark all notifications as read",description:"There was an error updating the notification status. Please try again later."})}},te=async()=>{try{await o.deleteAllNotifications(),c([]),d.success({message:"All notifications cleared",description:"All notifications have been deleted successfully."})}catch{d.error({message:"Failed to clear notifications",description:"There was an error deleting the notifications. Please try again later."})}},se=t=>{B(!0),setTimeout(()=>{V(t),B(!1),d.success({message:"Settings saved",description:"Your email notification settings have been updated successfully."})},1e3)};return e.jsx("div",{className:"notifications-page",children:e.jsxs(b,{gutter:[24,24],children:[e.jsx(f,{xs:24,children:e.jsx(R,{children:e.jsxs(b,{justify:"space-between",align:"middle",children:[e.jsxs(f,{children:[e.jsx(Ae,{level:4,children:e.jsxs(p,{children:[e.jsx(pe,{}),"Notifications ",i.length>0?`(${i.length})`:""]})}),e.jsx(D,{children:"Stay updated with all your lead activities and follow-ups"})]}),e.jsx(f,{children:e.jsxs(p,{children:[e.jsx(xe,{title:"Refresh notifications",children:e.jsx(j,{icon:e.jsx(ge,{}),onClick:w,loading:y,children:"Refresh"})}),e.jsx(j,{type:"primary",icon:e.jsx(je,{}),onClick:ee,disabled:i.filter(t=>!t.isRead).length===0,children:"Mark All as Read"}),e.jsx(j,{type:"primary",danger:!0,icon:e.jsx(ye,{}),onClick:te,disabled:i.length===0,children:"Clear All"})]})})]})})}),e.jsx(f,{xs:24,lg:16,children:e.jsxs(R,{className:"notifications-list-card",style:{marginBottom:24},children:[e.jsxs($,{activeKey:L,onChange:q,tabBarExtraContent:e.jsx(p,{children:e.jsx(Ee,{count:ne(i),offset:[-5,0],children:e.jsx("span",{style:{padding:"0 8px"},children:"Unread"})})}),children:[e.jsx(M,{tab:"All Notifications"},"all"),e.jsx(M,{tab:"Unread"},"unread")]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx(Le,{placeholder:"Search notifications...",onSearch:z,style:{width:300},allowClear:!0}),e.jsx(p,{children:e.jsx(j,{icon:e.jsx(Se,{}),onClick:W,disabled:E===""&&N==="ALL"&&S==="ALL",children:"Reset Filters"})})]}),e.jsx(we,{dataSource:x,renderItem:t=>e.jsx(oe,{notification:t,onView:Q,onMarkAsRead:Z,onDelete:J}),pagination:{pageSize:10,showTotal:(t,s)=>`${s[0]}-${s[1]} of ${t} notifications`},rowKey:"_id",loading:y,locale:{emptyText:e.jsx(Te,{description:e.jsx("span",{children:"No notifications found"})})}})]})}),e.jsxs(f,{xs:24,lg:8,children:[e.jsx(Re,{settings:U,onSave:se,loading:X}),e.jsx(R,{title:e.jsxs(p,{children:[e.jsx(Ie,{}),e.jsx("span",{children:"Notification Tips"})]}),children:e.jsx(D,{children:e.jsxs("ul",{children:[e.jsx("li",{children:"Notifications help you stay informed about important lead activities"}),e.jsx("li",{children:"Use email notifications for critical updates when you're away"}),e.jsx("li",{children:"Click on a notification to see more details or take action"}),e.jsx("li",{children:"Mark notifications as read to keep your inbox organized"})]})})})]})]})})};export{Oe as default};
