import{j as e}from"./index-BRKtYmDF.js";import{r as h,u as Ne}from"./vendor-react-BNeW3y6d.js";import{N as g,X as l,T as Re,S as N,K as V,bb as ze,c as m,bd as Pe,b0 as ee,l as De,R as F,a5 as H,a6 as f,a7 as y,aL as S,C as te,a_ as Ee,x as Le,h as $e,am as Me,aw as Be,a4 as T,bf as Fe,Z as G,n as se,d as j,b as C,aq as re,az as He,bv as Ge,p as Ue,bh as Ye,aR as Oe,b6 as Ve}from"./vendor-antd-Dz3j4xaK.js";/* empty css                       */import"./vendor-utils-CsjRLf7T.js";import"./vendor-styling-BEMjND7I.js";import"./vendor-canvas-BRbMLhVA.js";const{RangePicker:We}=Fe,{Option:x}=T,{Title:_e,Text:o}=Re,{TabPane:ne}=se,R=18,w=I=>Math.round(I*R/(100+R)),U=I=>I-w(I),tt=()=>{const[I,ae]=h.useState([]),[d,ie]=h.useState(null),[oe,W]=h.useState(!1),[b,k]=h.useState({current:1,pageSize:10,total:0}),[u,Y]=h.useState({}),[le,ce]=h.useState([]),[n,z]=h.useState(null),[de,O]=h.useState(!1),[pe,P]=h.useState(!1),[xe,D]=h.useState(!1),[he,E]=h.useState(!1),[me,L]=h.useState(!1),[_,$]=h.useState(!1),ge=Ne(),[q]=g.useForm();h.useEffect(()=>{ue()},[]),h.useEffect(()=>{M(),B()},[b.current,b.pageSize,u]);const ue=async()=>{try{const t=await fetch("/api/exhibitions",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const r=await t.json();ce(r.data||[])}}catch(t){console.error("Error fetching exhibitions:",t)}},M=async()=>{W(!0);try{const t={page:b.current.toString(),limit:b.pageSize.toString()};Object.entries(u).forEach(([c,i])=>{i!==void 0&&c!=="dateRange"&&(t[c]=String(i))}),u.dateRange&&(t.startDate=u.dateRange[0].toISOString(),t.endDate=u.dateRange[1].toISOString());const r=new URLSearchParams(t),a=await fetch(`/api/service-charges?${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const c=await a.json();ae(c.data||[]),k(i=>{var p;return{...i,total:((p=c.pagination)==null?void 0:p.total)||0}})}else l.error("Failed to fetch service charges")}catch(t){console.error("Error fetching service charges:",t),l.error("Error fetching service charges")}finally{W(!1)}},B=async()=>{var t;try{const r={period:"all"};Object.entries(u).forEach(([i,p])=>{p!==void 0&&i!=="dateRange"&&(r[i]=String(p))});const a=new URLSearchParams(r),c=await fetch(`/api/service-charges/stats?${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(c.ok){const i=await c.json();ie(((t=i.data)==null?void 0:t.overview)||null)}}catch(r){console.error("Error fetching stats:",r)}},fe=async t=>{if(n)try{(await fetch(`/api/service-charges/${n._id}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)})).ok?(l.success("Status updated successfully"),P(!1),M(),B()):l.error("Failed to update status")}catch(r){console.error("Error updating status:",r),l.error("Error updating status")}},je=async()=>{try{l.loading("Preparing export...",0);const t={export:"true",limit:"10000"};Object.entries(u).forEach(([c,i])=>{i!==void 0&&c!=="dateRange"&&(t[c]=String(i))}),u.dateRange&&(t.startDate=u.dateRange[0].toISOString(),t.endDate=u.dateRange[1].toISOString());const r=new URLSearchParams(t),a=await fetch(`/api/service-charges?${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(l.destroy(),a.ok){const i=(await a.json()).data||[];if(i.length===0){l.warning("No data to export");return}const p=["Receipt Number","Vendor Name","Company Name","Exhibitor Company","Mobile","Uploaded Image","Stall Number","Stall Area (sqm)","Base Amount (‚Çπ) - Excl. GST","GST Amount (‚Çπ) - 18%","Total Amount (‚Çπ) - Incl. GST","Payment Status","Status","Created Date","Created Time","Paid Date","Paid Time","Admin Notes"],Ie=i.map(s=>{const v=U(s.amount),Ae=w(s.amount);return[s.receiptNumber,s.vendorName,s.companyName,s.exhibitorCompanyName||"",s.vendorPhone,s.uploadedImage?s.uploadedImage.toLowerCase().includes("heic")?`HEIC Image (converted): ${s.uploadedImage}`:`Image: ${s.uploadedImage}`:"No image",s.stallNumber||"",s.stallArea||"",v,Ae,s.amount,s.paymentStatus.toUpperCase(),s.status.toUpperCase(),j(s.createdAt).format("DD/MM/YYYY"),j(s.createdAt).format("HH:mm:ss"),s.paidAt?j(s.paidAt).format("DD/MM/YYYY"):"",s.paidAt?j(s.paidAt).format("HH:mm:ss"):"",s.adminNotes||""]}),Z=s=>{const v=String(s||"");return v.includes(",")||v.includes('"')||v.includes(`
`)?`"${v.replace(/"/g,'""')}"`:v},Ce=[p.map(Z).join(","),...Ie.map(s=>s.map(Z).join(","))].join(`
`),Te="\uFEFF",ke=new Blob([Te+Ce],{type:"text/csv;charset=utf-8;"}),Q=window.URL.createObjectURL(ke),A=document.createElement("a");A.style.display="none",A.href=Q,A.download=`service-charges-${j().format("YYYY-MM-DD-HHmm")}.csv`,document.body.appendChild(A),A.click(),window.URL.revokeObjectURL(Q),l.success(`Export completed! ${i.length} records exported.`)}else l.error("Failed to export data")}catch(t){console.error("Error exporting data:",t),l.destroy(),l.error("Error exporting data")}},J=async(t,r)=>{try{l.loading({content:"Preparing receipt for download...",key:"receipt-download"});const a=await fetch(`/api/service-charges/${t}/receipt`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const c=await a.blob(),i=window.URL.createObjectURL(c),p=document.createElement("a");p.style.display="none",p.href=i,p.download=`Receipt-${r||t}.pdf`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(i),l.success({content:"Receipt downloaded successfully",key:"receipt-download"})}else{const c=await a.text();let i="Failed to download receipt";a.status===404?i="Receipt not found or not yet generated":a.status===403&&(i="Access denied - insufficient permissions"),l.error({content:i,key:"receipt-download"})}}catch(a){console.error("Error downloading receipt:",a),l.error({content:"Network error - please try again",key:"receipt-download"})}},ye=async()=>{if(n){$(!0);try{const t=await fetch(`/api/service-charges/${n._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok)l.success("Service charge deleted successfully"),E(!1),z(null),M(),B();else{const r=await t.json();l.error(r.message||"Failed to delete service charge")}}catch(t){console.error("Error deleting service charge:",t),l.error("Error deleting service charge")}finally{$(!1)}}},Se=async()=>{$(!0);try{const t=await fetch("/api/service-charges",{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const r=await t.json();l.success(r.message||"All service charges deleted successfully"),L(!1),M(),B()}else{const r=await t.json();l.error(r.message||"Failed to delete service charges")}}catch(t){console.error("Error deleting all service charges:",t),l.error("Error deleting service charges")}finally{$(!1)}},K=t=>{switch(t){case"paid":case"completed":return"green";case"pending":case"submitted":return"orange";case"cancelled":case"failed":return"red";default:return"default"}},X=t=>{switch(t){case"paid":return"green";case"pending":return"orange";case"failed":return"red";case"refunded":return"purple";default:return"default"}},be=[{key:"view",label:"View Details",icon:e.jsx(Oe,{})},{key:"status",label:"Update Status",icon:e.jsx(Ve,{})},{key:"receipt",label:"Download Receipt",icon:e.jsx(te,{})},{type:"divider"},{key:"delete",label:"Delete",icon:e.jsx(F,{}),danger:!0}],ve=(t,r)=>{switch(t){case"view":z(r),O(!0);break;case"status":z(r),P(!0),q.setFieldsValue({status:r.status,adminNotes:r.adminNotes});break;case"receipt":J(r._id,r.receiptNumber);break;case"delete":z(r),E(!0);break}},we=[{title:"Receipt #",dataIndex:"receiptNumber",key:"receiptNumber",width:140,fixed:"left",render:t=>e.jsx(o,{strong:!0,copyable:!0,style:{fontSize:"15px"},children:t})},{title:"Vendor Details",key:"vendor",width:180,render:t=>e.jsxs("div",{style:{lineHeight:"1.3"},children:[e.jsx("div",{children:e.jsx(o,{strong:!0,style:{fontSize:"13px"},children:t.vendorName})}),e.jsx("div",{children:e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:t.companyName})})]})},{title:"Exhibitor Company",key:"exhibitorCompany",width:160,render:t=>e.jsx("div",{style:{lineHeight:"1.3"},children:t.exhibitorCompanyName?e.jsx(o,{strong:!0,style:{fontSize:"13px",color:"#1890ff"},children:t.exhibitorCompanyName}):e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:"-"})})},{title:"Image",key:"uploadedImage",width:80,align:"center",render:t=>{if(!t.uploadedImage)return e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:"No image"});const r=`/api/public/uploads/${t.uploadedImage}`,a=t.uploadedImage.toLowerCase().includes("heic");return e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("img",{src:r,alt:"Service charge attachment",className:"service-charge-image",style:{width:"50px",height:"50px",objectFit:"cover",borderRadius:"4px",border:"1px solid #d9d9d9"},onClick:()=>{window.open(r,"_blank")},onError:c=>{const p=c.target.parentElement;p&&(p.innerHTML='<div class="service-charge-image-error">‚ùå</div>')},onLoad:c=>{const i=c.target;i.style.border="1px solid #52c41a"},title:a?"Originally HEIC, converted to JPEG - Click to view full size":"Click to view full size"})})}},{title:"Mobile",dataIndex:"vendorPhone",key:"mobile",width:120,align:"center",render:t=>e.jsx(o,{style:{fontSize:"15px",fontFamily:"monospace"},children:t})},{title:"Stall No.",dataIndex:"stallNumber",key:"stallNumber",width:100,align:"center",render:t=>e.jsx(C,{color:"blue",style:{fontSize:"13px",margin:0},children:t})},{title:"Stall Area",dataIndex:"stallArea",key:"stallArea",width:100,align:"center",render:t=>t?e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(o,{strong:!0,style:{fontSize:"13px",color:"#52c41a"},children:[t," sqm"]}),e.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:t<=50?"Small":"Large"})]}):e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:"-"})},{title:"Transaction ID",key:"transactionId",width:160,align:"center",render:t=>t.phonePeTransactionId&&t.paymentStatus==="paid"?e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsx(o,{copyable:!0,style:{fontSize:"12px",fontFamily:"monospace",color:"#52c41a",fontWeight:500},title:"PhonePe Transaction ID - Click to copy",children:t.phonePeTransactionId}),e.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:"PhonePe TXN"})]}):t.phonePeMerchantTransactionId?e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsx(o,{copyable:!0,style:{fontSize:"12px",fontFamily:"monospace",color:"#1890ff",fontWeight:500},title:"Merchant Transaction ID - Click to copy",children:t.phonePeMerchantTransactionId}),e.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:"Merchant ID"})]}):e.jsx(o,{type:"secondary",style:{fontSize:"12px"},children:"-"})},{title:"Base Amount",dataIndex:"amount",key:"baseAmount",width:110,align:"center",render:t=>{const r=U(t);return e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(o,{strong:!0,style:{fontSize:"13px",color:"#1890ff"},children:["‚Çπ",r.toLocaleString("en-IN")]}),e.jsx("div",{style:{fontSize:"9px",color:"#666",marginTop:"2px"},children:"(Excl. GST)"})]})}},{title:"GST Amount",dataIndex:"amount",key:"gstAmount",width:100,align:"center",render:t=>{const r=w(t);return e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(o,{strong:!0,style:{fontSize:"13px",color:"#f5222d"},children:["‚Çπ",r.toLocaleString("en-IN")]}),e.jsxs("div",{style:{fontSize:"9px",color:"#666",marginTop:"2px"},children:["(",R,"% GST)"]})]})}},{title:"Total Amount",dataIndex:"amount",key:"totalAmount",width:110,align:"center",render:t=>e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsxs(o,{strong:!0,style:{fontSize:"15px",color:"#52c41a"},children:["‚Çπ",t.toLocaleString("en-IN")]}),e.jsx("div",{style:{fontSize:"9px",color:"#666",marginTop:"2px"},children:"(Incl. GST)"})]})},{title:"Payment Status",dataIndex:"paymentStatus",key:"paymentStatus",width:120,align:"center",render:t=>e.jsx(C,{color:X(t),style:{fontSize:"13px",fontWeight:600,margin:0},children:t.toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:110,align:"center",render:t=>e.jsx(C,{color:K(t),style:{fontSize:"13px",fontWeight:600,margin:0},children:t.toUpperCase()})},{title:"Date",dataIndex:"createdAt",key:"date",width:100,align:"center",render:t=>e.jsx("div",{style:{lineHeight:"1.2"},children:e.jsxs("div",{style:{fontSize:"13px",fontWeight:500},children:[e.jsx(He,{style:{marginRight:4,color:"#1890ff"}}),j(t).format("DD/MM/YY")]})})},{title:"Time",dataIndex:"createdAt",key:"time",width:90,align:"center",render:t=>e.jsxs("div",{style:{fontSize:"13px",color:"#666"},children:[e.jsx(Ge,{style:{marginRight:4}}),j(t).format("HH:mm")]})},{title:"Paid At",dataIndex:"paidAt",key:"paidAt",width:100,align:"center",render:(t,r)=>!t||r.paymentStatus!=="paid"?e.jsx(o,{type:"secondary",style:{fontSize:"13px"},children:"-"}):e.jsxs("div",{style:{lineHeight:"1.2"},children:[e.jsx("div",{style:{fontSize:"13px",color:"#52c41a",fontWeight:500},children:j(t).format("DD/MM/YY")}),e.jsx("div",{style:{fontSize:"10px",color:"#52c41a"},children:j(t).format("HH:mm")})]})},{title:"Actions",key:"actions",width:100,align:"center",fixed:"right",render:t=>e.jsx(Ue,{menu:{items:be,onClick:({key:r})=>ve(r,t)},trigger:["click"],placement:"bottomRight",children:e.jsx(m,{type:"text",size:"small",icon:e.jsx(Ye,{}),style:{padding:"4px 8px",borderRadius:"6px",border:"1px solid #d9d9d9",backgroundColor:"#fafafa"}})})}];return e.jsxs("div",{className:"service-charges-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(_e,{level:2,children:"Service Charges"}),e.jsxs(N,{children:[e.jsx(V,{placeholder:"Search by receipt, vendor, company, mobile, stall no.",prefix:e.jsx(ze,{}),style:{width:350},value:u.search||"",onChange:t=>{const r=t.target.value;Y(a=>({...a,search:r})),k(a=>({...a,current:1}))},allowClear:!0}),e.jsx(m,{icon:e.jsx(Pe,{}),onClick:()=>D(!0),children:"Filters"}),e.jsx(m,{icon:e.jsx(ee,{}),onClick:je,type:"primary",children:"Export"}),e.jsx(m,{icon:e.jsx(De,{}),onClick:()=>ge("/service-charges/settings"),children:"Settings"}),e.jsx(m,{icon:e.jsx(F,{}),onClick:()=>L(!0),danger:!0,disabled:!d||d.totalCharges===0,children:"Delete All"})]})]}),d&&e.jsxs(H,{gutter:16,className:"stats-row",children:[e.jsx(f,{span:4,children:e.jsx(y,{children:e.jsx(S,{title:"Total Charges",value:d.totalCharges,prefix:e.jsx(te,{})})})}),e.jsx(f,{span:5,children:e.jsxs(y,{children:[e.jsx(S,{title:"Total Amount",value:d.totalAmount,prefix:e.jsx(Ee,{}),formatter:t=>`‚Çπ${t==null?void 0:t.toLocaleString("en-IN")}`}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Inclusive of GST)"})]})}),e.jsx(f,{span:5,children:e.jsxs(y,{children:[e.jsx(S,{title:"Total GST",value:d.totalGSTAmount||w(d.totalAmount||0),prefix:e.jsx("span",{style:{color:"#f5222d"},children:"üìä"}),formatter:t=>`‚Çπ${t==null?void 0:t.toLocaleString("en-IN")}`,valueStyle:{color:"#f5222d"}}),e.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:["(",R,"% GST Amount)"]})]})}),e.jsx(f,{span:5,children:e.jsxs(y,{children:[e.jsx(S,{title:"Paid Amount",value:d.paidAmount,prefix:e.jsx(Le,{}),formatter:t=>`‚Çπ${t==null?void 0:t.toLocaleString("en-IN")}`,valueStyle:{color:"#3f8600"}}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Inclusive of GST)"})]})}),e.jsx(f,{span:5,children:e.jsxs(y,{children:[e.jsx(S,{title:"Pending Amount",value:d.pendingAmount,prefix:e.jsx($e,{}),formatter:t=>`‚Çπ${t==null?void 0:t.toLocaleString("en-IN")}`,valueStyle:{color:"#cf1322"}}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Inclusive of GST)"})]})})]}),d&&e.jsxs(H,{gutter:16,className:"stats-row",style:{marginTop:"16px"},children:[e.jsx(f,{span:8,children:e.jsxs(y,{style:{background:"linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%)",border:"1px solid #91d5ff"},children:[e.jsx(S,{title:"Total Base Amount",value:U(d.totalAmount||0),prefix:e.jsx("span",{style:{color:"#1890ff"},children:"üí∞"}),formatter:t=>`‚Çπ${t==null?void 0:t.toLocaleString("en-IN")}`,valueStyle:{color:"#1890ff"}}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Exclusive of GST)"})]})}),e.jsx(f,{span:8,children:e.jsxs(y,{style:{background:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",border:"1px solid #b7eb8f"},children:[e.jsx(S,{title:"Paid GST Amount",value:w(d.paidAmount||0),prefix:e.jsx("span",{style:{color:"#52c41a"},children:"‚úÖ"}),formatter:t=>`‚Çπ${t==null?void 0:t.toLocaleString("en-IN")}`,valueStyle:{color:"#52c41a"}}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Collected GST)"})]})}),e.jsx(f,{span:8,children:e.jsxs(y,{style:{background:"linear-gradient(135deg, #fff2e8 0%, #ffd8bf 100%)",border:"1px solid #ffbb96"},children:[e.jsx(S,{title:"Pending GST Amount",value:w(d.pendingAmount||0),prefix:e.jsx("span",{style:{color:"#fa8c16"},children:"‚è≥"}),formatter:t=>`‚Çπ${t==null?void 0:t.toLocaleString("en-IN")}`,valueStyle:{color:"#fa8c16"}}),e.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:"(Pending GST)"})]})})]}),e.jsx(y,{className:"service-charges-table-card",children:e.jsx(Me,{columns:we,dataSource:I,rowKey:"_id",loading:oe,pagination:{current:b.current,pageSize:b.pageSize,total:b.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,r)=>`${r[0]}-${r[1]} of ${t} items`,pageSizeOptions:["10","20","50","100"],onChange:(t,r)=>{k(a=>({...a,current:t,pageSize:r||10}))}},scroll:{x:1560,y:"calc(100vh - 380px)"},size:"middle",bordered:!0,className:"modern-table",rowClassName:(t,r)=>r%2===0?"table-row-light":"table-row-dark"})}),e.jsx(Be,{title:"Filters",placement:"right",open:xe,onClose:()=>D(!1),width:400,children:e.jsxs(g,{layout:"vertical",onFinish:t=>{Y(t),D(!1),k(r=>({...r,current:1}))},initialValues:u,children:[e.jsx(g.Item,{name:"exhibitionId",label:"Exhibition",children:e.jsx(T,{placeholder:"Select exhibition",allowClear:!0,children:le.map(t=>e.jsx(x,{value:t._id,children:t.name},t._id))})}),e.jsx(g.Item,{name:"paymentStatus",label:"Payment Status",children:e.jsxs(T,{placeholder:"Select payment status",allowClear:!0,children:[e.jsx(x,{value:"pending",children:"Pending"}),e.jsx(x,{value:"paid",children:"Paid"}),e.jsx(x,{value:"failed",children:"Failed"}),e.jsx(x,{value:"refunded",children:"Refunded"})]})}),e.jsx(g.Item,{name:"status",label:"Status",children:e.jsxs(T,{placeholder:"Select status",allowClear:!0,children:[e.jsx(x,{value:"submitted",children:"Submitted"}),e.jsx(x,{value:"paid",children:"Paid"}),e.jsx(x,{value:"completed",children:"Completed"}),e.jsx(x,{value:"cancelled",children:"Cancelled"})]})}),e.jsx(g.Item,{name:"serviceType",label:"Service Type",children:e.jsxs(T,{placeholder:"Select service type",allowClear:!0,children:[e.jsx(x,{value:"positioning",children:"Positioning"}),e.jsx(x,{value:"setup",children:"Setup"}),e.jsx(x,{value:"maintenance",children:"Maintenance"}),e.jsx(x,{value:"other",children:"Other"})]})}),e.jsx(g.Item,{name:"search",label:"Search",children:e.jsx(V,{placeholder:"Search by receipt, vendor, company, mobile, stall no."})}),e.jsx(g.Item,{name:"dateRange",label:"Date Range",children:e.jsx(We,{style:{width:"100%"}})}),e.jsx(g.Item,{children:e.jsxs(N,{children:[e.jsx(m,{type:"primary",htmlType:"submit",children:"Apply Filters"}),e.jsx(m,{onClick:()=>{Y({}),D(!1),k(t=>({...t,current:1}))},children:"Clear"})]})})]})}),e.jsx(G,{title:"Update Status",open:pe,onCancel:()=>P(!1),footer:null,children:e.jsxs(g,{form:q,layout:"vertical",onFinish:fe,children:[e.jsx(g.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select a status"}],children:e.jsxs(T,{children:[e.jsx(x,{value:"submitted",children:"Submitted"}),e.jsx(x,{value:"paid",children:"Paid"}),e.jsx(x,{value:"completed",children:"Completed"}),e.jsx(x,{value:"cancelled",children:"Cancelled"})]})}),e.jsx(g.Item,{name:"adminNotes",label:"Admin Notes",children:e.jsx(V.TextArea,{rows:4,placeholder:"Add notes..."})}),e.jsx(g.Item,{children:e.jsxs(N,{children:[e.jsx(m,{type:"primary",htmlType:"submit",children:"Update Status"}),e.jsx(m,{onClick:()=>P(!1),children:"Cancel"})]})})]})}),e.jsx(G,{title:"Service Charge Details",open:de,onCancel:()=>O(!1),footer:[e.jsx(m,{onClick:()=>O(!1),children:"Close"},"close"),e.jsx(m,{type:"primary",icon:e.jsx(ee,{}),onClick:()=>n&&J(n._id,n.receiptNumber),disabled:!(n!=null&&n.receiptGenerated),children:n!=null&&n.receiptGenerated?"Download Receipt":"Receipt Not Available"},"download")],width:800,children:n&&e.jsx("div",{className:"service-charge-details",children:e.jsxs(se,{children:[e.jsx(ne,{tab:"Basic Info",children:e.jsxs(H,{gutter:24,children:[e.jsxs(f,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Receipt Number:"})," ",n.receiptNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vendor Name:"})," ",n.vendorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," ",n.companyName]}),n.exhibitorCompanyName&&e.jsxs("p",{children:[e.jsx("strong",{children:"Exhibitor Company:"})," ",e.jsx("span",{style:{color:"#1890ff"},children:n.exhibitorCompanyName})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",n.vendorPhone]}),n.stallNumber&&e.jsxs("p",{children:[e.jsx("strong",{children:"Stall Number:"})," ",n.stallNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Exhibition:"})," ",n.exhibitionId.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Venue:"})," ",n.exhibitionId.venue]})]}),e.jsxs(f,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Service Type:"})," ",n.serviceType]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("p",{style:{marginBottom:"8px"},children:e.jsx("strong",{children:"Amount Breakdown:"})}),e.jsxs("div",{style:{background:"#f9f9f9",padding:"12px",borderRadius:"6px",border:"1px solid #e8e8e8"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Base Amount:"}),e.jsxs("span",{style:{color:"#1890ff",fontWeight:"bold"},children:["‚Çπ",U(n.amount).toLocaleString("en-IN")]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsxs("span",{children:["GST (",R,"%):"]}),e.jsxs("span",{style:{color:"#f5222d",fontWeight:"bold"},children:["‚Çπ",w(n.amount).toLocaleString("en-IN")]})]}),e.jsx("div",{style:{borderTop:"1px solid #d9d9d9",paddingTop:"4px",marginTop:"4px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Total Amount:"}),e.jsxs("span",{style:{color:"#52c41a",fontWeight:"bold",fontSize:"16px"},children:["‚Çπ",n.amount.toLocaleString("en-IN")]})]})})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",j(n.createdAt).format("DD/MM/YYYY HH:mm")]}),n.paidAt&&e.jsxs("p",{children:[e.jsx("strong",{children:"Paid At:"})," ",j(n.paidAt).format("DD/MM/YYYY HH:mm")]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Uploaded Image:"})}),n.uploadedImage?e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsx("img",{src:`/api/public/uploads/${n.uploadedImage}`,alt:"Service charge attachment",className:"service-charge-image-preview",style:{maxWidth:"250px",maxHeight:"250px",objectFit:"contain",border:"1px solid #d9d9d9",borderRadius:"6px",cursor:"pointer",display:"block",transition:"all 0.2s ease-in-out"},onClick:()=>{window.open(`/api/public/uploads/${n.uploadedImage}`,"_blank")},onError:t=>{const a=t.target.parentElement;a&&(a.innerHTML=`
                                  <div style="
                                    color: #ff4d4f; 
                                    padding: 20px; 
                                    border: 1px dashed #ff4d4f; 
                                    border-radius: 6px; 
                                    text-align: center;
                                    background-color: #fff2f0;
                                    font-size: 14px;
                                  ">
                                    ‚ùå Image could not be loaded<br/>
                                    <small style="font-size: 12px; opacity: 0.8;">File may have been moved or deleted</small>
                                  </div>
                                `)},onLoad:t=>{const r=t.target;r.style.border="1px solid #52c41a"},onMouseEnter:t=>{const r=t.target;r.style.transform="scale(1.02)",r.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},onMouseLeave:t=>{const r=t.target;r.style.transform="scale(1)",r.style.boxShadow="none"}}),e.jsxs(o,{type:"secondary",style:{fontSize:"12px",display:"block",marginTop:"8px",textAlign:"center"},children:["üì± Click to view full size",n.uploadedImage.toLowerCase().includes("heic")&&e.jsx("span",{style:{color:"#1890ff",marginLeft:"8px"},children:"(Originally HEIC, converted to JPEG)"})]})]}):e.jsx("div",{style:{padding:"20px",border:"1px dashed #d9d9d9",borderRadius:"4px",textAlign:"center",color:"#999",backgroundColor:"#fafafa"},children:"üì∑ No image uploaded"})]})]})]})},"basic"),e.jsxs(ne,{tab:"Status",children:[e.jsxs(H,{gutter:16,children:[e.jsxs(f,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Status:"}),e.jsx(C,{color:X(n.paymentStatus),style:{marginLeft:8},children:n.paymentStatus.toUpperCase()})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"}),e.jsx(C,{color:K(n.status),style:{marginLeft:8},children:n.status.toUpperCase()})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Receipt Generated:"}),e.jsx(C,{color:n.receiptGenerated?"green":"orange",style:{marginLeft:8},children:n.receiptGenerated?"Yes":"No"})]})]}),e.jsx(f,{span:12,children:e.jsxs("div",{style:{border:"1px solid #e8e8e8",borderRadius:"6px",padding:"12px",backgroundColor:"#fafafa"},children:[e.jsx("p",{style:{fontWeight:600,marginBottom:"8px",color:"#1890ff",fontSize:"14px"},children:"üìä Transaction Details"}),n.phonePeTransactionId?e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx(o,{strong:!0,style:{fontSize:"12px"},children:"PhonePe Transaction ID:"}),e.jsx("br",{}),e.jsx(o,{copyable:!0,style:{fontFamily:"monospace",fontSize:"11px",color:"#52c41a",fontWeight:500,padding:"2px 4px",backgroundColor:"#f0f9f0",borderRadius:"3px"},children:n.phonePeTransactionId})]}):null,n.phonePeMerchantTransactionId?e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx(o,{strong:!0,style:{fontSize:"12px"},children:"Merchant Transaction ID:"}),e.jsx("br",{}),e.jsx(o,{copyable:!0,style:{fontFamily:"monospace",fontSize:"11px",color:"#1890ff",fontWeight:500,padding:"2px 4px",backgroundColor:"#f0f7ff",borderRadius:"3px"},children:n.phonePeMerchantTransactionId})]}):null,n.phonePeOrderId?e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx(o,{strong:!0,style:{fontSize:"12px"},children:"PhonePe Order ID:"}),e.jsx("br",{}),e.jsx(o,{copyable:!0,style:{fontFamily:"monospace",fontSize:"11px",color:"#722ed1",fontWeight:500,padding:"2px 4px",backgroundColor:"#f9f0ff",borderRadius:"3px"},children:n.phonePeOrderId})]}):null,!n.phonePeTransactionId&&!n.phonePeMerchantTransactionId&&!n.phonePeOrderId?e.jsx(o,{type:"secondary",style:{fontSize:"12px",fontStyle:"italic"},children:"No transaction IDs available yet"}):null]})})]}),n.adminNotes&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Admin Notes:"})}),e.jsx("p",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"4px"},children:n.adminNotes})]})]},"status")]})})}),e.jsx(G,{title:"Delete Service Charge",open:he,onCancel:()=>E(!1),footer:null,width:500,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(re,{style:{fontSize:"48px",color:"#ff4d4f",marginBottom:"20px"}}),e.jsx("h3",{style:{marginBottom:"16px"},children:"Are you sure you want to delete this service charge?"}),n&&e.jsxs("div",{style:{backgroundColor:"#f5f5f5",padding:"16px",borderRadius:"8px",marginBottom:"20px",textAlign:"left"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Receipt Number:"})," ",n.receiptNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vendor:"})," ",n.vendorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," ",n.companyName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ‚Çπ",n.amount.toLocaleString("en-IN")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",n.status]})]}),e.jsxs("div",{style:{color:"#ff4d4f",marginBottom:"20px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"‚ö†Ô∏è Warning:"})}),e.jsx("p",{children:"This action cannot be undone. The service charge record and associated receipt will be permanently deleted."})]}),e.jsxs(N,{children:[e.jsx(m,{onClick:()=>E(!1),children:"Cancel"}),e.jsx(m,{type:"primary",danger:!0,loading:_,onClick:ye,icon:e.jsx(F,{}),children:"Delete Service Charge"})]})]})}),e.jsx(G,{title:"Delete All Service Charges",open:me,onCancel:()=>L(!1),footer:null,width:600,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(re,{style:{fontSize:"48px",color:"#ff4d4f",marginBottom:"20px"}}),e.jsx("h3",{style:{marginBottom:"16px"},children:"Are you sure you want to delete ALL service charges?"}),d&&e.jsxs("div",{style:{backgroundColor:"#fff2f0",border:"1px solid #ffccc7",padding:"16px",borderRadius:"8px",marginBottom:"20px",textAlign:"left"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total Service Charges:"})," ",d.totalCharges]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Amount:"})," ‚Çπ",d.totalAmount.toLocaleString("en-IN")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Paid Amount:"})," ‚Çπ",d.paidAmount.toLocaleString("en-IN")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pending Amount:"})," ‚Çπ",d.pendingAmount.toLocaleString("en-IN")]})]}),e.jsxs("div",{style:{color:"#ff4d4f",marginBottom:"20px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"üö® DANGER ZONE:"})}),e.jsx("p",{children:"This action cannot be undone. ALL service charge records and associated receipts will be permanently deleted."}),e.jsx("p",{children:"This includes both paid and pending service charges."})]}),e.jsxs(N,{children:[e.jsx(m,{onClick:()=>L(!1),children:"Cancel"}),e.jsx(m,{type:"primary",danger:!0,loading:_,onClick:Se,icon:e.jsx(F,{}),children:"Delete All Service Charges"})]})]})})]})};export{tt as default};
