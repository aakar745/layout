import{v as w,w as N,j as e,x as te}from"./index-DoSueJxk.js";import{u as be,l as ve,k as Se,r as d}from"./vendor-react-dkbxt9Jf.js";import{g as se,a as we}from"./url-DUULaBjX.js";import{Y as Ce,$ as A,a0 as h,S as x,T as ke,c,ah as De,a1 as m,aq as C,C as ie,x as T,h as H,av as le,J as Ee,ar as Pe,ab as z,aw as Re,ax as Ae,ai as W,R as I,ag as _,d as O,a as B,U as Te,j as ze,at as U,aj as ae,p as Ie,ay as _e,b as f,az as Be,au as Me}from"./vendor-antd-mFVHvrVJ.js";/* empty css                  */import{u as $e}from"./reduxHooks-Be1Cl4uN.js";import"./vendor-utils-ngrFHoWO.js";import"./vendor-styling-CQa69cNz.js";const{Title:Fe,Text:y}=ke,{RangePicker:Le}=Re,qe=()=>{const{message:g,modal:V}=Ce.useApp(),M=be(),u=ve(),{exhibitions:o,loading:ne}=Se(t=>t.exhibition),[p,K]=d.useState([]),[q,k]=d.useState(!1),[b,D]=d.useState(!1),[$,J]=d.useState({current:1,pageSize:10,total:0}),[r,E]=d.useState({status:[],dateRange:null,search:"",activeStatus:null}),[P,oe]=d.useState("all"),[F,re]=d.useState({}),[G,Q]=d.useState(!1),{hasPermission:L}=$e();d.useEffect(()=>{u(w())},[u]),d.useEffect(()=>{o.length>0&&X()},[o]);const X=async()=>{if(o.length!==0)try{Q(!0);const t=o.map(async a=>{try{const i=a._id||a.id,n=await N.getExhibitionProgress(i);return{id:i,data:n}}catch(i){return console.warn(`Failed to load progress for exhibition ${a.name}:`,i),{id:a._id||a.id,data:null}}}),l=(await Promise.all(t)).reduce((a,{id:i,data:n})=>(a[i]=n,a),{});re(l)}catch(t){console.error("Failed to load progress data:",t)}finally{Q(!1)}},de=()=>{X()};d.useEffect(()=>{J(t=>({...t,total:ee.length}))},[o,r,P]);const v=d.useMemo(()=>{const t=o.length,s=o.filter(n=>n.status==="published").length,l=o.filter(n=>new Date(n.startDate)>new Date).length,a=o.filter(n=>n.status==="completed").length,i=o.filter(n=>n.isActive).length;return{total:t,active:s,upcoming:l,completed:a,activeCount:i}},[o]),ce=async t=>{const s=t._id||t.id;try{k(!0),await u(te(s)).unwrap(),g.success("Exhibition deleted successfully")}catch(l){g.error(l.message||"Failed to delete exhibition")}finally{k(!1)}},Z=async()=>{V.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(I,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Selected Exhibitions"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete ",e.jsxs("strong",{children:[p.length," selected exhibitions"]}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data for these exhibitions."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(c,{onClick:()=>_.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(c,{danger:!0,type:"primary",onClick:async()=>{try{k(!0),await Promise.all(p.map(t=>u(te(t._id||t.id)).unwrap())),g.success(`Successfully deleted ${p.length} exhibitions`),K([])}catch(t){g.error(t.message||"Failed to delete some exhibitions")}finally{k(!1),_.destroyAll()}},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete All"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},Y=async(t,s)=>{try{D(!0);const l=t._id||t.id;await N.updateExhibition(l,{status:s});const a=o.map(i=>(i._id||i.id)===l?{...i,status:s}:i);u(w.fulfilled(a,"",void 0)),g.success("Status updated successfully")}catch{g.error("Failed to update status"),u(w())}finally{D(!1)}},xe=async(t,s)=>{try{D(!0);const l=t._id||t.id;await N.updateExhibition(l,{isActive:s});const a=o.map(i=>(i._id||i.id)===l?{...i,isActive:s}:i);u(w.fulfilled(a,"",void 0)),g.success(`Exhibition ${s?"activated":"deactivated"} successfully`)}catch{g.error("Failed to update active status"),u(w())}finally{D(!1)}},j=(t,s)=>{const l=t._id||t.id;s==="/layout"?M(se(t,"layout"),{state:{exhibitionId:l}}):M(se(t)+s,{state:{exhibitionId:l}})},pe=t=>{switch(t.toLowerCase()){case"published":return"#52c41a";case"draft":return"#faad14";case"completed":return"#1890ff";default:return"#d9d9d9"}},he=(t,s)=>{const l=pe(t);return e.jsxs(x,{size:4,style:{display:"inline-flex",alignItems:"center"},children:[e.jsx(f,{color:l,style:{textTransform:"capitalize",minWidth:"80px",textAlign:"center",margin:0},children:t}),!s&&e.jsx(f,{color:"red",style:{margin:0},children:"Inactive"})]})},ge=t=>{const s=t._id||t.id,l=F[s];if(l?.progress?.combinedProgress!==void 0)return l.progress.combinedProgress;if(l?.progress?.stallBookingProgress!==void 0)return l.progress.stallBookingProgress;if(t.progress?.combinedProgress!==void 0)return t.progress.combinedProgress;if(t.progress?.stallBookingProgress!==void 0)return t.progress.stallBookingProgress;const a=new Date,i=new Date(t.startDate),n=new Date(t.endDate);if(a<i)return 0;if(a>n)return 100;const R=n.getTime()-i.getTime(),S=a.getTime()-i.getTime();return Math.round(S/R*100)},ue=t=>{V.confirm({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#101828",padding:"20px 24px",borderBottom:"1px solid #EAECF0"},children:[e.jsx(I,{style:{color:"#F04438",fontSize:"22px"}}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,lineHeight:"28px"},children:"Delete Exhibition"})]}),content:e.jsxs("div",{style:{padding:"20px 24px",color:"#475467"},children:[e.jsxs("p",{style:{fontSize:"14px",lineHeight:"20px",marginBottom:"8px"},children:["Are you sure you want to delete ",e.jsx("strong",{children:t.name}),"?"]}),e.jsx("p",{style:{color:"#667085",fontSize:"14px",lineHeight:"20px",marginBottom:0},children:"This action cannot be undone and will permanently delete all associated data."})]}),footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 24px",borderTop:"1px solid #EAECF0",marginTop:0},children:[e.jsx(c,{onClick:()=>_.destroyAll(),style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"1px solid #D0D5DD",color:"#344054",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Cancel"}),e.jsx(c,{danger:!0,type:"primary",onClick:()=>{ce(t),_.destroyAll()},style:{height:"40px",padding:"10px 18px",borderRadius:"8px",border:"none",backgroundColor:"#D92D20",color:"white",fontWeight:500,fontSize:"14px",lineHeight:"20px",display:"flex",alignItems:"center",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)"},children:"Delete"})]}),centered:!0,icon:null,width:400,closable:!0,maskClosable:!0,className:"delete-confirmation-modal",styles:{mask:{backgroundColor:"rgba(52, 64, 84, 0.7)"},content:{padding:0,borderRadius:"12px",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.05), 0px 12px 16px -4px rgba(16, 24, 40, 0.1)"},body:{padding:0},footer:{display:"none"}}})},me=t=>[{key:"view",label:"View Details",icon:e.jsx(U,{}),onClick:()=>j(t,"")},{key:"edit",label:"Edit Exhibition",icon:e.jsx(ae,{}),onClick:()=>j(t,"/edit")},{key:"layout",label:"Manage Layout",icon:e.jsx(Be,{}),onClick:()=>j(t,"/layout")},{type:"divider"},...t.status==="published"?[{key:"public-view",label:"Public View",icon:e.jsx(U,{}),onClick:()=>window.open(we(t),"_blank")},{type:"divider"}]:[],{key:"status",label:"Change Status",icon:e.jsx(Me,{}),children:[{key:"draft",label:e.jsxs(x,{children:[e.jsx(f,{color:"#faad14",style:{margin:0},children:"Draft"}),e.jsx("span",{children:"Set as Draft"})]}),icon:e.jsx(ie,{}),onClick:()=>Y(t,"draft"),disabled:t.status==="draft"||b},{key:"published",label:e.jsxs(x,{children:[e.jsx(f,{color:"#52c41a",style:{margin:0},children:"Published"}),e.jsx("span",{children:"Publish"})]}),icon:e.jsx(T,{}),onClick:()=>Y(t,"published"),disabled:t.status==="published"||b},{key:"completed",label:e.jsxs(x,{children:[e.jsx(f,{color:"#1890ff",style:{margin:0},children:"Completed"}),e.jsx("span",{children:"Mark as Completed"})]}),icon:e.jsx(H,{}),onClick:()=>Y(t,"completed"),disabled:t.status==="completed"||b}]},{key:"active-status",label:e.jsxs(x,{children:[t.isActive?e.jsx(f,{color:"red",style:{margin:0},children:"Deactivate"}):e.jsx(f,{color:"#52c41a",style:{margin:0},children:"Activate"}),e.jsx("span",{children:t.isActive?"Deactivate":"Activate"})]}),icon:e.jsx(le,{}),onClick:()=>xe(t,!t.isActive),disabled:b},{type:"divider"},{key:"delete",label:"Delete",icon:e.jsx(I,{}),danger:!0,onClick:()=>ue(t)}],ee=d.useMemo(()=>o.filter(t=>{if(r.search&&!t.name.toLowerCase().includes(r.search.toLowerCase())||r.status.length>0&&!r.status.includes(t.status)||r.activeStatus!==null&&t.isActive!==r.activeStatus)return!1;if(r.dateRange){const[s,l]=r.dateRange,a=new Date(t.startDate),i=new Date(t.endDate);if(a<new Date(s)||i>new Date(l))return!1}switch(P){case"active":return t.status==="published";case"upcoming":return new Date(t.startDate)>new Date;case"completed":return t.status==="completed";default:return!0}}),[o,r,P]),fe=[{title:"Exhibition Details",key:"details",render:(t,s)=>e.jsx(y,{strong:!0,style:{fontSize:"16px",cursor:"pointer"},onClick:()=>j(s,""),children:s.name})},{title:"Status",key:"status",width:180,align:"center",render:(t,s)=>he(s.status,s.isActive),filters:[{text:"Draft",value:"draft"},{text:"Published",value:"published"},{text:"Completed",value:"completed"}],onFilter:(t,s)=>s.status===t},{title:"Start Date",key:"startDate",width:130,render:(t,s)=>e.jsx(y,{children:O(s.startDate).format("MMM D, YYYY")})},{title:"End Date",key:"endDate",width:130,render:(t,s)=>e.jsx(y,{children:O(s.endDate).format("MMM D, YYYY")})},{title:"Create Date",key:"createdAt",width:130,render:(t,s)=>e.jsx(y,{children:O(s.createdAt).format("MMM D, YYYY")})},{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{children:"Progress"}),e.jsx(B,{title:"Refresh all progress data",children:e.jsx(c,{type:"text",size:"small",icon:e.jsx(ze,{}),loading:G,onClick:de,style:{padding:"2px"}})})]}),key:"progress",width:250,render:(t,s)=>{const l=ge(s),a=s._id||s.id,i=F[a]?.stats,n=F[a]?.progress;let R="active",S="#1890ff";s.status==="completed"?(R="success",S="#52c41a"):l===100&&(S="#faad14");const ye=i?e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("strong",{children:"Real-time Stall Booking:"})}),e.jsxs("div",{children:["• Total Stalls: ",i.totalStalls]}),e.jsxs("div",{children:["• Booked Stalls: ",i.bookedStalls]}),e.jsxs("div",{children:["• Available Stalls: ",i.availableStalls]}),e.jsxs("div",{children:["• Booking Rate: ",i.bookingRate,"%"]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:"8px"},children:e.jsx("strong",{children:"Progress Breakdown:"})}),e.jsxs("div",{children:["• Stall Booking: ",n.stallBookingProgress,"%"]}),e.jsxs("div",{children:["• Timeline: ",n.timeProgress,"%"]}),e.jsxs("div",{children:["• Combined: ",n.combinedProgress,"%"]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{children:["Progress: ",l,"%"]}),e.jsx("div",{children:"Based on timeline calculation"}),e.jsx("div",{style:{color:"#faad14",marginTop:"4px"},children:"⚠️ Real-time data not available"})]});return e.jsxs("div",{children:[e.jsx(B,{title:ye,placement:"topLeft",children:e.jsx(Te,{percent:l,size:"small",status:R,strokeColor:S,format:je=>`${je}%`})}),i?e.jsxs("div",{style:{fontSize:"12px",color:"#52c41a",marginTop:"4px"},children:[e.jsx(T,{style:{marginRight:"4px"}}),i.bookedStalls,"/",i.totalStalls," stalls booked"]}):e.jsxs("div",{style:{fontSize:"12px",color:"#faad14",marginTop:"4px"},children:[e.jsx(H,{style:{marginRight:"4px"}}),"Timeline-based progress"]})]})}},{title:"Actions",key:"actions",width:150,fixed:"right",render:(t,s)=>e.jsxs(x,{size:"middle",children:[L("exhibitions_view")&&e.jsx(B,{title:"View Details",children:e.jsx(c,{type:"text",icon:e.jsx(U,{}),onClick:()=>j(s,"")})}),L("exhibitions_edit")&&e.jsx(B,{title:"Edit Exhibition",children:e.jsx(c,{type:"text",icon:e.jsx(ae,{}),onClick:()=>j(s,"/edit")})}),L("exhibitions_delete")&&e.jsx(Ie,{menu:{items:me(s)},trigger:["click"],placement:"bottomRight",children:e.jsx(c,{type:"text",icon:e.jsx(_e,{})})})]})}];return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(A,{gutter:[24,24],align:"middle",children:[e.jsx(h,{flex:"auto",children:e.jsxs(x,{direction:"vertical",size:4,children:[e.jsx(Fe,{level:4,style:{margin:0},children:"Exhibitions"}),e.jsx(y,{type:"secondary",children:"Manage your exhibition spaces and layouts"})]})}),e.jsx(h,{children:e.jsx(c,{type:"primary",icon:e.jsx(De,{}),onClick:()=>M("/exhibition/create"),size:"large",children:"Create Exhibition"})})]})}),e.jsxs(A,{gutter:[24,24],style:{marginBottom:"24px"},children:[e.jsx(h,{xs:24,sm:12,md:6,lg:4,children:e.jsx(m,{children:e.jsx(C,{title:"Total Exhibitions",value:v.total,prefix:e.jsx(ie,{})})})}),e.jsx(h,{xs:24,sm:12,md:6,lg:5,children:e.jsx(m,{children:e.jsx(C,{title:"Published Exhibitions",value:v.active,prefix:e.jsx(T,{style:{color:"#52c41a"}})})})}),e.jsx(h,{xs:24,sm:12,md:6,lg:5,children:e.jsx(m,{children:e.jsx(C,{title:"Upcoming Exhibitions",value:v.upcoming,prefix:e.jsx(H,{style:{color:"#1890ff"}})})})}),e.jsx(h,{xs:24,sm:12,md:6,lg:5,children:e.jsx(m,{children:e.jsx(C,{title:"Completed Exhibitions",value:v.completed,prefix:e.jsx(T,{style:{color:"#8c8c8c"}})})})}),e.jsx(h,{xs:24,sm:12,md:6,lg:5,children:e.jsx(m,{children:e.jsx(C,{title:"Active Status",value:v.activeCount,prefix:e.jsx(le,{style:{color:"#52c41a"}})})})})]}),e.jsx(m,{className:"info-card",style:{marginBottom:"16px"},styles:{body:{padding:"20px"}},children:e.jsxs(x,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(A,{gutter:[16,16],align:"middle",children:[e.jsx(h,{flex:"auto",children:e.jsxs(x,{size:"middle",wrap:!0,children:[e.jsx(Ee,{placeholder:"Search exhibitions",prefix:e.jsx(Pe,{style:{color:"#8c8c8c"}}),style:{width:"250px"},value:r.search,onChange:t=>E(s=>({...s,search:t.target.value})),allowClear:!0}),e.jsx(z,{mode:"multiple",placeholder:"Filter by status",style:{minWidth:"200px"},value:r.status,onChange:t=>E(s=>({...s,status:t})),options:[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Completed",value:"completed"}]}),e.jsxs(z,{placeholder:"Active Status",style:{width:"150px"},value:r.activeStatus,onChange:t=>E(s=>({...s,activeStatus:t})),allowClear:!0,children:[e.jsx(z.Option,{value:!0,children:"Active"}),e.jsx(z.Option,{value:!1,children:"Inactive"})]}),e.jsx(Le,{onChange:t=>E(s=>({...s,dateRange:t?[t[0]?.toISOString()||"",t[1]?.toISOString()||""]:null}))})]})}),e.jsx(h,{children:e.jsx(Ae,{options:[{label:"All",value:"all"},{label:"Active",value:"active"},{label:"Upcoming",value:"upcoming"},{label:"Completed",value:"completed"}],value:P,onChange:t=>oe(t)})})]}),p.length>0&&e.jsx(A,{children:e.jsxs(x,{children:[e.jsxs(y,{children:["Selected ",p.length," items"]}),e.jsx(c,{danger:!0,onClick:Z,children:"Delete Selected"})]})})]})}),e.jsx(m,{className:"info-card",styles:{body:{padding:0}},children:e.jsx(W,{columns:fe,dataSource:ee.map(t=>({...t,key:t._id||t.id})),rowKey:t=>t._id||t.id,loading:ne||q||b||G,rowSelection:{selectedRowKeys:p.map(t=>t._id||t.id),onChange:(t,s)=>K(s),selections:[W.SELECTION_ALL,W.SELECTION_NONE]},footer:()=>p.length>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[e.jsxs(y,{children:["Selected ",e.jsx("strong",{children:p.length})," ",p.length===1?"exhibition":"exhibitions"]}),e.jsx(c,{danger:!0,onClick:Z,icon:e.jsx(I,{}),loading:q,children:"Delete Selected"})]}),scroll:{x:1500},pagination:{current:$.current,pageSize:$.pageSize,total:$.total,showSizeChanger:!0,showTotal:t=>`Total ${t} items`,style:{marginTop:"16px"},onChange:(t,s)=>{J(l=>({...l,current:t,pageSize:s}))}}})})]})};export{qe as default};
